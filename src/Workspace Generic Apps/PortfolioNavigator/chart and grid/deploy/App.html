<!DOCTYPE html>
<html>
<head>
    <title>Portfolio Chart And Grid</title>

    <script type="text/javascript" src="/apps/2.0rc3/sdk.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.1/q.js"></script>
    <script type="text/javascript" src="https://code.highcharts.com/highcharts.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelRallyApp",{alias:"widget.intelrallyapp",extend:"Rally.app.App",_TrainConfigPrefName:"intel-train-config",_projectFields:["ObjectID","Releases","Children","Parent","Name","TeamMembers"],_portfolioItemFields:["Name","ObjectID","FormattedID","c_TeamCommits","c_MoSCoW","Release","c_Risks","Project","PlannedEndDate","Parent","Children","PortfolioItemType","Ordinal"],_userStoryFields:["Name","ObjectID","Release","Project","PortfolioItem","PlannedEndDate","ActualEndDate","FormattedID","Predecessors","Successors","c_Dependencies","Iteration","PlanEstimate"],_releaseFields:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project","TeamMembers"],_loadScheduleStates:function(){var me=this,deferred=Q.defer();return Rally.data.ModelFactory.getModel({type:"UserStory",success:function(model){model.getField("ScheduleState").getAllowedValueStore().load({callback:function(records,operation,success){me.ScheduleStates=_.map(records,function(r){return r.data.StringValue}),deferred.resolve()}})}}),deferred.promise},_loadPortfolioItemStatesForEachType:function(){var me=this;return me.PortfolioItemTypeStates=[],Q.all(_.map(me.PortfolioItemTypes,function(portfolioType,ordinal){var store=Ext.create("Rally.data.wsapi.Store",{model:"State",autoLoad:!1,limit:1/0,disableMetaChangeEvent:!0,fetch:["Name","Enabled","OrderIndex"],filters:[{property:"TypeDef.Name",value:portfolioType},{property:"Enabled",value:!0}]});return me._reloadStore(store).then(function(store){me.PortfolioItemTypeStates[ordinal]=store.getRange()})}))},_loadPortfolioItemTypes:function(){var me=this,deferred=Q.defer(),store=Ext.create("Rally.data.wsapi.Store",{model:"TypeDefinition",autoLoad:!0,limit:1/0,disableMetaChangeEvent:!0,fetch:["Ordinal","Name"],filters:[{property:"Parent.Name",value:"Portfolio Item"},{property:"Creatable",value:!0}],listeners:{load:function(portfolioTypeStore){me.PortfolioItemTypes=_.map(_.sortBy(_.map(portfolioTypeStore.getRange(),function(item){return{Name:item.data.Name,Ordinal:item.data.Ordinal}}),function(item){return item.Ordinal}),function(item){return item.Name}),deferred.resolve()}}});return deferred.promise},_loadModels:function(){var me=this,promises=[],models={Project:"Project",UserStory:"HierarchicalRequirement",PortfolioItem:"PortfolioItem"};return _.each(me.PortfolioItemTypes,function(name){models[name]="PortfolioItem/"+name}),_.each(models,function(modelType,modelName){var deferred=Q.defer();Rally.data.WsapiModelFactory.getModel({type:modelType,success:function(loadedModel){me[modelName]=loadedModel,deferred.resolve()}}),promises.push(deferred.promise)}),Q.all(promises)},_loadTrainConfig:function(){var me=this,deferred=Q.defer();return Rally.data.PreferenceManager.load({workspace:me.getContext().getWorkspace()._ref,filterByName:me._TrainConfigPrefName,success:function(prefs){var workspaceConfigString=prefs[me._TrainConfigPrefName],trainConfig;try{trainConfig=JSON.parse(workspaceConfigString)}catch(e){trainConfig=[]}me.TrainConfig=trainConfig,deferred.resolve()},failure:deferred.reject}),deferred.promise},_saveTrainConfig:function(trainConfig){var me=this,s={},deferred=Q.defer();return s[me._TrainConfigPrefName]=JSON.stringify(trainConfig),Rally.data.PreferenceManager.update({workspace:me.getContext().getWorkspace()._ref,filterByName:me._TrainConfigPrefName,settings:s,success:deferred.resolve,failure:deferred.reject}),deferred.promise},_configureIntelRallyApp:function(){var me=this;return Q.all([me._loadPortfolioItemTypes().then(function(){return Q.all([me._loadModels(),me._loadPortfolioItemStatesForEachType()])}),me._loadTrainConfig(),me._loadScheduleStates()])},_reloadStore:function(store){var deferred=Q.defer();return store.load({callback:function(records,operation,success){success?deferred.resolve(store):deferred.reject(operation.getError()||"Could not load data")}}),deferred.promise},_loadProject:function(oid){var me=this,deferred=Q.defer();return oid?me.Project?(me.Project.load(oid,{fetch:me._projectFields,context:{workspace:me.getContext().getWorkspace()._ref,project:null},callback:deferred.resolve}),deferred.promise):Q.reject("IntelRallyApp is not configured!"):Q.reject("Invalid arguments: LP")},_loadUserStory:function(oid,projectRecord){var me=this,deferred=Q.defer();return oid?me.UserStory?(me.UserStory.load(oid,{fetch:me._userStoryFields,context:{workspace:projectRecord?null:me.getContext().getWorkspace()._ref,project:projectRecord?projectRecord.data._ref:null},callback:deferred.resolve}),deferred.promise):Q.reject("IntelRallyApp is not configured!"):Q.reject("Invalid arguments: LUS")},_loadPortfolioItemByType:function(oid,type){var me=this,deferred=Q.defer();return oid&&type?(me[type].load(oid,{fetch:me._portfolioItemFields,context:{workspace:me.getContext().getWorkspace()._ref,project:null},callback:deferred.resolve}),deferred.promise):Q.reject("Invalid arguments: LPIBT")},_loadPortfolioItemByOrdinal:function(oid,ordinal){var me=this,deferred=Q.defer(),type=me.PortfolioItemTypes[ordinal];return me._loadPortfolioItemByType(oid,type)},_projectInWhichTrain:function(projectRecord){if(projectRecord){var me=this,foundTrainConfig=_.find(me.TrainConfig,function(trainConfig){return trainConfig.TrainProjectOID==projectRecord.data.ObjectID});if(foundTrainConfig)return Q(projectRecord);var parent=projectRecord.data.Parent;return parent?me._loadProject(parent.ObjectID).then(function(parentRecord){return me._projectInWhichTrain(parentRecord)}):Q()}return Q()},_loadTrainPortfolioProject:function(trainRecord){if(!trainRecord)return Q.reject("Invalid arguments: ltpp");var me=this,foundTrainConfig=_.find(me.TrainConfig,function(trainConfig){return trainConfig.TrainProjectOID==trainRecord.data.ObjectID});return foundTrainConfig?foundTrainConfig.TrainAndPortfolioLocationTheSame?Q(trainRecord):me._loadProject(foundTrainConfig.PortfolioProjectOID):Q.reject("Project "+trainRecord.data.Name+" is not a train!")},_getTrainName:function(trainRecord){if(!trainRecord)throw"Invalid arguments: gtn";var me=this,foundTrainConfig=_.find(me.TrainConfig,function(trainConfig){return trainConfig.TrainProjectOID==trainRecord.data.ObjectID});if(!foundTrainConfig)throw"Project "+trainRecord.data.Name+" is not a train!";return foundTrainConfig.TrainName?foundTrainConfig.TrainName:trainRecord.data.Name},_loadAllTrains:function(){var me=this,filter=_.reduce(me.TrainConfig,function(filter,item){var newFilter=Ext.create("Rally.data.wsapi.Filter",{property:"ObjectID",value:item.TrainProjectOID});return filter?filter.or(newFilter):newFilter},null);if(filter){var store=Ext.create("Rally.data.wsapi.Store",{model:"Project",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._projectFields,filters:[filter],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})}return Q([])},__getUserStoryInReleaseTimeFrameFilter:function(releaseRecord){var me=this,twoWeeks=12096e5,releaseStartPadding=new Date(1*new Date(releaseRecord.data.ReleaseStartDate)+twoWeeks).toISOString(),releaseEndPadding=new Date(1*new Date(releaseRecord.data.ReleaseDate)-twoWeeks).toISOString();return Ext.create("Rally.data.wsapi.Filter",{property:"Release.ReleaseStartDate",operator:"<",value:releaseStartPadding}).and(Ext.create("Rally.data.wsapi.Filter",{property:"Release.ReleaseDate",operator:">",value:releaseEndPadding})).or(Ext.create("Rally.data.wsapi.Filter",{property:"Release.ObjectID",value:null}).and(Ext.create("Rally.data.wsapi.Filter",{property:"PortfolioItem.Release.ReleaseStartDate",operator:"<",value:releaseStartPadding}).and(Ext.create("Rally.data.wsapi.Filter",{property:"PortfolioItem.Release.ReleaseDate",operator:">",value:releaseEndPadding}))))},_loadRandomUserStory:function(projectRecord){if(!projectRecord)return Q.reject("Invalid arguments: LRUS");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1,pageSize:1,disableMetaChangeEvent:!0,fetch:!1,context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID}]});return me._reloadStore(store).then(function(store){return store.getRange().pop()})},_loadRandomUserStoryFromReleaseTimeframe:function(projectRecord,releaseRecord){if(!projectRecord||!releaseRecord)return Q.reject("Invalid arguments: LRUSFR");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:5,pageSize:5,disableMetaChangeEvent:!0,fetch:me._userStoryFields,context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},sorters:[{property:"CreationDate",direction:"DESC"}],filters:[Ext.create("Rally.data.wsapi.Filter",{property:"Project.ObjectID",value:projectRecord.data.ObjectID}).and(me.__getUserStoryInReleaseTimeFrameFilter(releaseRecord))]});return me._reloadStore(store).then(function(store){var records=store.data.items;return records.length?Q(records[Math.floor(Math.random()*records.length)]):Q(void 0)})},_loadUserStoryByFID:function(formattedID,projectRecord){if(!formattedID||!projectRecord)return Q.reject("Invalid arguments: LUSBFID");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1,pageSize:1,disableMetaChangeEvent:!0,fetch:["Name","Project","ObjectID","FormattedID","Predecessors","Successors","c_Dependencies"],context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},filters:[{property:"FormattedID",value:formattedID},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_loadPortfolioItemsOfType:function(portfolioProject,type){if(!portfolioProject||!type)return Q.reject("Invalid arguments: OPIOT");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/"+type,limit:1/0,disableMetaChangeEvent:!0,remoteSort:!1,fetch:me._portfolioItemFields,context:{project:portfolioProject.data._ref,projectScopeDown:!0,projectScopeUp:!1}});return me._reloadStore(store)},_loadPortfolioItemsOfOrdinal:function(portfolioProject,ordinal){if(!portfolioProject||ordinal===void 0)return Q.reject("Invalid arguments: LPIOO");var me=this,type=me.PortfolioItemTypes[ordinal];return type?me._loadPortfolioItemsOfType(portfolioProject,type):Q.reject("Invalid PortfolioItem ordinal")},_portfolioItemTypeToOrdinal:function(type){return this.PortfolioItemTypes.indexOf(type)},_getPortfolioItemTypeStateByOrdinal:function(ordinal,stateName){return _.find(this.PortfolioItemTypeStates[ordinal],function(state){return state.data.Name==stateName})},_getPortfolioItemTypeStateByName:function(portfolioType,stateName){return this._getPortfolioItemTypeStateByOrdinal(this._portfolioItemTypeToOrdinal(portfolioType),stateName)},__storeItemsToProjTree:function(projects){for(var me=this,projTree={},i=0,len=projects.length;len>i;++i){var project=projects[i],thisRef=project.data.ObjectID,parentRef=project.data.Parent?project.data.Parent.ObjectID:void 0;projTree[thisRef]||(projTree[thisRef]={}),projTree[thisRef].ProjectRecord=project,parentRef&&(projTree[parentRef]||(projTree[parentRef]={}),projTree[parentRef][thisRef]=projTree[thisRef])}return projTree},_loadAllProjects:function(){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){var map=_.reduce(store.getRange(),function(map,project){return map[project.data.ObjectID]=project,map},{});return map})},__addProjectsWithTeamMembersToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;curProj.data.TeamMembers.Count>0&&(hash[curProj.data.ObjectID]=curProj);for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__addProjectsWithTeamMembersToList(projTree[childProjRef],hash)},_loadProjectsWithTeamMembers:function(rootProjectRecord){var me=this,projectsWithTeamMembers={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__addProjectsWithTeamMembersToList(projTree[rootProjectRecord.data.ObjectID],projectsWithTeamMembers),projectsWithTeamMembers}return _.reduce(_.filter(store.getRange(),function(project){return project.data.TeamMembers.Count>0}),function(map,project){return map[project.data.ObjectID]=project,map},{})})},__allChildProjectToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;hash[curProj.data.ObjectID]=curProj;for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__allChildProjectToList(projTree[childProjRef],hash)},_loadAllChildrenProjects:function(rootProjectRecord){var me=this,childrenProjects={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__allChildProjectToList(projTree[rootProjectRecord.data.ObjectID],childrenProjects),childrenProjects}return _.reduce(store.getRange(),function(map,project){return map[project.data.ObjectID]=project,map},{})})},__allLeafProjectsToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;0===curProj.data.Children.Count&&(hash[curProj.data.ObjectID]=curProj);for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__allLeafProjectsToList(projTree[childProjRef],hash)},_loadAllLeafProjects:function(rootProjectRecord){var me=this,leafProjects={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__allLeafProjectsToList(projTree[rootProjectRecord.data.ObjectID],leafProjects),leafProjects}return _.reduce(_.filter(store.getRange(),function(project){return 0===project.data.Children.Count}),function(map,project){return map[project.data.ObjectID]=project,map},{})})},_loadProjectByName:function(projectName){if(!projectName)return Q.reject("Invalid arguments: LPBN");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",limit:1,pageSize:1,fetch:["Name","ObjectID"],disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",value:projectName}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_loadAllReleases:function(projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesAfterGivenDate:function(projectRecord,givenDate){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"ReleaseDate",operator:">=",value:new Date(givenDate).toISOString()},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesBeforeGivenDate:function(projectRecord,givenDate){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!1,disableMetaChangeEvent:!0,fetch:me._releaseFields,filters:[{property:"ReleaseDate",operator:"<=",value:new Date(givenDate).toISOString()},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesInTheFuture:function(projectRecord){return this._loadReleasesAfterGivenDate(projectRecord,new Date)},_loadReleasesByNameUnderProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",value:releaseName}],context:{project:projectRecord.data._ref,projectScopeDown:!0,projectScopeUp:!1}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleaseByNameForProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",value:releaseName},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange().pop()})},_loadReleasesByNameContainsForProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",operator:"contains",value:releaseName},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_getScopedRelease:function(releaseRecords,projectOID,appPrefs){var me=this,d=new Date,rs=releaseRecords,prefOID=appPrefs&&appPrefs.projs&&appPrefs.projs[projectOID]&&appPrefs.projs[projectOID].Release;return prefOID&&_.find(rs,function(r){return r.data.ObjectID==prefOID})||_.find(rs,function(r){return new Date(r.data.ReleaseDate)>=d&&d>=new Date(r.data.ReleaseStartDate)})||_.reduce(rs,function(best,r){if(null===best)return r;var d1=new Date(best.data.ReleaseStartDate),d2=new Date(r.data.ReleaseStartDate),now=new Date;return Math.abs(d1-now)<Math.abs(d2-now)?best:r},null)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("WorkweekDropdown",{extend:"Ext.data.Model",fields:[{name:"Workweek",type:"string"},{name:"DateVal",type:"number"}]}),Ext.define("TrainConfigItem",{extend:"Ext.data.Model",fields:[{name:"TrainProjectOID",type:"number"},{name:"TrainName",type:"string"},{name:"TrainAndPortfolioLocationTheSame",type:"boolean"},{name:"PortfolioProjectOID",type:"number"}]})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("WindowListener",{__initWindowEventListener:function(eventName){var me=this;me._windowListeners||(me._windowListeners={}),me._windowListeners[eventName]=[],window.parent["on"+eventName]=function(event){for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i](event)}},_addWindowEventListener:function(eventName,fn){var me=this;me._windowListeners&&me._windowListeners[eventName]||me.__initWindowEventListener(eventName),me._windowListeners[eventName].push(fn)},_fireParentWindowEvent:function(eventName){var me=this;if(me._windowListeners&&me._windowListeners[eventName])for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i]()}})})();
                (function(){var Ext=window.Ext4||window.Ext,TOP_BAR_HEIGHT=40,BOTTOM_BAR_HEIGHT=24,TITLE_BAR_HEIGHT=33,IFRAME_HEADER_HEIGHT=28;Ext.define("IframeResize",{requires:["WindowListener"],_fixRallyDashboard:function(){if(window.frameElement){for(var me=this,bottomEl=Ext.get(window.frameElement),portlet=bottomEl.up(".x-portlet"),dashboard=portlet.up("#mydash_portlet"),titleBar=dashboard.down(".titlebar"),domNodeW=bottomEl.dom,domNodeH=bottomEl.dom,innerHeight=window.parent.innerHeight,innerWidth=window.parent.innerWidth;;){if(domNodeW.style.width=innerWidth-4+"px",domNodeW.style.padding="0",domNodeW.style.margin="0","mydash_portlet"===domNodeW.id)break;domNodeW=domNodeW.parentNode}for(;;){if(domNodeH.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT+TITLE_BAR_HEIGHT+IFRAME_HEADER_HEIGHT)+"px",domNodeH.classList.contains("x-portlet"))break;domNodeH=domNodeH.parentNode}for(;;){if(domNodeH.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT+TITLE_BAR_HEIGHT)+"px","mydash_portlet"==domNodeH.id)break;domNodeH=domNodeH.parentNode}dashboard.dom.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT)+"px",dashboard.dom.style.padding="0 2px 0 2px",titleBar.dom.style.padding="2px",titleBar.dom.style.margin="0"}},_initFixRallyDashboard:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._fixRallyDashboard()}),me._fixRallyDashboard()},_disableResizeHandle:function(){var me=this,handle;window.frameElement&&(handle=Ext.get(window.frameElement).up(".x-portlet").down(".x-resizable-handle"),handle.hide(),handle.dom.onshow=function(){handle&&handle.hide()})},_initDisableResizeHandle:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._disableResizeHandle()}),me._disableResizeHandle()}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("PrettyAlert",{__getMessageBoxY:function(){var me=this,bottomEl=window.frameElement?Ext.get(window.frameElement):me.el,ph=window.parent.getWindowHeight(),ps=window.parent.getScrollY(),ofy=ps+bottomEl.dom.getBoundingClientRect().top,iyOffset=Math.floor(ph/2-ofy+ps-50);return 0>iyOffset?0:iyOffset},_alert:function(title,message){var me=this;message="string"==typeof message?message:message.message?message.message:JSON.stringify(message,null,"	"),1>arguments.length||(1===arguments.length&&(message=title,title=""),Ext.MessageBox.alert(title,message).setY(me.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},50))},_confirm:function(title,message,fn){var me=this;message="string"==typeof message?message:message.message?message.message:JSON.stringify(message,null,"	"),2>arguments.length||(2===arguments.length&&(fn=message,message=title,title=""),"function"!=typeof fn&&(fn=function(){}),Ext.MessageBox.confirm(title,message,fn).setY(me.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},20))}})})();
                (function(){var Ext=window.Ext4||window.Ext,intel_ww={},SECOND=1e3,MINUTE=60*SECOND,HOUR=60*MINUTE,DAY=24*HOUR,WEEK=7*DAY;Ext.define("IntelWorkweek",{_getWorkweek:function(_date){var date=new Date(_date),yearStart=new Date(date.getFullYear(),0,1),dayIndex=yearStart.getDay(),ww01Start=new Date(yearStart-dayIndex*DAY),utcDateMillis=Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()),ww01Millis=Date.UTC(ww01Start.getFullYear(),ww01Start.getMonth(),ww01Start.getDate()),timeDiff=utcDateMillis-ww01Millis,ww=Math.floor(timeDiff/WEEK)+1,leap=0===date.getFullYear()%4,weekCount=leap&&dayIndex>=5||!leap&&6===dayIndex?53:52;return ww>weekCount?1:ww},_getWeekCount:function(_date){var date=new Date(_date),leap=0===date.getFullYear()%4,day=new Date(date.getFullYear(),0,1).getDay();return leap&&day>=5||!leap&&6===day?53:52},_roundDateDownToWeekStart:function(_date){var date=new Date(_date),day=date.getDay(),monthDate=date.getDate(),month=date.getMonth(),year=date.getFullYear(),sundayMidday=new Date(1*new Date(year,month,monthDate)-(day*DAY-.5*DAY));return new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())},_getWorkweekDates:function(startDate,endDate){for(var startWeekDate=this._roundDateDownToWeekStart(startDate),endWeekDate=this._roundDateDownToWeekStart(endDate),startMillis=Date.UTC(startWeekDate.getFullYear(),startWeekDate.getMonth(),startWeekDate.getDate()),endMillis=Date.UTC(endWeekDate.getFullYear(),endWeekDate.getMonth(),endWeekDate.getDate()),totalWeeks=Math.floor((endMillis-startMillis)/WEEK)+1,weeks=Array(totalWeeks),i=0;totalWeeks>i;++i){var sundayMidday=new Date(1*startWeekDate+(WEEK*i+12*HOUR));weeks[i]=new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())}return weeks},_workweekToDate:function(ww,year){var yearStart=new Date(year,0,1),dayIndex=yearStart.getDay(),ww01StartMidday=new Date(yearStart-(dayIndex*DAY-.5*DAY)),sundayMidday=new Date(1*ww01StartMidday+(ww-1)*WEEK);return new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())},_getWorkWeeksForDropdown:function(releaseStartDate,releaseEndDate){for(var workweeks=this._getWorkweekDates(releaseStartDate,releaseEndDate),data=Array(workweeks.length),i=0,len=workweeks.length;len>i;++i)data[i]={Workweek:"ww"+this._getWorkweek(workweeks[i]),DateVal:1*workweeks[i]};return data}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("ParallelLoader",{__parallelLoadData:function(config){var me=this,pagesize=config.pagesize,url=config.url,params=config.params,promises=[],outputItems=[],totalRequestsSent=1;return _.times(totalRequestsSent,function(pageNum){var thisDeferred=Q.defer(),thisParams=Ext.merge({},params);promises.push(thisDeferred.promise),thisParams.start=config.itemOffset+pagesize*pageNum,Ext.data.JsonP.request({url:url,callbackKey:"jsonp",params:thisParams,success:function(resJSON){var items=resJSON.QueryResult?resJSON.QueryResult.Results:resJSON.Results,totalCount=resJSON.QueryResult?resJSON.QueryResult.TotalResultCount:resJSON.TotalResultCount,totalPages=(totalCount/pagesize>>0)+(totalCount%pagesize?1:0);if(outputItems=outputItems.concat(items),totalPages>totalRequestsSent){var additionalPromises=[];_.times(totalPages-totalRequestsSent,function(){var nextDeferred=Q.defer(),thisParams=Ext.merge({},params);additionalPromises.push(nextDeferred.promise),thisParams.start=config.itemOffset+pagesize*totalRequestsSent,++totalRequestsSent,Ext.data.JsonP.request({url:url,callbackKey:"jsonp",params:thisParams,success:function(resJSON){var items=resJSON.QueryResult?resJSON.QueryResult.Results:resJSON.Results;outputItems=outputItems.concat(items),nextDeferred.resolve()},failure:function(response){nextDeferred.reject(response)}})}),Q.all(additionalPromises).then(function(){thisDeferred.resolve()})}else thisDeferred.resolve()},failure:function(response){thisDeferred.reject(response)}})}),Q.all(promises).then(function(){return outputItems})},_parallelLoadWsapiStore:function(config){var me=this;return config.itemOffset=1,config.pagesize=config.pagesize>0&&200>=config.pagesize?config.pagesize:200,me.__parallelLoadData(config).then(function(items){return Ext.create("Rally.data.wsapi.Store",{model:config.model,totalCount:items.length,data:items,disableMetaChangeEvent:!0,load:function(){}})})},_parallelLoadLookbackStore:function(config){var me=this;return config.itemOffset=0,config.pagesize=config.pagesize>0&&2e4>=config.pagesize?config.pagesize:2e4,me.__parallelLoadData(config).then(function(items){return Ext.create("Rally.data.lookback.SnapshotStore",{totalCount:items.length,data:items,disableMetaChangeEvent:!0,model:Ext.define("Rally.data.lookback.SnapshotModel-"+Ext.id(),{extend:"Rally.data.lookback.SnapshotModel",fields:JSON.parse(config.params.fields||"[]")}),load:function(){}})})}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("AsyncQueue",{QueueOfFuncs:{},_dequeue:function(queueName){var me=this;if(queueName=queueName||"undefined",me.QueueOfFuncs[queueName]){if(me.QueueOfFuncs[queueName].shift(),!me.QueueOfFuncs[queueName].length)return;me.QueueOfFuncs[queueName][0].call(me,me._dequeue.bind(me,queueName))}},_enqueue:function(callback,queueName){var me=this;if(queueName=queueName||"undefined","function"!=typeof callback)throw"ERROR: not a function";me.QueueOfFuncs[queueName]&&me.QueueOfFuncs[queueName].length?me.QueueOfFuncs[queueName].push(callback):(me.QueueOfFuncs[queueName]=[callback],callback.call(me,me._dequeue.bind(me,queueName)))}})})();
                (function(){var Ext=window.Ext4||window.Ext,ChartsTooltipDatemap={};Ext.define("CumulativeFlowChartMixin",{requires:["IntelRallyApp","IntelWorkweek"],_defaultCumulativeFlowChartConfig:{chart:{defaultSeriesType:"area",zoomType:"xy"},colors:["#ABABAB","#E57E3A","#E5D038","#0080FF","#3A874F","#26FF00","#000000"],xAxis:{tickmarkPlacement:"on",title:{text:"Days",margin:10},labels:{y:20}},yAxis:{title:{text:"Points"},labels:{x:-5,y:4}},tooltip:{formatter:function(){for(var sum=0,datemap=ChartsTooltipDatemap[this.series.chart.container.id],i=4;i>=this.series.index;--i)sum+=this.series.chart.series[i].data[this.point.x].y;return"<b>"+this.x+"</b>"+(datemap?" ("+datemap[this.point.x]+")":"")+"<br /><b>"+this.series.name+"</b>: "+(100*this.y>>0)/100+(4>=this.series.index?"<br /><b>Total</b>: "+(100*sum>>0)/100:"")}},plotOptions:{series:{marker:{enabled:!1,states:{hover:{enabled:!0}}},groupPadding:.01},area:{stacking:"normal",lineColor:"#666666",lineWidth:2,marker:{enabled:!1}}}},_getCumulativeFlowChartColors:function(){var me=this,colors=me._defaultCumulativeFlowChartConfig.colors,scheduleStates=me.ScheduleStates;return scheduleStates.length>=5?{colors:colors}:{colors:colors.slice(0,scheduleStates.length).concat(colors.slice(scheduleStates.length+1))}},__addProjectedTrendline:function(data,options){var me=this,totalPoints=options.totalPoints,trendType=options.trendType,validTypes=["FromZero","FromStartAccepted","LastWeek","LinearRegression","WeightedLinearRegression"],topScheduleState=me.ScheduleStates.slice(-1)[0],s=_.find(data.series,function(s){return s.name===topScheduleState}),i,len,projectedTrend={type:"spline",dashStyle:"Solid",name:"Projected",data:s.data.slice()},begin=0,end=projectedTrend.data.length-1;for(i=1;projectedTrend.data.length>i;++i)if(null!==projectedTrend.data[i]&&0!==projectedTrend.data[i]){begin=i-1;break}for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}for(ratio=end===begin?0:(projectedTrend.data[end]-0)/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){return j>=begin?Math.round(100*(0+(j-begin)*ratio))/100:p}),i=1,len=projectedTrend.data.length;len>i;++i)if(projectedTrend.data[i]>=totalPoints){projectedTrend.data[i]={color:"red",marker:{enabled:!0,lineWidth:4,symbol:"circle",fillColor:"red",lineColor:"red"},y:projectedTrend.data[i]};break}return projectedTrend},_updateCumulativeFlowChartData:function(data,hideTrends){var me=this,now=new Date,datemap=[],totalPoints=new Date(data.categories[0])>now?0:_.reduce(data.series,function(sum,s){return sum+(s.data[s.data.length-1]||0)},0)||0,idealTrend,ratio;if(hideTrends||(idealTrend={type:"spline",dashStyle:"Solid",name:"Ideal",data:Array(data.categories.length)},ratio=totalPoints/(data.categories.length-1)||0,idealTrend.data=_.map(idealTrend.data,function(e,i){return Math.round(100*(0+i*ratio))/100})),_.each(data.categories,function(c,i,a){var d=new Date(c);a[i]="ww"+me._getWorkweek(d),datemap[i]=c,d>now&&_.each(data.series,function(s,j){s.data=s.data.slice(0,i).concat(_.map(Array(a.length-i),function(){return 0}))})}),!hideTrends){var projectedTrend=me.__addProjectedTrendline(data,{totalPoints:totalPoints});data.series.push(projectedTrend),data.series.push(idealTrend)}return data.datemap=datemap,data},_getCumulativeFlowChartTicks:function(startDate,endDate,width){var pixelTickWidth=40,ticks=width/pixelTickWidth>>0,oneDay=864e5,days=(1*endDate-1*startDate)/(5*oneDay/7)>>0,interval=5*((days/ticks>>0)/5>>0);return 5>interval?5:interval},_setCumulativeFlowChartDatemap:function(chartContainerId,datemap){ChartsTooltipDatemap[chartContainerId]=datemap}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("FastCumulativeFlowCalculator",{constructor:function(options){this.scheduleStates=options.scheduleStates,this.endDate=options.endDate,this.startDate=options.startDate},_getDates:function(){for(var dates=[],curDay=this.startDate,day=864e5;this.endDate>=curDay;){var n=curDay.getDay();0!==n&&6!==n&&dates.push(curDay),curDay=new Date(1*curDay+day)}return dates},_dateToStringDisplay:function(date){return Ext.Date.format(date,"m/d/Y")},_getIndexHelper:function(date,dateArray){for(var curVal=dateArray.length/2,curInt=curVal>>0,div=curVal/2,lastInt=-1;curInt!==lastInt;){if(dateArray[curInt]===date)return curInt;dateArray[curInt]>date?curVal-=div:curVal+=div,div/=2,lastInt=curInt,curInt=curVal>>0}return curInt},_getIndexOnOrBefore:function(date,dateArray){if(0===dateArray.length)return-1;var pos=this._getIndexHelper(date,dateArray);return 0===pos?date>=dateArray[pos]?pos:-1:date>=dateArray[pos]?pos:pos-1},_getIndexOnOrAfter:function(date,dateArray){if(0===dateArray.length)return-1;var pos=this._getIndexHelper(date,dateArray);return pos===dateArray.length-1?dateArray[pos]>=date?pos:-1:dateArray[pos]>=date?pos:pos+1},runCalculation:function(items){if(!this.scheduleStates||!this.startDate||!this.endDate)throw"invalid constructor config";for(var dates=this._getDates(),day=864e5,dateMapTemplate=_.map(Array(dates.length),function(){return 0}),totals=_.reduce(this.scheduleStates,function(map,ss){return map[ss]=dateMapTemplate.slice(),map},{}),itemIndex=0,len=items.length;len>itemIndex;++itemIndex){var item=items[itemIndex].raw,iStart=new Date(item._ValidFrom),iEnd=new Date(item._ValidTo),state=item.ScheduleState,pe=item.PlanEstimate;if(pe&&iStart/day>>0!==iEnd/day>>0){var startIndex=this._getIndexOnOrAfter(iStart,dates),endIndex=this._getIndexOnOrBefore(iEnd,dates);if(-1!==startIndex&&-1!==endIndex)for(var i=startIndex;endIndex>=i;++i)totals[state][i]+=pe}}return{categories:_.map(dates,function(d){return this._dateToStringDisplay(d)},this),series:_.reduce(this.scheduleStates,function(outputArray,ss){return outputArray.concat([{name:ss,type:"area",dashStyle:"Solid",data:totals[ss]}])},[])}}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("PortfolioChartAndGrid",{extend:"IntelRallyApp",mixins:["WindowListener","PrettyAlert","IntelWorkweek","AsyncQueue","ParallelLoader","CumulativeFlowChartMixin"],requires:["FastCumulativeFlowCalculator"],cls:"portfolio-cfd-app",items:[{xtype:"container",cls:"navbar",id:"navbar",layout:"hbox"},{xtype:"container",id:"portfolioItemChart",cls:"portfolio-item-chart",minHeight:100},{xtype:"container",id:"gridContainer",cls:"portfolio-item-grid"}],_loadGridStore:function(){var me=this,piLevel=me.CurrentPortfolioItem.self.ordinal,filters=[],sorters=[];0===piLevel&&(sorters.push({property:"ScheduleState",direction:"ASC"}),me.OnlyStoriesInCurrentProject&&filters.push({property:"Project.ObjectID",value:me.getContext().getProject().ObjectID}));var store=Ext.create("Rally.data.wsapi.Store",{model:0===piLevel?"HierarchicalRequirement":"PortfolioItem",limit:1/0,autoLoad:!1,remoteSort:!1,fetch:0===piLevel?["ObjectID","FormattedID","Name","PlanEstimate","Iteration","ScheduleState","Project","DirectChildrenCount"]:["ObjectID","FormattedID","Name","Project"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},sorters:sorters,filters:filters.concat([{property:0===piLevel?"PortfolioItem.ObjectID":"Parent.ObjectID",value:me.CurrentPortfolioItem.data.ObjectID}])});return me._reloadStore(store)},_loadChartStore:function(){var me=this,grid=Ext.getCmp("grid"),piRecord=me.CurrentPortfolioItem,parallelLoaderConfig={pagesize:2e4,url:"https://"+window.location.host+"/analytics/v2.0/service/rally/workspace/"+me.getContext().getWorkspace().ObjectID+"/artifact/snapshot/query.js",params:{workspace:me.getContext().getWorkspace()._ref,compress:!1,pagesize:2e4,find:JSON.stringify({_ItemHierarchy:grid?{$in:_.map(grid.getSelectionModel().getSelection(),function(record){return record.data.ObjectID})}:piRecord.data.ObjectID,Project:0===piRecord.self.ordinal&&me.OnlyStoriesInCurrentProject?me.getContext().getProject().ObjectID:void 0,_TypeHierarchy:"HierarchicalRequirement",Children:null,PlanEstimate:{$gte:0}}),fields:JSON.stringify(["ScheduleState","PlanEstimate","_ValidFrom","_ValidTo","ObjectID"]),hydrate:JSON.stringify(["ScheduleState"])}};return me._parallelLoadLookbackStore(parallelLoaderConfig)},_getChartStartDate:function(){var me=this,piData=me.CurrentPortfolioItem.data;return new Date(piData.PlannedStartDate||piData.ActualStartDate||""+new Date)},_getChartEndDate:function(){var me=this,piData=me.CurrentPortfolioItem.data;return new Date(piData.PlannedEndDate||piData.ActualEndDate||""+new Date)},_getChartTitle:function(){var me=this,piData=me.CurrentPortfolioItem.data,widthPerCharacter=10,totalCharacters=(me.getWidth()-20)/widthPerCharacter>>0,title="Portfolio Item Chart",align="center";return piData&&(title=piData.FormattedID+": "+piData.Name),title.length>totalCharacters&&(title=title.substring(0,totalCharacters)+"...",align="left"),{text:title,align:align,margin:30}},_getChartSubtitle:function(){var me=this,piData=me.CurrentPortfolioItem.data,widthPerCharacter=6,totalCharacters=(me.getWidth()-20)/widthPerCharacter>>0,startDateString=" ("+me._dateToStringDisplay(me._getChartStartDate())+")",startDateType="",endDateString=" ("+me._dateToStringDisplay(me._getChartEndDate())+")",endDateType="",template=Ext.create("Ext.XTemplate",'<tpl><span>{startDateString}</span><tpl if="tooBig">	<br/><tpl else>	&nbsp;&nbsp;&nbsp;</tpl><span>{endDateString}</span></tpl>');piData&&(piData.PlannedStartDate?startDateType="PlannedStartDate":piData.ActualStartDate&&(startDateType="ActualStartDate"),startDateString=startDateType?("PlannedStartDate"===startDateType?"Planned":"Actual")+" Start: WW"+me._getWorkweek(new Date(piData[startDateType]))+startDateString:"No start day set.",piData.PlannedEndDate?endDateType="PlannedEndDate":piData.ActualEndDate&&(endDateType="ActualEndDate"),endDateString=endDateType?("PlannedEndDate"===endDateType?"Planned":"Actual")+" End: WW"+me._getWorkweek(new Date(piData[endDateType]))+endDateString:"No end day set.");var formattedTitle=template.apply({startDateString:startDateString,endDateString:endDateString,tooBig:startDateString.length+endDateString.length+60>totalCharacters});return{text:formattedTitle,useHTML:!0,align:"center"}},_dateToStringDisplay:function(date){return Ext.Date.format(date,"m/d/Y")},_dateToString:function(date){return Ext.Date.format(date,"Y-m-d\\TH:i:s.u\\Z")},_hideHighchartsLinks:function(){$(".highcharts-container > svg > text:last-child").hide()},_reloadEverything:function(){var me=this;me._enqueue(function(unlockFunc){me._buildHeader(),me._buildGrid().then(function(){return me._buildChart()}).then(function(){return me._hideHighchartsLinks()}).fail(function(reason){me._alert("ERROR",reason||"")}).then(function(){unlockFunc()}).done()})},_subscribeToBus:function(){var me=this;me.subscribe(me,"portfoliotreeitemselected",function(treeItem){me.CurrentPortfolioItem=treeItem.getRecord(),me._reloadEverything()})},launch:function(){var me=this;me.ShowGrid=!1,me.OnlyStoriesInCurrentProject=!1,me._configureIntelRallyApp().then(function(){var scopeProject=me.getContext().getGlobalContext().getProject();return me._loadProject(scopeProject.ObjectID)}).then(function(scopeProjectRecord){return me.ProjectRecord=scopeProjectRecord,me._loadRandomUserStory(me.ProjectRecord)}).then(function(userStory){me.HasUserStories=!!userStory,me._subscribeToBus(),me._reloadEverything()}).fail(function(reason){me._alert("ERROR",reason)}).done()},_buildShowGridCheckbox:function(){var me=this;me.ShowGridCheckbox&&me.ShowGridCheckbox.destroy(),me.ShowGridCheckbox=Ext.getCmp("navbar").add({xtype:"rallycheckboxfield",boxLabel:"Show Grid",value:me.ShowGrid,listeners:{change:{fn:function(checkbox){me.ShowGrid=checkbox.getValue(),setTimeout(function(){me._reloadEverything()},0)}}},componentCls:"show-grid-checkbox",id:"show-grid-checkbox"})},_buildCurrentProjectOnlyCheckbox:function(){var me=this;me.CurrentProjectOnlyCheckbox&&me.CurrentProjectOnlyCheckbox.destroy(),me.CurrentProjectOnlyCheckbox=Ext.getCmp("navbar").add({xtype:"rallycheckboxfield",boxLabel:"Filter User Stories in Current Project",value:me.OnlyStoriesInCurrentProject,hidden:!me.CurrentPortfolioItem||me.CurrentPortfolioItem.self.ordinal>0||!me.HasUserStories||!me.ShowGrid,listeners:{change:{fn:function(checkbox){me.OnlyStoriesInCurrentProject=checkbox.getValue(),setTimeout(function(){me._reloadEverything()},0)}}},componentCls:"current-project-only-checkbox",id:"current-project-only-checkbox"})},_buildHeader:function(){var me=this;me._buildShowGridCheckbox(),me._buildCurrentProjectOnlyCheckbox()},_buildGrid:function(){var me=this,gridContainer=Ext.getCmp("gridContainer"),grid=Ext.getCmp("grid");return grid&&grid.destroy(),me.ShowGrid&&me.CurrentPortfolioItem?(gridContainer.setLoading("Loading Data"),me._loadGridStore().then(function(store){var grid=gridContainer.add({xtype:"rallygrid",id:"grid",store:store,columnCfgs:0===me.CurrentPortfolioItem.self.ordinal?[{dataIndex:"FormattedID",editor:!1,renderer:function(v,m,r){return'<a href="https://rally1.rallydev.com/#/'+r.data.Project.ObjectID+"d/detail/userstory/"+r.data.ObjectID+'" target="_blank">'+v+"</a>"}},"Name","PlanEstimate",{dataIndex:"Iteration",doSort:function(state){this.up("grid").getStore().sort({sorterFn:function(r1,r2){var i1=r1.data.Iteration?r1.data.Iteration.Name||"_":"_",i2=r2.data.Iteration?r2.data.Iteration.Name||"_":"_";return("ASC"===state?1:-1)*(i2>i1?-1:1)}})},renderer:function(v,m,r){return v?'<a href="https://rally1.rallydev.com/#/'+r.data.Iteration.Project.ObjectID+"d/detail/iteration/"+r.data.Iteration.ObjectID+'" target="_blank">'+v.Name+"</a>":void 0}},{dataIndex:"ScheduleState",editor:!1},{dataIndex:"Project",doSort:function(state){this.up("grid").getStore().sort({sorterFn:function(r1,r2){var i1=r1.data.Project?r1.data.Project.Name||"_":"_",i2=r2.data.Project?r2.data.Project.Name||"_":"_";return("ASC"===state?1:-1)*(i2>i1?-1:1)}})}},{dataIndex:"DirectChildrenCount",text:"Children",renderer:function(v,m,r){return'<a href="https://rally1.rallydev.com/#/'+r.data.Project.ObjectID+"d/detail/userstory/"+r.data.ObjectID+'/children" target="_blank">'+v+"</a>"}}]:["FormattedID","Name","Project"],showRowActionsColumn:!1,selType:"checkboxmodel",selModel:{ignoreRightMouseSelection:!0,checkOnly:!0},enableEditing:!1,autoScroll:!0,height:500,showPagingToolbar:!1,listeners:{selectionchange:function(){me._buildChart()}}});gridContainer.setLoading(!1),grid.getSelectionModel().selectAll(!0)})):Q()},_buildChart:function(){var me=this;return me.CurrentPortfolioItem?(Ext.getCmp("portfolioItemChart").setLoading("Loading Data"),me._loadChartStore().then(function(store){var calc=Ext.create("FastCumulativeFlowCalculator",{startDate:me._getChartStartDate(),endDate:me._getChartEndDate(),scheduleStates:me.ScheduleStates}),chartData=me._updateCumulativeFlowChartData(calc.runCalculation(store.getRange())),portfolioItemChart=$("#portfolioItemChart-innerCt").highcharts(Ext.Object.merge({},me._defaultCumulativeFlowChartConfig,me._getCumulativeFlowChartColors(),{chart:{height:400},legend:{enabled:!0,borderWidth:0,width:500,itemWidth:100},title:me._getChartTitle(),subtitle:me._getChartSubtitle(),xAxis:{categories:chartData.categories,tickInterval:me._getCumulativeFlowChartTicks(me._getChartStartDate(),me._getChartEndDate(),me.getWidth()-20)},series:chartData.series}))[0];me._setCumulativeFlowChartDatemap(portfolioItemChart.childNodes[0].id,chartData.datemap),me.doLayout(),Ext.getCmp("portfolioItemChart").setLoading(!1)})):Q()}})})();

            Rally.launchApp('PortfolioChartAndGrid', {
                name:"Portfolio Chart And Grid",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .x-grid-cell.intel-editor-cell *,.x4-grid-cell.intel-editor-cell *,.intel-editor-cell{cursor:pointer !important}.fa.fa-md{font-size:1.05rem;line-height:.75em;vertical-align:-15%}
    </style>
    <style type="text/css">
        .portfolio-cfd-app{width:100% !important;overflow-x:hidden;overflow-y:scroll !important}.portfolio-cfd-app .navbar{border-bottom:1px dotted #c6c6c6;line-height:1.1em}.portfolio-cfd-app .current-project-only{float:left}.portfolio-cfd-app .current-project-only-checkbox{float:left;margin-left:10px}
    </style>
</head>
<body>
</body>
</html>
