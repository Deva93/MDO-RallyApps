<!DOCTYPE html>
<html>
<head>
    <title>RetroDashboard</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0rc3/sdk.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="https://code.highcharts.com/highcharts.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.1/q.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelRallyApp",{alias:"widget.intelrallyapp",extend:"Rally.app.App",_TrainConfigPrefName:"intel-train-config",_projectFields:["ObjectID","Releases","Children","Parent","Name","TeamMembers"],_portfolioItemFields:["Name","ObjectID","FormattedID","Release","c_TeamCommits","c_MoSCoW","c_Risks","Project","PlannedEndDate","Parent","Children","PortfolioItemType","Ordinal"],_userStoryFields:["Name","ObjectID","Release","Project","PortfolioItem","PlannedEndDate","ActualEndDate","FormattedID","Predecessors","Successors","c_Dependencies","Iteration","PlanEstimate"],_releaseFields:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project","TeamMembers"],_loadScheduleStates:function(){var me=this,deferred=Q.defer();return Rally.data.ModelFactory.getModel({type:"UserStory",success:function(model){model.getField("ScheduleState").getAllowedValueStore().load({callback:function(records,operation,success){me.ScheduleStates=_.map(records,function(r){return r.data.StringValue}),deferred.resolve()}})}}),deferred.promise},_loadPortfolioItemStatesForEachType:function(){var me=this;return me.PortfolioItemTypeStates=[],Q.all(_.map(me.PortfolioItemTypes,function(portfolioType,ordinal){var store=Ext.create("Rally.data.wsapi.Store",{model:"State",autoLoad:!1,limit:1/0,disableMetaChangeEvent:!0,fetch:["Name","Enabled","OrderIndex"],filters:[{property:"TypeDef.Name",value:portfolioType},{property:"Enabled",value:!0}]});return me._reloadStore(store).then(function(store){me.PortfolioItemTypeStates[ordinal]=store.getRange()})}))},_loadPortfolioItemTypes:function(){var me=this,deferred=Q.defer(),store=Ext.create("Rally.data.wsapi.Store",{model:"TypeDefinition",autoLoad:!0,limit:1/0,disableMetaChangeEvent:!0,fetch:["Ordinal","Name"],filters:[{property:"Parent.Name",value:"Portfolio Item"},{property:"Creatable",value:!0}],listeners:{load:function(portfolioTypeStore){me.PortfolioItemTypes=_.map(_.sortBy(_.map(portfolioTypeStore.getRange(),function(item){return{Name:item.data.Name,Ordinal:item.data.Ordinal}}),function(item){return item.Ordinal}),function(item){return item.Name}),deferred.resolve()}}});return deferred.promise},_loadModels:function(){var me=this,promises=[],models={Project:"Project",UserStory:"HierarchicalRequirement",PortfolioItem:"PortfolioItem"};return _.each(me.PortfolioItemTypes,function(name){models[name]="PortfolioItem/"+name}),_.each(models,function(modelType,modelName){var deferred=Q.defer();Rally.data.WsapiModelFactory.getModel({type:modelType,success:function(loadedModel){me[modelName]=loadedModel,deferred.resolve()}}),promises.push(deferred.promise)}),Q.all(promises)},_loadTrainConfig:function(){var me=this,deferred=Q.defer();return Rally.data.PreferenceManager.load({workspace:me.getContext().getWorkspace()._ref,filterByName:me._TrainConfigPrefName,success:function(prefs){var workspaceConfigString=prefs[me._TrainConfigPrefName],trainConfig;try{trainConfig=JSON.parse(workspaceConfigString)}catch(e){trainConfig=[]}me.TrainConfig=trainConfig,deferred.resolve()},failure:deferred.reject}),deferred.promise},_saveTrainConfig:function(trainConfig){var me=this,s={},deferred=Q.defer();return s[me._TrainConfigPrefName]=JSON.stringify(trainConfig),Rally.data.PreferenceManager.update({workspace:me.getContext().getWorkspace()._ref,filterByName:me._TrainConfigPrefName,settings:s,success:deferred.resolve,failure:deferred.reject}),deferred.promise},_configureIntelRallyApp:function(){var me=this;return me.BaseUrl=Rally.environment.getServer().getBaseUrl(),Q.all([me._loadPortfolioItemTypes().then(function(){return me._userStoryFields.push(me.PortfolioItemTypes[0]),Q.all([me._loadModels(),me._loadPortfolioItemStatesForEachType()])}),me._loadTrainConfig(),me._loadScheduleStates()])},_reloadStore:function(store){var deferred=Q.defer();return store.load({callback:function(records,operation,success){success?deferred.resolve(store):deferred.reject(operation.getError()||"Could not load data")}}),deferred.promise},_loadProject:function(oid){var me=this,deferred=Q.defer();return oid?me.Project?(me.Project.load(oid,{fetch:me._projectFields,context:{workspace:me.getContext().getWorkspace()._ref,project:null},callback:deferred.resolve}),deferred.promise):Q.reject("IntelRallyApp is not configured!"):Q.reject("Invalid arguments: LP")},_loadUserStory:function(oid,projectRecord){var me=this,deferred=Q.defer();return oid?me.UserStory?(me.UserStory.load(oid,{fetch:me._userStoryFields,context:{workspace:projectRecord?null:me.getContext().getWorkspace()._ref,project:projectRecord?projectRecord.data._ref:null},callback:deferred.resolve}),deferred.promise):Q.reject("IntelRallyApp is not configured!"):Q.reject("Invalid arguments: LUS")},_loadPortfolioItemByType:function(oid,type){var me=this,deferred=Q.defer();return oid&&type?(me[type].load(oid,{fetch:me._portfolioItemFields,context:{workspace:me.getContext().getWorkspace()._ref,project:null},callback:deferred.resolve}),deferred.promise):Q.reject("Invalid arguments: LPIBT")},_loadPortfolioItemByOrdinal:function(oid,ordinal){var me=this,deferred=Q.defer(),type=me.PortfolioItemTypes[ordinal];return me._loadPortfolioItemByType(oid,type)},_projectInWhichTrain:function(projectRecord){if(projectRecord){var me=this,foundTrainConfig=_.find(me.TrainConfig,function(trainConfig){return trainConfig.TrainProjectOID==projectRecord.data.ObjectID});if(foundTrainConfig)return Q(projectRecord);var parent=projectRecord.data.Parent;return parent?me._loadProject(parent.ObjectID).then(function(parentRecord){return me._projectInWhichTrain(parentRecord)}):Q()}return Q()},_loadTrainPortfolioProject:function(trainRecord){if(!trainRecord)return Q.reject("Invalid arguments: ltpp");var me=this,foundTrainConfig=_.find(me.TrainConfig,function(trainConfig){return trainConfig.TrainProjectOID==trainRecord.data.ObjectID});return foundTrainConfig?foundTrainConfig.TrainAndPortfolioLocationTheSame?Q(trainRecord):me._loadProject(foundTrainConfig.PortfolioProjectOID):Q.reject("Project "+trainRecord.data.Name+" is not a train!")},_getTrainName:function(trainRecord){if(!trainRecord)throw"Invalid arguments: gtn";var me=this,foundTrainConfig=_.find(me.TrainConfig,function(trainConfig){return trainConfig.TrainProjectOID==trainRecord.data.ObjectID});if(!foundTrainConfig)throw"Project "+trainRecord.data.Name+" is not a train!";return foundTrainConfig.TrainName?foundTrainConfig.TrainName:trainRecord.data.Name},_loadAllTrains:function(){var me=this,filter=_.reduce(me.TrainConfig,function(filter,item){var newFilter=Ext.create("Rally.data.wsapi.Filter",{property:"ObjectID",value:item.TrainProjectOID});return filter?filter.or(newFilter):newFilter},null);if(filter){var store=Ext.create("Rally.data.wsapi.Store",{model:"Project",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._projectFields,filters:[filter],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})}return Q([])},__getUserStoryInReleaseTimeFrameFilter:function(releaseRecord){var me=this,twoWeeks=12096e5,releaseStartPadding=new Date(1*new Date(releaseRecord.data.ReleaseStartDate)+twoWeeks).toISOString(),releaseEndPadding=new Date(1*new Date(releaseRecord.data.ReleaseDate)-twoWeeks).toISOString();return Ext.create("Rally.data.wsapi.Filter",{property:"Release.ReleaseStartDate",operator:"<",value:releaseStartPadding}).and(Ext.create("Rally.data.wsapi.Filter",{property:"Release.ReleaseDate",operator:">",value:releaseEndPadding})).or(Ext.create("Rally.data.wsapi.Filter",{property:"Release.ObjectID",value:null}).and(Ext.create("Rally.data.wsapi.Filter",{property:"PortfolioItem.Release.ReleaseStartDate",operator:"<",value:releaseStartPadding}).and(Ext.create("Rally.data.wsapi.Filter",{property:"PortfolioItem.Release.ReleaseDate",operator:">",value:releaseEndPadding}))))},_loadRandomUserStory:function(projectRecord){if(!projectRecord)return Q.reject("Invalid arguments: LRUS");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1,pageSize:1,disableMetaChangeEvent:!0,fetch:!1,context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID}]});return me._reloadStore(store).then(function(store){return store.getRange().pop()})},_loadRandomUserStoryFromReleaseTimeframe:function(projectRecord,releaseRecord){if(!projectRecord||!releaseRecord)return Q.reject("Invalid arguments: LRUSFR");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:5,pageSize:5,disableMetaChangeEvent:!0,fetch:me._userStoryFields,context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},sorters:[{property:"CreationDate",direction:"DESC"}],filters:[Ext.create("Rally.data.wsapi.Filter",{property:"Project.ObjectID",value:projectRecord.data.ObjectID}).and(me.__getUserStoryInReleaseTimeFrameFilter(releaseRecord))]});return me._reloadStore(store).then(function(store){var records=store.data.items;return records.length?Q(records[Math.floor(Math.random()*records.length)]):Q(void 0)})},_loadUserStoryByFID:function(formattedID,projectRecord){if(!formattedID||!projectRecord)return Q.reject("Invalid arguments: LUSBFID");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1,pageSize:1,disableMetaChangeEvent:!0,fetch:["Name","Project","ObjectID","FormattedID","Predecessors","Successors","c_Dependencies"],context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},filters:[{property:"FormattedID",value:formattedID},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_loadPortfolioItemsOfType:function(portfolioProject,type){if(!portfolioProject||!type)return Q.reject("Invalid arguments: OPIOT");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/"+type,limit:1/0,disableMetaChangeEvent:!0,remoteSort:!1,fetch:me._portfolioItemFields,context:{project:portfolioProject.data._ref,projectScopeDown:!0,projectScopeUp:!1}});return me._reloadStore(store)},_loadPortfolioItemsOfOrdinal:function(portfolioProject,ordinal){if(!portfolioProject||ordinal===void 0)return Q.reject("Invalid arguments: LPIOO");var me=this,type=me.PortfolioItemTypes[ordinal];return type?me._loadPortfolioItemsOfType(portfolioProject,type):Q.reject("Invalid PortfolioItem ordinal")},_portfolioItemTypeToOrdinal:function(type){return this.PortfolioItemTypes.indexOf(type)},_getPortfolioItemTypeStateByOrdinal:function(ordinal,stateName){return _.find(this.PortfolioItemTypeStates[ordinal],function(state){return state.data.Name==stateName})},_getPortfolioItemTypeStateByName:function(portfolioType,stateName){return this._getPortfolioItemTypeStateByOrdinal(this._portfolioItemTypeToOrdinal(portfolioType),stateName)},__storeItemsToProjTree:function(projects){for(var me=this,projTree={},i=0,len=projects.length;len>i;++i){var project=projects[i],thisRef=project.data.ObjectID,parentRef=project.data.Parent?project.data.Parent.ObjectID:void 0;projTree[thisRef]||(projTree[thisRef]={}),projTree[thisRef].ProjectRecord=project,parentRef&&(projTree[parentRef]||(projTree[parentRef]={}),projTree[parentRef][thisRef]=projTree[thisRef])}return projTree},_loadAllProjects:function(){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){var map=_.reduce(store.getRange(),function(map,project){return map[project.data.ObjectID]=project,map},{});return map})},__addProjectsWithTeamMembersToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;curProj.data.TeamMembers.Count>0&&(hash[curProj.data.ObjectID]=curProj);for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__addProjectsWithTeamMembersToList(projTree[childProjRef],hash)},_loadProjectsWithTeamMembers:function(rootProjectRecord){var me=this,projectsWithTeamMembers={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__addProjectsWithTeamMembersToList(projTree[rootProjectRecord.data.ObjectID],projectsWithTeamMembers),projectsWithTeamMembers}return _.reduce(_.filter(store.getRange(),function(project){return project.data.TeamMembers.Count>0}),function(map,project){return map[project.data.ObjectID]=project,map},{})})},__allChildProjectToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;hash[curProj.data.ObjectID]=curProj;for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__allChildProjectToList(projTree[childProjRef],hash)},_loadAllChildrenProjects:function(rootProjectRecord){var me=this,childrenProjects={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__allChildProjectToList(projTree[rootProjectRecord.data.ObjectID],childrenProjects),childrenProjects}return _.reduce(store.getRange(),function(map,project){return map[project.data.ObjectID]=project,map},{})})},__allLeafProjectsToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;0===curProj.data.Children.Count&&(hash[curProj.data.ObjectID]=curProj);for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__allLeafProjectsToList(projTree[childProjRef],hash)},_loadAllLeafProjects:function(rootProjectRecord){var me=this,leafProjects={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__allLeafProjectsToList(projTree[rootProjectRecord.data.ObjectID],leafProjects),leafProjects}return _.reduce(_.filter(store.getRange(),function(project){return 0===project.data.Children.Count}),function(map,project){return map[project.data.ObjectID]=project,map},{})})},_loadProjectByName:function(projectName){if(!projectName)return Q.reject("Invalid arguments: LPBN");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",limit:1,pageSize:1,fetch:["Name","ObjectID"],disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",value:projectName}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_loadAllReleases:function(projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesAfterGivenDate:function(projectRecord,givenDate){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"ReleaseDate",operator:">=",value:new Date(givenDate).toISOString()},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesBeforeGivenDate:function(projectRecord,givenDate){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!1,disableMetaChangeEvent:!0,fetch:me._releaseFields,filters:[{property:"ReleaseDate",operator:"<=",value:new Date(givenDate).toISOString()},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesBetweenDates:function(projectRecord,startDate,endDate){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!1,fetch:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID},{property:"ReleaseDate",operator:"<=",value:new Date(endDate).toISOString()},{property:"ReleaseDate",operator:">=",value:new Date(startDate).toISOString()}]});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesInTheFuture:function(projectRecord){return this._loadReleasesAfterGivenDate(projectRecord,new Date)},_loadReleasesByNameUnderProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",value:releaseName}],context:{project:projectRecord.data._ref,projectScopeDown:!0,projectScopeUp:!1}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleaseByNameForProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",value:releaseName},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange().pop()})},_loadReleasesByNameContainsForProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",operator:"contains",value:releaseName},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_getScopedRelease:function(releaseRecords,projectOID,appPrefs){var me=this,d=new Date,rs=releaseRecords,prefOID=appPrefs&&appPrefs.projs&&appPrefs.projs[projectOID]&&appPrefs.projs[projectOID].Release;return prefOID&&_.find(rs,function(r){return r.data.ObjectID==prefOID})||_.find(rs,function(r){return new Date(r.data.ReleaseDate)>=d&&d>=new Date(r.data.ReleaseStartDate)})||_.reduce(rs,function(best,r){if(null===best)return r;var d1=new Date(best.data.ReleaseStartDate),d2=new Date(r.data.ReleaseStartDate),now=new Date;return Math.abs(d1-now)<Math.abs(d2-now)?best:r},null)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("WorkweekDropdown",{extend:"Ext.data.Model",fields:[{name:"Workweek",type:"string"},{name:"DateVal",type:"number"}]}),Ext.define("TrainConfigItem",{extend:"Ext.data.Model",fields:[{name:"TrainProjectOID",type:"number"},{name:"TrainName",type:"string"},{name:"TrainAndPortfolioLocationTheSame",type:"boolean"},{name:"PortfolioProjectOID",type:"number"}]})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("WindowListener",{__initWindowEventListener:function(eventName){var me=this;me._windowListeners||(me._windowListeners={}),me._windowListeners[eventName]=[],window.parent["on"+eventName]=function(event){for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i](event)}},_addWindowEventListener:function(eventName,fn){var me=this;me._windowListeners&&me._windowListeners[eventName]||me.__initWindowEventListener(eventName),me._windowListeners[eventName].push(fn)},_fireParentWindowEvent:function(eventName){var me=this;if(me._windowListeners&&me._windowListeners[eventName])for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i]()}})})();
                (function(){var Ext=window.Ext4||window.Ext,TOP_BAR_HEIGHT=40,BOTTOM_BAR_HEIGHT=24,TITLE_BAR_HEIGHT=33,IFRAME_HEADER_HEIGHT=28;Ext.define("IframeResize",{requires:["WindowListener"],_fixRallyDashboard:function(){if(window&&window.frameElement){for(var me=this,bottomEl=Ext.get(window.frameElement),portlet=bottomEl.up(".x-portlet"),dashboard=portlet.up("#mydash_portlet"),titleBar=dashboard.down(".titlebar"),domNodeW=bottomEl.dom,domNodeH=bottomEl.dom,innerHeight=window.parent.innerHeight,innerWidth=window.parent.innerWidth;;){if(domNodeW.style.width=innerWidth-4+"px",domNodeW.style.padding="0",domNodeW.style.margin="0","mydash_portlet"===domNodeW.id)break;domNodeW=domNodeW.parentNode}for(;;){if(domNodeH.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT+TITLE_BAR_HEIGHT+IFRAME_HEADER_HEIGHT)+"px",domNodeH.classList.contains("x-portlet"))break;domNodeH=domNodeH.parentNode}for(;;){if(domNodeH.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT+TITLE_BAR_HEIGHT)+"px","mydash_portlet"==domNodeH.id)break;domNodeH=domNodeH.parentNode}dashboard.dom.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT)+"px",dashboard.dom.style.padding="0 2px 0 2px",titleBar.dom.style.padding="2px",titleBar.dom.style.margin="0"}},_initFixRallyDashboard:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._fixRallyDashboard()}),me._fixRallyDashboard()},_disableResizeHandle:function(){var me=this,handle;window&&window.frameElement&&(handle=Ext.get(window.frameElement).up(".x-portlet").down(".x-resizable-handle"),handle&&(handle.hide(),handle.dom.onshow=function(){handle&&handle.hide()}))},_initDisableResizeHandle:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._disableResizeHandle()}),me._disableResizeHandle()}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("PrettyAlert",{__getMessageBoxY:function(){var me=this,bottomEl=window.frameElement?Ext.get(window.frameElement):me.el,ph=window.frameElement?window.parent.getWindowHeight():window.innerHeight,ps=window.frameElement?window.parent.getScrollY():window.scrollY,ofy=ps+bottomEl.dom.getBoundingClientRect().top,iyOffset=Math.floor(ph/2-ofy+ps-50);return 0>iyOffset?0:iyOffset},_alert:function(title,message){var me=this;message="string"==typeof message?message:message.message?message.message:JSON.stringify(message,null,"	"),1>arguments.length||(1===arguments.length&&(message=title,title=""),Ext.MessageBox.alert(title,message).setY(me.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},50))},_confirm:function(title,message,fn){var me=this;message="string"==typeof message?message:message.message?message.message:JSON.stringify(message,null,"	"),2>arguments.length||(2===arguments.length&&(fn=message,message=title,title=""),"function"!=typeof fn&&(fn=function(){}),Ext.MessageBox.confirm(title,message,fn).setY(me.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},20))}})})();
                (function(){var Ext=window.Ext4||window.Ext,intel_ww={},SECOND=1e3,MINUTE=60*SECOND,HOUR=60*MINUTE,DAY=24*HOUR,WEEK=7*DAY;Ext.define("IntelWorkweek",{_getWorkweek:function(_date){var date=new Date(_date),yearStart=new Date(date.getFullYear(),0,1),dayIndex=yearStart.getDay(),ww01Start=new Date(yearStart-dayIndex*DAY),utcDateMillis=Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()),ww01Millis=Date.UTC(ww01Start.getFullYear(),ww01Start.getMonth(),ww01Start.getDate()),timeDiff=utcDateMillis-ww01Millis,ww=Math.floor(timeDiff/WEEK)+1,leap=0===date.getFullYear()%4,weekCount=leap&&dayIndex>=5||!leap&&6===dayIndex?53:52;return ww>weekCount?1:ww},_getWeekCount:function(_date){var date=new Date(_date),leap=0===date.getFullYear()%4,day=new Date(date.getFullYear(),0,1).getDay();return leap&&day>=5||!leap&&6===day?53:52},_roundDateDownToWeekStart:function(_date){var date=new Date(_date),day=date.getDay(),monthDate=date.getDate(),month=date.getMonth(),year=date.getFullYear(),sundayMidday=new Date(1*new Date(year,month,monthDate)-(day*DAY-.5*DAY));return new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())},_getWorkweekDates:function(startDate,endDate){for(var startWeekDate=this._roundDateDownToWeekStart(startDate),endWeekDate=this._roundDateDownToWeekStart(endDate),startMillis=Date.UTC(startWeekDate.getFullYear(),startWeekDate.getMonth(),startWeekDate.getDate()),endMillis=Date.UTC(endWeekDate.getFullYear(),endWeekDate.getMonth(),endWeekDate.getDate()),totalWeeks=Math.floor((endMillis-startMillis)/WEEK)+1,weeks=Array(totalWeeks),i=0;totalWeeks>i;++i){var sundayMidday=new Date(1*startWeekDate+(WEEK*i+12*HOUR));weeks[i]=new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())}return weeks},_workweekToDate:function(ww,year){var yearStart=new Date(year,0,1),dayIndex=yearStart.getDay(),ww01StartMidday=new Date(yearStart-(dayIndex*DAY-.5*DAY)),sundayMidday=new Date(1*ww01StartMidday+(ww-1)*WEEK);return new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())},_getWorkWeeksForDropdown:function(releaseStartDate,releaseEndDate){for(var workweeks=this._getWorkweekDates(releaseStartDate,releaseEndDate),data=Array(workweeks.length),i=0,len=workweeks.length;len>i;++i)data[i]={Workweek:"ww"+this._getWorkweek(workweeks[i]),DateVal:1*workweeks[i]};return data}})})();
                (function(){var Ext=window.Ext4||window.Ext,ChartsTooltipDatemap={},RSquaredMap={};Ext.define("CumulativeFlowChartMixin",{requires:["IntelRallyApp","IntelWorkweek"],_defaultCumulativeFlowChartConfig:{chart:{defaultSeriesType:"area",zoomType:"xy"},colors:["#ABABAB","#E57E3A","#E5D038","#0080FF","#3A874F","#26FF00","#000000"],xAxis:{tickmarkPlacement:"on",title:{text:"Days",margin:10},labels:{y:20}},yAxis:{title:{text:"Points"},labels:{x:-5,y:4}},tooltip:{formatter:function(){for(var sum=0,datemap=ChartsTooltipDatemap[this.series.chart.container.id],rSquaredMap=RSquaredMap[this.series.chart.container.id],i=4;i>=this.series.index;--i)sum+=this.series.chart.series[i].data[this.point.x].y;return"<b>"+this.x+"</b>"+(datemap?" ("+datemap[this.point.x]+")":"")+(rSquaredMap&&rSquaredMap[this.series.index]?"<br/><b>R<sup>2</sup> = "+rSquaredMap[this.series.index].val:"")+"<br /><b>"+this.series.name+"</b>: "+(100*this.y>>0)/100+(4>=this.series.index?"<br /><b>Total</b>: "+(100*sum>>0)/100:"")}},plotOptions:{series:{marker:{enabled:!1,states:{hover:{enabled:!0}}},groupPadding:.01},area:{stacking:"normal",lineColor:"#666666",lineWidth:2,marker:{enabled:!1}}}},_getCumulativeFlowChartColors:function(){var me=this,colors=me._defaultCumulativeFlowChartConfig.colors,scheduleStates=me.ScheduleStates;return scheduleStates.length>=5?{colors:colors}:{colors:colors.slice(0,scheduleStates.length).concat(colors.slice(scheduleStates.length+1))}},_getValidTrendTypes:function(){return["FromZero","FromStartAccepted","FromStartWork","LastWeek","LastSprint","Last2Sprints","LinearRegression","LinearRegressionFromStartAccepted","LinearRegressionFromStartWork"]},__getRSquared:function(ySeries,fSeries,lastIndex){if(0>=lastIndex)return 1;var ys=ySeries.data.slice(0,lastIndex),fs=fSeries.data.slice(0,lastIndex),meanY=_.reduce(ys,function(sum,yi){return sum+(yi||0)},0)/ys.length,SStot=_.reduce(ys,function(sum,yi){return sum+Math.pow((yi||0)-meanY,2)},0),SSres=_.reduce(fs,function(sum,fi,i){return sum+Math.pow((ys[i]||0)-(fi||0),2)},0);return(1e3*(1-SSres/SStot)>>0)/1e3},__addProjectedTrendline:function(data,options){var me=this,totalPoints=options.totalPoints,trendType=options.trendType,validTypes=me._getValidTrendTypes(),slope,intercept,X,Y,scheduleStateSeries=_.filter(data.series,function(s){return me.ScheduleStates.indexOf(s.name)>-1}),scheduleStatesSumList=_.times(scheduleStateSeries[0].length,function(n){return _.reduce(scheduleStateSeries,function(sum,s){return sum+(s.data[n]||0)},0)});trendType=_.find(validTypes,function(type){return type==trendType})||validTypes[0];var topScheduleState=me.ScheduleStates.slice(-1)[0],topScheduleStateSeries=_.find(data.series,function(s){return s.name===topScheduleState}),i,len,projectedTrend={type:"spline",dashStyle:"Solid",name:"Projected",data:topScheduleStateSeries.data.slice()},begin=0,end=projectedTrend.data.length-1;if("FromZero"==trendType){for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){return(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100})}if("FromStartAccepted"==trendType){for(i=1;projectedTrend.data.length>i;++i)if(null!==projectedTrend.data[i]&&0!==projectedTrend.data[i]){begin=i-1;break}for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("FromStartWork"==trendType){for(i=1;scheduleStatesSumList.length>i;++i)if(null!==scheduleStatesSumList[i]&&0!==scheduleStatesSumList[i]){begin=i-1;break}for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("LastWeek"==trendType){for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}begin=0>end-5?0:end-5,slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("LastSprint"==trendType){for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}begin=0>end-10?0:end-10,slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("Last2Sprints"==trendType){for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}begin=0>end-20?0:end-20,slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("LinearRegression"==trendType){for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}X=$M(_.map(projectedTrend.data.slice(begin,end),function(p,j){return[1,j]})),Y=$M(_.map(projectedTrend.data.slice(begin,end),function(p){return p})),b=X.transpose().multiply(X).inverse().multiply(X.transpose().multiply(Y)),slope=b.elements[1][0],intercept=b.elements[0][0],projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(intercept+j*slope)>>0)/100;return 0>pt?0:pt})}if("LinearRegressionFromStartAccepted"==trendType){for(i=1;projectedTrend.data.length>i;++i)if(null!==projectedTrend.data[i]&&0!==projectedTrend.data[i]){begin=i-1;break}for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}X=$M(_.map(projectedTrend.data.slice(begin,end),function(p,j){return[1,j]})),Y=$M(_.map(projectedTrend.data.slice(begin,end),function(p){return p})),b=X.transpose().multiply(X).inverse().multiply(X.transpose().multiply(Y)),slope=b.elements[1][0],intercept=b.elements[0][0],projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(intercept+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("LinearRegressionFromStartWork"==trendType){for(i=1;scheduleStatesSumList.length>i;++i)if(null!==scheduleStatesSumList[i]&&0!==scheduleStatesSumList[i]){begin=i-1;break}for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}X=$M(_.map(projectedTrend.data.slice(begin,end),function(p,j){return[1,j]})),Y=$M(_.map(projectedTrend.data.slice(begin,end),function(p){return p})),b=X.transpose().multiply(X).inverse().multiply(X.transpose().multiply(Y)),slope=b.elements[1][0],intercept=b.elements[0][0],projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(intercept+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if(slope>=0)for(i=1,len=projectedTrend.data.length;len>i;++i)if(projectedTrend.data[i]>=totalPoints){projectedTrend.data[i]={color:"red",marker:{enabled:!0,lineWidth:4,symbol:"circle",fillColor:"red",lineColor:"red"},y:projectedTrend.data[i]};break}return projectedTrend},_updateCumulativeFlowChartData:function(data,options){_.merge({},options);var me=this,now=new Date,trendType=options.trendType,hideTrends=options.hideTrends,todayIndex=-1,datemap=[],rSquaredMap=[];todayIndex=new Date(data.categories[0])>now?-1:now>new Date(data.categories[data.categories.length-1])?data.categories.length:_.reduce(data.categories,function(savedI,c,i){return new Date(c)>now&&-1===savedI&&(savedI=i-1),savedI},-1);var topScheduleState=me.ScheduleStates.slice(-1)[0],topScheduleStateSeries=_.find(data.series,function(s){return s.name===topScheduleState}),totalPoints=new Date(data.categories[0])>now?0:_.reduce(data.series,function(sum,s){return sum+(s.data[s.data.length-1]||0)},0)||0,idealTrend,ratio;if(hideTrends||(idealTrend={type:"spline",dashStyle:"Solid",name:"Ideal",data:Array(data.categories.length)},ratio=totalPoints/(data.categories.length-1)||0,idealTrend.data=_.map(idealTrend.data,function(e,i){return Math.round(100*(0+i*ratio))/100})),_.each(data.categories,function(c,i,a){var d=new Date(c);a[i]="ww"+me._getWorkweek(d),datemap[i]=c,d>now&&_.each(data.series,function(s,j){s.data=s.data.slice(0,i).concat(_.map(Array(a.length-i),function(){return 0}))})}),!hideTrends){var projectedTrend=me.__addProjectedTrendline(data,{totalPoints:totalPoints,trendType:trendType});data.series.push(projectedTrend),rSquaredMap[data.series.length-1]={val:me.__getRSquared(projectedTrend,topScheduleStateSeries,todayIndex)},data.series.push(idealTrend)}return data.datemap=datemap,data.rSquaredMap=rSquaredMap,data},_getCumulativeFlowChartTicks:function(startDate,endDate,width){var pixelTickWidth=40,ticks=width/pixelTickWidth>>0,oneDay=864e5,days=(1*endDate-1*startDate)/oneDay>>0,interval=7*((days/ticks>>0)/7>>0);return 7>interval?7:interval},_setCumulativeFlowChartDatemap:function(chartContainerId,datemap){ChartsTooltipDatemap[chartContainerId]=datemap},_setCumulativeFlowChartRSquaredMap:function(chartContainerId,rSquaredMap){RSquaredMap[chartContainerId]=rSquaredMap}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("UserAppsPreference",{_userAppsPref:"intel-user-apps-preference",_loadAppsPreference:function(){var me=this,deferred=Q.defer();return Rally.data.PreferenceManager.load({filterByUser:!0,filterByName:me._userAppsPref,success:function(prefs){var appPrefs=prefs[me._userAppsPref];try{appPrefs=JSON.parse(appPrefs)}catch(e){appPrefs={projs:{},refresh:0}}deferred.resolve(appPrefs)},failure:deferred.reject}),deferred.promise},_saveAppsPreference:function(prefs){var me=this,s={},deferred=Q.defer();return prefs={projs:prefs.projs,refresh:prefs.refresh},s[me._userAppsPref]=JSON.stringify(prefs),Rally.data.PreferenceManager.update({filterByUser:!0,filterByName:me._userAppsPref,settings:s,success:deferred.resolve,failure:deferred.reject}),deferred.promise}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("ParallelLoader",{__parallelLoadData:function(config){var me=this,pagesize=config.pagesize,url=config.url,params=config.params,promises=[],outputItems=[];return totalRequestsSent=1,_.times(totalRequestsSent,function(pageNum){var thisDeferred=Q.defer(),thisParams=Ext.merge({},params);promises.push(thisDeferred.promise),thisParams.start=config.itemOffset+pagesize*pageNum,Ext.Ajax.request({url:url,method:"GET",params:thisParams,success:function(response){var resJSON=JSON.parse(response.responseText),items=resJSON.QueryResult?resJSON.QueryResult.Results:resJSON.Results,totalCount=resJSON.QueryResult?resJSON.QueryResult.TotalResultCount:resJSON.TotalResultCount,totalPages=(totalCount/pagesize>>0)+(totalCount%pagesize?1:0);if(outputItems=outputItems.concat(items),totalPages>totalRequestsSent){var additionalPromises=[];_.times(totalPages-totalRequestsSent,function(){var nextDeferred=Q.defer(),thisParams=Ext.merge({},params);additionalPromises.push(nextDeferred.promise),thisParams.start=config.itemOffset+pagesize*totalRequestsSent,++totalRequestsSent,Ext.Ajax.request({url:url,method:"GET",params:thisParams,success:function(response){var resJSON=JSON.parse(response.responseText),items=resJSON.QueryResult?resJSON.QueryResult.Results:resJSON.Results;outputItems=outputItems.concat(items),nextDeferred.resolve()},failure:function(response){console.log("error",response),nextDeferred.reject(response)}})}),Q.all(additionalPromises).then(function(){thisDeferred.resolve()})}else thisDeferred.resolve()},failure:function(response){thisDeferred.reject(response)}})}),Q.all(promises).then(function(){return outputItems})},_parallelLoadWsapiStore:function(config){var me=this;return config.itemOffset=1,config.pagesize=config.pagesize>0&&200>=config.pagesize?config.pagesize:200,me.__parallelLoadData(config).then(function(items){var featureStore=Ext.create("Rally.data.wsapi.Store",{model:config.model,totalCount:items.length,data:items,load:function(){}});return featureStore})},_parallelLoadLookbackStore:function(config){var me=this;return config.itemOffset=0,config.pagesize=config.pagesize>0&&2e4>=config.pagesize?config.pagesize:2e4,me.__parallelLoadData(config).then(function(items){return Ext.create("Rally.data.lookback.SnapshotStore",{totalCount:items.length,data:items,model:Ext.define("Rally.data.lookback.SnapshotModel-"+Ext.id(),{extend:"Rally.data.lookback.SnapshotModel",fields:JSON.parse(config.params.fields||"[]")}),load:function(){}})})}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelFixedComboBox",{extend:"Ext.form.field.ComboBox",alias:["widget.intelfixedcombo","widget.intelfixedcombobox"],constructor:function(options){options=options||{},options=Ext.merge({editable:!1,allowBlank:!0,queryMode:"local",listeners:{change:function(combo,newval,oldval){0===newval.length&&combo.setValue(oldval)},focus:function(combo){combo.setValue(""),combo.expand()}}},options),this.callParent([options])}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelReleasePicker",{extend:"IntelFixedComboBox",alias:["widget.intelreleasepicker"],constructor:function(options){options.releases&&options.currentRelease&&(options.displayField="Name",options.value=options.currentRelease.data.Name,options.store=Ext.create("Ext.data.Store",{fields:["Name"],data:_.map(options.releases,function(r){return{Name:r.data.Name}})}),options.fieldLabel=options.fieldLabel||"Release:",options.editable=options.editable||!1,options.width=options.width||240,options.labelWidth=options.labelWidth||50,this.callParent([options]))}})})();
                (function(){var Ext=window.Ext4||window.Ext,POLL_INTERVAL_MS=10;Ext.define("Skirtle.CTemplate",{extend:"Ext.XTemplate",statics:{AUTO_ID:0},copyDepth:10,cTpl:'<p id="ctemplate-{0}-{1}"></p>',isCTemplate:!0,constructor:function(){var me=this;me.callParent(arguments),me.id=++me.statics().AUTO_ID,me.reset()},copyValues:function(values,depth){var me=this,id,copy={},copyDepth=depth||me.copyDepth;return 1===copyDepth?values:Ext.isArray(values)?Ext.Array.map(values,function(value){return me.copyValues(value,copyDepth-1)}):Ext.isObject(values)?values.isComponent?(id=values.getId(),me.ids.push(id),Ext.String.format(me.cTpl,id,me.id)):(Ext.Object.each(values,function(key,value){copy[key]="$comp"===key?value:me.copyValues(value,copyDepth-1)}),copy):values},doInsert:function(){var ret=this.callParent(arguments);return this.injectComponents(),ret},doPolling:function(interval){var me=this;me.pollInterval=interval,me.pollId&&clearTimeout(me.pollId),me.pollId=Ext.defer(me.injectComponents,interval,me)},getPlaceholderEl:function(id){return Ext.get("ctemplate-"+id+"-"+this.id)},injectComponents:function(){for(var me=this,ids=me.ids,index=ids.length-1,id,cmp,placeholderEl;index>=0;--index)id=ids[index],cmp=Ext.getCmp(id),placeholderEl=me.getPlaceholderEl(id),(me.renderComponent(cmp,placeholderEl)||!cmp)&&(Ext.Array.splice(ids,index,1),placeholderEl&&placeholderEl.remove());ids.length&&me.doPolling(me.pollInterval)},overwrite:function(el){var dom,firstChild,ret;if(Ext.isIE)for(dom=Ext.getDom(el);dom.firstChild;)dom.removeChild(dom.firstChild);return ret=this.callParent(arguments),this.injectComponents(),ret},renderComponent:function(cmp,placeholderEl){if(cmp&&placeholderEl){var parent=placeholderEl.parent();return cmp.rendered?cmp.getEl().replace(placeholderEl):cmp.render(parent,placeholderEl),Ext.isIE6&&parent.repaint(),!0}return!1},reset:function(){var me=this;me.ids=[],me.pollId&&(clearTimeout(me.pollId),me.pollId=null)}},function(ctemplate){var apply=function(){var me=this,args=Ext.Array.slice(arguments);return args[0]=me.copyValues(args[0]),me.doPolling(POLL_INTERVAL_MS),me.callParent(args)};ctemplate.prototype.applyOut?ctemplate.override({applyOut:apply}):(ctemplate.override({applyTemplate:apply}),ctemplate.createAlias("apply","applyTemplate"))}),Ext.define("Skirtle.grid.column.Component",{alias:"widget.componentcolumn",extend:"Ext.grid.column.Column",requires:["Skirtle.CTemplate"],autoWidthComponents:!0,componentGC:!0,hasCustomRenderer:!0,lastFrameWidth:12,widthUpdateDelay:[10,400],constructor:function(cfg){var me=this;me.callParent(arguments),me.compIds=[],me.dataIndex=me.dataIndex||Ext.id(null,"cc-dataIndex-"),me.tpl=me.createTemplate(me.tpl),me.renderer=me.createRenderer(me.renderer),me.registerColumnListeners()},addRefOwner:function(child){var me=this,fn=me.refOwnerFn||(me.refOwnerFn=function(){return me});40200>me.extVersion?child.getBubbleTarget=fn:child.getRefOwner=fn},applyTemplate:function(data,value){return Ext.isDefined(value)&&(data[this.dataIndex]=value),this.tpl.apply(data)},beforeViewRefresh:function(){if(Ext.isIE)for(var ids=this.compIds,index=0,len=ids.length,item,el,parentEl;len>index;index++)(item=Ext.getCmp(ids[index]))&&(el=item.getEl())&&(el=el.dom)&&(parentEl=el.parentNode)&&parentEl.removeChild(el)},calculateFrameWidth:function(component){var el=component.getEl(),parentDiv=el&&el.parent(),parentTd=parentDiv&&parentDiv.parent();return parentTd?(this.lastFrameWidth=parentDiv.getFrameWidth("lr")+parentTd.getFrameWidth("lr"),this.lastFrameWidth):void 0},createRenderer:function(renderer){var me=this;return function(value,p,record){var data=Ext.apply({},record.data,record.getAssociatedData());return renderer&&(value=renderer.apply(this,arguments)),value=me.processValue(value),me.applyTemplate(data,value)}},createTemplate:function(tpl){return tpl&&tpl.isTemplate?tpl:Ext.create("Skirtle.CTemplate",tpl||["{",this.dataIndex,"}"])},destroyChild:function(child){child.destroy()},getRefItems:function(deep){for(var items=this.callParent([deep]),ids=this.compIds,index=0,len=ids.length,item;len>index;index++)item=Ext.getCmp(ids[index]),item&&(items.push(item),deep&&item.getRefItems&&items.push.apply(items,item.getRefItems(!0)));return items},onChildAfterRender:function(child){this.resizeChild(child)},onChildBoxReady:function(child){this.resizeChild(child,!1)},onChildDestroy:function(child){Ext.Array.remove(this.compIds,child.getId())},onChildResize:function(){this.redoScrollbars()},onColumnResize:function(column){column.resizeAll()},onColumnShow:function(column){column.resizeAll()},onColumnVisibilityChange:function(column){var items=column.getRefItems(),index=0,length=items.length,visible=!column.isHidden();for(Ext.suspendLayouts&&Ext.suspendLayouts();length>index;++index)items[index].setVisible(visible);Ext.resumeLayouts&&Ext.resumeLayouts(!0)},onDestroy:function(){Ext.destroy(this.getRefItems()),this.callParent()},onRender:function(){this.registerViewListeners(),this.callParent(arguments)},onViewChange:function(){var me=this,tpl=me.tpl;me.suspendResizing(),tpl.isCTemplate&&(tpl.injectComponents(),tpl.reset()),me.redoScrollbars(),me.resumeResizing(),me.performGC()},performGC:function(){for(var compIds=this.compIds,index=compIds.length-1,comp,el;index>=0;--index)comp=Ext.getCmp(compIds[index]),el=comp&&comp.getEl(),el&&(!this.componentGC||el.dom&&Ext.getDom(Ext.id(el))===el.dom)||comp&&!comp.isDestroyed&&comp.destroy()},processValue:function(value){var me=this,compIds=me.compIds,id,initialWidth,dom,parent;return Ext.isObject(value)&&!value.isComponent&&value.xtype&&(value=Ext.widget(value.xtype,value)),value&&value.isComponent&&(id=value.getId(),Ext.Array.contains(compIds,id)||compIds.push(id),me.addRefOwner(value),me.registerListeners(value),value.rendered?Ext.isIE&&(dom=value.el.dom,parent=dom.parentNode,parent&&(40101===me.extVersion&&Ext.core.DomHelper.insertBefore(dom,{tag:"p"}),parent.removeChild(dom))):me.autoWidthComponents&&(initialWidth=me.getWidth()-me.lastFrameWidth,initialWidth=initialWidth>4?initialWidth:4,value.setWidth(initialWidth)),(Ext.isIE6||Ext.isIE7)&&me.isHidden()&&value.hide()),value},redoScrollbars:function(){var me=this,grid=me.up("tablepanel");if(grid){if(me.resizeQueue)return me.redoScrollbarsRequired=!0,void 0;40100>me.extVersion?(grid.invalidateScroller(),grid.determineScrollbars()):grid.doLayout()}},registerColumnListeners:function(){var me=this;me.autoWidthComponents&&(me.on("resize",me.onColumnResize),me.on("show",me.onColumnShow)),(Ext.isIE6||Ext.isIE7)&&me.on({hide:me.onColumnVisibilityChange,show:me.onColumnVisibilityChange})},registerListeners:function(component){var me=this;component.on("destroy",me.onChildDestroy,me),me.autoWidthComponents&&(component.on("afterrender",me.onChildAfterRender,me,{single:!0}),me.extVersion>=40100&&component.on("boxready",me.onChildBoxReady,me,{single:!0})),component.on("resize",me.onChildResize,me)},registerViewListeners:function(){var me=this,view=me.up("tablepanel").getView();me.mon(view,"beforerefresh",me.beforeViewRefresh,me),me.mon(view,"refresh",me.onViewChange,me),me.mon(view,"itemupdate",me.onViewChange,me),me.mon(view,"itemadd",me.onViewChange,me),me.mon(view,"itemremove",me.onViewChange,me)},resizeAll:function(){var me=this;me.suspendResizing(),me.resizeQueue=me.getRefItems(),me.resumeResizing()},resizeChild:function(component,defer){var me=this,frameWidth,newWidth,oldWidth,resizeQueue;return me.resizingSuspended?(resizeQueue=me.resizeQueue,Ext.Array.contains(resizeQueue,component)||resizeQueue.push(component),void 0):(frameWidth=me.calculateFrameWidth(component),Ext.isNumber(frameWidth)&&(newWidth=me.getWidth()-frameWidth,oldWidth=component.getWidth(),me.setChildWidth(component,newWidth,oldWidth)&&defer!==!1&&Ext.each(me.widthUpdateDelay,function(delay){Ext.defer(me.resizeChild,delay,me,[component,!1])})),void 0)},resumeResizing:function(){var me=this,index=0,resizeQueue=me.resizeQueue,len=resizeQueue.length;if(!--me.resizingSuspended){for(;len>index;++index)me.resizeChild(resizeQueue[index]);me.resizeQueue=null,me.redoScrollbarsRequired&&me.redoScrollbars()}},setChildWidth:function(component,newWidth,oldWidth){return oldWidth===newWidth?!1:(component.setWidth(newWidth),!0)},suspendResizing:function(){var me=this;me.resizingSuspended=(me.resizingSuspended||0)+1,me.resizeQueue||(me.resizeQueue=[])}},function(cls){var proto=cls.prototype,version=Ext.getVersion();proto.extVersion=100*(100*version.getMajor()+version.getMinor())+version.getPatch(),Ext.Element.prototype.syncContent&&"4.1.0"==""+version&&(proto.extVersion=40101)})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("intel.grid.column.Component.",{alias:"widget.fastgridcolumn",extend:"Skirtle.grid.column.Component",autoWidthComponents:!1,componentGC:!0,hasCustomRenderer:!0,lastFrameWidth:12,constructor:function(cfg){var me=this;me.callParent(arguments)},registerViewListeners:function(){var me=this,view=me.up("tablepanel").getView();me.mon(view,"beforerefresh",me.beforeViewRefresh,me),me.mon(view,"refresh",me.onViewChange,me)},onViewChange:function(){var me=this,tpl=me.tpl;me.suspendResizing(),tpl.isCTemplate&&(tpl.injectComponents(),tpl.reset()),me.resumeResizing(),me.performGC()},resumeResizing:function(){var me=this,index=0,resizeQueue=me.resizeQueue,len=resizeQueue.length;if(!--me.resizingSuspended){for(;len>index;++index)me.resizeChild(resizeQueue[index]);me.resizeQueue=null}},onChildResize:function(){}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("FastCumulativeFlowCalculator",{constructor:function(options){this.scheduleStates=options.scheduleStates,this.startDate=options.startDate,this.endDate=options.endDate},_getDates:function(){for(var dates=[],curDay=this.startDate,day=864e5,n;this.endDate>curDay;)n=curDay.getDay(),this._dateToStringDisplay(curDay)===this._dateToStringDisplay(new Date)?dates.push(new Date):dates.push(curDay),curDay=new Date(1*curDay+day);return dates},_dateToStringDisplay:function(date){return Ext.Date.format(date,"m/d/Y")},_getIndexHelper:function(date,dateArray){for(var curVal=dateArray.length/2,curInt=curVal>>0,div=curVal/2,lastInt=-1;curInt!==lastInt;){if(dateArray[curInt]===date)return curInt;dateArray[curInt]>date?curVal-=div:curVal+=div,div/=2,lastInt=curInt,curInt=curVal>>0}return curInt},_getIndexBefore:function(date,dateArray){if(0===dateArray.length)return-1;var pos=this._getIndexHelper(date,dateArray);return date>dateArray[pos]?pos:pos-1},_getIndexOnOrAfter:function(date,dateArray){if(0===dateArray.length)return-1;var pos=this._getIndexHelper(date,dateArray);return pos===dateArray.length-1?dateArray[pos]>=date?pos:-1:dateArray[pos]>=date?pos:pos+1},runCalculation:function(items){if(!this.scheduleStates||!this.startDate||!this.endDate)throw"invalid constructor config";for(var dates=this._getDates(),day=864e5,dateMapTemplate=_.map(Array(dates.length),function(){return 0}),totals=_.reduce(this.scheduleStates,function(map,ss){return map[ss]=dateMapTemplate.slice(),map},{}),itemIndex=0,len=items.length;len>itemIndex;++itemIndex){var item=items[itemIndex].raw,iStart=new Date(item._ValidFrom),iEnd=new Date(item._ValidTo),state=item.ScheduleState,pe=item.PlanEstimate;if(pe&&state){var startIndex=this._getIndexOnOrAfter(iStart,dates),endIndex=this._getIndexBefore(iEnd,dates);if(-1!==startIndex&&-1!==endIndex)for(var i=startIndex;endIndex>=i;++i)totals[state][i]+=pe}}return{categories:_.map(dates,function(d){return this._dateToStringDisplay(d)},this),series:_.reduce(this.scheduleStates,function(outputArray,ss){return outputArray.concat([{name:ss,type:"area",dashStyle:"Solid",data:totals[ss]}])},[])}}})})();
                (function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory(jQuery)})(function($){function focusable(element,hasTabindex){var map,mapName,img,nodeName=element.nodeName.toLowerCase();return"area"===nodeName?(map=element.parentNode,mapName=map.name,element.href&&mapName&&"map"===map.nodeName.toLowerCase()?(img=$("img[usemap='#"+mapName+"']")[0],!!img&&visible(img)):!1):(/^(input|select|textarea|button|object)$/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||hasTabindex:hasTabindex)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length}$.ui=$.ui||{},$.extend($.ui,{version:"@VERSION",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},safeActiveElement:function(document){var activeElement;try{activeElement=document.activeElement}catch(error){activeElement=document.body}return activeElement||(activeElement=document.body),activeElement.nodeName||(activeElement=document.body),activeElement},safeBlur:function(element){element&&"body"!==element.nodeName.toLowerCase()&&$(element).blur()}}),$.fn.extend({scrollParent:function(includeHidden){var position=this.css("position"),excludeStaticParent="absolute"===position,overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/,scrollParent=this.parents().filter(function(){var parent=$(this);return excludeStaticParent&&"static"===parent.css("position")?!1:overflowRegex.test(parent.css("overflow")+parent.css("overflow-y")+parent.css("overflow-x"))}).eq(0);return"fixed"!==position&&scrollParent.length?scrollParent:$(this[0].ownerDocument||document)},uniqueId:function(){var uuid=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++uuid)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&$(this).removeAttr("id")})}}),$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,null!=$.attr(element,"tabindex"))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),hasTabindex=null!=tabIndex;return(!hasTabindex||tabIndex>=0)&&focusable(element,hasTabindex)}}),"1.7"===$.fn.jquery.substring(0,3)&&($.each(["Width","Height"],function(i,name){function reduce(elem,size,border,margin){return $.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0,border&&(size-=parseFloat($.css(elem,"border"+this+"Width"))||0),margin&&(size-=parseFloat($.css(elem,"margin"+this))||0)}),size}var side="Width"===name?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};$.fn["inner"+name]=function(size){return void 0===size?orig["inner"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+"px")})},$.fn["outer"+name]=function(size,margin){return"number"!=typeof size?orig["outer"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+"px")})}}),$.fn.addBack=function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}),$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),$.fn.extend({disableSelection:function(){var eventType="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(eventType+".ui-disableSelection",function(event){event.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")}}),$.ui.plugin={add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set)proto.plugins[i]=proto.plugins[i]||[],proto.plugins[i].push([option,set[i]])},call:function(instance,name,args,allowDisconnected){var i,set=instance.plugins[name];if(set&&(allowDisconnected||instance.element[0].parentNode&&11!==instance.element[0].parentNode.nodeType))for(i=0;set.length>i;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}}});
                (function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory(jQuery)})(function($){function focusable(element,hasTabindex){var map,mapName,img,nodeName=element.nodeName.toLowerCase();return"area"===nodeName?(map=element.parentNode,mapName=map.name,element.href&&mapName&&"map"===map.nodeName.toLowerCase()?(img=$("img[usemap='#"+mapName+"']")[0],!!img&&visible(img)):!1):(/^(input|select|textarea|button|object)$/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||hasTabindex:hasTabindex)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length}$.ui=$.ui||{},$.extend($.ui,{version:"@VERSION",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38},safeActiveElement:function(document){var activeElement;try{activeElement=document.activeElement}catch(error){activeElement=document.body}return activeElement||(activeElement=document.body),activeElement.nodeName||(activeElement=document.body),activeElement},safeBlur:function(element){element&&"body"!==element.nodeName.toLowerCase()&&$(element).blur()}}),$.fn.extend({scrollParent:function(includeHidden){var position=this.css("position"),excludeStaticParent="absolute"===position,overflowRegex=includeHidden?/(auto|scroll|hidden)/:/(auto|scroll)/,scrollParent=this.parents().filter(function(){var parent=$(this);return excludeStaticParent&&"static"===parent.css("position")?!1:overflowRegex.test(parent.css("overflow")+parent.css("overflow-y")+parent.css("overflow-x"))}).eq(0);return"fixed"!==position&&scrollParent.length?scrollParent:$(this[0].ownerDocument||document)},uniqueId:function(){var uuid=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++uuid)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&$(this).removeAttr("id")})}}),$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,null!=$.attr(element,"tabindex"))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),hasTabindex=null!=tabIndex;return(!hasTabindex||tabIndex>=0)&&focusable(element,hasTabindex)}}),"1.7"===$.fn.jquery.substring(0,3)&&($.each(["Width","Height"],function(i,name){function reduce(elem,size,border,margin){return $.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0,border&&(size-=parseFloat($.css(elem,"border"+this+"Width"))||0),margin&&(size-=parseFloat($.css(elem,"margin"+this))||0)}),size}var side="Width"===name?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};$.fn["inner"+name]=function(size){return void 0===size?orig["inner"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+"px")})},$.fn["outer"+name]=function(size,margin){return"number"!=typeof size?orig["outer"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+"px")})}}),$.fn.addBack=function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}),$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),$.fn.extend({disableSelection:function(){var eventType="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(eventType+".ui-disableSelection",function(event){event.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")}}),$.ui.plugin={add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set)proto.plugins[i]=proto.plugins[i]||[],proto.plugins[i].push([option,set[i]])},call:function(instance,name,args,allowDisconnected){var i,set=instance.plugins[name];if(set&&(allowDisconnected||instance.element[0].parentNode&&11!==instance.element[0].parentNode.nodeType))for(i=0;set.length>i;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}}});
                (function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory(jQuery)})(function($){var widget_uuid=0,widget_slice=Array.prototype.slice;return $.cleanData=function(orig){return function(elems){var events,elem,i;for(i=0;null!=(elem=elems[i]);i++)try{events=$._data(elem,"events"),events&&events.remove&&$(elem).triggerHandler("remove")}catch(e){}orig(elems)}}($.cleanData),$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];return name=name.split(".")[1],fullName=namespace+"-"+name,prototype||(prototype=base,base=$.Widget),$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)},$[namespace]=$[namespace]||{},existingConstructor=$[namespace][name],constructor=$[namespace][name]=function(options,element){return this._createWidget?(arguments.length&&this._createWidget(options,element),void 0):new constructor(options,element)},$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]}),basePrototype=new base,basePrototype.options=$.widget.extend({},basePrototype.options),$.each(prototype,function(prop,value){return $.isFunction(value)?(proxiedPrototype[prop]=function(){var _super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)};return function(){var __super=this._super,__superApply=this._superApply,returnValue;return this._super=_super,this._superApply=_superApply,returnValue=value.apply(this,arguments),this._super=__super,this._superApply=__superApply,returnValue}}(),void 0):(proxiedPrototype[prop]=value,void 0)}),constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix||name:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName}),existingConstructor?($.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)}),delete existingConstructor._childConstructors):base._childConstructors.push(constructor),$.widget.bridge(name,constructor),constructor},$.widget.extend=function(target){for(var input=widget_slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;inputLength>inputIndex;inputIndex++)for(key in input[inputIndex])value=input[inputIndex][key],input[inputIndex].hasOwnProperty(key)&&void 0!==value&&(target[key]=$.isPlainObject(value)?$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value):value);return target},$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall="string"==typeof options,args=widget_slice.call(arguments,1),returnValue=this;return isMethodCall?this.each(function(){var methodValue,instance=$.data(this,fullName);return"instance"===options?(returnValue=instance,!1):instance?$.isFunction(instance[options])&&"_"!==options.charAt(0)?(methodValue=instance[options].apply(instance,args),methodValue!==instance&&void 0!==methodValue?(returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue,!1):void 0):$.error("no such method '"+options+"' for "+name+" widget instance"):$.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'")}):(args.length&&(options=$.widget.extend.apply(null,[options].concat(args))),this.each(function(){var instance=$.data(this,fullName);instance?(instance.option(options||{}),instance._init&&instance._init()):$.data(this,fullName,new object(options,this))})),returnValue}},$.Widget=function(){},$.Widget._childConstructors=[],$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0],this.element=$(element),this.uuid=widget_uuid++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=$(),this.hoverable=$(),this.focusable=$(),this.classesElementLookup={},element!==this&&($.data(element,this.widgetFullName,this),this._on(!0,this.element,{remove:function(event){event.target===element&&this.destroy()}}),this.document=$(element.style?element.ownerDocument:element.document||element),this.window=$(this.document[0].defaultView||this.document[0].parentWindow)),this.options=$.widget.extend({},this.options,this._getCreateOptions(),options),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){var that=this;this._destroy(),$.each(this.classesElementLookup,function(key,value){that._removeClass(value,key)}),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.unbind(this.eventNamespace)},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var options=key,parts,curOption,i;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof key)if(options={},parts=key.split("."),key=parts.shift(),parts.length){for(curOption=options[key]=$.widget.extend({},this.options[key]),i=0;parts.length-1>i;i++)curOption[parts[i]]=curOption[parts[i]]||{},curOption=curOption[parts[i]];if(key=parts.pop(),1===arguments.length)return void 0===curOption[key]?null:curOption[key];curOption[key]=value}else{if(1===arguments.length)return void 0===this.options[key]?null:this.options[key];options[key]=value}return this._setOptions(options),this},_setOptions:function(options){var key;for(key in options)this._setOption(key,options[key]);return this},_setOption:function(key,value){return"classes"===key&&this._setOptionClasses(value),this.options[key]=value,"disabled"===key&&(this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!value),value&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))),this},_setOptionClasses:function(value){var classKey,elements,currentElements;for(classKey in value)currentElements=this.classesElementLookup[classKey],value[classKey]!==this.options.classes[classKey]&&currentElements&&currentElements.length&&(elements=$(currentElements.get()),this._removeClass(currentElements,classKey),elements.addClass(this._classes({element:elements,keys:classKey,classes:value,add:!0})))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(options){function processClassString(classes,checkOption){var current,i;for(i=0;classes.length>i;i++)current=that.classesElementLookup[classes[i]]||$(),current=options.add?$($.unique(current.get().concat(options.element.get()))):$(current.not(options.element).get()),that.classesElementLookup[classes[i]]=current,full.push(classes[i]),checkOption&&options.classes[classes[i]]&&full.push(options.classes[classes[i]])}var full=[],that=this;return options=$.extend({element:this.element,classes:this.options.classes||{}},options),options.keys&&processClassString(options.keys.match(/\S+/g)||[],!0),options.extra&&processClassString(options.extra.match(/\S+/g)||[]),full.join(" ")},_removeClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,!1)},_addClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,!0)},_toggleClass:function(element,keys,extra,add){add="boolean"==typeof add?add:extra;var shift="string"==typeof element||null===element,options={extra:shift?keys:extra,keys:shift?element:keys,element:shift?this.element:element,add:add};return options.element.toggleClass(this._classes(options),add),this},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;"boolean"!=typeof suppressDisabledCheck&&(handlers=element,element=suppressDisabledCheck,suppressDisabledCheck=!1),handlers?(element=delegateElement=$(element),this.bindings=this.bindings.add(element)):(handlers=element,element=this.element,delegateElement=this.widget()),$.each(handlers,function(event,handler){function handlerProxy(){return suppressDisabledCheck||instance.options.disabled!==!0&&!$(this).hasClass("ui-state-disabled")?("string"==typeof handler?instance[handler]:handler).apply(instance,arguments):void 0}"string"!=typeof handler&&(handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++);var match=event.match(/^([\w:-]*)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];selector?delegateElement.delegate(selector,eventName,handlerProxy):element.bind(eventName,handlerProxy)})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,element.unbind(eventName).undelegate(eventName),this.bindings=$(this.bindings.not(element).get()),this.focusable=$(this.focusable.not(element).get()),this.hoverable=$(this.hoverable.not(element).get())},_delay:function(handler,delay){function handlerProxy(){return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element),this._on(element,{mouseenter:function(event){this._addClass($(event.currentTarget),null,"ui-state-hover")},mouseleave:function(event){this._removeClass($(event.currentTarget),null,"ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element),this._on(element,{focusin:function(event){this._addClass($(event.currentTarget),null,"ui-state-focus")},focusout:function(event){this._removeClass($(event.currentTarget),null,"ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];if(data=data||{},event=$.Event(event),event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase(),event.target=this.element[0],orig=event.originalEvent)for(prop in orig)prop in event||(event[prop]=orig[prop]);return this.element.trigger(event,data),!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===!1||event.isDefaultPrevented())}},$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){"string"==typeof options&&(options={effect:options});var hasOptions,effectName=options?options===!0||"number"==typeof options?defaultEffect:options.effect||defaultEffect:method;options=options||{},"number"==typeof options&&(options={duration:options}),hasOptions=!$.isEmptyObject(options),options.complete=callback,options.delay&&element.delay(options.delay),hasOptions&&$.effects&&$.effects.effect[effectName]?element[method](options):effectName!==method&&element[effectName]?element[effectName](options.duration,options.easing,callback):element.queue(function(next){$(this)[method](),callback&&callback.call(element[0]),next()})}}),$.widget});
                (function(factory){"function"==typeof define&&define.amd?define(["jquery","./core"],factory):factory(jQuery)})(function($){function datepicker_getZindex(elem){for(var position,value;elem.length&&elem[0]!==document;){if(position=elem.css("position"),("absolute"===position||"relative"===position||"fixed"===position)&&(value=parseInt(elem.css("zIndex"),10),!isNaN(value)&&0!==value))return value;elem=elem.parent()}return 0}function Datepicker(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["S","M","T","W","T","F","S"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this._getWorkweek,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.regional.en=$.extend(!0,{},this.regional[""]),this.regional["en-US"]=$.extend(!0,{},this.regional.en),this.dpDiv=datepicker_bindHover($("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function datepicker_bindHover(dpDiv){var selector="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return dpDiv.delegate(selector,"mouseout",function(){$(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&$(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&$(this).removeClass("ui-datepicker-next-hover")}).delegate(selector,"mouseover",datepicker_handleMouseover)}function datepicker_handleMouseover(){$.datepicker._isDisabledDatepicker(datepicker_instActive.inline?datepicker_instActive.dpDiv.parent()[0]:datepicker_instActive.input[0])||($(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),$(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&$(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&$(this).addClass("ui-datepicker-next-hover"))}function datepicker_extendRemove(target,props){$.extend(target,props);for(var name in props)null==props[name]&&(target[name]=props[name]);return target}$.extend($.ui,{datepicker:{version:"@VERSION"}});var datepicker_instActive;return $.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(settings){return datepicker_extendRemove(this._defaults,settings||{}),this},_attachDatepicker:function(target,settings){var nodeName,inline,inst;nodeName=target.nodeName.toLowerCase(),inline="div"===nodeName||"span"===nodeName,target.id||(this.uuid+=1,target.id="dp"+this.uuid),inst=this._newInst($(target),inline),inst.settings=$.extend({},settings||{}),"input"===nodeName?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(target,inline){var id=target[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:id,input:target,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:inline,dpDiv:inline?datepicker_bindHover($("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(target,inst){var input=$(target);inst.append=$([]),inst.trigger=$([]),input.hasClass(this.markerClassName)||(this._attachments(input,inst),input.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(inst),$.data(target,"datepicker",inst),inst.settings.disabled&&this._disableDatepicker(target))},_attachments:function(input,inst){var showOn,buttonText,buttonImage,appendText=this._get(inst,"appendText"),isRTL=this._get(inst,"isRTL");inst.append&&inst.append.remove(),appendText&&(inst.append=$("<span class='"+this._appendClass+"'>"+appendText+"</span>"),input[isRTL?"before":"after"](inst.append)),input.unbind("focus",this._showDatepicker),inst.trigger&&inst.trigger.remove(),showOn=this._get(inst,"showOn"),("focus"===showOn||"both"===showOn)&&input.focus(this._showDatepicker),("button"===showOn||"both"===showOn)&&(buttonText=this._get(inst,"buttonText"),buttonImage=this._get(inst,"buttonImage"),inst.trigger=$(this._get(inst,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:buttonImage,alt:buttonText,title:buttonText}):$("<button type='button'></button>").addClass(this._triggerClass).html(buttonImage?$("<img/>").attr({src:buttonImage,alt:buttonText,title:buttonText}):buttonText)),input[isRTL?"before":"after"](inst.trigger),inst.trigger.click(function(){return $.datepicker._datepickerShowing&&$.datepicker._lastInput===input[0]?$.datepicker._hideDatepicker():$.datepicker._datepickerShowing&&$.datepicker._lastInput!==input[0]?($.datepicker._hideDatepicker(),$.datepicker._showDatepicker(input[0])):$.datepicker._showDatepicker(input[0]),!1}))},_autoSize:function(inst){if(this._get(inst,"autoSize")&&!inst.inline){var findMax,max,maxI,i,date=new Date(2009,11,20),dateFormat=this._get(inst,"dateFormat");dateFormat.match(/[DM]/)&&(findMax=function(names){for(max=0,maxI=0,i=0;names.length>i;i++)names[i].length>max&&(max=names[i].length,maxI=i);return maxI},date.setMonth(findMax(this._get(inst,dateFormat.match(/MM/)?"monthNames":"monthNamesShort"))),date.setDate(findMax(this._get(inst,dateFormat.match(/DD/)?"dayNames":"dayNamesShort"))+20-date.getDay())),inst.input.attr("size",this._formatDate(inst,date).length)}},_inlineDatepicker:function(target,inst){var divSpan=$(target);divSpan.hasClass(this.markerClassName)||(divSpan.addClass(this.markerClassName).append(inst.dpDiv),$.data(target,"datepicker",inst),this._setDate(inst,this._getDefaultDate(inst),!0),this._updateDatepicker(inst),this._updateAlternate(inst),inst.settings.disabled&&this._disableDatepicker(target),inst.dpDiv.css("display","block"))},_dialogDatepicker:function(input,date,onSelect,settings,pos){var id,browserWidth,browserHeight,scrollX,scrollY,inst=this._dialogInst;return inst||(this.uuid+=1,id="dp"+this.uuid,this._dialogInput=$("<input type='text' id='"+id+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),$("body").append(this._dialogInput),inst=this._dialogInst=this._newInst(this._dialogInput,!1),inst.settings={},$.data(this._dialogInput[0],"datepicker",inst)),datepicker_extendRemove(inst.settings,settings||{}),date=date&&date.constructor===Date?this._formatDate(inst,date):date,this._dialogInput.val(date),this._pos=pos?pos.length?pos:[pos.pageX,pos.pageY]:null,this._pos||(browserWidth=document.documentElement.clientWidth,browserHeight=document.documentElement.clientHeight,scrollX=document.documentElement.scrollLeft||document.body.scrollLeft,scrollY=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[browserWidth/2-100+scrollX,browserHeight/2-150+scrollY]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),inst.settings.onSelect=onSelect,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],"datepicker",inst),this},_destroyDatepicker:function(target){var nodeName,$target=$(target),inst=$.data(target,"datepicker");$target.hasClass(this.markerClassName)&&(nodeName=target.nodeName.toLowerCase(),$.removeData(target,"datepicker"),"input"===nodeName?(inst.append.remove(),inst.trigger.remove(),$target.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===nodeName||"span"===nodeName)&&$target.removeClass(this.markerClassName).empty(),datepicker_instActive===inst&&(datepicker_instActive=null))},_enableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,"datepicker");$target.hasClass(this.markerClassName)&&(nodeName=target.nodeName.toLowerCase(),"input"===nodeName?(target.disabled=!1,inst.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===nodeName||"span"===nodeName)&&(inline=$target.children("."+this._inlineClass),inline.children().removeClass("ui-state-disabled"),inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=$.map(this._disabledInputs,function(value){return value===target?null:value}))},_disableDatepicker:function(target){var nodeName,inline,$target=$(target),inst=$.data(target,"datepicker");$target.hasClass(this.markerClassName)&&(nodeName=target.nodeName.toLowerCase(),"input"===nodeName?(target.disabled=!0,inst.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===nodeName||"span"===nodeName)&&(inline=$target.children("."+this._inlineClass),inline.children().addClass("ui-state-disabled"),inline.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=$.map(this._disabledInputs,function(value){return value===target?null:value}),this._disabledInputs[this._disabledInputs.length]=target)},_isDisabledDatepicker:function(target){if(!target)return!1;for(var i=0;this._disabledInputs.length>i;i++)if(this._disabledInputs[i]===target)return!0;return!1},_getInst:function(target){try{return $.data(target,"datepicker")}catch(err){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(target,name,value){var settings,date,minDate,maxDate,inst=this._getInst(target);return 2===arguments.length&&"string"==typeof name?"defaults"===name?$.extend({},$.datepicker._defaults):inst?"all"===name?$.extend({},inst.settings):this._get(inst,name):null:(settings=name||{},"string"==typeof name&&(settings={},settings[name]=value),inst&&(this._curInst===inst&&this._hideDatepicker(),date=this._getDateDatepicker(target,!0),minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),datepicker_extendRemove(inst.settings,settings),null!==minDate&&void 0!==settings.dateFormat&&void 0===settings.minDate&&(inst.settings.minDate=this._formatDate(inst,minDate)),null!==maxDate&&void 0!==settings.dateFormat&&void 0===settings.maxDate&&(inst.settings.maxDate=this._formatDate(inst,maxDate)),"disabled"in settings&&(settings.disabled?this._disableDatepicker(target):this._enableDatepicker(target)),this._attachments($(target),inst),this._autoSize(inst),this._setDate(inst,date),this._updateAlternate(inst),this._updateDatepicker(inst)),void 0)},_changeDatepicker:function(target,name,value){this._optionDatepicker(target,name,value)},_refreshDatepicker:function(target){var inst=this._getInst(target);inst&&this._updateDatepicker(inst)},_setDateDatepicker:function(target,date){var inst=this._getInst(target);inst&&(this._setDate(inst,date),this._updateDatepicker(inst),this._updateAlternate(inst))},_getDateDatepicker:function(target,noDefault){var inst=this._getInst(target);return inst&&!inst.inline&&this._setDateFromField(inst,noDefault),inst?this._getDate(inst):null},_doKeyDown:function(event){var onSelect,dateStr,sel,inst=$.datepicker._getInst(event.target),handled=!0,isRTL=inst.dpDiv.is(".ui-datepicker-rtl");if(inst._keyEvent=!0,$.datepicker._datepickerShowing)switch(event.keyCode){case 9:$.datepicker._hideDatepicker(),handled=!1;break;case 13:return sel=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",inst.dpDiv),sel[0]&&$.datepicker._selectDay(event.target,inst.selectedMonth,inst.selectedYear,sel[0]),onSelect=$.datepicker._get(inst,"onSelect"),onSelect?(dateStr=$.datepicker._formatDate(inst),onSelect.apply(inst.input?inst.input[0]:null,[dateStr,inst])):$.datepicker._hideDatepicker(),!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(event.target,event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(event.target,event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths"),"M");break;case 35:(event.ctrlKey||event.metaKey)&&$.datepicker._clearDate(event.target),handled=event.ctrlKey||event.metaKey;break;case 36:(event.ctrlKey||event.metaKey)&&$.datepicker._gotoToday(event.target),handled=event.ctrlKey||event.metaKey;break;case 37:(event.ctrlKey||event.metaKey)&&$.datepicker._adjustDate(event.target,isRTL?1:-1,"D"),handled=event.ctrlKey||event.metaKey,event.originalEvent.altKey&&$.datepicker._adjustDate(event.target,event.ctrlKey?-$.datepicker._get(inst,"stepBigMonths"):-$.datepicker._get(inst,"stepMonths"),"M");break;case 38:(event.ctrlKey||event.metaKey)&&$.datepicker._adjustDate(event.target,-7,"D"),handled=event.ctrlKey||event.metaKey;break;case 39:(event.ctrlKey||event.metaKey)&&$.datepicker._adjustDate(event.target,isRTL?-1:1,"D"),handled=event.ctrlKey||event.metaKey,event.originalEvent.altKey&&$.datepicker._adjustDate(event.target,event.ctrlKey?+$.datepicker._get(inst,"stepBigMonths"):+$.datepicker._get(inst,"stepMonths"),"M");break;case 40:(event.ctrlKey||event.metaKey)&&$.datepicker._adjustDate(event.target,7,"D"),handled=event.ctrlKey||event.metaKey;break;default:handled=!1}else 36===event.keyCode&&event.ctrlKey?$.datepicker._showDatepicker(this):handled=!1;handled&&(event.preventDefault(),event.stopPropagation())},_doKeyPress:function(event){var chars,chr,inst=$.datepicker._getInst(event.target);return $.datepicker._get(inst,"constrainInput")?(chars=$.datepicker._possibleChars($.datepicker._get(inst,"dateFormat")),chr=String.fromCharCode(null==event.charCode?event.keyCode:event.charCode),event.ctrlKey||event.metaKey||" ">chr||!chars||chars.indexOf(chr)>-1):void 0},_doKeyUp:function(event){var date,inst=$.datepicker._getInst(event.target);if(inst.input.val()!==inst.lastVal)try{date=$.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),inst.input?inst.input.val():null,$.datepicker._getFormatConfig(inst)),date&&($.datepicker._setDateFromField(inst),$.datepicker._updateAlternate(inst),$.datepicker._updateDatepicker(inst))}catch(err){}return!0},_showDatepicker:function(input){if(input=input.target||input,"input"!==input.nodeName.toLowerCase()&&(input=$("input",input.parentNode)[0]),!$.datepicker._isDisabledDatepicker(input)&&$.datepicker._lastInput!==input){var inst,beforeShow,beforeShowSettings,isFixed,offset,showAnim,duration;inst=$.datepicker._getInst(input),$.datepicker._curInst&&$.datepicker._curInst!==inst&&($.datepicker._curInst.dpDiv.stop(!0,!0),inst&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0])),beforeShow=$.datepicker._get(inst,"beforeShow"),beforeShowSettings=beforeShow?beforeShow.apply(input,[input,inst]):{},beforeShowSettings!==!1&&(datepicker_extendRemove(inst.settings,beforeShowSettings),inst.lastVal=null,$.datepicker._lastInput=input,$.datepicker._setDateFromField(inst),$.datepicker._inDialog&&(input.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(input),$.datepicker._pos[1]+=input.offsetHeight),isFixed=!1,$(input).parents().each(function(){return isFixed|="fixed"===$(this).css("position"),!isFixed}),offset={left:$.datepicker._pos[0],top:$.datepicker._pos[1]},$.datepicker._pos=null,inst.dpDiv.empty(),inst.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(inst),offset=$.datepicker._checkOffset(inst,offset,isFixed),inst.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":isFixed?"fixed":"absolute",display:"none",left:offset.left+"px",top:offset.top+"px"}),inst.inline||(showAnim=$.datepicker._get(inst,"showAnim"),duration=$.datepicker._get(inst,"duration"),inst.dpDiv.css("z-index",datepicker_getZindex($(input))+1),$.datepicker._datepickerShowing=!0,$.effects&&$.effects.effect[showAnim]?inst.dpDiv.show(showAnim,$.datepicker._get(inst,"showOptions"),duration):inst.dpDiv[showAnim||"show"](showAnim?duration:null),$.datepicker._shouldFocusInput(inst)&&inst.input.focus(),$.datepicker._curInst=inst))}},_updateDatepicker:function(inst){this.maxRows=4,datepicker_instActive=inst,inst.dpDiv.empty().append(this._generateHTML(inst)),this._attachHandlers(inst);var origyearshtml,numMonths=this._getNumberOfMonths(inst),cols=numMonths[1],width=17,activeCell=inst.dpDiv.find("."+this._dayOverClass+" a");activeCell.length>0&&datepicker_handleMouseover.apply(activeCell.get(0)),inst.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),cols>1&&inst.dpDiv.addClass("ui-datepicker-multi-"+cols).css("width",width*cols+"em"),inst.dpDiv[(1!==numMonths[0]||1!==numMonths[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),inst.dpDiv[(this._get(inst,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),inst===$.datepicker._curInst&&$.datepicker._datepickerShowing&&$.datepicker._shouldFocusInput(inst)&&inst.input.focus(),inst.yearshtml&&(origyearshtml=inst.yearshtml,setTimeout(function(){origyearshtml===inst.yearshtml&&inst.yearshtml&&inst.dpDiv.find("select.ui-datepicker-year:first").replaceWith(inst.yearshtml),origyearshtml=inst.yearshtml=null},0))},_shouldFocusInput:function(inst){return inst.input&&inst.input.is(":visible")&&!inst.input.is(":disabled")&&!inst.input.is(":focus")},_checkOffset:function(inst,offset,isFixed){var dpWidth=inst.dpDiv.outerWidth(),dpHeight=inst.dpDiv.outerHeight(),inputWidth=inst.input?inst.input.outerWidth():0,inputHeight=inst.input?inst.input.outerHeight():0,viewWidth=document.documentElement.clientWidth+(isFixed?0:$(document).scrollLeft()),viewHeight=document.documentElement.clientHeight+(isFixed?0:$(document).scrollTop());return offset.left-=this._get(inst,"isRTL")?dpWidth-inputWidth:0,offset.left-=isFixed&&offset.left===inst.input.offset().left?$(document).scrollLeft():0,offset.top-=isFixed&&offset.top===inst.input.offset().top+inputHeight?$(document).scrollTop():0,offset.left-=Math.min(offset.left,offset.left+dpWidth>viewWidth&&viewWidth>dpWidth?Math.abs(offset.left+dpWidth-viewWidth):0),offset.top-=Math.min(offset.top,offset.top+dpHeight>viewHeight&&viewHeight>dpHeight?Math.abs(dpHeight+inputHeight):0),offset},_findPos:function(obj){for(var position,inst=this._getInst(obj),isRTL=this._get(inst,"isRTL");obj&&("hidden"===obj.type||1!==obj.nodeType||$.expr.filters.hidden(obj));)obj=obj[isRTL?"previousSibling":"nextSibling"];return position=$(obj).offset(),[position.left,position.top]},_hideDatepicker:function(input){var showAnim,duration,postProcess,onClose,inst=this._curInst;!inst||input&&inst!==$.data(input,"datepicker")||this._datepickerShowing&&(showAnim=this._get(inst,"showAnim"),duration=this._get(inst,"duration"),postProcess=function(){$.datepicker._tidyDialog(inst)},$.effects&&($.effects.effect[showAnim]||$.effects[showAnim])?inst.dpDiv.hide(showAnim,$.datepicker._get(inst,"showOptions"),duration,postProcess):inst.dpDiv["slideDown"===showAnim?"slideUp":"fadeIn"===showAnim?"fadeOut":"hide"](showAnim?duration:null,postProcess),showAnim||postProcess(),this._datepickerShowing=!1,onClose=this._get(inst,"onClose"),onClose&&onClose.apply(inst.input?inst.input[0]:null,[inst.input?inst.input.val():"",inst]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(inst){inst.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(event){if($.datepicker._curInst){var $target=$(event.target),inst=$.datepicker._getInst($target[0]);($target[0].id!==$.datepicker._mainDivId&&0===$target.parents("#"+$.datepicker._mainDivId).length&&!$target.hasClass($.datepicker.markerClassName)&&!$target.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||$target.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!==inst)&&$.datepicker._hideDatepicker()}},_adjustDate:function(id,offset,period){var target=$(id),inst=this._getInst(target[0]);this._isDisabledDatepicker(target[0])||(this._adjustInstDate(inst,offset+("M"===period?this._get(inst,"showCurrentAtPos"):0),period),this._updateDatepicker(inst))},_gotoToday:function(id){var date,target=$(id),inst=this._getInst(target[0]);this._get(inst,"gotoCurrent")&&inst.currentDay?(inst.selectedDay=inst.currentDay,inst.drawMonth=inst.selectedMonth=inst.currentMonth,inst.drawYear=inst.selectedYear=inst.currentYear):(date=new Date,inst.selectedDay=date.getDate(),inst.drawMonth=inst.selectedMonth=date.getMonth(),inst.drawYear=inst.selectedYear=date.getFullYear()),this._notifyChange(inst),this._adjustDate(target)},_selectMonthYear:function(id,select,period){var target=$(id),inst=this._getInst(target[0]);inst["selected"+("M"===period?"Month":"Year")]=inst["draw"+("M"===period?"Month":"Year")]=parseInt(select.options[select.selectedIndex].value,10),this._notifyChange(inst),this._adjustDate(target)},_selectDay:function(id,month,year,td){var inst,target=$(id);$(td).hasClass(this._unselectableClass)||this._isDisabledDatepicker(target[0])||(inst=this._getInst(target[0]),inst.selectedDay=inst.currentDay=$("a",td).html(),inst.selectedMonth=inst.currentMonth=month,inst.selectedYear=inst.currentYear=year,this._selectDate(id,this._formatDate(inst,inst.currentDay,inst.currentMonth,inst.currentYear)))},_clearDate:function(id){var target=$(id);this._selectDate(target,"")},_selectDate:function(id,dateStr){var onSelect,target=$(id),inst=this._getInst(target[0]);dateStr=null!=dateStr?dateStr:this._formatDate(inst),inst.input&&inst.input.val(dateStr),this._updateAlternate(inst),onSelect=this._get(inst,"onSelect"),onSelect?onSelect.apply(inst.input?inst.input[0]:null,[dateStr,inst]):inst.input&&inst.input.trigger("change"),inst.inline?this._updateDatepicker(inst):(this._hideDatepicker(),this._lastInput=inst.input[0],"object"!=typeof inst.input[0]&&inst.input.focus(),this._lastInput=null)},_updateAlternate:function(inst){var altFormat,date,dateStr,altField=this._get(inst,"altField");altField&&(altFormat=this._get(inst,"altFormat")||this._get(inst,"dateFormat"),date=this._getDate(inst),dateStr=this.formatDate(altFormat,date,this._getFormatConfig(inst)),$(altField).each(function(){$(this).val(dateStr)}))},noWeekends:function(date){var day=date.getDay();return[day>0&&6>day,""]},iso8601Week:function(date){var time,checkDate=new Date(date.getTime());return checkDate.setDate(checkDate.getDate()+4-(checkDate.getDay()||7)),time=checkDate.getTime(),checkDate.setMonth(0),checkDate.setDate(1),Math.floor(Math.round((time-checkDate)/864e5)/7)+1},_getWorkweek:function(date){var SECOND=1e3,MINUTE=60*SECOND,HOUR=60*MINUTE,DAY=24*HOUR,WEEK=7*DAY,date=new Date(date),yearStart=new Date(date.getFullYear(),0,1),dayIndex=yearStart.getDay(),ww01Start=new Date(yearStart-dayIndex*DAY),utcDateMillis=Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()),ww01Millis=Date.UTC(ww01Start.getFullYear(),ww01Start.getMonth(),ww01Start.getDate()),timeDiff=utcDateMillis-ww01Millis,ww=Math.floor(timeDiff/WEEK)+1,leap=0===date.getFullYear()%4,weekCount=leap&&dayIndex>=5||!leap&&6===dayIndex?53:52;return ww>weekCount?1:ww},parseDate:function(format,value,settings){if(null==format||null==value)throw"Invalid arguments";if(value="object"==typeof value?""+value:value+"",""===value)return null;var iFormat,dim,extra,iValue=0,shortYearCutoffTemp=(settings?settings.shortYearCutoff:null)||this._defaults.shortYearCutoff,shortYearCutoff="string"!=typeof shortYearCutoffTemp?shortYearCutoffTemp:(new Date).getFullYear()%100+parseInt(shortYearCutoffTemp,10),dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,year=-1,month=-1,day=-1,doy=-1,literal=!1,date,lookAhead=function(match){var matches=format.length>iFormat+1&&format.charAt(iFormat+1)===match;return matches&&iFormat++,matches},getNumber=function(match){var isDoubled=lookAhead(match),size="@"===match?14:"!"===match?20:"y"===match&&isDoubled?4:"o"===match?3:2,minSize="y"===match?size:1,digits=RegExp("^\\d{"+minSize+","+size+"}"),num=value.substring(iValue).match(digits);if(!num)throw"Missing number at position "+iValue;return iValue+=num[0].length,parseInt(num[0],10)},getName=function(match,shortNames,longNames){var index=-1,names=$.map(lookAhead(match)?longNames:shortNames,function(v,k){return[[k,v]]}).sort(function(a,b){return-(a[1].length-b[1].length)});if($.each(names,function(i,pair){var name=pair[1];return value.substr(iValue,name.length).toLowerCase()===name.toLowerCase()?(index=pair[0],iValue+=name.length,!1):void 0}),-1!==index)return index+1;throw"Unknown name at position "+iValue},checkLiteral=function(){if(value.charAt(iValue)!==format.charAt(iFormat))throw"Unexpected literal at position "+iValue;iValue++};for(iFormat=0;format.length>iFormat;iFormat++)if(literal)"'"!==format.charAt(iFormat)||lookAhead("'")?checkLiteral():literal=!1;else switch(format.charAt(iFormat)){case"d":day=getNumber("d");break;case"D":getName("D",dayNamesShort,dayNames);break;case"o":doy=getNumber("o");break;case"m":month=getNumber("m");break;case"M":month=getName("M",monthNamesShort,monthNames);break;case"y":year=getNumber("y");break;case"@":date=new Date(getNumber("@")),year=date.getFullYear(),month=date.getMonth()+1,day=date.getDate();break;case"!":date=new Date((getNumber("!")-this._ticksTo1970)/1e4),year=date.getFullYear(),month=date.getMonth()+1,day=date.getDate();break;case"'":lookAhead("'")?checkLiteral():literal=!0;break;default:checkLiteral()}if(value.length>iValue&&(extra=value.substr(iValue),!/^\s+/.test(extra)))throw"Extra/unparsed characters found in date: "+extra;if(-1===year?year=(new Date).getFullYear():100>year&&(year+=(new Date).getFullYear()-(new Date).getFullYear()%100+(shortYearCutoff>=year?0:-100)),doy>-1)for(month=1,day=doy;;){if(dim=this._getDaysInMonth(year,month-1),dim>=day)break;month++,day-=dim}if(date=this._daylightSavingAdjust(new Date(year,month-1,day)),date.getFullYear()!==year||date.getMonth()+1!==month||date.getDate()!==day)throw"Invalid date";return date},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(format,date,settings){if(!date)return"";var iFormat,dayNamesShort=(settings?settings.dayNamesShort:null)||this._defaults.dayNamesShort,dayNames=(settings?settings.dayNames:null)||this._defaults.dayNames,monthNamesShort=(settings?settings.monthNamesShort:null)||this._defaults.monthNamesShort,monthNames=(settings?settings.monthNames:null)||this._defaults.monthNames,lookAhead=function(match){var matches=format.length>iFormat+1&&format.charAt(iFormat+1)===match;return matches&&iFormat++,matches},formatNumber=function(match,value,len){var num=""+value;if(lookAhead(match))for(;len>num.length;)num="0"+num;return num},formatName=function(match,value,shortNames,longNames){return lookAhead(match)?longNames[value]:shortNames[value]},output="",literal=!1;if(date)for(iFormat=0;format.length>iFormat;iFormat++)if(literal)"'"!==format.charAt(iFormat)||lookAhead("'")?output+=format.charAt(iFormat):literal=!1;else switch(format.charAt(iFormat)){case"d":output+=formatNumber("d",date.getDate(),2);break;case"D":output+=formatName("D",date.getDay(),dayNamesShort,dayNames);break;case"o":output+=formatNumber("o",Math.round((new Date(date.getFullYear(),date.getMonth(),date.getDate()).getTime()-new Date(date.getFullYear(),0,0).getTime())/864e5),3);break;case"m":output+=formatNumber("m",date.getMonth()+1,2);break;case"M":output+=formatName("M",date.getMonth(),monthNamesShort,monthNames);break;case"y":output+=lookAhead("y")?date.getFullYear():(10>date.getYear()%100?"0":"")+date.getYear()%100;break;case"@":output+=date.getTime();break;case"!":output+=1e4*date.getTime()+this._ticksTo1970;break;case"'":lookAhead("'")?output+="'":literal=!0;break;default:output+=format.charAt(iFormat)}return output},_possibleChars:function(format){var iFormat,chars="",literal=!1,lookAhead=function(match){var matches=format.length>iFormat+1&&format.charAt(iFormat+1)===match;return matches&&iFormat++,matches};for(iFormat=0;format.length>iFormat;iFormat++)if(literal)"'"!==format.charAt(iFormat)||lookAhead("'")?chars+=format.charAt(iFormat):literal=!1;else switch(format.charAt(iFormat)){case"d":case"m":case"y":case"@":chars+="0123456789";break;case"D":case"M":return null;case"'":lookAhead("'")?chars+="'":literal=!0;break;default:chars+=format.charAt(iFormat)}return chars},_get:function(inst,name){return void 0!==inst.settings[name]?inst.settings[name]:this._defaults[name]},_setDateFromField:function(inst,noDefault){if(inst.input.val()!==inst.lastVal){var dateFormat=this._get(inst,"dateFormat"),dates=inst.lastVal=inst.input?inst.input.val():null,defaultDate=this._getDefaultDate(inst),date=defaultDate,settings=this._getFormatConfig(inst);try{date=this.parseDate(dateFormat,dates,settings)||defaultDate}catch(event){dates=noDefault?"":dates}inst.selectedDay=date.getDate(),inst.drawMonth=inst.selectedMonth=date.getMonth(),inst.drawYear=inst.selectedYear=date.getFullYear(),inst.currentDay=dates?date.getDate():0,inst.currentMonth=dates?date.getMonth():0,inst.currentYear=dates?date.getFullYear():0,this._adjustInstDate(inst)}},_getDefaultDate:function(inst){return this._restrictMinMax(inst,this._determineDate(inst,this._get(inst,"defaultDate"),new Date))},_determineDate:function(inst,date,defaultDate){var offsetNumeric=function(offset){var date=new Date;return date.setDate(date.getDate()+offset),date},offsetString=function(offset){try{return $.datepicker.parseDate($.datepicker._get(inst,"dateFormat"),offset,$.datepicker._getFormatConfig(inst))}catch(e){}for(var date=(offset.toLowerCase().match(/^c/)?$.datepicker._getDate(inst):null)||new Date,year=date.getFullYear(),month=date.getMonth(),day=date.getDate(),pattern=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,matches=pattern.exec(offset);matches;){switch(matches[2]||"d"){case"d":case"D":day+=parseInt(matches[1],10);break;case"w":case"W":day+=7*parseInt(matches[1],10);break;case"m":case"M":month+=parseInt(matches[1],10),day=Math.min(day,$.datepicker._getDaysInMonth(year,month));break;case"y":case"Y":year+=parseInt(matches[1],10),day=Math.min(day,$.datepicker._getDaysInMonth(year,month))
}matches=pattern.exec(offset)}return new Date(year,month,day)},newDate=null==date||""===date?defaultDate:"string"==typeof date?offsetString(date):"number"==typeof date?isNaN(date)?defaultDate:offsetNumeric(date):new Date(date.getTime());return newDate=newDate&&"Invalid Date"==""+newDate?defaultDate:newDate,newDate&&(newDate.setHours(0),newDate.setMinutes(0),newDate.setSeconds(0),newDate.setMilliseconds(0)),this._daylightSavingAdjust(newDate)},_daylightSavingAdjust:function(date){return date?(date.setHours(date.getHours()>12?date.getHours()+2:0),date):null},_setDate:function(inst,date,noChange){var clear=!date,origMonth=inst.selectedMonth,origYear=inst.selectedYear,newDate=this._restrictMinMax(inst,this._determineDate(inst,date,new Date));inst.selectedDay=inst.currentDay=newDate.getDate(),inst.drawMonth=inst.selectedMonth=inst.currentMonth=newDate.getMonth(),inst.drawYear=inst.selectedYear=inst.currentYear=newDate.getFullYear(),origMonth===inst.selectedMonth&&origYear===inst.selectedYear||noChange||this._notifyChange(inst),this._adjustInstDate(inst),inst.input&&inst.input.val(clear?"":this._formatDate(inst))},_getDate:function(inst){var startDate=!inst.currentYear||inst.input&&""===inst.input.val()?null:this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay));return startDate},_attachHandlers:function(inst){var stepMonths=this._get(inst,"stepMonths"),id="#"+inst.id.replace(/\\\\/g,"\\");inst.dpDiv.find("[data-handler]").map(function(){var handler={prev:function(){$.datepicker._adjustDate(id,-stepMonths,"M")},next:function(){$.datepicker._adjustDate(id,+stepMonths,"M")},hide:function(){$.datepicker._hideDatepicker()},today:function(){$.datepicker._gotoToday(id)},selectDay:function(){return $.datepicker._selectDay(id,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return $.datepicker._selectMonthYear(id,this,"M"),!1},selectYear:function(){return $.datepicker._selectMonthYear(id,this,"Y"),!1}};$(this).bind(this.getAttribute("data-event"),handler[this.getAttribute("data-handler")])})},_generateHTML:function(inst){var maxDraw,prevText,prev,nextText,next,currentText,gotoDate,controls,buttonPanel,firstDay,showWeek,dayNames,dayNamesMin,monthNames,monthNamesShort,beforeShowDay,showOtherMonths,selectOtherMonths,defaultDate,html,dow,row,group,col,selectedDate,cornerClass,calender,thead,day,daysInMonth,leadDays,curRows,numRows,printDate,dRow,tbody,daySettings,otherMonth,unselectable,tempDate=new Date,today=this._daylightSavingAdjust(new Date(tempDate.getFullYear(),tempDate.getMonth(),tempDate.getDate())),isRTL=this._get(inst,"isRTL"),showButtonPanel=this._get(inst,"showButtonPanel"),hideIfNoPrevNext=this._get(inst,"hideIfNoPrevNext"),navigationAsDateFormat=this._get(inst,"navigationAsDateFormat"),numMonths=this._getNumberOfMonths(inst),showCurrentAtPos=this._get(inst,"showCurrentAtPos"),stepMonths=this._get(inst,"stepMonths"),isMultiMonth=1!==numMonths[0]||1!==numMonths[1],currentDate=this._daylightSavingAdjust(inst.currentDay?new Date(inst.currentYear,inst.currentMonth,inst.currentDay):new Date(9999,9,9)),minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),drawMonth=inst.drawMonth-showCurrentAtPos,drawYear=inst.drawYear;if(0>drawMonth&&(drawMonth+=12,drawYear--),maxDate)for(maxDraw=this._daylightSavingAdjust(new Date(maxDate.getFullYear(),maxDate.getMonth()-numMonths[0]*numMonths[1]+1,maxDate.getDate())),maxDraw=minDate&&minDate>maxDraw?minDate:maxDraw;this._daylightSavingAdjust(new Date(drawYear,drawMonth,1))>maxDraw;)drawMonth--,0>drawMonth&&(drawMonth=11,drawYear--);for(inst.drawMonth=drawMonth,inst.drawYear=drawYear,prevText=this._get(inst,"prevText"),prevText=navigationAsDateFormat?this.formatDate(prevText,this._daylightSavingAdjust(new Date(drawYear,drawMonth-stepMonths,1)),this._getFormatConfig(inst)):prevText,prev=this._canAdjustMonth(inst,-1,drawYear,drawMonth)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+prevText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"e":"w")+"'>"+prevText+"</span></a>":hideIfNoPrevNext?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+prevText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"e":"w")+"'>"+prevText+"</span></a>",nextText=this._get(inst,"nextText"),nextText=navigationAsDateFormat?this.formatDate(nextText,this._daylightSavingAdjust(new Date(drawYear,drawMonth+stepMonths,1)),this._getFormatConfig(inst)):nextText,next=this._canAdjustMonth(inst,1,drawYear,drawMonth)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+nextText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"w":"e")+"'>"+nextText+"</span></a>":hideIfNoPrevNext?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+nextText+"'><span class='ui-icon ui-icon-circle-triangle-"+(isRTL?"w":"e")+"'>"+nextText+"</span></a>",currentText=this._get(inst,"currentText"),gotoDate=this._get(inst,"gotoCurrent")&&inst.currentDay?currentDate:today,currentText=navigationAsDateFormat?this.formatDate(currentText,gotoDate,this._getFormatConfig(inst)):currentText,controls=inst.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(inst,"closeText")+"</button>",buttonPanel=showButtonPanel?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(isRTL?controls:"")+(this._isInRange(inst,gotoDate)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+currentText+"</button>":"")+(isRTL?"":controls)+"</div>":"",firstDay=parseInt(this._get(inst,"firstDay"),10),firstDay=isNaN(firstDay)?0:firstDay,showWeek=this._get(inst,"showWeek"),dayNames=this._get(inst,"dayNames"),dayNamesMin=this._get(inst,"dayNamesMin"),monthNames=this._get(inst,"monthNames"),monthNamesShort=this._get(inst,"monthNamesShort"),beforeShowDay=this._get(inst,"beforeShowDay"),showOtherMonths=this._get(inst,"showOtherMonths"),selectOtherMonths=this._get(inst,"selectOtherMonths"),defaultDate=this._getDefaultDate(inst),html="",row=0;numMonths[0]>row;row++){for(group="",this.maxRows=4,col=0;numMonths[1]>col;col++){if(selectedDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,inst.selectedDay)),cornerClass=" ui-corner-all",calender="",isMultiMonth){if(calender+="<div class='ui-datepicker-group",numMonths[1]>1)switch(col){case 0:calender+=" ui-datepicker-group-first",cornerClass=" ui-corner-"+(isRTL?"right":"left");break;case numMonths[1]-1:calender+=" ui-datepicker-group-last",cornerClass=" ui-corner-"+(isRTL?"left":"right");break;default:calender+=" ui-datepicker-group-middle",cornerClass=""}calender+="'>"}for(calender+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+cornerClass+"'>"+(/all|left/.test(cornerClass)&&0===row?isRTL?next:prev:"")+(/all|right/.test(cornerClass)&&0===row?isRTL?prev:next:"")+this._generateMonthYearHeader(inst,drawMonth,drawYear,minDate,maxDate,row>0||col>0,monthNames,monthNamesShort)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",thead=showWeek?"<th class='ui-datepicker-week-col'>"+this._get(inst,"weekHeader")+"</th>":"",dow=0;7>dow;dow++)day=(dow+firstDay)%7,thead+="<th scope='col'"+((dow+firstDay+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+dayNames[day]+"'>"+dayNamesMin[day]+"</span></th>";for(calender+=thead+"</tr></thead><tbody>",daysInMonth=this._getDaysInMonth(drawYear,drawMonth),drawYear===inst.selectedYear&&drawMonth===inst.selectedMonth&&(inst.selectedDay=Math.min(inst.selectedDay,daysInMonth)),leadDays=(this._getFirstDayOfMonth(drawYear,drawMonth)-firstDay+7)%7,curRows=Math.ceil((leadDays+daysInMonth)/7),numRows=isMultiMonth?this.maxRows>curRows?this.maxRows:curRows:curRows,this.maxRows=numRows,printDate=this._daylightSavingAdjust(new Date(drawYear,drawMonth,1-leadDays)),dRow=0;numRows>dRow;dRow++){for(calender+="<tr>",tbody=showWeek?"<td class='ui-datepicker-week-col ui-state-highlight '>"+this._get(inst,"calculateWeek")(printDate)+"</td>":"",dow=0;7>dow;dow++)daySettings=beforeShowDay?beforeShowDay.apply(inst.input?inst.input[0]:null,[printDate]):[!0,""],otherMonth=printDate.getMonth()!==drawMonth,unselectable=otherMonth&&!selectOtherMonths||!daySettings[0]||minDate&&minDate>printDate||maxDate&&printDate>maxDate,tbody+="<td class='"+((dow+firstDay+6)%7>=5?" ui-datepicker-week-end":"")+(otherMonth?" ui-datepicker-other-month":"")+(printDate.getTime()===selectedDate.getTime()&&drawMonth===inst.selectedMonth&&inst._keyEvent||defaultDate.getTime()===printDate.getTime()&&defaultDate.getTime()===selectedDate.getTime()?" "+this._dayOverClass:"")+(unselectable?" "+this._unselectableClass+" ui-state-disabled":"")+(otherMonth&&!showOtherMonths?"":" "+daySettings[1]+(printDate.getTime()===currentDate.getTime()?" "+this._currentClass:"")+(printDate.getTime()===today.getTime()?" ui-datepicker-today":""))+"'"+(otherMonth&&!showOtherMonths||!daySettings[2]?"":" title='"+daySettings[2].replace(/'/g,"&#39;")+"'")+(unselectable?"":" data-handler='selectDay' data-event='click' data-month='"+printDate.getMonth()+"' data-year='"+printDate.getFullYear()+"'")+">"+(otherMonth&&!showOtherMonths?"&#xa0;":unselectable?"<span class='ui-state-default'>"+printDate.getDate()+"</span>":"<a class='ui-state-default"+(printDate.getTime()===today.getTime()?" ui-state-highlight":"")+(printDate.getTime()===currentDate.getTime()?" ui-state-active":"")+(otherMonth?" ui-priority-secondary":"")+"' href='#'>"+printDate.getDate()+"</a>")+"</td>",printDate.setDate(printDate.getDate()+1),printDate=this._daylightSavingAdjust(printDate);calender+=tbody+"</tr>"}drawMonth++,drawMonth>11&&(drawMonth=0,drawYear++),calender+="</tbody></table>"+(isMultiMonth?"</div>"+(numMonths[0]>0&&col===numMonths[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),group+=calender}html+=group}return html+=buttonPanel,inst._keyEvent=!1,html},_generateMonthYearHeader:function(inst,drawMonth,drawYear,minDate,maxDate,secondary,monthNames,monthNamesShort){var inMinYear,inMaxYear,month,years,thisYear,determineYear,year,endYear,changeMonth=this._get(inst,"changeMonth"),changeYear=this._get(inst,"changeYear"),showMonthAfterYear=this._get(inst,"showMonthAfterYear"),html="<div class='ui-datepicker-title'>",monthHtml="";if(secondary||!changeMonth)monthHtml+="<span class='ui-datepicker-month'>"+monthNames[drawMonth]+"</span>";else{for(inMinYear=minDate&&minDate.getFullYear()===drawYear,inMaxYear=maxDate&&maxDate.getFullYear()===drawYear,monthHtml+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",month=0;12>month;month++)(!inMinYear||month>=minDate.getMonth())&&(!inMaxYear||maxDate.getMonth()>=month)&&(monthHtml+="<option value='"+month+"'"+(month===drawMonth?" selected='selected'":"")+">"+monthNamesShort[month]+"</option>");monthHtml+="</select>"}if(showMonthAfterYear||(html+=monthHtml+(!secondary&&changeMonth&&changeYear?"":"&#xa0;")),!inst.yearshtml)if(inst.yearshtml="",secondary||!changeYear)html+="<span class='ui-datepicker-year'>"+drawYear+"</span>";else{for(years=this._get(inst,"yearRange").split(":"),thisYear=(new Date).getFullYear(),determineYear=function(value){var year=value.match(/c[+\-].*/)?drawYear+parseInt(value.substring(1),10):value.match(/[+\-].*/)?thisYear+parseInt(value,10):parseInt(value,10);return isNaN(year)?thisYear:year},year=determineYear(years[0]),endYear=Math.max(year,determineYear(years[1]||"")),year=minDate?Math.max(year,minDate.getFullYear()):year,endYear=maxDate?Math.min(endYear,maxDate.getFullYear()):endYear,inst.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";endYear>=year;year++)inst.yearshtml+="<option value='"+year+"'"+(year===drawYear?" selected='selected'":"")+">"+year+"</option>";inst.yearshtml+="</select>",html+=inst.yearshtml,inst.yearshtml=null}return html+=this._get(inst,"yearSuffix"),showMonthAfterYear&&(html+=(!secondary&&changeMonth&&changeYear?"":"&#xa0;")+monthHtml),html+="</div>"},_adjustInstDate:function(inst,offset,period){var year=inst.drawYear+("Y"===period?offset:0),month=inst.drawMonth+("M"===period?offset:0),day=Math.min(inst.selectedDay,this._getDaysInMonth(year,month))+("D"===period?offset:0),date=this._restrictMinMax(inst,this._daylightSavingAdjust(new Date(year,month,day)));inst.selectedDay=date.getDate(),inst.drawMonth=inst.selectedMonth=date.getMonth(),inst.drawYear=inst.selectedYear=date.getFullYear(),("M"===period||"Y"===period)&&this._notifyChange(inst)},_restrictMinMax:function(inst,date){var minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),newDate=minDate&&minDate>date?minDate:date;return maxDate&&newDate>maxDate?maxDate:newDate},_notifyChange:function(inst){var onChange=this._get(inst,"onChangeMonthYear");onChange&&onChange.apply(inst.input?inst.input[0]:null,[inst.selectedYear,inst.selectedMonth+1,inst])},_getNumberOfMonths:function(inst){var numMonths=this._get(inst,"numberOfMonths");return null==numMonths?[1,1]:"number"==typeof numMonths?[1,numMonths]:numMonths},_getMinMaxDate:function(inst,minMax){return this._determineDate(inst,this._get(inst,minMax+"Date"),null)},_getDaysInMonth:function(year,month){return 32-this._daylightSavingAdjust(new Date(year,month,32)).getDate()},_getFirstDayOfMonth:function(year,month){return new Date(year,month,1).getDay()},_canAdjustMonth:function(inst,offset,curYear,curMonth){var numMonths=this._getNumberOfMonths(inst),date=this._daylightSavingAdjust(new Date(curYear,curMonth+(0>offset?offset:numMonths[0]*numMonths[1]),1));return 0>offset&&date.setDate(this._getDaysInMonth(date.getFullYear(),date.getMonth())),this._isInRange(inst,date)},_isInRange:function(inst,date){var yearSplit,currentYear,minDate=this._getMinMaxDate(inst,"min"),maxDate=this._getMinMaxDate(inst,"max"),minYear=null,maxYear=null,years=this._get(inst,"yearRange");return years&&(yearSplit=years.split(":"),currentYear=(new Date).getFullYear(),minYear=parseInt(yearSplit[0],10),maxYear=parseInt(yearSplit[1],10),yearSplit[0].match(/[+\-].*/)&&(minYear+=currentYear),yearSplit[1].match(/[+\-].*/)&&(maxYear+=currentYear)),(!minDate||date.getTime()>=minDate.getTime())&&(!maxDate||date.getTime()<=maxDate.getTime())&&(!minYear||date.getFullYear()>=minYear)&&(!maxYear||maxYear>=date.getFullYear())},_getFormatConfig:function(inst){var shortYearCutoff=this._get(inst,"shortYearCutoff");return shortYearCutoff="string"!=typeof shortYearCutoff?shortYearCutoff:(new Date).getFullYear()%100+parseInt(shortYearCutoff,10),{shortYearCutoff:shortYearCutoff,dayNamesShort:this._get(inst,"dayNamesShort"),dayNames:this._get(inst,"dayNames"),monthNamesShort:this._get(inst,"monthNamesShort"),monthNames:this._get(inst,"monthNames")}},_formatDate:function(inst,day,month,year){day||(inst.currentDay=inst.selectedDay,inst.currentMonth=inst.selectedMonth,inst.currentYear=inst.selectedYear);var date=day?"object"==typeof day?day:this._daylightSavingAdjust(new Date(year,month,day)):this._daylightSavingAdjust(new Date(inst.currentYear,inst.currentMonth,inst.currentDay));return this.formatDate(this._get(inst,"dateFormat"),date,this._getFormatConfig(inst))}}),$.fn.datepicker=function(options){if(!this.length)return this;$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick),$.datepicker.initialized=!0),0===$("#"+$.datepicker._mainDivId).length&&$("body").append($.datepicker.dpDiv);var otherArgs=Array.prototype.slice.call(arguments,1);return"string"!=typeof options||"isDisabled"!==options&&"getDate"!==options&&"widget"!==options?"option"===options&&2===arguments.length&&"string"==typeof arguments[1]?$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs)):this.each(function(){"string"==typeof options?$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this].concat(otherArgs)):$.datepicker._attachDatepicker(this,options)}):$.datepicker["_"+options+"Datepicker"].apply($.datepicker,[this[0]].concat(otherArgs))},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="@VERSION",$.datepicker});
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("RetroDashboard",{extend:"IntelRallyApp",componentCls:"app",requires:["FastCumulativeFlowCalculator"],mixins:["PrettyAlert","UserAppsPreference","IntelWorkweek","CumulativeFlowChartMixin","ParallelLoader"],items:[{xtype:"container",id:"retroWrapper",cls:"chart-wrapper",items:[{xtype:"container",id:"retroReleasePicker",marginTop:40,marginBottom:240},{xtype:"container",id:"datePickerWrapper",layout:{type:"hbox",align:"left"},items:[{xtype:"textfield",fieldLabel:"Choose Release Start Date",id:"datepicker",name:"datepicker"},{xtype:"container",id:"btnDatePicker"}]},{xtype:"container",id:"retroBarChartWrapper",cls:"barchart-wrapper",layout:{type:"hbox",align:"left"},renderTo:document.body,items:[{xtype:"container",id:"retroChart",height:450,width:"44%"},{xtype:"container",id:"retroBarChartScopeWrapper",height:400,width:"18%"},{xtype:"container",id:"retroBarChartCaOriginalWrapper",height:400,width:"18%"},{xtype:"container",id:"retroBarChartCaFinalWrapper",height:400,width:"18%"}]},{xtype:"container",id:"legend",html:['<div class="legendwrapper">','<div class="dtarget"></div>','<div class="dtargetwrapper">Did not meet Target</div>','<div class="mtarget"></div>','<div class="mtargetwrapper">Met Target</div>','<div class="atarget"></div>','<div class="mtargetwrapper">A/C = Accept to Commit</div>',"</div>"].join("\n")},{xtype:"container",id:"portfolio_item_information",cls:"chart-with-border3"},{xtype:"container",id:"scopeGridWrapper",items:[{xtype:"container",id:"scopeGrid",cls:"scope_grid"}]}]}],_userAppsPref:"intel-retro-dashboard",_releasePickerSelected:function(combo,records){var me=this;if(me.ReleaseRecord.data.Name!==records[0].data.Name){me.setLoading(!0),me.ReleaseRecord=_.find(me.ReleaseRecords,function(rr){return rr.data.Name==records[0].data.Name});var pid=me.ProjectRecord.data.ObjectID;"object"!=typeof me.AppsPref.projs[pid]&&(me.AppsPref.projs[pid]={}),me.AppsPref.projs[pid].Release=me.ReleaseRecord.data.ObjectID,me._saveAppsPreference(me.AppsPref).then(function(){return me._reloadEverything()}).fail(function(reason){me._alert("ERROR",reason||""),me.setLoading(!1)}).done()}},_buildReleasePicker:function(){var me=this;me.ReleasePicker=Ext.getCmp("retroReleasePicker").add({xtype:"intelreleasepicker",labelWidth:80,width:240,releases:me.ReleaseRecords,currentRelease:me.ReleaseRecord,listeners:{change:function(combo,newval,oldval){0===newval.length&&combo.setValue(oldval)},select:me._releasePickerSelected,scope:me}})},_buildReleasePickerStartDate:function(){var me=this,_6days=5184e5,datePickerDefaultDate=new Date(1*new Date(me.ReleaseRecord.data.ReleaseStartDate)+_6days);$("#datepicker-inputEl").datepicker({defaultDate:datePickerDefaultDate,appendText:"(Default sample date for data is 7 days after the release date)",navigationAsDateFormat:!0,showWeek:!0,firstDay:0,onSelect:function(value){me.datePickerDate=value}}),$("#datepicker-inputEl").val(datePickerDefaultDate.getMonth()+1+"/"+datePickerDefaultDate.getDate()+"/"+datePickerDefaultDate.getFullYear()),Ext.create("Ext.Button",{text:"Click me",renderTo:"btnDatePicker",handler:function(value){me.releaseStartDateChanged=!0;var date1=me.ReleaseRecord.data.ReleaseStartDate,date2=new Date(me.datePickerDate),_1day=864e5,daysCountDifference=Math.floor((Date.parse(date2)-Date.parse(date1))/_1day);me.initalAddedDaysCount=me.releaseStartDateChanged&&daysCountDifference>0?daysCountDifference:6,me._reloadEverything()}})},_loadAllChildReleases:function(){var me=this,releaseName=me.ReleaseRecord.data.Name;return me._loadReleasesByNameUnderProject(releaseName,me.TrainRecord).then(function(releaseRecords){me.ReleasesWithNameHash=_.reduce(releaseRecords,function(hash,rr){return hash[rr.data.ObjectID]=!0,hash},{})})},_findDifferenceinDatesinDays:function(){},_loadSnapshotStores:function(){var me=this,releaseStart=new Date(me.ReleaseRecord.data.ReleaseStartDate).toISOString(),releaseEnd=new Date(me.ReleaseRecord.data.ReleaseDate).toISOString(),releaseName=me.ReleaseRecord.data.Name,lowestPortfolioItemType=me.PortfolioItemTypes[0];return me.AllSnapshots=[],Q.all(_.map(me.TrainChildren,function(project){var parallelLoaderConfig={pagesize:2e4,url:me.BaseUrl+"/analytics/v2.0/service/rally/workspace/"+me.getContext().getWorkspace().ObjectID+"/artifact/snapshot/query.js",params:{workspace:me.getContext().getGlobalContext().getWorkspace()._ref,compress:!0,pagesize:2e4,find:JSON.stringify({_TypeHierarchy:"HierarchicalRequirement",Children:null,Project:project.data.ObjectID,_ValidFrom:{$lte:releaseEnd},_ValidTo:{$gt:releaseStart}}),fields:JSON.stringify(["ScheduleState","PlanEstimate","Release",lowestPortfolioItemType,"_ValidFrom","_ValidTo","ObjectID"]),hydrate:JSON.stringify(["ScheduleState"])}};return me._parallelLoadLookbackStore(parallelLoaderConfig).then(function(snapshotStore){for(var records=_.filter(snapshotStore.getRange(),function(snapshot){return me.ReleasesWithNameHash[snapshot.data.Release]||!snapshot.data.Release&&me.LowestPortfolioItemsHash[snapshot.data[lowestPortfolioItemType]]==releaseName}),tmpRecs=records.slice(),convertDupes=function(dupes){return _.map(_.sortBy(dupes,function(d){return new Date(d.data._ValidFrom)}),function(d,i,a){return a.length-1>i&&(d.raw._ValidTo=a[i+1].raw._ValidFrom),d})},i=tmpRecs.length-1;i>=0;--i){for(var dupes=[],j=i-1;j>=0;--j)tmpRecs[i].data.ObjectID==tmpRecs[j].data.ObjectID&&tmpRecs[i].data._ValidTo==tmpRecs[j].data._ValidTo&&(dupes.push(tmpRecs.splice(j,1)[0]),--i);dupes.length&&(dupes.push(tmpRecs.splice(i,1)[0]),tmpRecs=tmpRecs.concat(convertDupes(dupes)))}records=tmpRecs,me.AllSnapshots=me.AllSnapshots.concat(records)})}))},_getPortfolioItems:function(){var me=this,releaseName=me.ReleaseRecord.data.Name;return me.LowestPortfolioItemsHash={},me.PortfolioItemsInReleaseStore=null,me._loadPortfolioItemsOfType(me.TrainPortfolioProject,me.PortfolioItemTypes[0]).then(function(portfolioItemStore){var portfolioItemsInRelease=_.filter(portfolioItemStore.getRange(),function(pi){return(pi.data.Release||{}).Name==releaseName});me.PortfolioItemsInReleaseStore=Ext.create("Rally.data.wsapi.Store",{model:me[me.PortfolioItemTypes[0]],data:portfolioItemsInRelease,totalCount:portfolioItemsInRelease.length,disableMetaChangeEvent:!0,load:function(){}}),me.LowestPortfolioItemsHash=_.reduce(portfolioItemStore.getRange(),function(hash,r){return hash[r.data.ObjectID]=(r.data.Release||{}).Name||"No Release",hash},{})})},_loadUserStoriesforPortfolioItems:function(){var me=this,lowestPortfolioItemType=me.PortfolioItemTypes[0],parallelLoaderConfig={pagesize:200,model:me.UserStory,url:me.BaseUrl+"/slm/webservice/v2.0/hierarchicalrequirement",params:{project:me.TrainRecord.data._ref,projectScopeDown:!0,projectScopeUp:!1,fetch:["ScheduleState","PlanEstimate",lowestPortfolioItemType,"ObjectID"].join(",")}};return me.WsapiUserStoryMap={},Q.all(_.map(me.PortfolioItemsInReleaseStore.data.items,function(portfolioItemRecord){var portfolioItemFilter=Ext.create("Rally.data.wsapi.Filter",{property:lowestPortfolioItemType+".ObjectID",value:portfolioItemRecord.data.ObjectID});return parallelLoaderConfig.params.query=""+portfolioItemFilter,me._parallelLoadWsapiStore(parallelLoaderConfig).then(function(userStoryStore){me.WsapiUserStoryMap[portfolioItemRecord.data.ObjectID]=userStoryStore.getRange()})}))},_loadScopeToReleaseStore:function(){var me=this,userStorySnapshots=me.AllSnapshots,_10days=864e6,lowestPortfolioItemType=me.PortfolioItemTypes[0],date1=me.ReleaseRecord.data.ReleaseStartDate,date2=new Date(me.datePickerDate),daysCountDifference=Math.floor(Date.parse(date2)-Date.parse(date1)),startTargetDate=me.releaseStartDateChanged?new Date(1*new Date(me.ReleaseRecord.data.ReleaseStartDate)+daysCountDifference):new Date(1*new Date(me.ReleaseRecord.data.ReleaseStartDate)+_10days),finalTargetDate=new Date(1*new Date(me.ReleaseRecord.data.ReleaseDate)),scopeToReleaseGridRows=[],userStorySnapshotsInitialWithoutPortfolioItems=_.filter(userStorySnapshots,function(userStorySnapshot){return startTargetDate>new Date(userStorySnapshot.data._ValidFrom)&&new Date(userStorySnapshot.data._ValidTo)>startTargetDate&&!userStorySnapshot.data[lowestPortfolioItemType]}),userStorySnapshotsFinalWithoutPortfolioItems=_.filter(userStorySnapshots,function(userStorySnapshot){return finalTargetDate>new Date(userStorySnapshot.data._ValidFrom)&&new Date(userStorySnapshot.data._ValidTo)>finalTargetDate&&!userStorySnapshot.data[lowestPortfolioItemType]}),userStorySnapshotsInitialWithPortfolioItems=_.filter(userStorySnapshots,function(userStorySnapshot){return startTargetDate>new Date(userStorySnapshot.data._ValidFrom)&&new Date(userStorySnapshot.data._ValidTo)>startTargetDate&&!!userStorySnapshot.data[lowestPortfolioItemType]}),userStorySnapshotsFinalWithPortfolioItems=_.filter(userStorySnapshots,function(userStorySnapshot){return finalTargetDate>new Date(userStorySnapshot.data._ValidFrom)&&new Date(userStorySnapshot.data._ValidTo)>finalTargetDate&&!!userStorySnapshot.data[lowestPortfolioItemType]});_.each(me.PortfolioItemsInReleaseStore.getRange(),function(portfolioItemRecord,key){var scopeToReleaseGridRow={},releaseStartSnapshots=[],releaseFinalSnapshots=[],userStoriesForPortfolioItem=me.WsapiUserStoryMap[portfolioItemRecord.data.ObjectID],userStorySnapshotsInitialForPortfolioItem=_.filter(userStorySnapshotsInitialWithPortfolioItems,function(userStorySnapshot){return portfolioItemRecord.data.ObjectID===userStorySnapshot.data[lowestPortfolioItemType]}),userStorySnapshotsFinalForPortfolioItem=_.filter(userStorySnapshotsFinalWithPortfolioItems,function(userStorySnapshot){return portfolioItemRecord.data.ObjectID===userStorySnapshot.data[lowestPortfolioItemType]});if(releaseStartSnapshots=releaseStartSnapshots.concat(userStorySnapshotsInitialForPortfolioItem),releaseFinalSnapshots=releaseFinalSnapshots.concat(userStorySnapshotsFinalForPortfolioItem),_.each(userStoriesForPortfolioItem,function(wsapiUserStory){var userStorySnapshotsInitialWithoutPortfolioItem=_.filter(userStorySnapshotsInitialWithoutPortfolioItems,function(userStorySnapshot){return userStorySnapshot.data.ObjectID===wsapiUserStory.data.ObjectID}),userStorySnapshotsFinalWithoutPortfolioItem=_.filter(userStorySnapshotsFinalWithoutPortfolioItems,function(userStorySnapshot){return userStorySnapshot.data.ObjectID===wsapiUserStory.data.ObjectID});releaseStartSnapshots=releaseStartSnapshots.concat(userStorySnapshotsInitialWithoutPortfolioItem),releaseFinalSnapshots=releaseFinalSnapshots.concat(userStorySnapshotsFinalWithoutPortfolioItem)}),releaseStartSnapshots.length>0||releaseFinalSnapshots.length>0){var startDateAcceptedPoints=_.reduce(releaseStartSnapshots,function(sum,item){return sum+("Accepted"==item.data.ScheduleState?1*item.data.PlanEstimate:0)},0),startDateNotAcceptedPoints=_.reduce(releaseStartSnapshots,function(sum,item){return sum+("Accepted"!=item.data.ScheduleState?1*item.data.PlanEstimate:0)},0),startDateTotalPoints=_.reduce(releaseStartSnapshots,function(sum,item){return sum+1*item.data.PlanEstimate},0),finalDateAcceptedPoints=_.reduce(releaseFinalSnapshots,function(sum,item){return sum+("Accepted"==item.data.ScheduleState?1*item.data.PlanEstimate:0)},0),finalDateNotAcceptedPoints=_.reduce(releaseFinalSnapshots,function(sum,item){return sum+("Accepted"!=item.data.ScheduleState?1*item.data.PlanEstimate:0)},0),finalDatetotalPoints=_.reduce(releaseFinalSnapshots,function(sum,item){return sum+1*item.data.PlanEstimate},0);scopeToReleaseGridRow.completedAtStart=startDateAcceptedPoints/startDateTotalPoints,scopeToReleaseGridRow.completedAtEnd=finalDateAcceptedPoints/finalDatetotalPoints,isFinite(scopeToReleaseGridRow.completedAtStart)===!1&&(scopeToReleaseGridRow.completedAtStart=0),isFinite(scopeToReleaseGridRow.completedAtEnd)===!1&&(scopeToReleaseGridRow.completedAtEnd=0),scopeToReleaseGridRow.growth=0===startDateTotalPoints?finalDatetotalPoints:(finalDatetotalPoints-startDateTotalPoints)/startDateTotalPoints,scopeToReleaseGridRow.intent=startDateTotalPoints.toFixed(0),scopeToReleaseGridRow.actual=finalDatetotalPoints.toFixed(0),scopeToReleaseGridRow.FormattedID=portfolioItemRecord.data.FormattedID,scopeToReleaseGridRow.Name=portfolioItemRecord.data.Name,scopeToReleaseGridRow.ObjectID=portfolioItemRecord.data.ObjectID,scopeToReleaseGridRow.ProjectObjectID=portfolioItemRecord.data.Project.ObjectID,portfolioItemRecord.state=portfolioItemRecord.data.State,scopeToReleaseGridRows=scopeToReleaseGridRows.concat(scopeToReleaseGridRow)}}),me.InitialTargetDate=[startTargetDate.getMonth()+1,startTargetDate.getDate(),startTargetDate.getFullYear()].join("/"),me.CompleteFinalTargetDate=[finalTargetDate.getMonth()+1,finalTargetDate.getDate(),finalTargetDate.getFullYear()].join("/"),me.gridstore=Ext.create("Ext.data.Store",{fields:["completedAtStart","completedAtEnd","growth","intent","actual","FormattedID","Name","ObjectID","ProjectObjectID","state"],data:scopeToReleaseGridRows})},_buildScopeToReleaseGrid:function(){var me=this,lowestPortfolioItemType=me.PortfolioItemTypes[0];Ext.getCmp("scopeGrid").removeAll(),Ext.getCmp("scopeGrid").add({xtype:"rallygrid",id:"grid",showRowActionsColumn:!1,selModel:{ignoreRightMouseSelection:!0,checkOnly:!0},enableEditing:!1,autoScroll:!0,height:500,showPagingToolbar:!1,title:"Scope to release ("+me.InitialTargetDate+" - "+me.CompleteFinalTargetDate+")",store:me.gridstore,columnCfgs:[{header:lowestPortfolioItemType+"s",dataIndex:"Name",flex:4,renderer:function(v,m,r){return Ext.String.format('<a href="{0}/#/{1}d/detail/portfolioitem/{2}/{3}" target="_blank">{4}: </a>{5}',me.BaseUrl,r.data.ProjectObjectID,lowestPortfolioItemType,r.data.ObjectID,r.data.FormattedID,v)}},{header:"% Complete<br/> @ Release Start "+me.InitialTargetDate,dataIndex:"completedAtStart",flex:2,xtype:"fastgridcolumn",tdCls:"iconCell",resizable:!1,draggable:!1,renderer:function(v,meta,record){return{xtype:"progressbar",text:[(100*v).toFixed(2),"%"].join(""),width:"100px",value:v}}},{header:"% Complete<br/>@ Release End "+me.CompleteFinalTargetDate,dataIndex:"completedAtEnd",flex:2,xtype:"fastgridcolumn",tdCls:"iconCell",resizable:!1,draggable:!1,renderer:function(v,meta,record){return{xtype:"progressbar",text:[(100*v).toFixed(2),"%"].join(""),width:"100px",value:v}}},{header:"Points Planned<br/> @ Release Start "+me.InitialTargetDate,dataIndex:"intent",flex:1},{header:"Final Points <br/>@ Release End "+me.CompleteFinalTargetDate,dataIndex:"actual",flex:1},{header:lowestPortfolioItemType+" Scope Change",dataIndex:"growth",flex:2,xtype:"fastgridcolumn",tdCls:"iconCell",resizable:!1,draggable:!1,renderer:function(v,meta,record){var growthText="";return growthText=v>0?"+"+[(100*v).toFixed(2),"%"].join(""):[(100*v).toFixed(2),"%"].join(""),{xtype:"container",html:growthText}}},{header:lowestPortfolioItemType+" State",dataIndex:"state",flex:1}]})},_buildCumulativeFlowChart:function(){var me=this,calc=Ext.create("FastCumulativeFlowCalculator",{scheduleStates:me.ScheduleStates,startDate:me.ReleaseRecord.data.ReleaseStartDate,endDate:me.ReleaseRecord.data.ReleaseDate}),aggregateChartData=me._updateCumulativeFlowChartData(calc.runCalculation(me.AllSnapshots),{trendType:"Last2Sprints"}),datemap=aggregateChartData.datemap,total={};total.initialCommit=0,total.finalCommit=0,total.finalAccepted=0,total.projected=0,_.each(aggregateChartData.series,function(f){"Accepted"===f.name&&(total.finalAccepted=total.finalAccepted+f.data[aggregateChartData.categories.length-6]),"Ideal"!=f.name&&"Projected"!=f.name&&(total.initialCommit=total.initialCommit+f.data[me.initalAddedDaysCount],total.finalCommit=total.finalCommit+f.data[aggregateChartData.categories.length-6]),"Projected"===f.name&&(total.projected=total.projected+f.data[aggregateChartData.categories.length-6])}),0===total.finalCommit&&(total.finalCommit=total.projected,total.finalAccepted=total.projected);var commitDataPlus=[];_.each(aggregateChartData.categories,function(f,key){commitDataPlus.push(total.initialCommit)}),aggregateChartData.series.push({colorIndex:1,symbolIndex:1,dashStyle:"shortdash",color:"red",data:commitDataPlus,name:"Commitment",type:"spline"}),me.total=total,$("#retroChart").highcharts(Ext.Object.merge({},me._defaultCumulativeFlowChartConfig,me._getCumulativeFlowChartColors(),{chart:{height:400,width:.42*me.getWidth()>>0},legend:{borderWidth:0,width:500,itemWidth:.42*me.getWidth()>>-50},title:{text:me.TrainRecord.data.Name},subtitle:{text:me.ReleaseRecord.data.Name.split(" ")[0]},xAxis:{categories:aggregateChartData.categories,tickInterval:me._getCumulativeFlowChartTicks(me.ReleaseRecord.data.ReleaseStartDate,me.ReleaseRecord.data.ReleaseDate,.44*me.getWidth())},series:aggregateChartData.series})),me._setCumulativeFlowChartDatemap($("#retroChart").children()[0].id,datemap)},_hideHighchartsLinks:function(){$(".highcharts-container > svg > text:last-child").hide()},_buildRetroChart:function(){var me=this,scopeDeltaPerc=100*((me.total.finalCommit-me.total.initialCommit)/me.total.initialCommit),originalCommitRatio=100*(me.total.finalAccepted/me.total.initialCommit),finalCommitRatio=100*(me.total.finalAccepted/me.total.finalCommit),dataseries=[],chartMax=[];Highcharts.setOptions({colors:["#3A874F","#7cb5ec"]}),chartConfig={chart:{type:"column"},title:{text:"Scope"},subtitle:{text:"4 of 6 "},xAxis:{categories:["Original Commit","Final Workload"],tickLength:10},yAxis:{min:0,tickPixelInterval:50,title:{text:"Total Points"},plotLines:[{name:"maxTarget",value:0,color:"#92d947",dashStyle:"shortdash",width:2,zIndex:5,label:{text:"Acceptable increase (+10%)",style:{color:"black","text-shadow":"0 1px 0 white"}}},{name:"minTarget",value:0,color:"#92d947",dashStyle:"shortdash",zIndex:5,width:2,label:{text:"Acceptable decrease (-10%) ",style:{color:"black","text-shadow":"0 1px 0 white"}}}]},tooltip:{valueDecimals:1},plotOptions:{series:{stacking:"normal",borderWidth:2,borderColor:"white",shadow:!0},column:{colorByPoint:!0}},series:[{name:["Meet Target"],showInLegend:!1,data:dataseries,dataLabels:{enabled:!0,format:"{point.y:,.0f}"}}]},chartMax.push(me.total.initialCommit,me.total.finalAccepted,me.total.finalCommit),chartConfig.yAxis.max=Math.max.apply(null,chartMax),chartConfig.yAxis.max=chartConfig.yAxis.max+.2*chartConfig.yAxis.max,chartConfig.title.text=scopeDeltaPerc>0?"Scope Delta: +"+scopeDeltaPerc.toFixed(2)+"%":"Scope Delta:"+scopeDeltaPerc.toFixed(2)+"%",chartConfig.subtitle.text=Math.round(me.total.finalCommit)+" of "+Math.round(me.total.initialCommit),dataseries.push(["initialcommit",me.total.initialCommit]),dataseries.push(["finalcommit",me.total.finalCommit]),chartConfig.series.data=dataseries,chartConfig.yAxis.plotLines[0].value=me.total.initialCommit+.1*me.total.initialCommit,chartConfig.yAxis.plotLines[1].value=me.total.initialCommit-.1*me.total.initialCommit,scopeDeltaPerc>=-10.99&&10.99>=scopeDeltaPerc?Highcharts.setOptions({colors:["#40d0ed","#92D050"]}):Highcharts.setOptions({colors:["#40d0ed","#d05052"]}),scopeDeltaPerc>=400&&(chartConfig.yAxis.plotLines[1].label={text:"Acceptable decrease (-10%)",align:"right",x:-10,y:16}),$("#retroBarChartScopeWrapper").highcharts(chartConfig),chartConfig.title.text="A/C Original: "+originalCommitRatio.toFixed(0)+"%",chartConfig.subtitle.text=Math.round(me.total.finalAccepted)+" of "+Math.round(me.total.initialCommit),chartConfig.xAxis.categories[1]="Final Accepted",chartConfig.yAxis.plotLines[0].label={text:"Target >90%",align:"center"},dataseries.length=0,dataseries.push(["initialcommit",me.total.initialCommit]),dataseries.push(["finalaccepted",me.total.finalAccepted]),chartConfig.series.data=dataseries,chartConfig.yAxis.plotLines[0].value=.9*me.total.initialCommit,chartConfig.yAxis.plotLines.splice(1,1),originalCommitRatio>=90?Highcharts.setOptions({colors:["#40d0ed","#92D050"]}):Highcharts.setOptions({colors:["#40d0ed","#d05052"]}),$("#retroBarChartCaOriginalWrapper").highcharts(chartConfig),finalCommitRatio=100*(me.total.finalAccepted/me.total.finalCommit),chartConfig.title.text="A/C Final: "+finalCommitRatio.toFixed(0)+"%",chartConfig.subtitle.text=Math.round(me.total.finalAccepted)+" of "+Math.round(me.total.finalCommit),chartConfig.xAxis.categories[0]="Final Workload",chartConfig.xAxis.categories[1]="Final Accepted",chartConfig.yAxis.plotLines[0].label={text:"Target >90%",align:"center"},dataseries.length=0,dataseries.push(["finalCommit",me.total.finalCommit]),dataseries.push(["finalaccepted",me.total.finalAccepted]),chartConfig.series.data=dataseries,chartConfig.yAxis.plotLines[0].value=.9*me.total.finalCommit,chartConfig.yAxis.plotLines.splice(1,1),finalCommitRatio>=90?Highcharts.setOptions({colors:["#40d0ed","#92D050"]}):Highcharts.setOptions({colors:["#40d0ed","#d05052"]}),$("#retroBarChartCaFinalWrapper").highcharts(chartConfig)},_reloadEverything:function(){var me=this;return me.setLoading("Loading Data"),Q.all([me._loadAllChildReleases(),me._getPortfolioItems()]).then(function(){return Q.all([me._loadSnapshotStores(),me._loadUserStoriesforPortfolioItems()])}).then(function(){return 0===me.AllSnapshots.length?(me._alert("ERROR",me.TrainRecord.data.Name+" has no data for release: "+me.ReleaseRecord.data.Name),void 0):(me._buildCumulativeFlowChart(),me._buildRetroChart(),me._hideHighchartsLinks(),me._loadScopeToReleaseStore(),me._buildScopeToReleaseGrid(),me.setLoading(!1),void 0)}).fail(function(reason){me.setLoading(!1),me._alert("ERROR",reason||"")}).done()},launch:function(){var me=this;me.setLoading("Loading Configuration"),me._configureIntelRallyApp().then(function(){var scopeProject=me.getContext().getProject();return me._loadProject(scopeProject.ObjectID)}).then(function(scopeProjectRecord){return me.ProjectRecord=scopeProjectRecord,Q.all([me._projectInWhichTrain(me.ProjectRecord).then(function(trainRecord){return trainRecord&&me.ProjectRecord.data.ObjectID==trainRecord.data.ObjectID?(me.TrainRecord=trainRecord,me._loadTrainPortfolioProject(trainRecord)):Q.reject("You are not scoped to a train.")}).then(function(trainPortfolioProject){return me.TrainPortfolioProject=trainPortfolioProject,me._loadAllChildrenProjects(me.TrainRecord)}).then(function(scrums){me.TrainChildren=scrums}),me._loadAppsPreference().then(function(appsPref){me.AppsPref=appsPref;var today=new Date,quarter=Math.floor((today.getMonth()+3)/3),year=today.getFullYear(),start=new Date(year,3*quarter-3,1),endDate=new Date(year,3*quarter,0),oneYear=31536e6;return me._loadReleasesBetweenDates(me.ProjectRecord,1*new Date-oneYear,endDate)}).then(function(releaseRecords){me.ReleaseRecords=releaseRecords;var currentRelease=me._getScopedRelease(releaseRecords,me.ProjectRecord.data.ObjectID,me.AppsPref);return currentRelease?(me.ReleaseRecord=currentRelease,void 0):Q.reject("This project has no releases.")})])}).then(function(){me._buildReleasePicker(),me._buildReleasePickerStartDate()}).then(function(){me._reloadEverything()}).fail(function(reason){me.setLoading(!1),me._alert("ERROR",reason||"")}).done()}})})();

            Rally.launchApp('RetroDashboard', {
                name:"RetroDashboard",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .chart-wrapper{margin:10px;padding:10px}.retrochart-wrapper{clear:both;float:right}.barchart-wrapper{margin-top:20px;border:solid #BFBFBF 2px;width:100%}.chart-with-border{font-weight:bold;font-family:"Lucida Grande","Lucida Sans Unicode",Arial,Helvetica,sans-serif;z-index:-1}.chart-with-border3{border:solid #BFBFBF 4px;background-color:green}span#retroDonutScopeArrow-outerCt,span#retroDonutCaOriginalArrow-outerCt,span#retroDonutCaFinalArrow-outerCt{margin-top:70px;margin-left:60px}#retroDonutScopeFooter,#retroDonutCaOriginalFooter,#retroDonutCaFinalFooter{padding-top:190px;padding-left:0px;font-weight:bold;font-family:"Lucida Grande","Lucida Sans Unicode",Arial,Helvetica,sans-serif}.legendwrapper{float:right;width:35%;text-align:center;margin-top:-50px}.mtargetwrapper{float:left;color:#333333;font-size:12px;font-weight:bold}.mtarget{float:left;background-color:#92D050;height:12px;width:16px;margin-left:50px;margin-right:3px;margin-top:3px}.atarget{float:left;height:12px;width:16px;margin-left:50px;margin-right:3px;margin-top:3px}.dtargetwrapper{float:left;color:#333333;font-size:12px;font-weight:bold;cursor:pointer}.dtarget{float:left;background-color:#d05052;height:12px;width:16px;margin-left:10px;margin-right:3px;margin-top:3px}#grid_header_hd{color:#396295;font-size:16px;font-weight:bold;cursor:pointer;fill:#333333}.progress-right .progress-bar-r{float:left;border:solid red 1px;height:20px;text-align:left;background-color:#fc8585;text-shadow:0 1px 0 #D05052;color:black}div.sr-only{border:solid #D05052 1px;float:left;background-color:#D05052;color:white;height:19px;overflow:visible}
    </style>
    <style type="text/css">
        @import "base.css";@import "theme.css";/*!
 * jQuery UI CSS Framework @VERSION
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/category/theming/
 */
    </style>
    <style type="text/css">
        body{font-family:Arial,Helvetica,sans-serif}table{font-size:1em}.demo-description{clear:both;padding:12px}.ui-draggable,.ui-droppable{background-position:top}
    </style>
</head>
<body>
</body>
</html>
