<!DOCTYPE html>
<html>
<head>
    <title>RetroDashboard</title>

    <script type="text/javascript" src="/apps/2.0rc3/sdk.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.js"></script>
    <script type="text/javascript" src="https://code.highcharts.com/highcharts.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.1/q.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                (function(){var Ext=window.Ext4||window.Ext,timeout=12e4;Ext.override(Ext.data.proxy.Ajax,{timeout:timeout}),Ext.override(Ext.data.proxy.JsonP,{timeout:timeout}),Ext.override(Rally.sdk.data.lookback.JsonPProxy,{setException:function(operation,response){var error=operation.getError()||{};operation.setException(Ext.apply(error,{errors:(response||{}).Errors||[]}))}}),Ext.define("IntelRallyApp",{alias:"widget.intelrallyapp",extend:"Rally.app.App",_ScrumGroupConfigPrefName:"intel-portfolio-locations-config",_projectFields:["ObjectID","Releases","Children","Parent","Name","TeamMembers"],_portfolioItemFields:["Name","ObjectID","FormattedID","Release","c_TeamCommits","c_MoSCoW","c_Risks","Project","PlannedEndDate","Parent","Children","PortfolioItemType","Ordinal"],_userStoryFields:["Name","ObjectID","Release","Project","PortfolioItem","PlannedEndDate","ActualEndDate","FormattedID","Predecessors","Successors","c_Dependencies","Iteration","PlanEstimate"],_releaseFields:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project","TeamMembers"],_loadScheduleStates:function(){var me=this,deferred=Q.defer();return Rally.data.ModelFactory.getModel({type:"UserStory",success:function(model){model.getField("ScheduleState").getAllowedValueStore().load({callback:function(records,operation,success){me.ScheduleStates=_.map(records,function(r){return r.data.StringValue}),deferred.resolve()}})}}),deferred.promise},_loadPortfolioItemStatesForEachType:function(){var me=this;return me.PortfolioItemTypeStates=[],Q.all(_.map(me.PortfolioItemTypes,function(portfolioType,ordinal){var store=Ext.create("Rally.data.wsapi.Store",{model:"State",autoLoad:!1,limit:1/0,disableMetaChangeEvent:!0,fetch:["Name","Enabled","OrderIndex"],filters:[{property:"TypeDef.Name",value:portfolioType},{property:"Enabled",value:!0}]});return me._reloadStore(store).then(function(store){me.PortfolioItemTypeStates[ordinal]=store.getRange()})}))},_loadPortfolioItemTypes:function(){var me=this,deferred=Q.defer(),store=Ext.create("Rally.data.wsapi.Store",{model:"TypeDefinition",autoLoad:!0,limit:1/0,disableMetaChangeEvent:!0,fetch:["Ordinal","Name"],filters:[{property:"Parent.Name",value:"Portfolio Item"},{property:"Creatable",value:!0}],listeners:{load:function(portfolioTypeStore){me.PortfolioItemTypes=_.map(_.sortBy(_.map(portfolioTypeStore.getRange(),function(item){return{Name:item.data.Name,Ordinal:item.data.Ordinal}}),function(item){return item.Ordinal}),function(item){return item.Name}),deferred.resolve()}}});return deferred.promise},_loadModels:function(){var me=this,promises=[],models={Project:"Project",UserStory:"HierarchicalRequirement",PortfolioItem:"PortfolioItem"};return _.each(me.PortfolioItemTypes,function(name){models[name]="PortfolioItem/"+name}),_.each(models,function(modelType,modelName){var deferred=Q.defer();Rally.data.WsapiModelFactory.getModel({type:modelType,success:function(loadedModel){me[modelName]=loadedModel,deferred.resolve()}}),promises.push(deferred.promise)}),Q.all(promises)},_loadScrumGroupConfig:function(){var me=this,deferred=Q.defer();return Rally.data.PreferenceManager.load({workspace:me.getContext().getWorkspace()._ref,filterByName:me._ScrumGroupConfigPrefName,success:function(prefs){var configString=prefs[me._ScrumGroupConfigPrefName],scrumGroupConfig;try{scrumGroupConfig=JSON.parse(configString)}catch(e){scrumGroupConfig=[]}me.ScrumGroupConfig=scrumGroupConfig,deferred.resolve()},failure:deferred.reject}),deferred.promise},_saveScrumGroupConfig:function(scrumGroupConfig){var me=this,s={},deferred=Q.defer();return s[me._ScrumGroupConfigPrefName]=JSON.stringify(scrumGroupConfig),Rally.data.PreferenceManager.update({workspace:me.getContext().getWorkspace()._ref,filterByName:me._ScrumGroupConfigPrefName,settings:s,success:deferred.resolve,failure:deferred.reject}),deferred.promise},_configureIntelRallyApp:function(){var me=this;return me.BaseUrl=Rally.environment.getServer().getBaseUrl(),Q.all([me._loadPortfolioItemTypes().then(function(){return me._userStoryFields.push(me.PortfolioItemTypes[0]),Q.all([me._loadModels(),me._loadPortfolioItemStatesForEachType()])}),me._loadScrumGroupConfig(),me._loadScheduleStates()])},_reloadStore:function(store){var deferred=Q.defer();return store.load({callback:function(records,operation,success){success?deferred.resolve(store):deferred.reject(operation.getError()||"Could not load data")}}),deferred.promise},_loadProject:function(oid){var me=this,deferred=Q.defer();return oid?me.Project?(me.Project.load(oid,{fetch:me._projectFields,context:{workspace:me.getContext().getWorkspace()._ref,project:null},callback:deferred.resolve}),deferred.promise):Q.reject("IntelRallyApp is not configured!"):Q.reject("Invalid arguments: LP")},_loadUserStory:function(oid,projectRecord){var me=this,deferred=Q.defer();return oid?me.UserStory?(me.UserStory.load(oid,{fetch:me._userStoryFields,context:{workspace:projectRecord?null:me.getContext().getWorkspace()._ref,project:projectRecord?projectRecord.data._ref:null},callback:deferred.resolve}),deferred.promise):Q.reject("IntelRallyApp is not configured!"):Q.reject("Invalid arguments: LUS")},_loadPortfolioItemByType:function(oid,type){var me=this,deferred=Q.defer();return oid&&type?(me[type].load(oid,{fetch:me._portfolioItemFields,context:{workspace:me.getContext().getWorkspace()._ref,project:null},callback:deferred.resolve}),deferred.promise):Q.reject("Invalid arguments: LPIBT")},_loadPortfolioItemByOrdinal:function(oid,ordinal){var me=this,deferred=Q.defer(),type=me.PortfolioItemTypes[ordinal];return me._loadPortfolioItemByType(oid,type)},_projectInWhichScrumGroup:function(projectRecord){if(projectRecord){var me=this,foundScrumGroupConfig=_.find(me.ScrumGroupConfig,function(scrumGroupConfig){return scrumGroupConfig.ScrumGroupRootProjectOID==projectRecord.data.ObjectID});if(foundScrumGroupConfig)return Q(projectRecord);var parent=projectRecord.data.Parent;return parent?me._loadProject(parent.ObjectID).then(function(parentRecord){return me._projectInWhichScrumGroup(parentRecord)}):Q()}return Q()},_loadScrumGroupPortfolioProject:function(scrumGroupRootProjectRecord){if(!scrumGroupRootProjectRecord)return Q.reject("Invalid arguments: _loadScrumGroupPortfolioProject");var me=this,foundScrumGroupConfig=_.find(me.ScrumGroupConfig,function(scrumGroupConfig){return scrumGroupConfig.ScrumGroupRootProjectOID==scrumGroupRootProjectRecord.data.ObjectID});return foundScrumGroupConfig?foundScrumGroupConfig.ScrumGroupAndPortfolioLocationTheSame?Q(scrumGroupRootProjectRecord):me._loadProject(foundScrumGroupConfig.PortfolioProjectOID):Q.reject("Project "+scrumGroupRootProjectRecord.data.Name+" is not a scrum group!")},_getScrumGroupName:function(scrumGroupRootProjectRecord){if(!scrumGroupRootProjectRecord)throw"Invalid arguments: _getScrumGroupName";var me=this,foundScrumGroupConfig=_.find(me.ScrumGroupConfig,function(scrumGroupConfig){return scrumGroupConfig.ScrumGroupRootProjectOID==scrumGroupRootProjectRecord.data.ObjectID});if(!foundScrumGroupConfig)throw"Project "+scrumGroupRootProjectRecord.data.Name+" is not a scrum-group!";return foundScrumGroupConfig.ScrumGroupName?foundScrumGroupConfig.ScrumGroupName:scrumGroupRootProjectRecord.data.Name},_loadAllScrumGroups:function(){var me=this,filter=_.reduce(me.ScrumGroupConfig,function(filter,scrumGroupConfig){var newFilter=Ext.create("Rally.data.wsapi.Filter",{property:"ObjectID",value:scrumGroupConfig.ScrumGroupRootProjectOID});return filter?filter.or(newFilter):newFilter},null);if(filter){var store=Ext.create("Rally.data.wsapi.Store",{model:"Project",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._projectFields,filters:[filter],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})}return Q([])},__getUserStoryInReleaseTimeFrameFilter:function(releaseRecord){var me=this,lowestPortfolioItem=me.PortfolioItemTypes[0],twoWeeks=12096e5,releaseStartPadding=new Date(1*new Date(releaseRecord.data.ReleaseStartDate)+twoWeeks).toISOString(),releaseEndPadding=new Date(1*new Date(releaseRecord.data.ReleaseDate)-twoWeeks).toISOString();return Ext.create("Rally.data.wsapi.Filter",{property:"Release.ReleaseStartDate",operator:"<",value:releaseStartPadding}).and(Ext.create("Rally.data.wsapi.Filter",{property:"Release.ReleaseDate",operator:">",value:releaseEndPadding})).or(Ext.create("Rally.data.wsapi.Filter",{property:"Release.ObjectID",value:null}).and(Ext.create("Rally.data.wsapi.Filter",{property:lowestPortfolioItem+".Release.ReleaseStartDate",operator:"<",value:releaseStartPadding}).and(Ext.create("Rally.data.wsapi.Filter",{property:lowestPortfolioItem+".Release.ReleaseDate",operator:">",value:releaseEndPadding}))))},_loadRandomUserStory:function(projectRecord){if(!projectRecord)return Q.reject("Invalid arguments: LRUS");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1,pageSize:1,disableMetaChangeEvent:!0,fetch:!1,context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID}]});return me._reloadStore(store).then(function(store){return store.getRange().pop()})},_loadRandomUserStoryFromReleaseTimeframe:function(projectRecord,releaseRecord){if(!projectRecord||!releaseRecord)return Q.reject("Invalid arguments: LRUSFR");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:5,pageSize:5,disableMetaChangeEvent:!0,fetch:me._userStoryFields,context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},sorters:[{property:"CreationDate",direction:"DESC"}],filters:[Ext.create("Rally.data.wsapi.Filter",{property:"Project.ObjectID",value:projectRecord.data.ObjectID}).and(me.__getUserStoryInReleaseTimeFrameFilter(releaseRecord))]});return me._reloadStore(store).then(function(store){var records=store.data.items;return records.length?Q(records[Math.floor(Math.random()*records.length)]):Q(void 0)})},_loadUserStoryByFID:function(formattedID,projectRecord){if(!formattedID||!projectRecord)return Q.reject("Invalid arguments: LUSBFID");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1,pageSize:1,disableMetaChangeEvent:!0,fetch:["Name","Project","ObjectID","FormattedID","Predecessors","Successors","c_Dependencies"],context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},filters:[{property:"FormattedID",value:formattedID},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_loadPortfolioItemsOfType:function(portfolioProject,type){if(!portfolioProject||!type)return Q.reject("Invalid arguments: OPIOT");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/"+type,limit:1/0,disableMetaChangeEvent:!0,remoteSort:!1,fetch:me._portfolioItemFields,context:{project:portfolioProject.data._ref,projectScopeDown:!0,projectScopeUp:!1}});return me._reloadStore(store)},_loadPortfolioItemsOfOrdinal:function(portfolioProject,ordinal){if(!portfolioProject||ordinal===void 0)return Q.reject("Invalid arguments: LPIOO");var me=this,type=me.PortfolioItemTypes[ordinal];return type?me._loadPortfolioItemsOfType(portfolioProject,type):Q.reject("Invalid PortfolioItem ordinal")},_portfolioItemTypeToOrdinal:function(type){return this.PortfolioItemTypes.indexOf(type)},_getPortfolioItemTypeStateByOrdinal:function(ordinal,stateName){return _.find(this.PortfolioItemTypeStates[ordinal],function(state){return state.data.Name==stateName})},_getPortfolioItemTypeStateByName:function(portfolioType,stateName){return this._getPortfolioItemTypeStateByOrdinal(this._portfolioItemTypeToOrdinal(portfolioType),stateName)},__storeItemsToProjTree:function(projects){for(var me=this,projTree={},i=0,len=projects.length;len>i;++i){var project=projects[i],thisRef=project.data.ObjectID,parentRef=project.data.Parent?project.data.Parent.ObjectID:void 0;projTree[thisRef]||(projTree[thisRef]={}),projTree[thisRef].ProjectRecord=project,parentRef&&(projTree[parentRef]||(projTree[parentRef]={}),projTree[parentRef][thisRef]=projTree[thisRef])}return projTree},_loadAllProjects:function(){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){var map=_.reduce(store.getRange(),function(map,project){return map[project.data.ObjectID]=project,map},{});return map})},__addProjectsWithTeamMembersToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;curProj.data.TeamMembers.Count>0&&(hash[curProj.data.ObjectID]=curProj);for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__addProjectsWithTeamMembersToList(projTree[childProjRef],hash)},_loadProjectsWithTeamMembers:function(rootProjectRecord){var me=this,projectsWithTeamMembers={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__addProjectsWithTeamMembersToList(projTree[rootProjectRecord.data.ObjectID],projectsWithTeamMembers),projectsWithTeamMembers}return _.reduce(_.filter(store.getRange(),function(project){return project.data.TeamMembers.Count>0}),function(map,project){return map[project.data.ObjectID]=project,map},{})})},__allChildProjectToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;hash[curProj.data.ObjectID]=curProj;for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__allChildProjectToList(projTree[childProjRef],hash)},_loadAllChildrenProjects:function(rootProjectRecord){var me=this,childrenProjects={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__allChildProjectToList(projTree[rootProjectRecord.data.ObjectID],childrenProjects),childrenProjects}return _.reduce(store.getRange(),function(map,project){return map[project.data.ObjectID]=project,map},{})})},__allLeafProjectsToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;0===curProj.data.Children.Count&&(hash[curProj.data.ObjectID]=curProj);for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__allLeafProjectsToList(projTree[childProjRef],hash)},_loadAllLeafProjects:function(rootProjectRecord){var me=this,leafProjects={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__allLeafProjectsToList(projTree[rootProjectRecord.data.ObjectID],leafProjects),leafProjects}return _.reduce(_.filter(store.getRange(),function(project){return 0===project.data.Children.Count}),function(map,project){return map[project.data.ObjectID]=project,map},{})})},_loadProjectByName:function(projectName){if(!projectName)return Q.reject("Invalid arguments: LPBN");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",limit:1,pageSize:1,fetch:["Name","ObjectID"],disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",value:projectName}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_loadAllReleases:function(projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesAfterGivenDate:function(projectRecord,givenDate){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"ReleaseDate",operator:">=",value:new Date(givenDate).toISOString()},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesBeforeGivenDate:function(projectRecord,givenDate){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!1,disableMetaChangeEvent:!0,fetch:me._releaseFields,filters:[{property:"ReleaseDate",operator:"<=",value:new Date(givenDate).toISOString()},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesBetweenDates:function(projectRecord,startDate,endDate){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!1,fetch:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID},{property:"ReleaseDate",operator:">",value:new Date(startDate).toISOString()},{property:"ReleaseStartDate",operator:"<",value:new Date(endDate).toISOString()}]});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesInTheFuture:function(projectRecord){return this._loadReleasesAfterGivenDate(projectRecord,new Date)},_loadReleasesByNameUnderProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",value:releaseName}],context:{project:projectRecord.data._ref,projectScopeDown:!0,projectScopeUp:!1}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleaseByNameForProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",value:releaseName},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange().pop()})},_loadReleasesByNameContainsForProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",operator:"contains",value:releaseName},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_getScopedRelease:function(releaseRecords,projectOID,appPrefs){var me=this,d=new Date,rs=releaseRecords,prefOID=appPrefs&&appPrefs.projs&&appPrefs.projs[projectOID]&&appPrefs.projs[projectOID].Release;return prefOID&&_.find(rs,function(r){return r.data.ObjectID==prefOID})||_.find(rs,function(r){return new Date(r.data.ReleaseDate)>=d&&d>=new Date(r.data.ReleaseStartDate)})||_.reduce(rs,function(best,r){if(null===best)return r;var d1=1*new Date(best.data.ReleaseStartDate),d2=1*new Date(r.data.ReleaseStartDate),now=1*new Date;return Math.abs(d1-now)<Math.abs(d2-now)?best:r},null)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("WorkweekDropdown",{extend:"Ext.data.Model",fields:[{name:"Workweek",type:"string"},{name:"DateVal",type:"number"}]}),Ext.define("ScrumGroupPortfolioConfigItem",{extend:"Ext.data.Model",fields:[{name:"ScrumGroupRootProjectOID",type:"number"},{name:"ScrumGroupName",type:"string"},{name:"ScrumGroupAndPortfolioLocationTheSame",type:"boolean"},{name:"PortfolioProjectOID",type:"number"},{name:"IsTrain",type:"boolean"}]})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("WindowListener",{__initWindowEventListener:function(eventName){var me=this;me._windowListeners||(me._windowListeners={}),me._windowListeners[eventName]=[],window.parent["on"+eventName]=function(event){for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i](event)}},_addWindowEventListener:function(eventName,fn){var me=this;me._windowListeners&&me._windowListeners[eventName]||me.__initWindowEventListener(eventName),me._windowListeners[eventName].push(fn)},_fireParentWindowEvent:function(eventName){var me=this;if(me._windowListeners&&me._windowListeners[eventName])for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i]()}})})();
                (function(){var Ext=window.Ext4||window.Ext,TOP_BAR_HEIGHT=40,BOTTOM_BAR_HEIGHT=24,BOTTOM_IFRAME_PADDING=20,TITLE_BAR_HEIGHT=33,IFRAME_HEADER_HEIGHT=28;Ext.define("IframeResize",{requires:["WindowListener"],_fixRallyDashboard:function(){if(window&&window.frameElement){for(var me=this,bottomEl=Ext.get(window.frameElement),portlet=bottomEl.up(".x-portlet"),dashboard=portlet.up("#mydash_portlet"),titleBar=dashboard.down(".titlebar"),domNodeW=bottomEl.dom,domNodeH=bottomEl.dom,innerHeight=window.parent.innerHeight,innerWidth=window.parent.innerWidth;;){if(domNodeW.style.width=innerWidth-4+"px",domNodeW.style.padding="0",domNodeW.style.margin="0","mydash_portlet"===domNodeW.id)break;domNodeW=domNodeW.parentNode}for(;;){if(domNodeH.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT+TITLE_BAR_HEIGHT+IFRAME_HEADER_HEIGHT+BOTTOM_IFRAME_PADDING)+"px",domNodeH.classList.contains("x-portlet"))break;domNodeH=domNodeH.parentNode}for(;;){if(domNodeH.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT+TITLE_BAR_HEIGHT)+"px","mydash_portlet"==domNodeH.id)break;domNodeH=domNodeH.parentNode}dashboard.dom.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT)+"px",dashboard.dom.style.padding="0 2px 0 2px",titleBar.dom.style.padding="2px",titleBar.dom.style.margin="0"}},_initFixRallyDashboard:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._fixRallyDashboard()}),me._fixRallyDashboard()},_disableResizeHandle:function(){var me=this,handle;window&&window.frameElement&&(handle=Ext.get(window.frameElement).up(".x-portlet").down(".x-resizable-handle"),handle&&(handle.hide(),handle.dom.onshow=function(){handle&&handle.hide()}))},_initDisableResizeHandle:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._disableResizeHandle()}),me._disableResizeHandle()}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("PrettyAlert",{__getMessageBoxY:function(){var me=this,bottomEl=window.frameElement?Ext.get(window.frameElement):me.el,ph=window.frameElement?window.parent.getWindowHeight():window.innerHeight,ps=window.frameElement?window.parent.getScrollY():window.scrollY,ofy=ps+bottomEl.dom.getBoundingClientRect().top,iyOffset=Math.floor(ph/2-ofy+ps-50);return 0>iyOffset?0:iyOffset},_alert:function(title,message){var me=this;message="string"==typeof message?message:message.message?message.message:JSON.stringify(message,null,"	"),1>arguments.length||(1===arguments.length&&(message=title,title=""),Ext.MessageBox.alert(title,message).setY(me.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},50))},_confirm:function(title,message,fn){var me=this;message="string"==typeof message?message:message.message?message.message:JSON.stringify(message,null,"	"),2>arguments.length||(2===arguments.length&&(fn=message,message=title,title=""),"function"!=typeof fn&&(fn=function(){}),Ext.MessageBox.confirm(title,message,fn).setY(me.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},20))}})})();
                (function(){var Ext=window.Ext4||window.Ext,intel_ww={},SECOND=1e3,MINUTE=60*SECOND,HOUR=60*MINUTE,DAY=24*HOUR,WEEK=7*DAY;Ext.define("IntelWorkweek",{_getWorkweek:function(_date){var date=new Date(_date),yearStart=new Date(date.getFullYear(),0,1),dayIndex=yearStart.getDay(),ww01Start=new Date(yearStart-dayIndex*DAY),utcDateMillis=Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()),ww01Millis=Date.UTC(ww01Start.getFullYear(),ww01Start.getMonth(),ww01Start.getDate()),timeDiff=utcDateMillis-ww01Millis,ww=Math.floor(timeDiff/WEEK)+1,leap=0===date.getFullYear()%4,weekCount=leap&&dayIndex>=5||!leap&&6===dayIndex?53:52;return ww>weekCount?1:ww},_getWeekCount:function(_date){var date=new Date(_date),leap=0===date.getFullYear()%4,day=new Date(date.getFullYear(),0,1).getDay();return leap&&day>=5||!leap&&6===day?53:52},_roundDateDownToWeekStart:function(_date){var date=new Date(_date),day=date.getDay(),monthDate=date.getDate(),month=date.getMonth(),year=date.getFullYear(),sundayMidday=new Date(1*new Date(year,month,monthDate)-(day*DAY-.5*DAY));return new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())},_getWorkweekDates:function(startDate,endDate){for(var startWeekDate=this._roundDateDownToWeekStart(startDate),endWeekDate=this._roundDateDownToWeekStart(endDate),startMillis=Date.UTC(startWeekDate.getFullYear(),startWeekDate.getMonth(),startWeekDate.getDate()),endMillis=Date.UTC(endWeekDate.getFullYear(),endWeekDate.getMonth(),endWeekDate.getDate()),totalWeeks=Math.floor((endMillis-startMillis)/WEEK)+1,weeks=Array(totalWeeks),i=0;totalWeeks>i;++i){var sundayMidday=new Date(1*startWeekDate+(WEEK*i+12*HOUR));weeks[i]=new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())}return weeks},_workweekToDate:function(ww,year){var yearStart=new Date(year,0,1),dayIndex=yearStart.getDay(),ww01StartMidday=new Date(yearStart-(dayIndex*DAY-.5*DAY)),sundayMidday=new Date(1*ww01StartMidday+(ww-1)*WEEK);return new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())},_getWorkWeeksForDropdown:function(releaseStartDate,releaseEndDate){for(var workweeks=this._getWorkweekDates(releaseStartDate,releaseEndDate),data=Array(workweeks.length),i=0,len=workweeks.length;len>i;++i)data[i]={Workweek:"ww"+this._getWorkweek(workweeks[i]),DateVal:1*workweeks[i]};return data}})})();
                (function(){var Ext=window.Ext4||window.Ext,ChartsTooltipDatemap={},RSquaredMap={};Ext.define("CumulativeFlowChartMixin",{requires:["IntelRallyApp","IntelWorkweek"],_defaultCumulativeFlowChartConfig:{chart:{defaultSeriesType:"area",zoomType:"xy"},colors:["#ABABAB","#E57E3A","#E5D038","#0080FF","#3A874F","#26FF00","#000000"],xAxis:{tickmarkPlacement:"on",title:{text:"Days",margin:10},labels:{y:20}},yAxis:{title:{text:"Points"},labels:{x:-5,y:4}},tooltip:{formatter:function(){for(var sum=0,datemap=ChartsTooltipDatemap[this.series.chart.container.id],rSquaredMap=RSquaredMap[this.series.chart.container.id],i=4;i>=this.series.index;--i)sum+=this.series.chart.series[i].data[this.point.x].y;return"<b>"+this.x+"</b>"+(datemap?" ("+datemap[this.point.x]+")":"")+(rSquaredMap&&rSquaredMap[this.series.index]?"<br/><b>R<sup>2</sup> = "+rSquaredMap[this.series.index].val:"")+"<br /><b>"+this.series.name+"</b>: "+(100*this.y>>0)/100+(4>=this.series.index?"<br /><b>Total</b>: "+(100*sum>>0)/100:"")}},plotOptions:{series:{marker:{enabled:!1,states:{hover:{enabled:!0}}},groupPadding:.01},area:{stacking:"normal",lineColor:"#666666",lineWidth:2,marker:{enabled:!1}}}},_getCumulativeFlowChartColors:function(){var me=this,colors=me._defaultCumulativeFlowChartConfig.colors,scheduleStates=me.ScheduleStates;return scheduleStates.length>=5?{colors:colors}:{colors:colors.slice(0,scheduleStates.length).concat(colors.slice(scheduleStates.length+1))}},_getValidTrendTypes:function(){return["FromZero","FromStartAccepted","FromStartWork","LastWeek","LastSprint","Last2Sprints","LinearRegression","LinearRegressionFromStartAccepted","LinearRegressionFromStartWork"]},__getRSquared:function(ySeries,fSeries,lastIndex){if(0>=lastIndex)return 1;var ys=ySeries.data.slice(0,lastIndex),fs=fSeries.data.slice(0,lastIndex),meanY=_.reduce(ys,function(sum,yi){return sum+(yi||0)},0)/ys.length,SStot=_.reduce(ys,function(sum,yi){return sum+Math.pow((yi||0)-meanY,2)},0),SSres=_.reduce(fs,function(sum,fi,i){return sum+Math.pow((ys[i]||0)-(fi||0),2)},0);return(1e3*(1-SSres/SStot)>>0)/1e3},__addProjectedTrendline:function(data,options){var me=this,totalPoints=options.totalPoints,trendType=options.trendType,validTypes=me._getValidTrendTypes(),slope,intercept,X,Y,scheduleStateSeries=_.filter(data.series,function(s){return me.ScheduleStates.indexOf(s.name)>-1}),scheduleStatesSumList=_.times(scheduleStateSeries[0].length,function(n){return _.reduce(scheduleStateSeries,function(sum,s){return sum+(s.data[n]||0)},0)});trendType=_.find(validTypes,function(type){return type==trendType})||validTypes[0];var topScheduleState=me.ScheduleStates.slice(-1)[0],topScheduleStateSeries=_.find(data.series,function(s){return s.name===topScheduleState}),i,len,projectedTrend={type:"spline",dashStyle:"Solid",name:"Projected",data:topScheduleStateSeries.data.slice()},begin=0,end=projectedTrend.data.length-1;if("FromZero"==trendType){for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){return(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100})}if("FromStartAccepted"==trendType){for(i=1;projectedTrend.data.length>i;++i)if(null!==projectedTrend.data[i]&&0!==projectedTrend.data[i]){begin=i-1;break}for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("FromStartWork"==trendType){for(i=1;scheduleStatesSumList.length>i;++i)if(null!==scheduleStatesSumList[i]&&0!==scheduleStatesSumList[i]){begin=i-1;break}for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("LastWeek"==trendType){for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}begin=0>end-5?0:end-5,slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("LastSprint"==trendType){for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}begin=0>end-10?0:end-10,slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("Last2Sprints"==trendType){for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}begin=0>end-20?0:end-20,slope=end===begin?0:(projectedTrend.data[end]-projectedTrend.data[begin])/(end-begin),projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(projectedTrend.data[begin]+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("LinearRegression"==trendType){for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}X=$M(_.map(projectedTrend.data.slice(begin,end),function(p,j){return[1,j]})),Y=$M(_.map(projectedTrend.data.slice(begin,end),function(p){return p})),b=X.transpose().multiply(X).inverse().multiply(X.transpose().multiply(Y)),slope=b.elements[1][0],intercept=b.elements[0][0],projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(intercept+j*slope)>>0)/100;return 0>pt?0:pt})}if("LinearRegressionFromStartAccepted"==trendType){for(i=1;projectedTrend.data.length>i;++i)if(null!==projectedTrend.data[i]&&0!==projectedTrend.data[i]){begin=i-1;break}for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}X=$M(_.map(projectedTrend.data.slice(begin,end),function(p,j){return[1,j]})),Y=$M(_.map(projectedTrend.data.slice(begin,end),function(p){return p})),b=X.transpose().multiply(X).inverse().multiply(X.transpose().multiply(Y)),slope=b.elements[1][0],intercept=b.elements[0][0],projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(intercept+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if("LinearRegressionFromStartWork"==trendType){for(i=1;scheduleStatesSumList.length>i;++i)if(null!==scheduleStatesSumList[i]&&0!==scheduleStatesSumList[i]){begin=i-1;break}for(i=end;i>=begin;--i)if(0!==projectedTrend.data[i]){end=i;break}X=$M(_.map(projectedTrend.data.slice(begin,end),function(p,j){return[1,j]})),Y=$M(_.map(projectedTrend.data.slice(begin,end),function(p){return p})),b=X.transpose().multiply(X).inverse().multiply(X.transpose().multiply(Y)),slope=b.elements[1][0],intercept=b.elements[0][0],projectedTrend.data=_.map(projectedTrend.data,function(p,j){var pt=(100*(intercept+(j-begin)*slope)>>0)/100;return 0>pt?0:pt})}if(slope>=0)for(i=1,len=projectedTrend.data.length;len>i;++i)if(projectedTrend.data[i]>=totalPoints){projectedTrend.data[i]={color:"red",marker:{enabled:!0,lineWidth:4,symbol:"circle",fillColor:"red",lineColor:"red"},y:projectedTrend.data[i]};break}return projectedTrend},_updateCumulativeFlowChartData:function(data,options){_.merge({},options);var me=this,now=new Date,trendType=options.trendType,hideTrends=options.hideTrends,todayIndex=-1,datemap=[],rSquaredMap=[];todayIndex=new Date(data.categories[0])>now?-1:now>new Date(data.categories[data.categories.length-1])?data.categories.length:_.reduce(data.categories,function(savedI,c,i){return new Date(c)>now&&-1===savedI&&(savedI=i-1),savedI},-1);var topScheduleState=me.ScheduleStates.slice(-1)[0],topScheduleStateSeries=_.find(data.series,function(s){return s.name===topScheduleState}),totalPoints=new Date(data.categories[0])>now?0:_.reduce(data.series,function(sum,s){return sum+(s.data[s.data.length-1]||0)},0)||0,idealTrend,ratio;if(hideTrends||(idealTrend={type:"spline",dashStyle:"Solid",name:"Ideal",data:Array(data.categories.length)},ratio=totalPoints/(data.categories.length-1)||0,idealTrend.data=_.map(idealTrend.data,function(e,i){return Math.round(100*(0+i*ratio))/100})),_.each(data.categories,function(c,i,a){var d=new Date(c);a[i]="ww"+me._getWorkweek(d),datemap[i]=c,d>now&&_.each(data.series,function(s,j){s.data=s.data.slice(0,i).concat(_.map(Array(a.length-i),function(){return 0}))})}),!hideTrends){var projectedTrend=me.__addProjectedTrendline(data,{totalPoints:totalPoints,trendType:trendType});data.series.push(projectedTrend),rSquaredMap[data.series.length-1]={val:me.__getRSquared(projectedTrend,topScheduleStateSeries,todayIndex)},data.series.push(idealTrend)}return data.datemap=datemap,data.rSquaredMap=rSquaredMap,data},_getCumulativeFlowChartTicks:function(startDate,endDate,width){var pixelTickWidth=40,ticks=width/pixelTickWidth>>0,oneDay=864e5,days=(1*endDate-1*startDate)/oneDay>>0,interval=7*((days/ticks>>0)/7>>0);return 7>interval?7:interval},_setCumulativeFlowChartDatemap:function(chartContainerId,datemap){ChartsTooltipDatemap[chartContainerId]=datemap},_setCumulativeFlowChartRSquaredMap:function(chartContainerId,rSquaredMap){RSquaredMap[chartContainerId]=rSquaredMap}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("UserAppsPreference",{_userAppsPref:"intel-user-apps-preference",_loadAppsPreference:function(){var me=this,deferred=Q.defer();return Rally.data.PreferenceManager.load({filterByUser:!0,filterByName:me._userAppsPref,success:function(prefs){var appPrefs=prefs[me._userAppsPref];try{appPrefs=JSON.parse(appPrefs)}catch(e){appPrefs={projs:{},refresh:0}}deferred.resolve(appPrefs)},failure:deferred.reject}),deferred.promise},_saveAppsPreference:function(prefs){var me=this,s={},deferred=Q.defer();return prefs={projs:prefs.projs,refresh:prefs.refresh},s[me._userAppsPref]=JSON.stringify(prefs),Rally.data.PreferenceManager.update({filterByUser:!0,filterByName:me._userAppsPref,settings:s,success:deferred.resolve,failure:deferred.reject}),deferred.promise}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("ParallelLoader",{_parallelLoadWsapiStore:function(config){function doStoreLoad(page){var deferred=Q.defer(),store=Ext.create("Rally.data.wsapi.Store",_.merge({},config,{pageSize:200,listeners:{load:function(store,records,successful){successful?deferred.resolve(store):deferred.reject("could not load data from server")}}}));return store.loadPage(page),deferred.promise}function makeStore(){return Ext.create("Rally.data.wsapi.Store",{model:model,totalCount:data.length,data:data,disableMetaChangeEvent:!0,load:function(){}})}var me=this,data=[],model;return doStoreLoad(1).then(function(store){data=data.concat(store.getRange()),model=store.model;var pages=store.totalCount/200>>0+(store.totalCount%200?0:1)||1;return 1===pages?makeStore():Q.all(_.times(pages-1,function(pageNum){return doStoreLoad(pageNum+2).then(function(store){data=data.concat(store.getRange())})})).then(makeStore)})},_parallelLoadLookbackStore:function(config){function doStoreLoad(page){var deferred=Q.defer(),store=Ext.create("Rally.data.lookback.SnapshotStore",_.merge({},config,{pageSize:2e4,listeners:{load:function(store,records,successful){successful?deferred.resolve(store):deferred.reject("could not load data from server")}}}));return store.loadPage(page),deferred.promise}function makeStore(){return Ext.create("Rally.data.lookback.SnapshotStore",{model:model,totalCount:data.length,data:data,disableMetaChangeEvent:!0,load:function(){}})}var me=this,data=[],model;return doStoreLoad(1).then(function(store){data=data.concat(store.getRange()),model=store.model;var pages=store.totalCount/2e4>>0+(store.totalCount%2e4?0:1)||1;return 1===pages?makeStore():Q.all(_.times(pages-1,function(pageNum){return doStoreLoad(pageNum+2).then(function(store){data=data.concat(store.getRange())})})).then(makeStore)})}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelFixedComboBox",{extend:"Ext.form.field.ComboBox",alias:["widget.intelfixedcombo","widget.intelfixedcombobox"],constructor:function(options){options=options||{},options=Ext.merge({editable:!1,allowBlank:!0,queryMode:"local",listeners:{change:function(combo,newval,oldval){0===newval.length&&combo.setValue(oldval)},focus:function(combo){combo.setValue(""),combo.expand()}}},options),this.callParent([options])}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelReleasePicker",{extend:"IntelFixedComboBox",alias:["widget.intelreleasepicker"],constructor:function(options){options.releases&&options.currentRelease&&(options.displayField="Name",options.value=options.currentRelease.data.Name,options.store=Ext.create("Ext.data.Store",{fields:["Name"],data:_.map(options.releases,function(r){return{Name:r.data.Name}})}),options.fieldLabel=options.fieldLabel||"Release:",options.editable=options.editable||!1,options.width=options.width||240,options.labelWidth=options.labelWidth||50,this.callParent([options]))}})})();
                (function(){var Ext=window.Ext4||window.Ext,POLL_INTERVAL_MS=10;Ext.define("Skirtle.CTemplate",{extend:"Ext.XTemplate",statics:{AUTO_ID:0},copyDepth:10,cTpl:'<p id="ctemplate-{0}-{1}"></p>',isCTemplate:!0,constructor:function(){var me=this;me.callParent(arguments),me.id=++me.statics().AUTO_ID,me.reset()},copyValues:function(values,depth){var me=this,id,copy={},copyDepth=depth||me.copyDepth;return 1===copyDepth?values:Ext.isArray(values)?Ext.Array.map(values,function(value){return me.copyValues(value,copyDepth-1)}):Ext.isObject(values)?values.isComponent?(id=values.getId(),me.ids.push(id),Ext.String.format(me.cTpl,id,me.id)):(Ext.Object.each(values,function(key,value){copy[key]="$comp"===key?value:me.copyValues(value,copyDepth-1)}),copy):values},doInsert:function(){var ret=this.callParent(arguments);return this.injectComponents(),ret},doPolling:function(interval){var me=this;me.pollInterval=interval,me.pollId&&clearTimeout(me.pollId),me.pollId=Ext.defer(me.injectComponents,interval,me)},getPlaceholderEl:function(id){return Ext.get("ctemplate-"+id+"-"+this.id)},injectComponents:function(){for(var me=this,ids=me.ids,index=ids.length-1,id,cmp,placeholderEl;index>=0;--index)id=ids[index],cmp=Ext.getCmp(id),placeholderEl=me.getPlaceholderEl(id),(me.renderComponent(cmp,placeholderEl)||!cmp)&&(Ext.Array.splice(ids,index,1),placeholderEl&&placeholderEl.remove());ids.length&&me.doPolling(me.pollInterval)},overwrite:function(el){var dom,firstChild,ret;if(Ext.isIE)for(dom=Ext.getDom(el);dom.firstChild;)dom.removeChild(dom.firstChild);return ret=this.callParent(arguments),this.injectComponents(),ret},renderComponent:function(cmp,placeholderEl){if(cmp&&placeholderEl){var parent=placeholderEl.parent();return cmp.rendered?cmp.getEl().replace(placeholderEl):cmp.render(parent,placeholderEl),Ext.isIE6&&parent.repaint(),!0}return!1},reset:function(){var me=this;me.ids=[],me.pollId&&(clearTimeout(me.pollId),me.pollId=null)}},function(ctemplate){var apply=function(){var me=this,args=Ext.Array.slice(arguments);return args[0]=me.copyValues(args[0]),me.doPolling(POLL_INTERVAL_MS),me.callParent(args)};ctemplate.prototype.applyOut?ctemplate.override({applyOut:apply}):(ctemplate.override({applyTemplate:apply}),ctemplate.createAlias("apply","applyTemplate"))}),Ext.define("Skirtle.grid.column.Component",{alias:"widget.componentcolumn",extend:"Ext.grid.column.Column",requires:["Skirtle.CTemplate"],autoWidthComponents:!0,componentGC:!0,hasCustomRenderer:!0,lastFrameWidth:12,widthUpdateDelay:[10,400],constructor:function(cfg){var me=this;me.callParent(arguments),me.compIds=[],me.dataIndex=me.dataIndex||Ext.id(null,"cc-dataIndex-"),me.tpl=me.createTemplate(me.tpl),me.renderer=me.createRenderer(me.renderer),me.registerColumnListeners()},addRefOwner:function(child){var me=this,fn=me.refOwnerFn||(me.refOwnerFn=function(){return me});40200>me.extVersion?child.getBubbleTarget=fn:child.getRefOwner=fn},applyTemplate:function(data,value){return Ext.isDefined(value)&&(data[this.dataIndex]=value),this.tpl.apply(data)},beforeViewRefresh:function(){if(Ext.isIE)for(var ids=this.compIds,index=0,len=ids.length,item,el,parentEl;len>index;index++)(item=Ext.getCmp(ids[index]))&&(el=item.getEl())&&(el=el.dom)&&(parentEl=el.parentNode)&&parentEl.removeChild(el)},calculateFrameWidth:function(component){var el=component.getEl(),parentDiv=el&&el.parent(),parentTd=parentDiv&&parentDiv.parent();return parentTd?(this.lastFrameWidth=parentDiv.getFrameWidth("lr")+parentTd.getFrameWidth("lr"),this.lastFrameWidth):void 0},createRenderer:function(renderer){var me=this;return function(value,p,record){var data=Ext.apply({},record.data,record.getAssociatedData());return renderer&&(value=renderer.apply(this,arguments)),value=me.processValue(value),me.applyTemplate(data,value)}},createTemplate:function(tpl){return tpl&&tpl.isTemplate?tpl:Ext.create("Skirtle.CTemplate",tpl||["{",this.dataIndex,"}"])},destroyChild:function(child){child.destroy()},getRefItems:function(deep){for(var items=this.callParent([deep]),ids=this.compIds,index=0,len=ids.length,item;len>index;index++)item=Ext.getCmp(ids[index]),item&&(items.push(item),deep&&item.getRefItems&&items.push.apply(items,item.getRefItems(!0)));return items},onChildAfterRender:function(child){this.resizeChild(child)},onChildBoxReady:function(child){this.resizeChild(child,!1)},onChildDestroy:function(child){Ext.Array.remove(this.compIds,child.getId())},onChildResize:function(){this.redoScrollbars()},onColumnResize:function(column){column.resizeAll()},onColumnShow:function(column){column.resizeAll()},onColumnVisibilityChange:function(column){var items=column.getRefItems(),index=0,length=items.length,visible=!column.isHidden();for(Ext.suspendLayouts&&Ext.suspendLayouts();length>index;++index)items[index].setVisible(visible);Ext.resumeLayouts&&Ext.resumeLayouts(!0)},onDestroy:function(){Ext.destroy(this.getRefItems()),this.callParent()},onRender:function(){this.registerViewListeners(),this.callParent(arguments)},onViewChange:function(){var me=this,tpl=me.tpl;me.suspendResizing(),tpl.isCTemplate&&(tpl.injectComponents(),tpl.reset()),me.redoScrollbars(),me.resumeResizing(),me.performGC()},performGC:function(){for(var compIds=this.compIds,index=compIds.length-1,comp,el;index>=0;--index)comp=Ext.getCmp(compIds[index]),el=comp&&comp.getEl(),el&&(!this.componentGC||el.dom&&Ext.getDom(Ext.id(el))===el.dom)||comp&&!comp.isDestroyed&&comp.destroy()},processValue:function(value){var me=this,compIds=me.compIds,id,initialWidth,dom,parent;return Ext.isObject(value)&&!value.isComponent&&value.xtype&&(value=Ext.widget(value.xtype,value)),value&&value.isComponent&&(id=value.getId(),Ext.Array.contains(compIds,id)||compIds.push(id),me.addRefOwner(value),me.registerListeners(value),value.rendered?Ext.isIE&&(dom=value.el.dom,parent=dom.parentNode,parent&&(40101===me.extVersion&&Ext.core.DomHelper.insertBefore(dom,{tag:"p"}),parent.removeChild(dom))):me.autoWidthComponents&&(initialWidth=me.getWidth()-me.lastFrameWidth,initialWidth=initialWidth>4?initialWidth:4,value.setWidth(initialWidth)),(Ext.isIE6||Ext.isIE7)&&me.isHidden()&&value.hide()),value},redoScrollbars:function(){var me=this,grid=me.up("tablepanel");if(grid){if(me.resizeQueue)return me.redoScrollbarsRequired=!0,void 0;40100>me.extVersion?(grid.invalidateScroller(),grid.determineScrollbars()):grid.doLayout()}},registerColumnListeners:function(){var me=this;me.autoWidthComponents&&(me.on("resize",me.onColumnResize),me.on("show",me.onColumnShow)),(Ext.isIE6||Ext.isIE7)&&me.on({hide:me.onColumnVisibilityChange,show:me.onColumnVisibilityChange})},registerListeners:function(component){var me=this;component.on("destroy",me.onChildDestroy,me),me.autoWidthComponents&&(component.on("afterrender",me.onChildAfterRender,me,{single:!0}),me.extVersion>=40100&&component.on("boxready",me.onChildBoxReady,me,{single:!0})),component.on("resize",me.onChildResize,me)},registerViewListeners:function(){var me=this,view=me.up("tablepanel").getView();me.mon(view,"beforerefresh",me.beforeViewRefresh,me),me.mon(view,"refresh",me.onViewChange,me),me.mon(view,"itemupdate",me.onViewChange,me),me.mon(view,"itemadd",me.onViewChange,me),me.mon(view,"itemremove",me.onViewChange,me)},resizeAll:function(){var me=this;me.suspendResizing(),me.resizeQueue=me.getRefItems(),me.resumeResizing()},resizeChild:function(component,defer){var me=this,frameWidth,newWidth,oldWidth,resizeQueue;return me.resizingSuspended?(resizeQueue=me.resizeQueue,Ext.Array.contains(resizeQueue,component)||resizeQueue.push(component),void 0):(frameWidth=me.calculateFrameWidth(component),Ext.isNumber(frameWidth)&&(newWidth=me.getWidth()-frameWidth,oldWidth=component.getWidth(),me.setChildWidth(component,newWidth,oldWidth)&&defer!==!1&&Ext.each(me.widthUpdateDelay,function(delay){Ext.defer(me.resizeChild,delay,me,[component,!1])})),void 0)},resumeResizing:function(){var me=this,index=0,resizeQueue=me.resizeQueue,len=resizeQueue.length;if(!--me.resizingSuspended){for(;len>index;++index)me.resizeChild(resizeQueue[index]);me.resizeQueue=null,me.redoScrollbarsRequired&&me.redoScrollbars()}},setChildWidth:function(component,newWidth,oldWidth){return oldWidth===newWidth?!1:(component.setWidth(newWidth),!0)},suspendResizing:function(){var me=this;me.resizingSuspended=(me.resizingSuspended||0)+1,me.resizeQueue||(me.resizeQueue=[])}},function(cls){var proto=cls.prototype,version=Ext.getVersion();proto.extVersion=100*(100*version.getMajor()+version.getMinor())+version.getPatch(),Ext.Element.prototype.syncContent&&"4.1.0"==""+version&&(proto.extVersion=40101)})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("intel.grid.column.Component.",{alias:"widget.fastgridcolumn",extend:"Skirtle.grid.column.Component",autoWidthComponents:!1,componentGC:!0,hasCustomRenderer:!0,lastFrameWidth:12,constructor:function(cfg){var me=this;me.callParent(arguments)},registerViewListeners:function(){var me=this,view=me.up("tablepanel").getView();me.mon(view,"beforerefresh",me.beforeViewRefresh,me),me.mon(view,"refresh",me.onViewChange,me)},onViewChange:function(){var me=this,tpl=me.tpl;me.suspendResizing(),tpl.isCTemplate&&(tpl.injectComponents(),tpl.reset()),me.resumeResizing(),me.performGC()},resumeResizing:function(){var me=this,index=0,resizeQueue=me.resizeQueue,len=resizeQueue.length;if(!--me.resizingSuspended){for(;len>index;++index)me.resizeChild(resizeQueue[index]);me.resizeQueue=null}},onChildResize:function(){}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("FastCumulativeFlowCalculator",{constructor:function(options){this.scheduleStates=options.scheduleStates,this.startDate=options.startDate,this.endDate=options.endDate},_getDates:function(){for(var dates=[],curDay=this.startDate,day=864e5,n;this.endDate>curDay;)n=curDay.getDay(),this._dateToStringDisplay(curDay)===this._dateToStringDisplay(new Date)?dates.push(new Date):dates.push(curDay),curDay=new Date(1*curDay+day);return dates},_dateToStringDisplay:function(date){return Ext.Date.format(date,"m/d/Y")},_getIndexHelper:function(date,dateArray){for(var curVal=dateArray.length/2,curInt=curVal>>0,div=curVal/2,lastInt=-1;curInt!==lastInt;){if(dateArray[curInt]===date)return curInt;dateArray[curInt]>date?curVal-=div:curVal+=div,div/=2,lastInt=curInt,curInt=curVal>>0}return curInt},_getIndexBefore:function(date,dateArray){if(0===dateArray.length)return-1;var pos=this._getIndexHelper(date,dateArray);return date>dateArray[pos]?pos:pos-1},_getIndexOnOrAfter:function(date,dateArray){if(0===dateArray.length)return-1;var pos=this._getIndexHelper(date,dateArray);return pos===dateArray.length-1?dateArray[pos]>=date?pos:-1:dateArray[pos]>=date?pos:pos+1},runCalculation:function(items){if(!this.scheduleStates||!this.startDate||!this.endDate)throw"invalid constructor config";for(var dates=this._getDates(),day=864e5,dateMapTemplate=_.map(Array(dates.length),function(){return 0}),totals=_.reduce(this.scheduleStates,function(map,ss){return map[ss]=dateMapTemplate.slice(),map},{}),itemIndex=0,len=items.length;len>itemIndex;++itemIndex){var item=items[itemIndex].raw,iStart=new Date(item._ValidFrom),iEnd=new Date(item._ValidTo),state=item.ScheduleState,pe=item.PlanEstimate;if(pe&&state){var startIndex=this._getIndexOnOrAfter(iStart,dates),endIndex=this._getIndexBefore(iEnd,dates);if(-1!==startIndex&&-1!==endIndex)for(var i=startIndex;endIndex>=i;++i)totals[state][i]+=pe}}return{categories:_.map(dates,function(d){return this._dateToStringDisplay(d)},this),series:_.reduce(this.scheduleStates,function(outputArray,ss){return outputArray.concat([{name:ss,type:"area",dashStyle:"Solid",data:totals[ss]}])},[])}}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("RetroDashboard",{extend:"IntelRallyApp",componentCls:"app",requires:["FastCumulativeFlowCalculator"],mixins:["PrettyAlert","UserAppsPreference","IntelWorkweek","CumulativeFlowChartMixin","ParallelLoader"],items:[{xtype:"container",id:"retroWrapper",cls:"chart-wrapper",items:[{xtype:"container",id:"datePickerWrapper",layout:{type:"hbox"},items:[{xtype:"container",id:"retroReleasePicker",width:"240px"},{xtype:"component",id:"cntClickForDateChange",cls:"clickForDateChange",width:"390px",autoEl:{tag:"a",html:"Please Click here to change the Release Start Date"},listeners:{el:{click:{element:"el",fn:function(){Rally.getApp()._buildReleasePickerStartDate()}}}}},{xtype:"container",id:"cntDatePickerWrapper",hidden:!0,width:"390px",layout:{type:"hbox",align:"left"}}]},{xtype:"component",id:"cntInformation",cls:"clickForDateChange appInfo",autoEl:{tag:"a",html:'Help <img src="https://rally1.rallydev.com/slm/images/icon_help.gif" alt="Help" title="Help" >'},listeners:{el:{click:{element:"el",fn:function(){var html=['<ul class ="ulInformation"><li><b>Scope Delta</b> = (Final Workload - Original Commit) / Original Commit</li>',"<li><b>A/C Original</b> = Final Accepted / Original Commit</li>","<li><b>A/C Final</b> = Final Accepted / Original Commit</li>","<li>Sample dates are taken 7 days after Release Start Date and 7 days before the Release end date for Scope Delta , and 10 days after Release Start Date for Feature Scope Change.</li>","<li>If there are 0 points at Release Start Date, then the projected data is taken for the sample, and if there is no projected data, ideal data is taken for the sample.</li>","<li>You can change the Release Start Date for the selected Release. This will update the sample date for the Release Start Date.</li>","<li><b>Final Accepted</b> is the total points for user stories that are accepted at the Release End Date","<li><b>Final Workload</b> is the total points for user stories at the Release End Date","<li><b>Initial Commit</b> is the total points for user stories at the Release Start Date</ul>"].join("\n");Rally.getApp()._alert("Information on Data Calculations",html)}}}}},{xtype:"container",id:"retroBarChartWrapper",cls:"barchart-wrapper",layout:{type:"hbox",align:"left"},renderTo:document.body,items:[{xtype:"container",id:"retroChart",height:450,width:"44%"},{xtype:"container",id:"retroBarChartScopeWrapper",height:400,width:"18%"},{xtype:"container",id:"retroBarChartCaOriginalWrapper",height:400,width:"18%"},{xtype:"container",id:"retroBarChartCaFinalWrapper",height:400,width:"18%"}]},{xtype:"container",id:"legend",html:['<div class="legendwrapper">','<div class="dtarget"></div>','<div class="dtargetwrapper">Did Not Meet Target</div>','<div class="mtarget"></div>','<div class="mtargetwrapper">Met Target</div>','<div class="atarget"></div>','<div class="mtargetwrapper">A/C = Accept To Commit</div>',"</div>"].join("\n")},{xtype:"container",id:"scopeGridWrapper",items:[{xtype:"container",id:"scopeGrid",width:"99%"}]}]}],_userAppsPref:"intel-retro-dashboard",_releasePickerSelected:function(combo,records){var me=this;Ext.getCmp("cntDatePickerWrapper").removeAll(),Ext.getCmp("cntDatePickerWrapper").hide(),Ext.getCmp("cntClickForDateChange").show(),me.releaseStartDateChanged=!1,me.ReleaseRecord.data.Name!==records[0].data.Name&&(me.setLoading(!0),me.ReleaseRecord=_.find(me.ReleaseRecords,function(rr){return rr.data.Name==records[0].data.Name}),me._reloadEverything())},_buildReleasePicker:function(){var me=this;me.ReleasePicker=Ext.getCmp("retroReleasePicker").add({xtype:"intelreleasepicker",labelWidth:40,releases:me.ReleaseRecords,currentRelease:me.ReleaseRecord,listeners:{change:function(combo,newval,oldval){0===newval.length&&combo.setValue(oldval)},select:me._releasePickerSelected,scope:me}})},_buildReleasePickerStartDate:function(){Ext.getCmp("cntDatePickerWrapper").removeAll(),Ext.getCmp("cntClickForDateChange").hide(),Ext.getCmp("cntDatePickerWrapper").show();var me=this,_6days=5184e5,datePickerDefaultDate,rid=me.ReleaseRecord.data.ObjectID,pid=me.ProjectRecord.data.ObjectID,releaseSampleDataDate=new Date(1*new Date(me.ReleaseRecord.data.ReleaseStartDate)+_6days);"object"!=typeof me.AppsPref.projs[pid]&&(me.AppsPref.projs[pid]={}),datePickerDefaultDate=me.AppsPref.projs[pid][rid]?new Date(me.AppsPref.projs[pid][rid].ReleaseStartDate):releaseSampleDataDate;var maxDate=me.ReleaseRecord.data.ReleaseDate>new Date?new Date:me.ReleaseRecord.data.ReleaseDate,items=[{xtype:"rallydatefield",id:"ReleaseDatePicker",fieldLabel:"Select Release Start Date",labelWidth:140,minValue:releaseSampleDataDate,maxValue:maxDate,value:datePickerDefaultDate,showToday:!1},{xtype:"button",text:"Update",id:"btnUpdateReleaseDate",handler:function(){var txtValue=new Date(Ext.getCmp("ReleaseDatePicker").value).toLocaleDateString();Date.parse(txtValue)>=Date.parse(new Date(1*new Date(me.ReleaseRecord.data.ReleaseStartDate)+_6days))&&Date.parse(txtValue)<=Date.parse(maxDate)?(me.setLoading("Loading Data"),me.AppsPref.projs[pid]=me.AppsPref.projs[pid]||{},me.AppsPref.projs[pid][rid]=me.AppsPref.projs[pid][rid]||{},me.AppsPref.projs[pid][rid].ReleaseStartDate=txtValue,me._saveAppsPreference(me.AppsPref).then(function(){me.releaseStartDateChanged=!0,me.datePickerDate=txtValue;var date1=me.ReleaseRecord.data.ReleaseStartDate,date2=new Date(me.datePickerDate),_1day=864e5,daysCountDifference=Math.floor((Date.parse(date2)-Date.parse(date1))/_1day);me.initialAddedDaysCount=me.releaseStartDateChanged&&daysCountDifference>0?daysCountDifference:6,me._buildCumulativeFlowChart(),me._buildRetroChart(),me._hideHighchartsLinks(),me._buildScopeToReleaseStore(),me._buildScopeToReleaseGrid(),me.setLoading(!1)}).fail(function(reason){me._alert("ERROR",reason),me.setLoading(!1)}).done()):me._alert("Date Validation Note:","The entered date should be between Release start date("+releaseSampleDataDate.toLocaleDateString()+") and Release end date("+maxDate.toLocaleDateString()+").")}}];Ext.getCmp("cntDatePickerWrapper").add(items)},_loadAllChildReleases:function(){var me=this,releaseName=me.ReleaseRecord.data.Name;return me.ReleasesWithNameHash={},me._loadReleasesByNameUnderProject(releaseName,me.ScrumGroupRootRecord).then(function(releaseRecords){me.ReleasesWithNameHash=_.reduce(releaseRecords,function(hash,rr){return hash[rr.data.ObjectID]=!0,hash},{})})},_getPortfolioItems:function(){var me=this,releaseName=me.ReleaseRecord.data.Name;return me.LowestPortfolioItemsHash={},me.PortfolioItemsInReleaseStore=null,me._loadPortfolioItemsOfType(me.ScrumGroupPortfolioProject,me.PortfolioItemTypes[0]).then(function(portfolioItemStore){var portfolioItemsInRelease=_.filter(portfolioItemStore.getRange(),function(pi){return(pi.data.Release||{}).Name==releaseName});me.PortfolioItemsInReleaseStore=Ext.create("Rally.data.wsapi.Store",{model:me[me.PortfolioItemTypes[0]],data:portfolioItemsInRelease,totalCount:portfolioItemsInRelease.length,disableMetaChangeEvent:!0,load:function(){}}),me.LowestPortfolioItemsHash=_.reduce(portfolioItemStore.getRange(),function(hash,r){return hash[r.data.ObjectID]=(r.data.Release||{}).Name||"No Release",hash},{})})},_loadSnapshotStores:function(){var me=this,releaseStart=new Date(me.ReleaseRecord.data.ReleaseStartDate).toISOString(),releaseEnd=new Date(me.ReleaseRecord.data.ReleaseDate).toISOString(),releaseName=me.ReleaseRecord.data.Name,lowestPortfolioItemType=me.PortfolioItemTypes[0];return me.AllSnapshots=[],Q.all(_.map(me.CurrentScrum?[me.CurrentScrum]:me.LeafProjects,function(project){var parallelLoaderConfig={context:{workspace:me.getContext().getGlobalContext().getWorkspace()._ref,project:null},compress:!0,findConfig:{_TypeHierarchy:"HierarchicalRequirement",Children:null,Project:project.data.ObjectID,_ValidFrom:{$lte:releaseEnd},_ValidTo:{$gt:releaseStart}},fetch:["ScheduleState","PlanEstimate","Release",lowestPortfolioItemType,"_ValidFrom","_ValidTo","ObjectID"],hydrate:["ScheduleState"]};return me._parallelLoadLookbackStore(parallelLoaderConfig).then(function(snapshotStore){var records=_.filter(snapshotStore.getRange(),function(snapshot){return(me.ReleasesWithNameHash[snapshot.data.Release]||!snapshot.data.Release&&me.LowestPortfolioItemsHash[snapshot.data[lowestPortfolioItemType]]==releaseName)&&snapshot.data._ValidFrom!=snapshot.data._ValidTo});me.AllSnapshots=me.AllSnapshots.concat(records)})}))},_loadUserStoriesforPortfolioItems:function(){var me=this,lowestPortfolioItemType=me.PortfolioItemTypes[0],parallelLoaderConfig={model:"HierarchicalRequirement",context:{project:me.ScrumGroupRootRecord.data._ref,projectScopeDown:!0,projectScopeUp:!1},fetch:["ScheduleState","PlanEstimate",lowestPortfolioItemType,"ObjectID"]};return me.WsapiUserStoryMap={},Q.all(_.map(me.PortfolioItemsInReleaseStore.data.items,function(portfolioItemRecord){var portfolioItemFilter=Ext.create("Rally.data.wsapi.Filter",{property:lowestPortfolioItemType+".ObjectID",value:portfolioItemRecord.data.ObjectID});return me._parallelLoadWsapiStore(_.merge({filters:[portfolioItemFilter]},parallelLoaderConfig)).then(function(userStoryStore){me.WsapiUserStoryMap[portfolioItemRecord.data.ObjectID]=userStoryStore.getRange()})}))},_buildScopeToReleaseStore:function(){var me=this,userStorySnapshots=me.AllSnapshots,_10days=864e6,lowestPortfolioItemType=me.PortfolioItemTypes[0],date1=me.ReleaseRecord.data.ReleaseStartDate,date2=new Date(me.datePickerDate),daysCountDifference=Math.floor(Date.parse(date2)-Date.parse(date1)),startTargetDate=me.releaseStartDateChanged&&daysCountDifference>0?new Date(1*new Date(me.ReleaseRecord.data.ReleaseStartDate)+daysCountDifference):new Date(1*new Date(me.ReleaseRecord.data.ReleaseStartDate)+_10days),finalTargetDate=new Date(1*new Date(me.ReleaseRecord.data.ReleaseDate)),scopeToReleaseGridRows=[],userStorySnapshotsInitialWithoutPortfolioItems=_.filter(userStorySnapshots,function(userStorySnapshot){return startTargetDate>new Date(userStorySnapshot.data._ValidFrom)&&new Date(userStorySnapshot.data._ValidTo)>startTargetDate&&!userStorySnapshot.data[lowestPortfolioItemType]}),userStorySnapshotsFinalWithoutPortfolioItems=_.filter(userStorySnapshots,function(userStorySnapshot){return finalTargetDate>new Date(userStorySnapshot.data._ValidFrom)&&new Date(userStorySnapshot.data._ValidTo)>finalTargetDate&&!userStorySnapshot.data[lowestPortfolioItemType]}),userStorySnapshotsInitialWithPortfolioItems=_.filter(userStorySnapshots,function(userStorySnapshot){return startTargetDate>new Date(userStorySnapshot.data._ValidFrom)&&new Date(userStorySnapshot.data._ValidTo)>startTargetDate&&!!userStorySnapshot.data[lowestPortfolioItemType]}),userStorySnapshotsFinalWithPortfolioItems=_.filter(userStorySnapshots,function(userStorySnapshot){return finalTargetDate>new Date(userStorySnapshot.data._ValidFrom)&&new Date(userStorySnapshot.data._ValidTo)>finalTargetDate&&!!userStorySnapshot.data[lowestPortfolioItemType]});_.each(me.PortfolioItemsInReleaseStore.getRange(),function(portfolioItemRecord,key){var scopeToReleaseGridRow={},releaseStartSnapshots=[],releaseFinalSnapshots=[],userStoriesForPortfolioItem=me.WsapiUserStoryMap[portfolioItemRecord.data.ObjectID],userStorySnapshotsInitialForPortfolioItem=_.filter(userStorySnapshotsInitialWithPortfolioItems,function(userStorySnapshot){return portfolioItemRecord.data.ObjectID===userStorySnapshot.data[lowestPortfolioItemType]}),userStorySnapshotsFinalForPortfolioItem=_.filter(userStorySnapshotsFinalWithPortfolioItems,function(userStorySnapshot){return portfolioItemRecord.data.ObjectID===userStorySnapshot.data[lowestPortfolioItemType]});if(releaseStartSnapshots=releaseStartSnapshots.concat(userStorySnapshotsInitialForPortfolioItem),releaseFinalSnapshots=releaseFinalSnapshots.concat(userStorySnapshotsFinalForPortfolioItem),_.each(userStoriesForPortfolioItem,function(wsapiUserStory){var userStorySnapshotsInitialWithoutPortfolioItem=_.filter(userStorySnapshotsInitialWithoutPortfolioItems,function(userStorySnapshot){return userStorySnapshot.data.ObjectID===wsapiUserStory.data.ObjectID}),userStorySnapshotsFinalWithoutPortfolioItem=_.filter(userStorySnapshotsFinalWithoutPortfolioItems,function(userStorySnapshot){return userStorySnapshot.data.ObjectID===wsapiUserStory.data.ObjectID});releaseStartSnapshots=releaseStartSnapshots.concat(userStorySnapshotsInitialWithoutPortfolioItem),releaseFinalSnapshots=releaseFinalSnapshots.concat(userStorySnapshotsFinalWithoutPortfolioItem)}),releaseStartSnapshots.length>0||releaseFinalSnapshots.length>0){var startDateAcceptedPoints=_.reduce(releaseStartSnapshots,function(sum,item){return sum+("Accepted"==item.data.ScheduleState?1*item.data.PlanEstimate:0)},0),startDateNotAcceptedPoints=_.reduce(releaseStartSnapshots,function(sum,item){return sum+("Accepted"!=item.data.ScheduleState?1*item.data.PlanEstimate:0)},0),startDateTotalPoints=_.reduce(releaseStartSnapshots,function(sum,item){return sum+1*item.data.PlanEstimate},0),finalDateAcceptedPoints=_.reduce(releaseFinalSnapshots,function(sum,item){return sum+("Accepted"==item.data.ScheduleState?1*item.data.PlanEstimate:0)},0),finalDateNotAcceptedPoints=_.reduce(releaseFinalSnapshots,function(sum,item){return sum+("Accepted"!=item.data.ScheduleState?1*item.data.PlanEstimate:0)},0),finalDatetotalPoints=_.reduce(releaseFinalSnapshots,function(sum,item){return sum+1*item.data.PlanEstimate},0);scopeToReleaseGridRow.completedAtStart=startDateAcceptedPoints/startDateTotalPoints,scopeToReleaseGridRow.completedAtEnd=finalDateAcceptedPoints/finalDatetotalPoints,isFinite(scopeToReleaseGridRow.completedAtStart)===!1&&(scopeToReleaseGridRow.completedAtStart=0),isFinite(scopeToReleaseGridRow.completedAtEnd)===!1&&(scopeToReleaseGridRow.completedAtEnd=0),scopeToReleaseGridRow.growth=0===startDateTotalPoints?finalDatetotalPoints:(finalDatetotalPoints-startDateTotalPoints)/startDateTotalPoints,scopeToReleaseGridRow.intent=startDateTotalPoints.toFixed(0),scopeToReleaseGridRow.actual=finalDatetotalPoints.toFixed(0),scopeToReleaseGridRow.FormattedID=portfolioItemRecord.data.FormattedID,scopeToReleaseGridRow.Name=portfolioItemRecord.data.Name,scopeToReleaseGridRow.ObjectID=portfolioItemRecord.data.ObjectID,scopeToReleaseGridRow.ProjectObjectID=portfolioItemRecord.data.Project.ObjectID,portfolioItemRecord.state=portfolioItemRecord.data.State,scopeToReleaseGridRows=scopeToReleaseGridRows.concat(scopeToReleaseGridRow)}}),me.InitialTargetDate=[startTargetDate.getMonth()+1,startTargetDate.getDate(),startTargetDate.getFullYear()].join("/"),me.CompleteFinalTargetDate=[finalTargetDate.getMonth()+1,finalTargetDate.getDate(),finalTargetDate.getFullYear()].join("/"),me.gridstore=Ext.create("Ext.data.Store",{fields:["completedAtStart","completedAtEnd","growth","intent","actual","FormattedID","Name","ObjectID","ProjectObjectID","state"],data:scopeToReleaseGridRows})},_buildScopeToReleaseGrid:function(){var me=this,lowestPortfolioItemType=me.PortfolioItemTypes[0];Ext.getCmp("scopeGrid").removeAll(),Ext.getCmp("scopeGrid").add({xtype:"rallygrid",id:"grid",showRowActionsColumn:!1,selModel:{ignoreRightMouseSelection:!0,checkOnly:!0},enableEditing:!1,autoScroll:!0,height:500,showPagingToolbar:!1,title:"Scope to release ("+me.InitialTargetDate+" - "+me.CompleteFinalTargetDate+")",store:me.gridstore,columnCfgs:[{header:lowestPortfolioItemType+"s",dataIndex:"Name",flex:4,renderer:function(v,m,r){return Ext.String.format('<a href="{0}/#/{1}d/detail/portfolioitem/{2}/{3}" target="_blank">{4}: </a>{5}',me.BaseUrl,r.data.ProjectObjectID,lowestPortfolioItemType,r.data.ObjectID,r.data.FormattedID,v)}},{header:"% Complete<br/> @ Release Start "+me.InitialTargetDate,dataIndex:"completedAtStart",flex:2,xtype:"fastgridcolumn",tdCls:"iconCell",resizable:!1,draggable:!1,renderer:function(v,meta,record){return{xtype:"progressbar",text:[(100*v).toFixed(2),"%"].join(""),width:"100px",value:v}}},{header:"% Complete<br/>@ Release End "+me.CompleteFinalTargetDate,dataIndex:"completedAtEnd",flex:2,xtype:"fastgridcolumn",tdCls:"iconCell",resizable:!1,draggable:!1,renderer:function(v,meta,record){return{xtype:"progressbar",text:[(100*v).toFixed(2),"%"].join(""),width:"100px",value:v}}},{header:"Points Planned<br/> @ Release Start "+me.InitialTargetDate,dataIndex:"intent",flex:1},{header:"Final Points <br/>@ Release End "+me.CompleteFinalTargetDate,dataIndex:"actual",flex:1},{header:lowestPortfolioItemType+" Scope Change",dataIndex:"growth",flex:2,xtype:"fastgridcolumn",tdCls:"iconCell",resizable:!1,draggable:!1,renderer:function(v,meta,record){var growthText="";return growthText=v>0?"+"+[(100*v).toFixed(2),"%"].join(""):[(100*v).toFixed(2),"%"].join(""),{xtype:"container",html:growthText}}},{header:lowestPortfolioItemType+" State",dataIndex:"state",flex:1}]})},_buildCumulativeFlowChart:function(){var me=this,calc=Ext.create("FastCumulativeFlowCalculator",{scheduleStates:me.ScheduleStates,startDate:me.ReleaseRecord.data.ReleaseStartDate,endDate:me.ReleaseRecord.data.ReleaseDate}),aggregateChartData=me._updateCumulativeFlowChartData(calc.runCalculation(me.AllSnapshots),{trendType:"Last2Sprints"}),datemap=aggregateChartData.datemap,total={};if(total.initialCommit=0,total.finalCommit=0,total.finalAccepted=0,total.projected=0,total.ideal=0,me.releaseStartDateChanged&&me.initialAddedDaysCount)for(;Date.parse(datemap[me.initialAddedDaysCount])!=Date.parse(me.datePickerDate);)Date.parse(datemap[me.initialAddedDaysCount])>Date.parse(me.datePickerDate)?me.initialAddedDaysCount=me.initialAddedDaysCount-1:Date.parse(datemap[me.initialAddedDaysCount])<Date.parse(me.datePickerDate)&&(me.initialAddedDaysCount=me.initialAddedDaysCount+1);me.initialAddedDaysCount=me.initialAddedDaysCount?me.initialAddedDaysCount:6,_.each(aggregateChartData.series,function(f){"Accepted"===f.name&&(total.finalAccepted=total.finalAccepted+f.data[aggregateChartData.categories.length-6]),"Ideal"!=f.name&&"Projected"!=f.name&&(total.initialCommit=total.initialCommit+f.data[me.initialAddedDaysCount],total.finalCommit=total.finalCommit+f.data[aggregateChartData.categories.length-6]),"Projected"===f.name&&(total.projected=total.projected+f.data[aggregateChartData.categories.length-6]),"Ideal"===f.name&&(total.ideal=total.ideal+f.data[aggregateChartData.categories.length-6])}),0===total.finalCommit&&(total.finalCommit=total.projected>0?total.projected:total.ideal,total.finalAccepted=total.projected>0?total.projected:total.ideal);var commitDataPlus=[];_.each(aggregateChartData.categories,function(f,key){commitDataPlus.push(total.initialCommit)}),aggregateChartData.series.push({colorIndex:1,symbolIndex:1,dashStyle:"shortdash",color:"red",data:commitDataPlus,name:"Commitment",type:"spline"}),me.total=total,$("#retroChart").highcharts(Ext.Object.merge({},me._defaultCumulativeFlowChartConfig,me._getCumulativeFlowChartColors(),{chart:{height:400,width:.42*me.getWidth()>>0},legend:{borderWidth:0,width:500,itemWidth:.42*me.getWidth()>>-50},title:{text:me.ScrumGroupRootRecord.data.Name},subtitle:{text:me.ReleaseRecord.data.Name.split(" ")[0]},xAxis:{categories:aggregateChartData.categories,tickInterval:me._getCumulativeFlowChartTicks(me.ReleaseRecord.data.ReleaseStartDate,me.ReleaseRecord.data.ReleaseDate,.44*me.getWidth())},series:aggregateChartData.series})),me._setCumulativeFlowChartDatemap($("#retroChart").children()[0].id,datemap)},_hideHighchartsLinks:function(){$(".highcharts-container > svg > text:last-child").hide()},_buildRetroChart:function(){var me=this,scopeDeltaPerc=100*((me.total.finalCommit-me.total.initialCommit)/me.total.initialCommit),originalCommitRatio=100*(me.total.finalAccepted/me.total.initialCommit),finalCommitRatio=100*(me.total.finalAccepted/me.total.finalCommit),dataseries=[],chartMax=[];Highcharts.setOptions({colors:["#3A874F","#7cb5ec"]});var chartConfig={chart:{type:"column"},title:{text:"Scope"},subtitle:{text:"4 of 6 "},xAxis:{categories:[],tickLength:10},yAxis:{min:0,tickPixelInterval:50,title:{text:"Total Points"},plotLines:[{name:"maxTarget",value:0,color:"#92d947",dashStyle:"shortdash",width:2,zIndex:5,label:{text:"Acceptable increase (+10%)",style:{color:"black","text-shadow":"0 1px 0 white"}}},{name:"minTarget",value:0,color:"#92d947",dashStyle:"shortdash",zIndex:5,width:2,label:{text:"Acceptable decrease (-10%) ",style:{color:"black","text-shadow":"0 1px 0 white"}}}]},tooltip:{valueDecimals:1},plotOptions:{series:{stacking:"normal",borderWidth:2,borderColor:"white",shadow:!0},column:{colorByPoint:!0}},series:[{name:["Total"],showInLegend:!1,data:dataseries,dataLabels:{enabled:!0,format:"{point.y:,.0f}"}}]};chartMax.push(me.total.initialCommit,me.total.finalAccepted,me.total.finalCommit),chartConfig.yAxis.max=Math.max.apply(null,chartMax),chartConfig.yAxis.max=chartConfig.yAxis.max+.2*chartConfig.yAxis.max,chartConfig.title.text=scopeDeltaPerc>0?"Scope Delta: +"+scopeDeltaPerc.toFixed(2)+"%":"Scope Delta:"+scopeDeltaPerc.toFixed(2)+"%",chartConfig.subtitle.text=Math.round(me.total.finalCommit)+" of "+Math.round(me.total.initialCommit),dataseries.push(["InitialCommit",me.total.initialCommit]),dataseries.push(["FinalWorkload",me.total.finalCommit]),chartConfig.series.data=dataseries,chartConfig.yAxis.plotLines[0].value=me.total.initialCommit+.1*me.total.initialCommit,chartConfig.yAxis.plotLines[1].value=me.total.initialCommit-.1*me.total.initialCommit,scopeDeltaPerc>=-10.99&&10.99>=scopeDeltaPerc?Highcharts.setOptions({colors:["#40d0ed","#92D050"]}):Highcharts.setOptions({colors:["#40d0ed","#d05052"]}),scopeDeltaPerc>=400&&(chartConfig.yAxis.plotLines[1].label={text:"Acceptable decrease (-10%)",align:"right",x:-10,y:16}),chartConfig.xAxis.categories[0]="Original Commit",chartConfig.xAxis.categories[1]="Final Workload",$("#retroBarChartScopeWrapper").highcharts(chartConfig);var chartConfig2={chart:{type:"column"},title:{text:"Scope"},subtitle:{text:"4 of 6 "},xAxis:{categories:[],tickLength:10},yAxis:{min:0,tickPixelInterval:50,title:{text:"Total Points"},plotLines:[{name:"maxTarget",value:0,color:"#92d947",dashStyle:"shortdash",width:2,zIndex:5,label:{text:"Acceptable increase (+10%)",style:{color:"black","text-shadow":"0 1px 0 white"}}},{name:"minTarget",value:0,color:"#92d947",dashStyle:"shortdash",zIndex:5,width:2,label:{text:"Acceptable decrease (-10%) ",style:{color:"black","text-shadow":"0 1px 0 white"}}}]},tooltip:{valueDecimals:1},plotOptions:{series:{stacking:"normal",borderWidth:2,borderColor:"white",shadow:!0},column:{colorByPoint:!0}},series:[{name:["Total"],showInLegend:!1,data:dataseries,dataLabels:{enabled:!0,format:"{point.y:,.0f}"}}]};chartConfig2.yAxis.max=chartConfig.yAxis.max,chartConfig2.title.text="A/C Original: "+originalCommitRatio.toFixed(0)+"%",chartConfig2.subtitle.text=Math.round(me.total.finalAccepted)+" of "+Math.round(me.total.initialCommit),chartConfig2.xAxis.categories[0]="Original Commit",chartConfig2.xAxis.categories[1]="Final Accepted",chartConfig2.yAxis.plotLines[0].label={text:"Target >90%",align:"center"},dataseries.length=0,dataseries.push(["InitialCommit",me.total.initialCommit]),dataseries.push(["FinalAccepted",me.total.finalAccepted]),chartConfig2.series.data=dataseries,chartConfig2.yAxis.plotLines[0].value=.9*me.total.initialCommit,chartConfig2.yAxis.plotLines.splice(1,1),originalCommitRatio>=90?Highcharts.setOptions({colors:["#40d0ed","#92D050"]}):Highcharts.setOptions({colors:["#40d0ed","#d05052"]}),$("#retroBarChartCaOriginalWrapper").highcharts(chartConfig2);var chartConfig3={chart:{type:"column"},title:{text:"Scope"},subtitle:{text:"4 of 6 "},xAxis:{categories:[],tickLength:10},yAxis:{min:0,tickPixelInterval:50,title:{text:"Total Points"},plotLines:[{name:"maxTarget",value:0,color:"#92d947",dashStyle:"shortdash",width:2,zIndex:5,label:{text:"Acceptable increase (+10%)",style:{color:"black","text-shadow":"0 1px 0 white"}}},{name:"minTarget",value:0,color:"#92d947",dashStyle:"shortdash",zIndex:5,width:2,label:{text:"Acceptable decrease (-10%) ",style:{color:"black","text-shadow":"0 1px 0 white"}}}]},tooltip:{valueDecimals:1},plotOptions:{series:{stacking:"normal",borderWidth:2,borderColor:"white",shadow:!0},column:{colorByPoint:!0}},series:[{name:["Total"],showInLegend:!1,data:dataseries,dataLabels:{enabled:!0,format:"{point.y:,.0f}"}}]};finalCommitRatio=100*(me.total.finalAccepted/me.total.finalCommit),chartConfig3.yAxis.max=chartConfig.yAxis.max,chartConfig3.title.text="A/C Final: "+finalCommitRatio.toFixed(0)+"%",chartConfig3.subtitle.text=Math.round(me.total.finalAccepted)+" of "+Math.round(me.total.finalCommit),chartConfig3.xAxis.categories[0]="Final Workload",chartConfig3.xAxis.categories[1]="Final Accepted",chartConfig3.yAxis.plotLines[0].label={text:"Target >90%",align:"center"},dataseries.length=0,dataseries.push(["FinalCommit",me.total.finalCommit]),dataseries.push(["FinalAccepted",me.total.finalAccepted]),chartConfig3.series.data=dataseries,chartConfig3.yAxis.plotLines[0].value=.9*me.total.finalCommit,chartConfig3.yAxis.plotLines.splice(1,1),finalCommitRatio>=90?Highcharts.setOptions({colors:["#40d0ed","#92D050"]}):Highcharts.setOptions({colors:["#40d0ed","#d05052"]}),$("#retroBarChartCaFinalWrapper").highcharts(chartConfig3)},_setUserPreferenceReleaseStartDate:function(){var me=this,rid=me.ReleaseRecord.data.ObjectID,pid=me.ProjectRecord.data.ObjectID;if("object"!=typeof me.AppsPref.projs[pid]&&(me.AppsPref.projs[pid]={}),me.releaseStartDateChanged=me.AppsPref.projs[pid][rid]?!0:!1,me.releaseStartDateChanged){me.datePickerDate=me.AppsPref.projs[pid][rid].ReleaseStartDate;var date1=me.ReleaseRecord.data.ReleaseStartDate,date2=new Date(me.datePickerDate),_1day=864e5;me.initialAddedDaysCount=Math.floor((Date.parse(date2)-Date.parse(date1))/_1day)}},_reloadEverything:function(){var me=this;return me.setLoading("Loading Data"),Q.all([me._loadAllChildReleases(),me._getPortfolioItems()]).then(function(){return me._loadSnapshotStores()}).then(function(){return me._buildCumulativeFlowChart(),me._buildRetroChart(),me._hideHighchartsLinks(),me._loadUserStoriesforPortfolioItems()}).then(function(){me._loadAppsPreference().then(function(appsPref){me.AppsPref=appsPref,me._setUserPreferenceReleaseStartDate()})}).then(function(){return 0===me.AllSnapshots.length?(me.setLoading(!1),me._alert("ERROR",me.ScrumGroupRootRecord.data.Name+" has no data for release: "+me.ReleaseRecord.data.Name),void 0):(me._buildScopeToReleaseStore(),me._buildScopeToReleaseGrid(),me.setLoading(!1),void 0)}).fail(function(reason){me.setLoading(!1),me._alert("ERROR",reason)}).done()},launch:function(){var me=this;me.setLoading("Loading Configuration"),me._configureIntelRallyApp().then(function(){var scopeProject=me.getContext().getProject();return me._loadProject(scopeProject.ObjectID)}).then(function(scopeProjectRecord){return me.ProjectRecord=scopeProjectRecord,Q.all([me._projectInWhichScrumGroup(me.ProjectRecord).then(function(scrumGroupRootRecord){return scrumGroupRootRecord?(me.ScrumGroupRootRecord=scrumGroupRootRecord,Q.all([me._loadAllLeafProjects(me.ScrumGroupRootRecord).then(function(leafProjects){me.LeafProjects=leafProjects,me.CurrentScrum=_.find(leafProjects,function(p){return p.data.ObjectID==me.ProjectRecord.data.ObjectID})?me.ProjectRecord:null}),me._loadScrumGroupPortfolioProject(me.ScrumGroupRootRecord).then(function(scrumGroupPortfolioProject){me.ScrumGroupPortfolioProject=scrumGroupPortfolioProject})])):(me.CurrentScrum=me.ProjectRecord,void 0)}),me._loadAppsPreference().then(function(appsPref){me.AppsPref=appsPref;var oneYear=31536e6,endDate=new Date;return me._loadReleasesBetweenDates(me.ProjectRecord,1*new Date-oneYear,endDate)}).then(function(releaseRecords){me.ReleaseRecords=releaseRecords;var currentRelease=me._getScopedRelease(releaseRecords,me.ProjectRecord.data.ObjectID,null);return currentRelease?(me.ReleaseRecord=currentRelease,void 0):Q.reject("This project has no releases.")})])}).then(function(){me._buildReleasePicker()}).then(function(){return me._reloadEverything()}).fail(function(reason){me.setLoading(!1),me._alert("ERROR",reason)}).done()}})})();

            Rally.launchApp('RetroDashboard', {
                name:"RetroDashboard",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .ulInformation{margin-top:-3px}.clickForDateChange{text-decoration:underline;font-style:italic;cursor:pointer;padding-top:5px;padding-left:5px;margin-left:5px}#cntDatePickerWrapper{margin-left:5px}.appInfo{float:right;text-align:right;font:bold;font-weight:bold;color:green}.rui-triggerfield .icon-calendar{background-image:none;color:#888;font-size:12px;padding:3px 3px 5px 4px}.chart-wrapper{margin-top:10px;padding:10px;width:100%}.retrochart-wrapper{clear:both;float:right}.barchart-wrapper{border:solid #BFBFBF 2px;width:100%}span#retroDonutScopeArrow-outerCt,span#retroDonutCaOriginalArrow-outerCt,span#retroDonutCaFinalArrow-outerCt{margin-top:70px;margin-left:60px}#retroDonutScopeFooter,#retroDonutCaOriginalFooter,#retroDonutCaFinalFooter{padding-top:190px;padding-left:0px;font-weight:bold;font-family:"Lucida Grande","Lucida Sans Unicode",Arial,Helvetica,sans-serif}.legendwrapper{margin-top:-50px;float:right;width:35%;text-align:center}.mtargetwrapper{float:left;color:#333333;font-size:12px;font-weight:bold}.mtarget{float:left;background-color:#92D050;height:12px;width:16px;margin-left:50px;margin-right:3px;margin-top:3px}.atarget{float:left;height:12px;width:16px;margin-left:50px;margin-right:3px;margin-top:3px}.dtargetwrapper{float:left;color:#333333;font-size:12px;font-weight:bold;cursor:pointer}.dtarget{float:left;background-color:#d05052;height:12px;width:16px;margin-left:10px;margin-right:3px;margin-top:3px}#grid_header_hd{color:#396295;font-size:16px;font-weight:bold;cursor:pointer;fill:#333333}.progress-right .progress-bar-r{float:left;border:solid red 1px;height:20px;text-align:left;background-color:#fc8585;text-shadow:0 1px 0 #D05052;color:black}div.sr-only{border:solid #D05052 1px;float:left;background-color:#D05052;color:white;height:19px;overflow:visible}
    </style>
</head>
<body>
</body>
</html>
