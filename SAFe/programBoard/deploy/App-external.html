<!DOCTYPE html>
<html>
<head>
    <title>Program Board</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0rc3/sdk.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.1/q.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelVelocity",{extend:"Ext.data.Model",fields:[{name:"Name",type:"string"},{name:"PlannedVelocity",type:"number"},{name:"RealVelocity",type:"number"}]}),Ext.define("IntelTeamCommits",{extend:"Ext.data.Model",fields:[{name:"Rank",type:"number"},{name:"Name",type:"string"},{name:"ObjectID",type:"string"},{name:"FormattedID",type:"string"},{name:"Commitment",type:"string"},{name:"Expected",type:"boolean"},{name:"Objective",type:"string"},{name:"Product",type:"string"},{name:"PlannedEnd",type:"number"}]}),Ext.define("IntelRisk",{extend:"Ext.data.Model",fields:[{name:"RiskID",type:"string"},{name:"ObjectID",type:"number"},{name:"FormattedID",type:"string"},{name:"FeatureName",type:"string"},{name:"Description",type:"string"},{name:"Impact",type:"string"},{name:"MitigationPlan",type:"string"},{name:"Urgency",type:"string"},{name:"Status",type:"string"},{name:"Contact",type:"string"},{name:"Checkpoint",type:"number"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelDepTeam",{extend:"Ext.data.Model",fields:[{name:"TID",type:"string"},{name:"PID",type:"string"},{name:"Sup",type:"string"},{name:"USID",type:"string"},{name:"USName",type:"string"},{name:"A",type:"boolean"}]}),Ext.define("IntelPredDep",{extend:"Ext.data.Model",fields:[{name:"ObjectID",type:"number"},{name:"DependencyID",type:"string"},{name:"FormattedID",type:"string"},{name:"UserStoryName",type:"string"},{name:"Description",type:"string"},{name:"Checkpoint",type:"number"},{name:"Status",type:"string"},{name:"Predecessors",type:"auto"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelSuccDep",{extend:"Ext.data.Model",fields:[{name:"ObjectID",type:"number"},{name:"DependencyID",type:"string"},{name:"SuccUserStoryName",type:"string"},{name:"SuccFormattedID",type:"string"},{name:"SuccProjectID",type:"string"},{name:"UserStoryName",type:"string"},{name:"FormattedID",type:"string"},{name:"ReleaseStartDate",type:"number"},{name:"ReleaseDate",type:"number"},{name:"Description",type:"string"},{name:"Checkpoint",type:"number"},{name:"Supported",type:"string"},{name:"Assigned",type:"boolean"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelRiskWithProject",{extend:"Ext.data.Model",fields:[{name:"RiskID",type:"string"},{name:"ProjectName",type:"string"},{name:"ProjectID",type:"number"},{name:"Product",type:"string"},{name:"ObjectID",type:"number"},{name:"FormattedID",type:"string"},{name:"FeatureName",type:"string"},{name:"Description",type:"string"},{name:"Impact",type:"string"},{name:"Status",type:"string"},{name:"MitigationPlan",type:"string"},{name:"Urgency",type:"string"},{name:"Contact",type:"string"},{name:"Checkpoint",type:"number"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelPredDepWithProject",{extend:"Ext.data.Model",fields:[{name:"DependencyID",type:"string"},{name:"ProjectName",type:"string"},{name:"ProjectID",type:"number"},{name:"Product",type:"string"},{name:"ObjectID",type:"number"},{name:"FormattedID",type:"string"},{name:"UserStoryName",type:"string"},{name:"Description",type:"string"},{name:"Checkpoint",type:"number"},{name:"Status",type:"string"},{name:"Predecessors",type:"auto"},{name:"Edited",type:"boolean"}]}),Ext.define("CommitsMatrixFeature",{extend:"Ext.data.Model",fields:[{name:"Rank",type:"number"},{name:"FormattedID",type:"string"},{name:"ObjectID",type:"number"},{name:"FeatureName",type:"string"},{name:"ProductName",type:"string"},{name:"PlannedEndDate",type:"number"}]}),Ext.define("CFEditorModel",{extend:"Ext.data.Model",fields:[{name:"FormattedID",type:"string"},{name:"Name",type:"string"},{name:"Release",type:"string"},{name:"CustomFieldValue",type:"string"}]})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelRallyApp",{alias:"widget.intelrallyapp",extend:"Rally.app.App",_loadModels:function(){var me=this,promises=[],models={Project:"Project",UserStory:"HierarchicalRequirement",Feature:"PortfolioItem/Feature",Milestone:"PortfolioItem/Milestone"};return _.each(models,function(modelType,modelName){var deferred=Q.defer();Rally.data.WsapiModelFactory.getModel({type:modelType,success:function(loadedModel){me[modelName]=loadedModel,deferred.resolve()}}),promises.push(deferred.promise)}),Q.all(promises)},_loadProject:function(oid){var me=this,deferred=Q.defer();return oid?me.Project?(me.Project.load(oid,{fetch:["ObjectID","Releases","Children","Parent","Name"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},callback:deferred.resolve}),deferred.promise):me._loadModels().then(function(){return me._loadProject(oid)}):Q.resolve()},_loadFeature:function(oid,projectRef){var me=this,deferred=Q.defer();return oid?me.Feature?(me.Feature.load(oid,{fetch:["Name","ObjectID","FormattedID","c_TeamCommits","c_Risks","Project","PlannedEndDate","Parent"],context:{workspace:me.getContext().getWorkspace()._ref,project:projectRef},callback:deferred.resolve}),deferred.promise):me._loadModels().then(function(){return me._loadFeature(oid,projectRef)}):Q.resolve()},_loadUserStory:function(oid,projectRef){var me=this,deferred=Q.defer();return oid?me.UserStory?(me.UserStory.load(oid,{fetch:["Name","ObjectID","Release","Project","Feature","FormattedID","Predecessors","Successors","c_Dependencies","Iteration","PlanEstimate"],context:{workspace:me.getContext().getWorkspace()._ref,project:projectRef},callback:deferred.resolve}),deferred.promise):me._loadModels().then(function(){return me._loadUserStory(oid,projectRef)}):Q.resolve()},_loadMilestone:function(oid,projectRef){var me=this,deferred=Q.defer();return oid?me.Milestone?(me.Milestone.load(oid,{fetch:["ObjectID","Parent","Name"],context:{workspace:me.getContext().getWorkspace()._ref,project:projectRef},callback:deferred.resolve}),deferred.promise):me._loadModels().then(function(){return me._loadMilestone(oid)}):Q.resolve()},_loadRootProject:function(projectRecord){if(!projectRecord)return Q.reject("Invalid arguments: LRP");var me=this,n=projectRecord.data.Name;return"All Scrums"===n||"All Scrums Sandbox"===n?Q(projectRecord):projectRecord.data.Parent?me._loadProject(projectRecord.data.Parent.ObjectID).then(function(parentRecord){return me._loadRootProject(parentRecord)}):Q.reject('You do not have viewer access to "All Scrums"!')},_loadTopProject:function(projectRecord){if(!projectRecord)return Q.reject("Invalid arguments: LTP");var me=this,n=projectRecord.data.Name;return projectRecord.data.Parent?me._loadProject(projectRecord.data.Parent.ObjectID).then(function(parentRecord){return me._loadTopProject(parentRecord)}):Q(projectRecord)},_projectInWhichTrain:function(projectRecord){if(projectRecord){var me=this,split=projectRecord.data.Name.split(" ART");if(split.length>1)return Q(projectRecord);var parent=projectRecord.data.Parent;return parent?me._loadProject(parent.ObjectID).then(function(parentRecord){return me._projectInWhichTrain(parentRecord)}):Q.reject("Project not in a train")}return Q.reject("Invalid arguments: PIWT")},_loadAllTrains:function(rootProjectRecord){if(!rootProjectRecord)return Q.reject("Invalid arguments: LAT");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",remoteSort:!1,limit:1/0,fetch:["Name","ObjectID"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",operator:"contains",value:" ART"},{property:"Name",operator:"All Scrums Sandbox"===rootProjectRecord.data.Name?"contains":"!contains",value:"Test"}]});return me._reloadStore(store).then(function(store){return console.log("AllTrainRecords loaded",store.data.items),Q(store)})},_loadRandomUserStory:function(projectRef){if(!projectRef)return Q.reject("Invalid arguments: LRUS");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:5,pageSize:5,fetch:["Name","CreationDate","Project","ObjectID","FormattedID","Predecessors","Successors","c_Dependencies"],context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},sorters:[{property:"CreationDate",direction:"DESC"}],filters:[{property:"Project",value:projectRef}]});return me._reloadStore(store).then(function(store){var records=store.data.items;return records.length?Q(records[Math.floor(Math.random()*records.length)]):Q(void 0)})},_getUserStoryInReleaseTimeFrameFilter:function(releaseRecord){var me=this,twoWeeks=12096e5,releaseStartPadding=new Date(1*new Date(releaseRecord.data.ReleaseStartDate)+twoWeeks).toISOString(),releaseEndPadding=new Date(1*new Date(releaseRecord.data.ReleaseDate)-twoWeeks).toISOString();return Ext.create("Rally.data.wsapi.Filter",{property:"Release.ReleaseStartDate",operator:"<",value:releaseStartPadding}).and(Ext.create("Rally.data.wsapi.Filter",{property:"Release.ReleaseDate",operator:">",value:releaseEndPadding})).or(Ext.create("Rally.data.wsapi.Filter",{property:"Feature.Release.ReleaseStartDate",operator:"<",value:releaseStartPadding}).and(Ext.create("Rally.data.wsapi.Filter",{property:"Feature.Release.ReleaseDate",operator:">",value:releaseEndPadding})))},_loadRandomUserStoryFromRelease:function(projectRef,releaseName){if(!projectRef||!releaseName)return Q.reject("Invalid arguments: LRUSFR");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:5,pageSize:5,fetch:["Name","CreationDate","Project","ObjectID","FormattedID","Predecessors","Successors","c_Dependencies"],context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},sorters:[{property:"CreationDate",direction:"DESC"}],filters:[Ext.create("Rally.data.wsapi.Filter",{property:"Project",value:projectRef}).and(Ext.create("Rally.data.wsapi.Filter",{property:"Release.Name",value:releaseName}).or(Ext.create("Rally.data.wsapi.Filter",{property:"Feature.Release.Name",value:releaseName})))]});return me._reloadStore(store).then(function(store){var records=store.data.items;return records.length?Q(records[Math.floor(Math.random()*records.length)]):Q(void 0)})},_loadRandomUserStoryFromReleaseTimeframe:function(projectRef,releaseRecord){if(!projectRef||!releaseRecord)return Q.reject("Invalid arguments: LRUSFR");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:5,pageSize:5,fetch:["Name","CreationDate","Project","ObjectID","FormattedID","Predecessors","Successors","c_Dependencies"],context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},sorters:[{property:"CreationDate",direction:"DESC"}],filters:[Ext.create("Rally.data.wsapi.Filter",{property:"Project",value:projectRef}).and(me._getUserStoryInReleaseTimeFrameFilter(releaseRecord))]});return me._reloadStore(store).then(function(store){var records=store.data.items;return records.length?Q(records[Math.floor(Math.random()*records.length)]):Q(void 0)})},_loadUserStoryByFID:function(formattedID,projectRef){if(!formattedID||!projectRef)return Q.reject("Invalid arguments: LUSBFID");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1,pageSize:1,fetch:["Name","Project","ObjectID","FormattedID","Predecessors","Successors","c_Dependencies"],context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},filters:[{property:"FormattedID",value:formattedID},{property:"Project",value:projectRef}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_loadProjectByName:function(name){if(!name)return Q.reject("Invalid arguments: LPBN");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",limit:1,pageSize:1,fetch:["Name","ObjectID"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",value:name}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_getFeatureFilter:function(trainRecord,releaseRecord){if(!trainRecord||!releaseRecord)throw"invalid arguments: GFF";var me=this,trainName=trainRecord.data.Name.split(" ART")[0],relSplit=releaseRecord.data.Name.split(" "),coreFilter=Ext.create("Rally.data.wsapi.Filter",{property:"Release.Name",value:releaseRecord.data.Name});return trainName=2==relSplit.length?relSplit[1]:trainName,"Test ART (P&E)"==trainRecord.data.Name?Ext.create("Rally.data.wsapi.Filter",{property:"Project.Name",value:"Test ART (P&E)"}).and(coreFilter):Ext.create("Rally.data.wsapi.Filter",{property:"Project.Parent.Name",value:trainName+" POWG Portfolios"}).or(Ext.create("Rally.data.wsapi.Filter",{property:"Project.Name",value:trainName+" POWG Portfolios"})).and(coreFilter)},_getProductFilter:function(trainRecord){if(!trainRecord)throw"invalid arguments: GPF";var me=this,trainName=trainRecord.data.Name.split(" ART")[0];return"Test"===trainName?Ext.create("Rally.data.wsapi.Filter",{property:"Project.Name",value:"Test ART (P&E)"}):Ext.create("Rally.data.wsapi.Filter",{property:"Project.Parent.Name",value:trainName+" POWG Portfolios"}).or(Ext.create("Rally.data.wsapi.Filter",{property:"Project.Name",value:trainName+" POWG Portfolios"}))},_loadProducts:function(trainRecord){if(!trainRecord)return Q.reject("Invalid arguments: LPROD");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/Product",limit:1/0,remoteSort:!1,fetch:["Name"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[me._getProductFilter(trainRecord)]});return me._reloadStore(store).then(function(store){return console.log("Products loaded",store.data.items),Q(store)})},_addValidProjectsToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;curProj.data.TeamMembers.Count>0&&(hash[curProj.data.ObjectID]=curProj);for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me._addValidProjectsToList(projTree[childProjRef],hash)},_loadValidProjects:function(rootProjectRecord){if(!rootProjectRecord)return Q.reject("Invalid arguments: LVP");var me=this,validProjects={},projTree={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:["Name","Parent","ObjectID","TeamMembers"],limit:1/0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){for(var projects=store.data.items,i=0,len=projects.length;len>i;++i){var project=projects[i],thisRef=project.data.ObjectID,parentRef=project.data.Parent?project.data.Parent.ObjectID:void 0;projTree[thisRef]||(projTree[thisRef]={}),projTree[thisRef].ProjectRecord=project,parentRef&&(projTree[parentRef]||(projTree[parentRef]={}),projTree[parentRef][thisRef]=projTree[thisRef])}return me._addValidProjectsToList(projTree[rootProjectRecord.data.ObjectID],validProjects),console.log("valid projects",validProjects),Q(validProjects)})},_allChildProjectToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;hash[curProj.data.ObjectID]=curProj;for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me._allChildProjectToList(projTree[childProjRef],hash)},_loadAllChildrenProjects:function(rootProjectRecord){if(!rootProjectRecord)return Q.reject("Invalid arguments: LACP");var me=this,childrenProjects={},projTree={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:["Name","Parent","ObjectID"],limit:1/0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){for(var projects=store.data.items,i=0,len=projects.length;len>i;++i){var project=projects[i],thisRef=project.data.ObjectID,parentRef=project.data.Parent?project.data.Parent.ObjectID:void 0;projTree[thisRef]||(projTree[thisRef]={}),projTree[thisRef].ProjectRecord=project,parentRef&&(projTree[parentRef]||(projTree[parentRef]={}),projTree[parentRef][thisRef]=projTree[thisRef])}return me._allChildProjectToList(projTree[rootProjectRecord.data.ObjectID],childrenProjects),console.log("childrenProjects",childrenProjects),Q(childrenProjects)})},_allLeafProjectsToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;0===curProj.data.Children.Count&&(hash[curProj.data.ObjectID]=curProj);for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me._allLeafProjectsToList(projTree[childProjRef],hash)},_loadAllLeafProjects:function(rootProjectRecord){if(!rootProjectRecord)return Q.reject("Invalid arguments: LALP");var me=this,childrenProjects={},projTree={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:["Name","Parent","ObjectID","Children"],limit:1/0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){for(var projects=store.data.items,i=0,len=projects.length;len>i;++i){var project=projects[i],thisRef=project.data.ObjectID,parentRef=project.data.Parent?project.data.Parent.ObjectID:void 0;projTree[thisRef]||(projTree[thisRef]={}),projTree[thisRef].ProjectRecord=project,parentRef&&(projTree[parentRef]||(projTree[parentRef]={}),projTree[parentRef][thisRef]=projTree[thisRef])}return me._allLeafProjectsToList(projTree[rootProjectRecord.data.ObjectID],childrenProjects),console.log("childrenProjects",childrenProjects),Q(childrenProjects)})},_reloadStore:function(store){var deferred=Q.defer();return store.load({callback:function(records,operation,success){success?deferred.resolve(store):deferred.reject(operation.getError()||"Could not load data")}}),deferred.promise}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("WorkweekDropdown",{extend:"Ext.data.Model",fields:[{name:"Workweek",type:"string"},{name:"DateVal",type:"number"}]})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("WindowListener",{__initWindowEventListener:function(eventName){var me=this;me._windowListeners||(me._windowListeners={}),me._windowListeners[eventName]=[],window.parent["on"+eventName]=function(event){for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i](event)}},_addWindowEventListener:function(eventName,fn){var me=this;me._windowListeners&&me._windowListeners[eventName]||me.__initWindowEventListener(eventName),me._windowListeners[eventName].push(fn)},_fireParentWindowEvent:function(eventName){var me=this;if(me._windowListeners&&me._windowListeners[eventName])for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i]()}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IframeResize",{requires:["WindowListener"],_applyIframeResizeToContents:function(){for(var w=window,p=w.parent,pd=w.parent.document,l=w.location,iframe=window.frameElement?Ext.get(window.frameElement):me.el,ip1=iframe.parentNode,ip2=iframe.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode,height=0,next=this.down();next;)height+=next.getHeight()+1*next.getEl().getMargin("tb")+1*next.getEl().getPadding("tb"),next=next.next();height+=150,ip1.style.height=height+"px",ip2.style.height=height+"px",iframe.style.height=height+"px"},_initIframeResizeToContents:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._applyIframeResizeToContents()})},_applyIframeResizeToWindow:function(){var iframe=window.frameElement?Ext.get(window.frameElement):me.el,i=iframe.dom,portlet=iframe.up(".x-portlet"),portalColumn=portlet.up(".x-portal-column"),dashboard=portlet.up("#mydash_portlet");height=window.parent.innerHeight-70,height-=200,iframe.style.height=height+"px",ip1.style.height=height+"px",height+=30,ip2.style.height=height+"px"},_initIframeResizeToWindow:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._applyIframeResizeToWindow()}),me._applyIframeResizeToWindow()},_fixRallyDashboard:function(){for(var me=this,bottomEl=window.frameElement?Ext.get(window.frameElement):me.el,portlet=bottomEl.up(".x-portlet"),portalColumn=portlet.up(".x-portal-column"),dashboard=portlet.up("#mydash_portlet"),domNodeW=bottomEl.dom,domNodeH=bottomEl.dom,innerHeight=window.parent.innerHeight,innerWidth=window.parent.innerWidth;;){if(domNodeW.style.width=innerWidth-4+"px",domNodeW.style.padding="0",domNodeW.style.margin="0","mydash_portlet"===domNodeW.id)break;domNodeW=domNodeW.parentNode}for(;;){if(domNodeH.style.height=innerHeight-135+"px",domNodeH.classList.contains("x-portlet"))break;domNodeH=domNodeH.parentNode}dashboard.dom.style.height=innerHeight-65+"px",portlet.dom.style.height=innerHeight-105+"px",dashboard.dom.style.padding="0 2px 0 2px"},_initFixRallyDashboard:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._fixRallyDashboard()}),me._fixRallyDashboard()},_disableResizeHandle:function(){var me=this,handle;handle=window.frameElement?Ext.get(window.frameElement).up(".x-portlet").down(".x-resizable-handle"):me.el.up(".x-portlet").down(".x-resizable-handle"),handle&&(handle.hide(),handle.dom.onshow=function(){handle&&handle.hide()})},_initDisableResizeHandle:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._disableResizeHandle()}),me._disableResizeHandle()}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("PrettyAlert",{__getMessageBoxY:function(){var me=this,bottomEl=window.frameElement?Ext.get(window.frameElement):me.el,ph=window.parent.getWindowHeight(),ps=window.parent.getScrollY(),ofy=ps+bottomEl.dom.getBoundingClientRect().top,iyOffset=Math.floor(ph/2-ofy+ps-50);return 0>iyOffset?0:iyOffset},_alert:function(title,str){1>arguments.length||(1===arguments.length&&(str=title,title=""),Ext.MessageBox.alert(title,str).setY(this.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},20))},_confirm:function(title,str,fn){2>arguments.length||(2===arguments.length&&(fn=str,str=title,title=""),"function"!=typeof fn&&(fn=function(){}),Ext.MessageBox.confirm(title,str,fn).setY(this.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},20))}})})();
                (function(){var Ext=window.Ext4||window.Ext,intel_ww={},SECOND=1e3,MINUTE=60*SECOND,HOUR=60*MINUTE,DAY=24*HOUR,WEEK=7*DAY;Ext.define("IntelWorkweek",{_getWorkweek:function(_date){var date=new Date(_date),yearStart=new Date(date.getFullYear(),0,1),dayIndex=yearStart.getDay(),ww01Start=new Date(yearStart-dayIndex*DAY),utcDateMillis=Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()),ww01Millis=Date.UTC(ww01Start.getFullYear(),ww01Start.getMonth(),ww01Start.getDate()),timeDiff=utcDateMillis-ww01Millis,ww=Math.floor(timeDiff/WEEK)+1,leap=0===date.getFullYear()%4,weekCount=leap&&dayIndex>=5||!leap&&6===dayIndex?53:52;return ww>weekCount?1:ww},_getWeekCount:function(_date){var date=new Date(_date),leap=0===date.getFullYear()%4,day=new Date(date.getFullYear(),0,1).getDay();return leap&&day>=5||!leap&&6===day?53:52},_roundDateDownToWeekStart:function(_date){var date=new Date(_date),day=date.getDay(),monthDate=date.getDate(),month=date.getMonth(),year=date.getFullYear(),sundayMidday=new Date(1*new Date(year,month,monthDate)-(day*DAY-.5*DAY));return new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())},_getWorkweekDates:function(startDate,endDate){for(var startWeekDate=this._roundDateDownToWeekStart(startDate),endWeekDate=this._roundDateDownToWeekStart(endDate),startMillis=Date.UTC(startWeekDate.getFullYear(),startWeekDate.getMonth(),startWeekDate.getDate()),endMillis=Date.UTC(endWeekDate.getFullYear(),endWeekDate.getMonth(),endWeekDate.getDate()),totalWeeks=Math.floor((endMillis-startMillis)/WEEK)+1,weeks=Array(totalWeeks),i=0;totalWeeks>i;++i){var sundayMidday=new Date(1*startWeekDate+(WEEK*i+12*HOUR));weeks[i]=new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())}return weeks},_workweekToDate:function(ww,year){var yearStart=new Date(year,0,1),dayIndex=yearStart.getDay(),ww01StartMidday=new Date(yearStart-(dayIndex*DAY-.5*DAY)),sundayMidday=new Date(1*ww01StartMidday+(ww-1)*WEEK);return new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())},_getWorkWeeksForDropdown:function(releaseStartDate,releaseEndDate){for(var workweeks=this._getWorkweekDates(releaseStartDate,releaseEndDate),data=Array(workweeks.length),i=0,len=workweeks.length;len>i;++i)data[i]={Workweek:"ww"+this._getWorkweek(workweeks[i]),DateVal:1*workweeks[i]};return data}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("ReleaseQuery",{_loadAllReleases:function(projectRecord){var deferred=Q.defer();return Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!0,fetch:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],listeners:{load:{fn:function(releaseStore,releaseRecords){console.log("releases loaded:",releaseRecords),deferred.resolve(releaseStore)},single:!0}}}),deferred.promise},_loadReleasesInTheFuture:function(projectRecord){var deferred=Q.defer();return Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!0,fetch:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID},{property:"ReleaseDate",operator:">=",value:(new Date).toISOString()}],listeners:{load:{fn:function(releaseStore,releaseRecords){console.log("releases loaded:",releaseRecords),deferred.resolve(releaseStore)},single:!0}}}),deferred.promise},_loadReleasesWithName:function(releaseName,nameContains){var deferred=Q.defer();return Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!0,fetch:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project","TeamMembers"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",value:releaseName},{property:"Project.Name",operator:"contains",value:nameContains},{property:"Project.Children.Name",operator:"=",value:""},{property:"Project.Name",operator:"!contains",value:" ART"}],listeners:{load:{fn:function(store,records){console.log("releasesWithName loaded:",records),deferred.resolve(store)},single:!0}}}),deferred.promise},_loadReleaseByNameForProject:function(releaseName,projectRecord){var deferred=Q.defer();return Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!0,fetch:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",value:releaseName},{property:"Project",value:projectRecord.data._ref}],listeners:{load:{fn:function(store,records){deferred.resolve(records.pop())},single:!0}}}),deferred.promise},_loadReleasesByNameContainsForProject:function(releaseName,projectRecord){var deferred=Q.defer();return Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!0,fetch:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",operator:"contains",value:releaseName},{property:"Project",value:projectRecord.data._ref}],listeners:{load:{fn:function(store,records){deferred.resolve(records)},single:!0}}}),deferred.promise},_loadReleasesAfterGivenDate:function(projectRecord,givenDate){var deferred=Q.defer();return Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!0,fetch:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID},{property:"ReleaseDate",operator:">=",value:new Date(givenDate).toISOString()}],listeners:{load:{fn:function(releaseStore,releaseRecords){console.log("releases loaded:",releaseRecords),deferred.resolve(releaseStore)},single:!0}}}),deferred.promise},_getScopedRelease:function(releaseRecords,projectOID,appPrefs){var me=this,d=new Date,rs=releaseRecords,prefOID=appPrefs&&appPrefs.projs&&appPrefs.projs[projectOID]&&appPrefs.projs[projectOID].Release;return prefOID&&_.find(rs,function(r){return r.data.ObjectID==prefOID})||_.find(rs,function(r){return new Date(r.data.ReleaseDate)>=d&&d>=new Date(r.data.ReleaseStartDate)})||_.reduce(rs,function(best,r){if(null===best)return r;var d1=new Date(best.data.ReleaseStartDate),d2=new Date(r.data.ReleaseStartDate),now=new Date;return Math.abs(d1-now)<Math.abs(d2-now)?best:r},null)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("AsyncQueue",{QueueOfFuncs:{},_dequeue:function(queueName){var me=this;if(queueName=queueName||"undefined",me.QueueOfFuncs[queueName]){if(me.QueueOfFuncs[queueName].shift(),!me.QueueOfFuncs[queueName].length)return;me.QueueOfFuncs[queueName][0].call(me,me._dequeue.bind(me,queueName))}},_enqueue:function(callback,queueName){var me=this;return queueName=queueName||"undefined","function"!=typeof callback?console.log("ERR: not a function",callback):(me.QueueOfFuncs[queueName]&&me.QueueOfFuncs[queueName].length?me.QueueOfFuncs[queueName].push(callback):(me.QueueOfFuncs[queueName]=[callback],callback.call(me,me._dequeue.bind(me,queueName))),void 0)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Skirtle.CTemplate",{extend:"Ext.XTemplate",statics:{AUTO_ID:0},copyDepth:10,cTpl:'<p id="ctemplate-{0}-{1}"></p>',isCTemplate:!0,constructor:function(){var me=this;me.callParent(arguments),me.id=++me.statics().AUTO_ID,me.reset()},copyValues:function(values,depth){var me=this,id,copy={},copyDepth=depth||me.copyDepth;return 1===copyDepth?values:Ext.isArray(values)?Ext.Array.map(values,function(value){return me.copyValues(value,copyDepth-1)}):Ext.isObject(values)?values.isComponent?(id=values.getId(),me.ids.push(id),Ext.String.format(me.cTpl,id,me.id)):(Ext.Object.each(values,function(key,value){copy[key]="$comp"===key?value:me.copyValues(value,copyDepth-1)}),copy):values},doInsert:function(){var ret=this.callParent(arguments);return this.injectComponents(),ret},doPolling:function(interval){var me=this;me.pollInterval=interval,me.pollId&&clearTimeout(me.pollId),me.pollId=Ext.defer(me.injectComponents,interval,me)},getPlaceholderEl:function(id){return Ext.get("ctemplate-"+id+"-"+this.id)},injectComponents:function(){for(var me=this,ids=me.ids,index=ids.length-1,id,cmp,placeholderEl;index>=0;--index)id=ids[index],cmp=Ext.getCmp(id),placeholderEl=me.getPlaceholderEl(id),(me.renderComponent(cmp,placeholderEl)||!cmp)&&(Ext.Array.splice(ids,index,1),placeholderEl&&placeholderEl.remove());ids.length&&me.doPolling(1.5*me.pollInterval)},overwrite:function(el){var dom,firstChild,ret;if(Ext.isIE)for(dom=Ext.getDom(el);dom.firstChild;)dom.removeChild(dom.firstChild);return ret=this.callParent(arguments),this.injectComponents(),ret},renderComponent:function(cmp,placeholderEl){if(cmp&&placeholderEl){var parent=placeholderEl.parent();return cmp.rendered?cmp.getEl().replace(placeholderEl):cmp.render(parent,placeholderEl),Ext.isIE6&&parent.repaint(),!0}return!1},reset:function(){var me=this;me.ids=[],me.pollId&&(clearTimeout(me.pollId),me.pollId=null)}},function(ctemplate){var apply=function(){var me=this,args=Ext.Array.slice(arguments);return args[0]=me.copyValues(args[0]),me.doPolling(10),me.callParent(args)};ctemplate.prototype.applyOut?ctemplate.override({applyOut:apply}):(ctemplate.override({applyTemplate:apply}),ctemplate.createAlias("apply","applyTemplate"))}),Ext.define("Skirtle.grid.column.Component",{alias:"widget.componentcolumn",extend:"Ext.grid.column.Column",requires:["Skirtle.CTemplate"],autoWidthComponents:!0,componentGC:!0,hasCustomRenderer:!0,lastFrameWidth:12,widthUpdateDelay:[10,400],constructor:function(cfg){var me=this;me.callParent(arguments),me.compIds=[],me.dataIndex=me.dataIndex||Ext.id(null,"cc-dataIndex-"),me.tpl=me.createTemplate(me.tpl),me.renderer=me.createRenderer(me.renderer),me.registerColumnListeners()},addRefOwner:function(child){var me=this,fn=me.refOwnerFn||(me.refOwnerFn=function(){return me});40200>me.extVersion?child.getBubbleTarget=fn:child.getRefOwner=fn},applyTemplate:function(data,value){return Ext.isDefined(value)&&(data[this.dataIndex]=value),this.tpl.apply(data)},beforeViewRefresh:function(){if(Ext.isIE)for(var ids=this.compIds,index=0,len=ids.length,item,el,parentEl;len>index;index++)(item=Ext.getCmp(ids[index]))&&(el=item.getEl())&&(el=el.dom)&&(parentEl=el.parentNode)&&parentEl.removeChild(el)},calculateFrameWidth:function(component){var el=component.getEl(),parentDiv=el&&el.parent(),parentTd=parentDiv&&parentDiv.parent();return parentTd?this.lastFrameWidth=parentDiv.getFrameWidth("lr")+parentTd.getFrameWidth("lr"):void 0},createRenderer:function(renderer){var me=this;return function(value,p,record){var data=Ext.apply({},record.data,record.getAssociatedData());return renderer&&(value=renderer.apply(this,arguments)),value=me.processValue(value),me.applyTemplate(data,value)}},createTemplate:function(tpl){return tpl&&tpl.isTemplate?tpl:Ext.create("Skirtle.CTemplate",tpl||["{",this.dataIndex,"}"])},destroyChild:function(child){child.destroy()},getRefItems:function(deep){for(var items=this.callParent([deep]),ids=this.compIds,index=0,len=ids.length,item;len>index;index++)item=Ext.getCmp(ids[index]),item&&(items.push(item),deep&&item.getRefItems&&items.push.apply(items,item.getRefItems(!0)));return items},onChildAfterRender:function(child){this.resizeChild(child)},onChildBoxReady:function(child){this.resizeChild(child,!1)},onChildDestroy:function(child){Ext.Array.remove(this.compIds,child.getId())},onChildResize:function(){this.redoScrollbars()},onColumnResize:function(column){column.resizeAll()},onColumnShow:function(column){column.resizeAll()},onColumnVisibilityChange:function(column){var items=column.getRefItems(),index=0,length=items.length,visible=!column.isHidden();for(Ext.suspendLayouts&&Ext.suspendLayouts();length>index;++index)items[index].setVisible(visible);Ext.resumeLayouts&&Ext.resumeLayouts(!0)},onDestroy:function(){Ext.destroy(this.getRefItems()),this.callParent()},onRender:function(){this.registerViewListeners(),this.callParent(arguments)},onViewChange:function(){var me=this,tpl=me.tpl;me.suspendResizing(),tpl.isCTemplate&&(tpl.injectComponents(),tpl.reset()),me.redoScrollbars(),me.resumeResizing(),me.performGC()},performGC:function(){for(var compIds=this.compIds,index=compIds.length-1,comp,el;index>=0;--index)comp=Ext.getCmp(compIds[index]),el=comp&&comp.getEl(),el&&(!this.componentGC||el.dom&&Ext.getDom(Ext.id(el))===el.dom)||comp&&!comp.isDestroyed&&comp.destroy()},processValue:function(value){var me=this,compIds=me.compIds,id,initialWidth,dom,parent;return Ext.isObject(value)&&!value.isComponent&&value.xtype&&(value=Ext.widget(value.xtype,value)),value&&value.isComponent&&(id=value.getId(),Ext.Array.contains(compIds,id)||compIds.push(id),me.addRefOwner(value),me.registerListeners(value),value.rendered?Ext.isIE&&(dom=value.el.dom,parent=dom.parentNode,parent&&(40101===me.extVersion&&Ext.core.DomHelper.insertBefore(dom,{tag:"p"}),parent.removeChild(dom))):me.autoWidthComponents&&(initialWidth=me.getWidth()-me.lastFrameWidth,initialWidth=initialWidth>4?initialWidth:4,value.setWidth(initialWidth)),(Ext.isIE6||Ext.isIE7)&&me.isHidden()&&value.hide()),value},redoScrollbars:function(){var me=this,grid=me.up("tablepanel");if(grid){if(me.resizeQueue)return me.redoScrollbarsRequired=!0,void 0;40100>me.extVersion?(grid.invalidateScroller(),grid.determineScrollbars()):grid.doLayout()}},registerColumnListeners:function(){var me=this;me.autoWidthComponents&&(me.on("resize",me.onColumnResize),me.on("show",me.onColumnShow)),(Ext.isIE6||Ext.isIE7)&&me.on({hide:me.onColumnVisibilityChange,show:me.onColumnVisibilityChange})},registerListeners:function(component){var me=this;component.on("destroy",me.onChildDestroy,me),me.autoWidthComponents&&(component.on("afterrender",me.onChildAfterRender,me,{single:!0}),me.extVersion>=40100&&component.on("boxready",me.onChildBoxReady,me,{single:!0})),component.on("resize",me.onChildResize,me)},registerViewListeners:function(){var me=this,view=me.up("tablepanel").getView();me.mon(view,"beforerefresh",me.beforeViewRefresh,me),me.mon(view,"refresh",me.onViewChange,me),me.mon(view,"itemupdate",me.onViewChange,me),me.mon(view,"itemadd",me.onViewChange,me),me.mon(view,"itemremove",me.onViewChange,me)},resizeAll:function(){var me=this;me.suspendResizing(),me.resizeQueue=me.getRefItems(),me.resumeResizing()},resizeChild:function(component,defer){var me=this,frameWidth,newWidth,oldWidth,resizeQueue;return me.resizingSuspended?(resizeQueue=me.resizeQueue,Ext.Array.contains(resizeQueue,component)||resizeQueue.push(component),void 0):(frameWidth=me.calculateFrameWidth(component),Ext.isNumber(frameWidth)&&(newWidth=me.getWidth()-frameWidth,oldWidth=component.getWidth(),me.setChildWidth(component,newWidth,oldWidth)&&defer!==!1&&Ext.each(me.widthUpdateDelay,function(delay){Ext.defer(me.resizeChild,delay,me,[component,!1])})),void 0)},resumeResizing:function(){var me=this,index=0,resizeQueue=me.resizeQueue,len=resizeQueue.length;if(!--me.resizingSuspended){for(;len>index;++index)me.resizeChild(resizeQueue[index]);me.resizeQueue=null,me.redoScrollbarsRequired&&me.redoScrollbars()}},setChildWidth:function(component,newWidth,oldWidth){return oldWidth===newWidth?!1:(component.setWidth(newWidth),!0)},suspendResizing:function(){var me=this;me.resizingSuspended=(me.resizingSuspended||0)+1,me.resizeQueue||(me.resizeQueue=[])}},function(cls){var proto=cls.prototype,version=Ext.getVersion();proto.extVersion=100*(100*version.getMajor()+version.getMinor())+version.getPatch(),Ext.Element.prototype.syncContent&&"4.1.0"==""+version&&(proto.extVersion=40101)})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Intel.form.field.ComboBox",{extend:"Ext.form.field.ComboBox",alias:["widget.intelcombo","widget.intelcombobox"],constructor:function(options){options=options||{},options=Ext.merge({enableKeyEvents:!0,queryMode:"local",ignoreNoChange:!0,allowBlank:!1,listeners:{keyup:function(a,b){if(!(b.keyCode>=37&&40>=b.keyCode)){var combo=this;combo.store.clearFilter(),combo.store.filterBy(function(item){return null!==item.data[combo.displayField].match(RegExp(combo.getRawValue(),"i"))})}},focus:function(combo){combo.store.clearFilter(),combo.setValue(""),combo.expand()}}},options),this.callParent([options])}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Intel.form.field.FixedComboBox",{extend:"Ext.form.field.ComboBox",alias:["widget.intelfixedcombo","widget.intelfixedcombobox"],constructor:function(options){options=options||{},options=Ext.merge({editable:!1,allowBlank:!1,queryMode:"local",listeners:{focus:function(combo){combo.setValue(""),combo.expand()}}},options),this.callParent([options])}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Intel.form.field.ReleasePicker",{extend:"Intel.form.field.FixedComboBox",alias:["widget.intelreleasepicker"],constructor:function(options){options.releases&&options.currentRelease&&(options.displayField="Name",options.value=options.currentRelease.data.Name,options.store=Ext.create("Ext.data.Store",{fields:["Name"],sorters:[function(o1,o2){return o1.data.Name>o2.data.Name?-1:1}],data:_.map(options.releases,function(r){return{Name:r.data.Name}})}),options.fieldLabel=options.fieldLabel||"Release:",options.editable=options.editable||!1,options.width=options.width||240,options.labelWidth=options.labelWidth||50,this.callParent([options]))}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelTextarea",{extend:"Ext.form.field.TextArea",alias:["widget.inteltextarea"],grow:!0,growMin:20,growMax:160,maxLength:150,enforceMaxLength:!0,enterIsSpecial:!0})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("intel.grid.column.Component.",{alias:"widget.fastgridcolumn",extend:"Skirtle.grid.column.Component",autoWidthComponents:!1,componentGC:!0,hasCustomRenderer:!0,lastFrameWidth:12,constructor:function(cfg){var me=this;me.callParent(arguments)},registerViewListeners:function(){var me=this,view=me.up("tablepanel").getView();me.mon(view,"beforerefresh",me.beforeViewRefresh,me),me.mon(view,"refresh",me.onViewChange,me)},onViewChange:function(){var me=this,tpl=me.tpl;me.suspendResizing(),tpl.isCTemplate&&(tpl.injectComponents(),tpl.reset()),me.resumeResizing(),me.performGC()},resumeResizing:function(){var me=this,index=0,resizeQueue=me.resizeQueue,len=resizeQueue.length;if(!--me.resizingSuspended){for(;len>index;++index)me.resizeChild(resizeQueue[index]);me.resizeQueue=null}},onChildResize:function(){}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Intel.data.proxy.SessionStorage",{extend:"Ext.data.proxy.SessionStorage",alias:"proxy.fastsessionproxy",constructor:function(cfg){var me=this;me.callParent(arguments)},create:function(operation,callback,scope){var me=this,records=operation.records,length=records.length,ids=me.getIds(),id,record,i;for(operation.setStarted(),void 0===me.isHierarchical&&(me.isHierarchical=!!records[0].isNode,me.isHierarchical&&me.getStorageObject().setItem(me.getTreeKey(),!0)),i=0;length>i;i++)record=records[i],record.phantom?(record.phantom=!1,id=me.getNextId()):id=record.getId(),record.beginEdit(),me.setRecord(record,id),record.endEdit(!0),record.commit(!0),ids.push(id);me.setIds(ids),operation.setCompleted(),operation.setSuccessful(),"function"==typeof callback&&callback.call(scope||me,operation)},update:function(operation,callback,scope){var records=operation.records,length=records.length,ids=this.getIds(),record,id,i;for(operation.setStarted(),i=0;length>i;i++)record=records[i],this.setRecord(record),record.commit(!0),id=record.getId(),void 0!==id&&-1==Ext.Array.indexOf(ids,id)&&ids.push(id);this.setIds(ids),operation.setCompleted(),operation.setSuccessful(),"function"==typeof callback&&callback.call(scope||this,operation)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Intel.data.FastStore",{extend:"Ext.data.Store",alias:"store.faststore",constructor:function(cfg){var me=this;me.callParent(arguments)},afterEdit:function(record,modifiedFieldNames){var me=this,i,shouldSync;if(me.autoSync&&!me.autoSyncSuspended)for(i=modifiedFieldNames.length;i--;)if(record.fields.get(modifiedFieldNames[i]).persist){me.sync();break}me.onUpdate(record,Ext.data.Model.EDIT,modifiedFieldNames)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Intel.grid.plugin.CellEditing",{alias:"plugin.fastcellediting",extend:"Ext.grid.plugin.CellEditing",triggerEvent:"cellclick",onEditComplete:function(ed,value,startValue){var me=this,activeColumn=me.getActiveColumn(),context=me.context,record;if(activeColumn){if(record=context.record,me.setActiveEditor(null),me.setActiveColumn(null),me.setActiveRecord(null),context.value=value,!me.validateEdit())return me.editing=!1,void 0;record.beginEdit(),record.isEqual(value,startValue)||record.set(activeColumn.dataIndex,value),context.view.focusRow(context.rowIdx,100),me.fireEvent("edit",me,context),record.endEdit(),me.editing=!1}}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("Intel.view.ScrollTable",{extend:"Ext.view.Table",alias:"widget.scrolltableview",constructor:function(cfg){var me=this;me.callParent(arguments)},refresh:function(){var me=this,targetEl,targetParent,oldDisplay,nextSibling,dom,records,el=me.getEl(),scroll=el&&el.getScrollTop();me.rendered&&!me.isDestroyed&&(me.hasListeners.beforerefresh&&me.fireEvent("beforerefresh",me)===!1||(targetEl=me.getTargetEl(),records=me.getViewRange(),dom=targetEl.dom,me.preserveScrollOnRefresh||(targetParent=dom.parentNode,oldDisplay=dom.style.display,dom.style.display="none",nextSibling=dom.nextSibling,targetParent.removeChild(dom)),me.refreshCounter?me.clearViewEl():(me.fixedNodes=targetEl.dom.childNodes.length,me.refreshCounter=1),me.tpl.append(targetEl,me.collectData(records,me.all.startIndex)),1>records.length?(this.store.loading||me.deferEmptyText&&!me.hasFirstRefresh||Ext.core.DomHelper.insertHtml("beforeEnd",targetEl.dom,me.emptyText),me.all.clear()):(me.collectNodes(targetEl.dom),me.updateIndexes(0)),me.hasFirstRefresh&&(me.refreshSelmodelOnRefresh!==!1?me.selModel.refresh():me.selModel.pruneIf()),me.hasFirstRefresh=!0,me.preserveScrollOnRefresh||(targetParent.insertBefore(dom,nextSibling),dom.style.display=oldDisplay),Ext.suspendLayouts(),this.refreshSize(),me.fireEvent("refresh",me),Ext.resumeLayouts(!0),me.viewReady||(me.viewReady=!0,me.fireEvent("viewready",me))),scroll&&me.preserveScrollOnRefresh&&el.setScrollTop(scroll))},onRemove:function(ds,records,indexes){var me=this,fireItemRemove=me.hasListeners.itemremove,i,record,index,el=me.getEl(),scroll=el&&el.getScrollTop();if(me.all.getCount()){if(0===me.dataSource.getCount()){if(fireItemRemove)for(i=indexes.length-1;i>=0;--i)me.fireEvent("itemremove",records[i],indexes[i])}else{for(i=indexes.length-1;i>=0;--i)record=records[i],index=indexes[i],me.doRemove(record,index),fireItemRemove&&me.fireEvent("itemremove",record,index);me.updateIndexes(indexes[0])}this.refreshSize(),scroll&&me.preserveScrollOnRefresh&&el.setScrollTop(scroll)}},onUpdate:function(ds,record){var me=this,index,node,el=me.getEl(),scroll=el&&el.getScrollTop();if(me.viewReady){if(index=me.dataSource.indexOf(record),index>-1&&(node=me.bufferRender([record],index)[0],me.getNode(record)))return me.all.replaceElement(index,node,!0),me.updateIndexes(index,index),me.selModel.onUpdate(record),me.hasListeners.itemupdate&&me.fireEvent("itemupdate",record,index,node),node;scroll&&me.preserveScrollOnRefresh&&el.setScrollTop(scroll)}},onAdd:function(store,records,index){var me=this,nodes,el=me.getEl(),scroll=el&&el.getScrollTop();me.rendered&&(0===me.all.getCount()?(me.refresh(),nodes=me.all.slice()):(nodes=me.doAdd(records,index),me.refreshSelmodelOnRefresh!==!1&&me.selModel.refresh(),me.updateIndexes(index)),me.hasListeners.itemadd&&me.fireEvent("itemadd",records,index,nodes),scroll&&me.preserveScrollOnRefresh&&el.setScrollTop(scroll))},scrollRowIntoView:function(row){return 0===row?(this.getEl().setScrollTop(0),void 0):(row=this.getNode(row,!0),row&&Ext.fly(row).scrollIntoView(this.el,!1),void 0)}})})();
                (function(){var Ext=window.Ext4||window.Ext;RALLY_MAX_STRING_SIZE=32768,console={log:function(){}},Ext.define("ProgramBoard",{extend:"IntelRallyApp",mixins:["WindowListener","PrettyAlert","IframeResize","IntelWorkweek","ReleaseQuery","AsyncQueue"],_prefName:"intel-program-board",layout:{type:"vbox",align:"stretch",pack:"start"},items:[{xtype:"container",padding:"0 10px 0 10px",layout:{type:"hbox",align:"stretch",pack:"start"},height:45,itemId:"navbox",items:[{xtype:"container",flex:3,itemId:"navbox_left",layout:{type:"hbox"}},{xtype:"container",flex:2,itemId:"navbox_right",layout:{type:"hbox",pack:"end"}}]},{xtype:"container",padding:"0 10px 0 10px",layout:{type:"hbox",align:"stretch",pack:"start"},itemId:"tc_vel_box",items:[{xtype:"container",flex:2,itemId:"tc_vel_box_left"},{xtype:"container",flex:1,itemId:"tc_vel_box_right"}]}],minWidth:910,_loadFeatures:function(){var me=this,featureStore=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/Feature",limit:1/0,remoteSort:!1,fetch:["Name","ObjectID","FormattedID","c_TeamCommits","c_Risks","Project","PlannedEndDate","Parent","DragAndDropRank"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[me._getFeatureFilter(me.TrainRecord,me.ReleaseRecord)]});return me._reloadStore(featureStore).then(function(featureStore){var promises=[],featureRecords=featureStore.data.items;return console.log("features loaded:",featureRecords),me.FeatureStore=featureStore,me.FeatureProductHash={},featureRecords.forEach(function(fr){var frData=fr.data;frData.Parent?promises.push(me._loadMilestone(frData.Parent.ObjectID).then(function(milestoneRecord){var p=milestoneRecord.data.Parent;me.FeatureProductHash[frData.ObjectID]=p&&p.Name?p.Name:""})):me.FeatureProductHash[frData.ObjectID]=""}),Q.all(promises)})},_loadIterations:function(){var me=this,startDate=Rally.util.DateTime.toIsoString(me.ReleaseRecord.data.ReleaseStartDate),endDate=Rally.util.DateTime.toIsoString(me.ReleaseRecord.data.ReleaseDate);return iterationStore=Ext.create("Rally.data.WsapiDataStore",{model:"Iteration",remoteSort:!1,limit:1/0,fetch:["Name","EndDate","StartDate","PlannedVelocity","Project"],context:{project:me.getContext().getProject()._ref,projectScopeUp:!1},filters:[{property:"EndDate",operator:">=",value:startDate},{property:"StartDate",operator:"<=",value:endDate}]}),me._reloadStore(iterationStore).then(function(iterationStore){console.log("iterations loaded:",iterationStore.data.items),me.IterationStore=iterationStore})},_loadUserStories:function(){var me=this,userStoryStore=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1/0,remoteSort:!1,fetch:["Name","ObjectID","Release","Project","Feature","FormattedID","Predecessors","Successors","c_Dependencies","Iteration","PlanEstimate"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[Ext.create("Rally.data.wsapi.Filter",{property:"Project",value:me.ProjectRecord.data._ref}).and(me._getUserStoryInReleaseTimeFrameFilter(me.ReleaseRecord))]});return me._reloadStore(userStoryStore).then(function(userStoryStore){console.log("userStories loaded:",userStoryStore.data.items),me.UserStoryStore=userStoryStore})},_getTeamCommit:function(featureRecord){var tcs=featureRecord.data.c_TeamCommits,projectID=this.ProjectRecord.data.ObjectID;try{tcs=JSON.parse(atob(tcs))[projectID]||{}}catch(e){tcs={}}return tcs},_setTeamCommit:function(featureRecord,tc){var tcs=featureRecord.data.c_TeamCommits,projectID=this.ProjectRecord.data.ObjectID,deferred=Q.defer();try{tcs=JSON.parse(atob(tcs))||{}}catch(e){tcs={}}tcs[projectID]||(tcs[projectID]={}),tcs[projectID].Commitment=tc.Commitment,tcs[projectID].Objective=tc.Objective;var str=btoa(JSON.stringify(tcs,null,"	"));return str.length>=RALLY_MAX_STRING_SIZE?deferred.reject("TeamCommits field for "+featureRecord.data.FormattedID+" ran out of space! Cannot save"):(featureRecord.set("c_TeamCommits",str),featureRecord.save({callback:function(record,operation,success){success?(console.log("added teamCommits to feature:",featureRecord,tcs),deferred.resolve()):deferred.reject("Failed to modify Feature "+featureRecord.data.FormattedID)}})),deferred.promise},_TeamCommitsCountHash:{},_getStoryCount:function(FID){if(this._TeamCommitsCountHash[FID])return this._TeamCommitsCountHash[FID];for(var count=0,recs=this.UserStoryStore.data.items,i=0,len=recs.length;len>i;++i){var us=recs[i];count+=1*(us.data.Feature&&us.data.Feature.ObjectID==FID)}return this._TeamCommitsCountHash[FID]=count,count},_TeamCommitsEstimateHash:{},_getStoriesEstimate:function(FID){if(this._TeamCommitsEstimateHash[FID])return this._TeamCommitsEstimateHash[FID];for(var estimate=0,recs=this.UserStoryStore.data.items,i=0,len=recs.length;len>i;++i){var us=recs[i];estimate+=1*(us.data.Feature&&us.data.Feature.ObjectID==FID?us.data.PlanEstimate:0)}return this._TeamCommitsEstimateHash[FID]=estimate,estimate},_getSanityStoreConfigs:function(){var me=this,releaseName=me.ReleaseRecord.data.Name,releaseDate=new Date(me.ReleaseRecord.data.ReleaseDate).toISOString(),releaseStartDate=new Date(me.ReleaseRecord.data.ReleaseStartDate).toISOString(),trainName=me.TrainRecord.data.Name.split(" ART")[0],releaseNameFilter=Ext.create("Rally.data.wsapi.Filter",{property:"Release.Name",value:releaseName}),userStoryProjectFilter=Ext.create("Rally.data.wsapi.Filter",{property:"Project",value:me.ProjectRecord.data._ref});return[{title:"Unsized Stories",filters:[Ext.create("Rally.data.wsapi.Filter",{property:"PlanEstimate",operator:"=",value:null}).and(releaseNameFilter).and(userStoryProjectFilter)]},{title:"Improperly Sized Stories",filters:[Ext.create("Rally.data.wsapi.Filter",{property:"Children.ObjectID",value:null}).and(Ext.create("Rally.data.wsapi.Filter",{property:"PlanEstimate",operator:"!=",value:null})).and(Ext.create("Rally.data.wsapi.Filter",{property:"PlanEstimate",operator:"!=",value:"1"})).and(Ext.create("Rally.data.wsapi.Filter",{property:"PlanEstimate",operator:"!=",value:"2"})).and(Ext.create("Rally.data.wsapi.Filter",{property:"PlanEstimate",operator:"!=",value:"4"})).and(Ext.create("Rally.data.wsapi.Filter",{property:"PlanEstimate",operator:"!=",value:"8"})).and(Ext.create("Rally.data.wsapi.Filter",{property:"PlanEstimate",operator:"!=",value:"16"})).and(releaseNameFilter).and(userStoryProjectFilter)]},{title:"Stories in Release without Iteration",filters:[Ext.create("Rally.data.wsapi.Filter",{property:"Iteration",value:null}).and(releaseNameFilter).and(userStoryProjectFilter)]},{title:"Stories in Iteration not attached to Release",filters:[Ext.create("Rally.data.wsapi.Filter",{property:"Iteration.StartDate",operator:"<",value:releaseDate}).and(Ext.create("Rally.data.wsapi.Filter",{property:"Iteration.EndDate",operator:">",value:releaseStartDate})).and(Ext.create("Rally.data.wsapi.Filter",{property:"Release.Name",value:null})).and(Ext.create("Rally.data.wsapi.Filter",{property:"Feature.Release.Name",value:null})).and(userStoryProjectFilter)]},{title:"Stories with End Date past Feature End Date",filters:[Ext.create("Rally.data.wsapi.Filter",{property:"Iteration.EndDate",operator:">",value:releaseDate}).and(releaseNameFilter).and(userStoryProjectFilter)]}]},_loadSanityStores:function(){var me=this;return me.SanityStores=[],Q.all(_.map(me._getSanityStoreConfigs(),function(storeConfig){var userStoryStore=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1/0,remoteSort:!1,fetch:["Name","FormattedID","ObjectID","Project","Iteration","Release"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:storeConfig.filters});return me._reloadStore(userStoryStore).then(function(userStoryStore){me.SanityStores.push({title:storeConfig.title,userStories:userStoryStore.getRange()})})}))},_updateFColumnStores:function(){var me=this,features=me.FeatureStore.data.items,i,len;if(me.FeatureFIDStore)for(me.FeatureFIDStore.removeAll(),i=0,len=features.length;len>i;++i)me.FeatureFIDStore.add({FormattedID:features[i].data.FormattedID});if(me.FeatureNameStore)for(me.FeatureNameStore.removeAll(),i=0,len=features.length;len>i;++i)me.FeatureNameStore.add({Name:features[i].data.Name})},_getRisks:function(featureRecord){var risks=featureRecord.data.c_Risks;try{risks=JSON.parse(atob(risks))||{}}catch(e){risks={}}return risks},_parseRisksFromFeature:function(featureRecord){var array=[],projectID=this.ProjectRecord.data.ObjectID,risks=this._getRisks(featureRecord),ObjectID=featureRecord.data.ObjectID,FormattedID=featureRecord.data.FormattedID,FeatureName=featureRecord.data.Name;if(risks[projectID])for(var riskID in risks[projectID]){var risk=risks[projectID][riskID];array.push({ObjectID:ObjectID,FormattedID:FormattedID,FeatureName:FeatureName,RiskID:riskID,Description:risk.Desc,Impact:risk.Imp,MitigationPlan:risk.Mit,Urgency:risk.Urg,Status:risk.Sta,Contact:risk.Cont,Checkpoint:risk.CP,Edited:!1})}return array},_parseRisksData:function(){var me=this,array=[],records=me.FeatureStore.getRecords(),relUSs=[],i,len;for(i=0,len=records.length;len>i;++i)array=array.concat(me._parseRisksFromFeature(records[i]));me.RisksParsedData=array},_spliceRiskFromList:function(riskID,riskList){for(var i=0;riskList.length>i;++i)if(riskList[i].RiskID==riskID)return riskList.splice(i,1)[0]},_removeRisk:function(featureRecord,riskData){var risks=this._getRisks(featureRecord),projectID=this.ProjectRecord.data.ObjectID,deferred=Q.defer();if(risks[projectID]){risks[projectID][riskData.RiskID]=void 0,this.RisksParsedData=_.reject(this.RisksParsedData,function(rpd){return rpd.RiskID===riskData.RiskID&&rpd.FormattedID===riskData.FormattedID});var str=btoa(JSON.stringify(risks,null,"	"));str.length>=RALLY_MAX_STRING_SIZE?deferred.reject("Risks field for "+featureRecord.data.FormattedID+" ran out of space! Cannot save"):(featureRecord.set("c_Risks",str),featureRecord.save({callback:function(record,operation,success){success?(console.log("removed risk from feature:",featureRecord,riskData,risks),deferred.resolve()):deferred.reject("Failed to modify Feature "+featureRecord.data.FormattedID)}}))}else deferred.resolve();return deferred.promise},_addRisk:function(featureRecord,riskData){var risks=this._getRisks(featureRecord),projectID=this.ProjectRecord.data.ObjectID,deferred=Q.defer();riskData=Ext.clone(riskData),riskData.Edited=!1,risks[projectID]||(risks[projectID]={});var copy={CP:riskData.Checkpoint,Desc:riskData.Description,Imp:riskData.Impact,Mit:riskData.MitigationPlan,Urg:riskData.Urgency,Sta:riskData.Status,Cont:riskData.Contact};risks[projectID][riskData.RiskID]=copy;for(var parseDataAdded=!1,i=0;this.RisksParsedData.length>i;++i){var rpd=this.RisksParsedData[i];if(rpd.RiskID===riskData.RiskID&&rpd.FormattedID===riskData.FormattedID){this.RisksParsedData[i]=riskData,parseDataAdded=!0;break}}parseDataAdded||this.RisksParsedData.push(riskData);var str=btoa(JSON.stringify(risks,null,"	"));return str.length>=RALLY_MAX_STRING_SIZE?deferred.reject("Risks field for "+featureRecord.data.FormattedID+" ran out of space! Cannot save"):(featureRecord.set("c_Risks",str),featureRecord.save({callback:function(record,operation,success){success?(console.log("added risk to feature:",featureRecord,riskData,risks),deferred.resolve()):deferred.reject("Failed to modify Feature "+featureRecord.data.FormattedID)}})),deferred.promise},_updateUSColumnStores:function(){var me=this,uses=me.DependenciesReleaseUserStories,i,len;if(me.UserStoryFIDStore)for(me.UserStoryFIDStore.removeAll(),i=0,len=uses.length;len>i;++i)me.UserStoryFIDStore.add({FormattedID:uses[i].data.FormattedID});if(me.UserStoryNameStore)for(me.UserStoryNameStore.removeAll(),i=0,len=uses.length;len>i;++i)me.UserStoryNameStore.add({Name:uses[i].data.Name})},_isInRelease:function(usr){return usr.data.Release&&usr.data.Release.Name===this.ReleaseRecord.data.Name||usr.data.Feature&&usr.data.Feature.Release&&usr.data.Feature.Release.Name===this.ReleaseRecord.data.Name},_getDependencies:function(userStoryRecord){var dependencies,dependencyString=userStoryRecord.data.c_Dependencies;if(""===dependencyString)dependencies={Preds:{},Succs:[]};else try{dependencies=JSON.parse(atob(dependencyString))}catch(e){dependencies={Preds:{},Succs:[]}}return dependencies},_parseDependenciesFromUserStory:function(userStoryRecord){var deps=this._getDependencies(userStoryRecord),preds=deps.Preds,succs=deps.Succs,predDepsList=[],succDepsList=[],startDate=new Date(this.ReleaseRecord.data.ReleaseStartDate),endDate=new Date(this.ReleaseRecord.data.ReleaseDate),ObjectID=userStoryRecord.data.ObjectID,FormattedID=userStoryRecord.data.FormattedID,UserStoryName=userStoryRecord.data.Name;if(this._isInRelease(userStoryRecord))for(var predDepID in preds){var predDep=preds[predDepID];predDepsList.push({DependencyID:predDepID,ObjectID:ObjectID,FormattedID:FormattedID,UserStoryName:UserStoryName,Description:predDep.Desc,Checkpoint:predDep.CP,Status:predDep.Sta,Predecessors:predDep.Preds||[],Edited:!1})}for(var i=0;succs.length>i;++i){var succDep=succs[i];new Date(succDep.REL)>=startDate&&endDate>=new Date(succDep.REL_S)&&(succDep.A?(FormattedID=userStoryRecord.data.FormattedID,UserStoryName=userStoryRecord.data.Name):FormattedID=UserStoryName="",succDepsList.push({DependencyID:succDep.ID,SuccUserStoryName:succDep.SUSName,SuccFormattedID:succDep.SUSID,SuccProjectID:succDep.SPID,ReleaseDate:succDep.REL,ReleaseStartDate:succDep.REL_S,Description:succDep.Desc,Checkpoint:succDep.CP,Supported:succDep.Sup,Assigned:succDep.A,FormattedID:FormattedID,UserStoryName:UserStoryName,ObjectID:ObjectID,Edited:!1}))}return{Predecessors:predDepsList,Successors:succDepsList}},_parseDependenciesData:function(){var me=this,predDepsList=[],succDepsList=[],records=me.UserStoryStore.getRecords(),relUSs=[],i,len;for(i=0,len=records.length;len>i;++i)me._isInRelease(records[i])&&relUSs.push(records[i]);for(me.DependenciesReleaseUserStories=relUSs,i=0;len>i;++i){var usrData=me._parseDependenciesFromUserStory(records[i]);predDepsList=predDepsList.concat(usrData.Predecessors),succDepsList=succDepsList.concat(usrData.Successors)}me.DependenciesParsedData={Predecessors:predDepsList,Successors:succDepsList}},_newTeamDep:function(){return{TID:1*new Date+""+(100*Math.random()>>0),PID:"",Sup:"Undefined",USID:"",USName:"",A:!1}},_spliceDepFromList:function(dependencyID,dependencyList){for(var i=0;dependencyList.length>i;++i)if(dependencyList[i].DependencyID==dependencyID)return dependencyList.splice(i,1)[0]},_syncCollection:function(userStoryRecord,usAddList,usRemoveList,type){var me=this,collectionStore,collectionRecords,syncCollectionProxy=!1,funcDeferred=Q.defer();return userStoryRecord.getCollection(type).load({fetch:["FormattedID"],callback:function(){var promises=[],collectionStore=this,collectionRecords=collectionStore.getRange();usAddList.forEach(function(dep){if(!_.find(collectionRecords,function(cr){return cr.data.FormattedID===dep.USID})){var project=me.ValidProjects[dep.PID];promises.push(me._loadUserStoryByFID(dep.USID,project.data._ref).then(function(us){us&&(syncCollectionProxy=!0,collectionStore.add(us))}))}}),usRemoveList.forEach(function(dep){var realDep=_.find(collectionRecords,function(cr){return cr.data.FormattedID===dep.USID});realDep&&(collectionStore.remove(realDep),syncCollectionProxy=!0)});var attempts=0;Q.all(promises).then(function retrySync(){++attempts>5?(console.log("Quit trying to modify "+type+" of User Story: "+userStoryRecord.data.FormattedID),funcDeferred.resolve()):syncCollectionProxy?collectionStore.sync({failure:function(){console.log("Failed attempt to modify "+type+" of User Story: "+userStoryRecord.data.FormattedID),retrySync()},success:function(){console.log("Successfully modified "+type+" of User Story: "+userStoryRecord.data.FormattedID),funcDeferred.resolve()}}):funcDeferred.resolve()}).fail(function(reason){funcDeferred.reject(reason)}).done()}}),funcDeferred.promise},_collectionSynced:function(userStoryRecord,msg,depData,dependencies){var me=this,str=btoa(JSON.stringify(dependencies,null,"	")),deferred=Q.defer();if(str.length>=RALLY_MAX_STRING_SIZE)deferred.reject("Dependencies field for "+userStoryRecord.data.FormattedID+" ran out of space! Cannot save");else{userStoryRecord.set("c_Dependencies",str);var attempts=0;(function retrySync(){return++attempts>5?(deferred.reject("Failed to modify User Story "+userStoryRecord.data.FormattedID),void 0):(userStoryRecord.save({callback:function(record,operation,success){success?(console.log(msg,userStoryRecord,depData,dependencies),deferred.resolve()):(console.log("Failed attempt to modify "+type+" of User Story: "+userStoryRecord.data.FormattedID),retrySync())}}),void 0)})()}return deferred.promise},_removePredDep:function(userStoryRecord,predDepData){var me=this,dependencies=me._getDependencies(userStoryRecord),cachePreds=me.DependenciesParsedData.Predecessors,addUSlist=[],removeUSlist=[],depID=predDepData.DependencyID,i;if(removeUSlist=dependencies.Preds[depID].Preds||[],delete dependencies.Preds[depID],userStoryRecord.data.Project.ObjectID===me.ProjectRecord.data.ObjectID)for(i=0;cachePreds.length>i;++i)if(cachePreds[i].DependencyID===depID){cachePreds.splice(i,1);break}return _.each(dependencies.Preds,function(predDep){_.each(predDep.Preds,function(pred){if(pred.A){for(i=0;removeUSlist.length>i;++i)removeUSlist[i].USID===pred.USID&&removeUSlist.splice(i,1);for(i=0;addUSlist.length>i;++i)if(addUSlist[i].USID===pred.USID)return;addUSlist.push(pred)}})}),me._syncCollection(userStoryRecord,addUSlist,removeUSlist,"Predecessors").then(function(){return me._collectionSynced(userStoryRecord,"removed predDep",predDepData,dependencies)})},_removeSuccDep:function(userStoryRecord,succDepData){var me=this,dependencies=me._getDependencies(userStoryRecord),cacheSuccs=me.DependenciesParsedData.Successors,dpds,addUSlist=[],removeUSlist=[],succDep,i;for(i=0;dependencies.Succs.length>i;++i)dependencies.Succs[i].ID===succDepData.DependencyID&&(succDep=dependencies.Succs.splice(i,1)[0],removeUSlist.push({USID:succDep.SUSID,PID:succDep.SPID}));if(userStoryRecord.data.Project.ObjectID===me.ProjectRecord.data.ObjectID)for(i=0;cacheSuccs.length>i;++i)if(dpds=cacheSuccs[i],dpds.DependencyID===succDepData.DependencyID&&dpds.FormattedID===succDepData.FormattedID){cacheSuccs.splice(i,1);break}return _.each(dependencies.Succs,function(succ){if(succ.A){for(i=0;removeUSlist.length>i;++i)removeUSlist[i].USID===succ.SUSID&&removeUSlist.splice(i,1);for(i=0;addUSlist.length>i;++i)if(addUSlist[i].USID===succ.SUSID)return;addUSlist.push({USID:succ.SUSID,PID:succ.SPID})}}),me._syncCollection(userStoryRecord,addUSlist,removeUSlist,"Successors").then(function(){return me._collectionSynced(userStoryRecord,"removed succdep",succDepData,dependencies)})},_addPredDep:function(userStoryRecord,predDepData){function appendPred(pred){if(pred.A){for(i=0;predUSlist.length>i;++i)if(predUSlist[i].USID===pred.USID)return;predUSlist.push(pred)}}var me=this,dependencies=me._getDependencies(userStoryRecord),cachePreds=me.DependenciesParsedData.Predecessors,dpdp,predUSlist=[],parseDataAdded=!1,depID,i;if(predDepData=Ext.clone(predDepData),predDepData.Edited=!1,dependencies.Preds[predDepData.DependencyID]={Desc:predDepData.Description,CP:predDepData.Checkpoint,Sta:predDepData.Status,Preds:predDepData.Predecessors},userStoryRecord.data.Project.ObjectID===me.ProjectRecord.data.ObjectID){for(i=0;cachePreds.length>i;++i)if(dpdp=cachePreds[i],dpdp.DependencyID===predDepData.DependencyID){cachePreds[i]=predDepData,parseDataAdded=!0;break}parseDataAdded||cachePreds.push(predDepData)}for(depID in dependencies.Preds)_.each(dependencies.Preds[depID].Preds,appendPred);return me._syncCollection(userStoryRecord,predUSlist,[],"Predecessors").then(function(){return me._collectionSynced(userStoryRecord,"added predDep",predDepData,dependencies)})},_addSuccDep:function(userStoryRecord,succDepData){var me=this,dependencies=me._getDependencies(userStoryRecord),cacheSuccs=me.DependenciesParsedData.Successors,dpds,replaced=!1,succUSlist=[],parseDataAdded=!1,i,newSucc;for(succDepData=Ext.clone(succDepData),succDepData.Edited=!1,newSucc={ID:succDepData.DependencyID,SUSID:succDepData.SuccFormattedID,SUSName:succDepData.SuccUserStoryName,SPID:succDepData.SuccProjectID,Desc:succDepData.Description,CP:succDepData.Checkpoint,Sup:succDepData.Supported,A:succDepData.Assigned,REL:succDepData.ReleaseDate,REL_S:succDepData.ReleaseStartDate},i=0;dependencies.Succs.length>i;++i)if(dependencies.Succs[i].ID===newSucc.ID){dependencies.Succs[i]=newSucc,replaced=!0;break}if(replaced||dependencies.Succs.push(newSucc),userStoryRecord.data.Project.ObjectID===me.ProjectRecord.data.ObjectID){for(i=0;cacheSuccs.length>i;++i)if(dpds=cacheSuccs[i],dpds.DependencyID===succDepData.DependencyID&&dpds.FormattedID===succDepData.FormattedID){cacheSuccs[i]=succDepData,parseDataAdded=!0;break}parseDataAdded||cacheSuccs.push(succDepData)}return _.each(dependencies.Succs,function(succ){if(succ.A){for(i=0;succUSlist.length>i;++i)if(succUSlist[i].USID===succ.SUSID)return;succUSlist.push({USID:succ.SUSID,PID:succ.SPID})}}),me._syncCollection(userStoryRecord,succUSlist,[],"Successors").then(function(){return me._collectionSynced(userStoryRecord,"added succdep",succDepData,dependencies)})},_getOldAndNewUSRecords:function(depData){function loadOriginalParent(){me._loadUserStory(depData.ObjectID).then(function(oldUSRecord){newUSRecord=newUSRecord||oldUSRecord,deferred.resolve([oldUSRecord,newUSRecord])})}var me=this,tmpNewUSRecord=me.UserStoryStore.findExactRecord("FormattedID",depData.FormattedID),tmpNewUSData=tmpNewUSRecord&&tmpNewUSRecord.data,newUSRecord,deferred=Q.defer();return tmpNewUSData&&tmpNewUSData.ObjectID!=depData.ObjectID?me._loadUserStory(tmpNewUSData.ObjectID).then(function(usRecord){newUSRecord=usRecord,loadOriginalParent()}):loadOriginalParent(),deferred.promise},_getRealDepData:function(oldUSRecord,depData,type){var me=this,realDepsData;return realDepsData=oldUSRecord?me._parseDependenciesFromUserStory(oldUSRecord)[type]:[],me._spliceDepFromList(depData.DependencyID,realDepsData)},_getTeamDepArrays:function(predDepData,realDepData){var me=this,addedTeams=[],removedTeams=[],updatedTeams=[],localTeams=predDepData.Predecessors,realTeams=realDepData?realDepData.Predecessors||[]:[];if(realDepData){Outer:for(var i=localTeams.length-1;i>=0;--i){for(var j=0;realTeams.length>j;++j)if(localTeams[i].TID===realTeams[j].TID){updatedTeams.push(realTeams.splice(j,1)[0]);continue Outer}addedTeams.push(localTeams[i])}removedTeams=realTeams}else addedTeams=predDepData.Predecessors;return{added:addedTeams,updated:updatedTeams,removed:removedTeams}},_getAddedTeamDepCallbacks:function(teamDeps,predDepData){var me=this,permissions=me.getContext().getPermissions(),promises=[];return teamDeps.forEach(function(teamDepData){var project=me.ValidProjects[teamDepData.PID];permissions.isProjectEditor(project)?promises.push(me._loadRandomUserStoryFromReleaseTimeframe(project.data._ref,me.ReleaseRecord).then(function(us){return us?Q(function(){teamDepData.USID=us.data.FormattedID,teamDepData.USName=us.data.Name;var succDep={DependencyID:predDepData.DependencyID,SuccUserStoryName:predDepData.UserStoryName,SuccFormattedID:predDepData.FormattedID,SuccProjectID:me.ProjectRecord.data.ObjectID,UserStoryName:"",FormattedID:"",Description:predDepData.Description,Checkpoint:predDepData.Checkpoint,Supported:teamDepData.Sup,Assigned:!1,ReleaseStartDate:1*new Date(me.ReleaseRecord.data.ReleaseStartDate),ReleaseDate:1*new Date(me.ReleaseRecord.data.ReleaseDate),Edited:!1};return me._addSuccDep(us,succDep)}):Q.reject("Project "+project.data.Name+" has no user stories in this Release, cannot continue")})):promises.push(Q.reject("You lack permissions to modify project: "+project.data.Name))}),Q.all(promises)},_getUpdatedTeamDepCallbacks:function(teamDeps,predDepData){var me=this,permissions=me.getContext().getPermissions(),promises=[];return teamDeps.forEach(function(teamDepData){var project=me.ValidProjects[teamDepData.PID];permissions.isProjectEditor(project)?promises.push(me._loadUserStoryByFID(teamDepData.USID,project.data._ref).then(function(us){var succDep={DependencyID:predDepData.DependencyID,SuccUserStoryName:predDepData.UserStoryName,SuccFormattedID:predDepData.FormattedID,SuccProjectID:me.ProjectRecord.data.ObjectID,Description:predDepData.Description,Checkpoint:predDepData.Checkpoint,ReleaseStartDate:1*new Date(me.ReleaseRecord.data.ReleaseStartDate),ReleaseDate:1*new Date(me.ReleaseRecord.data.ReleaseDate),Supported:teamDepData.Sup,Edited:!1};return us?Q(function(){return succDep.UserStoryName=teamDepData.USName,succDep.FormattedID=teamDepData.USID,succDep.Assigned=teamDepData.A,me._addSuccDep(us,succDep)}):me._loadRandomUserStoryFromReleaseTimeframe(project.data._ref,me.ReleaseRecord).then(function(us){return us?Q(function(){return teamDepData.USID=us.data.FormattedID,teamDepData.USName=us.data.Name,teamDepData.A=!1,succDep.UserStoryName="",succDep.FormattedID="",succDep.Assigned=!1,me._addSuccDep(us,succDep)}):Q.reject("Project "+project.data.Name+" has no user stories in this Release, cannot continue")})})):promises.push(Q.reject("You lack permissions to modify project: "+project.data.Name))}),Q.all(promises)},_getRemovedTeamDepCallbacks:function(teamDeps,predDepData){var me=this,permissions=me.getContext().getPermissions(),promises=[];return teamDeps.forEach(function(teamDepData){var project=me.ValidProjects[teamDepData.PID];permissions.isProjectEditor(project)?promises.push(me._loadUserStoryByFID(teamDepData.USID,project.data._ref).then(function(us){return us?Q(function(){var succDepData={FormattedID:teamDepData.USID,DependencyID:predDepData.DependencyID};return me._removeSuccDep(us,succDepData)}):Q(function(){})})):promises.push(Q.reject("You lack permissions to modify project: "+project.data.Name))}),Q.all(promises)},_updateSuccessor:function(succDepData,newUSRecord){var me=this,permissions=me.getContext().getPermissions(),project=me.ValidProjects[succDepData.SuccProjectID];return permissions.isProjectEditor(project)?me._loadUserStoryByFID(succDepData.SuccFormattedID,project.data._ref).then(function(us){if(us){var deps=me._getDependencies(us),rppData=deps.Preds[succDepData.DependencyID];if(rppData){for(var predDepData={DependencyID:succDepData.DependencyID,FormattedID:us.data.FormattedID,UserStoryName:us.data.Name,Description:rppData.Desc,Checkpoint:rppData.CP,Status:rppData.Sta,Predecessors:rppData.Preds||[],Edited:!1},predecessors=predDepData.Predecessors,i=0;predecessors.length>i;++i)if(predecessors[i].PID==me.ProjectRecord.data.ObjectID)return predecessors[i].Sup=succDepData.Supported,predecessors[i].USID=newUSRecord.data.FormattedID,predecessors[i].USName=newUSRecord.data.Name,predecessors[i].A=succDepData.Assigned,me._addPredDep(us,predDepData);return Q.reject(["Successor removed this dependency."])}return Q.reject(["Successor removed this dependency."])}return Q.reject(["Successor UserStory has been deleted."])}):Q.reject("You lack permissions to modify project: "+project.data.Name)},_loadPreferences:function(){var me=this,deferred=Q.defer();return Rally.data.PreferenceManager.load({filterByUser:!0,filterByName:me._prefName,success:function(prefs){var appPrefs=prefs[me._prefName];try{appPrefs=JSON.parse(appPrefs)}catch(e){appPrefs={projs:{},refresh:30}}console.log("loaded prefs",appPrefs),deferred.resolve(appPrefs)},failure:deferred.reject}),deferred.promise},_savePreferences:function(prefs){var me=this,s={},deferred=Q.defer();return prefs={projs:prefs.projs,refresh:prefs.refresh},s[me._prefName]=JSON.stringify(prefs),console.log("saving prefs",prefs),Rally.data.PreferenceManager.update({filterByUser:!0,settings:s,success:deferred.resolve,failure:deferred.reject}),deferred.promise},_htmlEscape:function(str){return(str+"").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},_getDirtyType:function(localRecord,realData){var localData=localRecord.data;return realData?localData.Edited?"Edited":"Unchanged":localData.Edited?"New":"Deleted"},_isEditingTeamCommits:!1,_isEditingVelocity:!1,_isEditing:function(store){if(!store)return!1;for(var records=store.getRange(),i=0,len=records.length;len>i;++i)if(records[i].data.Edited)return!0;return!1},_showGrids:function(){var me=this;me._loadTeamCommitsGrid(),me._loadVelocityGrid(),me._loadSanityGrid(),me._loadRisksGrid(),me._loadDependenciesGrids()},_updateGrids:function(){var me=this,isEditingRisks=me._isEditing(me.CustomRisksStore),isEditingDeps=me._isEditing(me.CustomPredDepStore)||me._isEditing(me.CustomSuccDepStore);!me._isEditingVelocity&&me.IterationStore&&me.UserStoryStore&&me.CustomVelocityStore&&me.CustomVelocityStore.intelUpdate(),!me._isEditingTeamCommits&&me.FeatureStore&&me.UserStoryStore&&me.CustomTeamCommitsStore&&me.CustomTeamCommitsStore.intelUpdate(),!isEditingRisks&&me.FeatureStore&&(me._parseRisksData(),me._updateFColumnStores(),me.CustomRisksStore&&me.CustomRisksStore.intelUpdate()),!isEditingDeps&&me.UserStoryStore&&me.FeatureStore&&(me._parseDependenciesData(),me._updateUSColumnStores(),me.CustomPredDepStore&&me.CustomPredDepStore.intelUpdate(),me.CustomSuccDepStore&&me.CustomSuccDepStore.intelUpdate())},_reloadStores:function(){var me=this,isEditingRisks=me._isEditing(me.CustomRisksStore),isEditingDeps=me._isEditing(me.CustomPredDepStore)||me._isEditing(me.CustomSuccDepStore),promises=[];return me.SanityStores||promises.push(me._loadSanityStores()),me._isEditingVelocity||(me.IterationStore?promises.push(me._reloadStore(me.IterationStore)):promises.push(me._loadIterations())),me._isEditingTeamCommits||isEditingRisks||(me.FeatureStore?promises.push(me._reloadStore(me.FeatureStore)):promises.push(me._loadFeatures())),me._isEditingVelocity||me._isEditingTeamCommits||isEditingDeps||(me.UserStoryStore?promises.push(me._reloadStore(me.UserStoryStore)):promises.push(me._loadUserStories())),Q.all(promises)},_reloadEverything:function(){var me=this;me._isEditingTeamCommits=!1,me._isEditingVelocity=!1,me.UserStoryStore=void 0,me.FeatureStore=void 0,me.IterationStore=void 0,me.SanityStores=void 0,me.PredDepGrid=void 0,me.SuccDepGrid=void 0,me.RisksGrid=void 0,me.VelocityGrid=void 0,me.TeamCommitsGrid=void 0,me.CustomPredDepStore=void 0,me.CustomSuccDepStore=void 0,me.CustomRisksStore=void 0,me.CustomTeamCommitsStore=void 0,me.CustomVelocityStore=void 0,me.setLoading(!0);for(var toRemove=me.down("#tc_vel_box").next(),tmp;toRemove;)tmp=toRemove.next(),toRemove.up().remove(toRemove),toRemove=tmp;me.down("#tc_vel_box_left").removeAll(),me.down("#tc_vel_box_right").removeAll(),me.ReleasePicker||(me._loadReleasePicker(),me._loadTrainPicker(),me._loadRefreshIntervalCombo(),me._loadManualRefreshButton()),me._enqueue(function(unlockFunc){me._reloadStores().then(function(){me._updateGrids()}).then(function(){me.setLoading(!1),me._showGrids(),unlockFunc()}).fail(function(reason){me.setLoading(!1),me._alert("ERROR",reason),unlockFunc()}).done()})},_setLoadingMasks:function(){var me=this,t="Refreshing Data",isEditingRisks=me._isEditing(me.CustomRisksStore),isEditingDeps=me._isEditing(me.CustomPredDepStore)||me._isEditing(me.CustomSuccDepStore);me.TeamCommitsGrid&&!me._isEditingTeamCommits&&me.TeamCommitsGrid.setLoading(t),me.VelocityGrid&&!me._isEditingVelocity&&me.VelocityGrid.setLoading(t),me.RisksGrid&&!isEditingRisks&&me.RisksGrid.setLoading(t),me.PredDepGrid&&!isEditingDeps&&me.PredDepGrid.setLoading(t),me.SuccDepGrid&&!isEditingDeps&&me.SuccDepGrid.setLoading(t)},_removeLoadingMasks:function(){var me=this,isEditingRisks=me._isEditing(me.CustomRisksStore),isEditingDeps=me._isEditing(me.CustomPredDepStore)||me._isEditing(me.CustomSuccDepStore);me.TeamCommitsGrid&&!me._isEditingTeamCommits&&me.TeamCommitsGrid.setLoading(!1),me.VelocityGrid&&!me._isEditingVelocity&&me.VelocityGrid.setLoading(!1),me.RisksGrid&&!isEditingRisks&&me.RisksGrid.setLoading(!1),me.PredDepGrid&&!isEditingDeps&&me.PredDepGrid.setLoading(!1),me.SuccDepGrid&&!isEditingDeps&&me.SuccDepGrid.setLoading(!1)},_refreshDataFunc:function(){var me=this;
me._enqueue(function(unlockFunc){me._setLoadingMasks(),me._reloadStores().then(function(){me._updateGrids()}).then(function(){me._removeLoadingMasks(),unlockFunc()}).fail(function(reason){me._alert("ERROR",reason),me._removeLoadingMasks(),unlockFunc()}).done()})},_setRefreshInterval:function(){var me=this;me.RefreshInterval&&(clearInterval(me.RefreshInterval),me.RefreshInterval=void 0),"Off"!==me.AppPrefs.refresh&&(me.RefreshInterval=setInterval(function(){me._refreshDataFunc()},1e3*me.AppPrefs.refresh))},launch:function(){var me=this;me.setLoading(!0),me._initDisableResizeHandle(),me._initFixRallyDashboard(),me.getContext().getPermissions().isProjectEditor(me.getContext().getProject())?me._loadModels().then(function(){var scopeProject=me.getContext().getProject();return me._loadProject(scopeProject.ObjectID)}).then(function(scopeProjectRecord){return me.ProjectRecord=scopeProjectRecord,me._loadRootProject(scopeProjectRecord)}).then(function(rootProject){return me.RootProject=rootProject,me._loadValidProjects(rootProject)}).then(function(validProjects){me.ValidProjects=validProjects,me.ProjectNames=[];for(var projOID in validProjects)me.ProjectNames.push({Name:validProjects[projOID].data.Name});return me.ValidProjects[me.ProjectRecord.data.ObjectID]?me._loadPreferences():Q.reject("Please scope to a team that has members")}).then(function(appPrefs){return me.AppPrefs=appPrefs,me._loadAllTrains(me.RootProject)}).then(function(allTrainStore){var trainRecs=allTrainStore.data.items;me.AllTrainRecordsStore=allTrainStore,me.TrainNames=[];for(var i=0,len=trainRecs.length;len>i;++i)me.TrainNames[i]={Name:trainRecs[i].data.Name.split(" ART")[0]};return me._projectInWhichTrain(me.ProjectRecord)}).fail(function(error){return"Project not in a train"!==error?Q.reject(error):void 0}).then(function(trainRecord){if(trainRecord)me.TrainRecord=trainRecord;else{me.ProjectNotInTrain=!0;var pid=me.ProjectRecord.data.ObjectID;me.AppPrefs.projs[pid]&&me.AppPrefs.projs[pid].Train?(me.TrainRecord=me.AllTrainRecordsStore.findExactRecord("ObjectID",me.AppPrefs.projs[pid].Train),me.TrainRecord||(me.TrainRecord=me.AllTrainRecordsStore.first())):me.TrainRecord=me.AllTrainRecordsStore.first()}console.log("train loaded:",trainRecord);var threeWeeksAgo=1*new Date-18144e5;return me._loadReleasesAfterGivenDate(me.ProjectRecord,threeWeeksAgo)}).then(function(releaseStore){me.ReleaseStore=releaseStore;var currentRelease=me._getScopedRelease(me.ReleaseStore.data.items,me.ProjectRecord.data.ObjectID,me.AppPrefs);return currentRelease?(me.ReleaseRecord=currentRelease,me._workweekData=me._getWorkWeeksForDropdown(currentRelease.data.ReleaseStartDate,currentRelease.data.ReleaseDate),console.log("release loaded",currentRelease),me._setRefreshInterval(),me._reloadEverything(),void 0):Q.reject("This train has no releases.")}).fail(function(reason){me.setLoading(!1),me._alert("ERROR",reason||"")}).done():(me.setLoading(!1),me._alert("ERROR","You do not have permissions to edit this project"))},_releasePickerSelected:function(combo,records){var me=this,pid=me.ProjectRecord.data.ObjectID;me.ReleaseRecord.data.Name!==records[0].data.Name&&(me.setLoading(!0),me.ReleaseRecord=me.ReleaseStore.findExactRecord("Name",records[0].data.Name),me._workweekData=me._getWorkWeeksForDropdown(me.ReleaseRecord.data.ReleaseStartDate,me.ReleaseRecord.data.ReleaseDate),"object"!=typeof me.AppPrefs.projs[pid]&&(me.AppPrefs.projs[pid]={}),me.AppPrefs.projs[pid].Release=me.ReleaseRecord.data.ObjectID,me._savePreferences(me.AppPrefs).then(function(){me._reloadEverything()}).fail(function(reason){me._alert("ERROR",reason||""),me.setLoading(!1)}).done())},_loadReleasePicker:function(){var me=this;me.ReleasePicker=me.down("#navbox_left").add({xtype:"intelreleasepicker",padding:"0 10px 0 0",releases:me.ReleaseStore.data.items,currentRelease:me.ReleaseRecord,listeners:{change:function(combo,newval,oldval){0===newval.length&&combo.setValue(oldval)},select:me._releasePickerSelected.bind(me)}})},_trainPickerSelected:function(combo,records){var me=this,pid=me.ProjectRecord.data.ObjectID;0!==me.TrainRecord.data.Name.indexOf(records[0].data.Name)&&(me.setLoading(!0),me.TrainRecord=me.AllTrainRecordsStore.findRecord("Name",records[0].data.Name+" ART"),"object"!=typeof me.AppPrefs.projs[pid]&&(me.AppPrefs.projs[pid]={}),me.AppPrefs.projs[pid].Train=me.TrainRecord.data.ObjectID,me._savePreferences(me.AppPrefs).then(function(){me._reloadEverything()}).fail(function(reason){me._alert("ERROR",reason||""),me.setLoading(!1)}).done())},_loadTrainPicker:function(){var me=this;me.ProjectNotInTrain&&me.down("#navbox_left").add({xtype:"intelfixedcombo",width:240,labelWidth:40,store:Ext.create("Ext.data.Store",{fields:["Name"],sorters:[function(o1,o2){return o1.data.Name<o2.data.Name?-1:1}],data:me.TrainNames}),displayField:"Name",fieldLabel:"Train:",value:me.TrainRecord.data.Name.split(" ART")[0],listeners:{change:function(combo,newval,oldval){0===newval.length&&combo.setValue(oldval)},select:me._trainPickerSelected.bind(me)}})},_refreshComboSelected:function(combo,records){var me=this,rate=records[0].data.Rate;me.AppPrefs.refresh!==rate&&(me.AppPrefs.refresh=rate,me._setRefreshInterval(),me._savePreferences(me.AppPrefs))},_loadRefreshIntervalCombo:function(){var me=this;me.down("#navbox_right").add({xtype:"intelfixedcombo",store:Ext.create("Ext.data.Store",{fields:["Rate"],data:[{Rate:"Off"},{Rate:"10"},{Rate:"15"},{Rate:"30"},{Rate:"60"},{Rate:"120"}]}),displayField:"Rate",fieldLabel:"Auto-Refresh Rate (seconds):",value:me.AppPrefs.refresh,listeners:{change:function(combo,newval,oldval){0===newval.length&&combo.setValue(oldval)},select:me._refreshComboSelected.bind(me)}})},_loadManualRefreshButton:function(){var me=this;me.down("#navbox_right").add({xtype:"button",text:"Refresh Data",style:"margin: 5px 0 0 5px",width:100,listeners:{click:me._refreshDataFunc.bind(me)}})},_loadTeamCommitsGrid:function(){function teamCommitsFilter(r){return filterProduct&&r.data.Product!=filterProduct?!1:filterStatus&&r.data.Commitment!=filterStatus?!1:filterEnd&&1*me._roundDateDownToWeekStart(r.data.PlannedEnd)!=filterEnd?!1:!0}function filterTeamCommitsRowsByFn(fn){_.each(me.CustomTeamCommitsStore.getRange(),function(item,index){fn(item)?me.TeamCommitsGrid.view.removeRowCls(index,"hidden"):me.TeamCommitsGrid.view.addRowCls(index,"hidden")})}var me=this;me._TeamCommitsCountHash={},me._TeamCommitsEstimateHash={};var customTeamCommitsRecords=_.map(_.sortBy(me.FeatureStore.getRecords(),function(featureRecord){return featureRecord.data.DragAndDropRank}),function(featureRecord,index){var tc=me._getTeamCommit(featureRecord);return{Rank:index+1,Name:featureRecord.data.Name,Commitment:tc.Commitment||"Undecided",Objective:tc.Objective||"",Expected:tc.Expected||!1,FormattedID:featureRecord.data.FormattedID,ObjectID:featureRecord.data.ObjectID,Product:me.FeatureProductHash[featureRecord.data.ObjectID],PlannedEnd:1*new Date(featureRecord.data.PlannedEndDate)}});me.CustomTeamCommitsStore=Ext.create("Intel.data.FastStore",{data:customTeamCommitsRecords,model:"IntelTeamCommits",autoSync:!0,limit:1/0,proxy:{type:"fastsessionproxy",id:"TeamCommitsProxy"+Math.random()},intelUpdate:function(){var tcStore=me.CustomTeamCommitsStore,tcRecords=tcStore.getRange();tcStore.suspendEvents(!0),console.log("syncing teamCommits with features",tcRecords,me.FeatureStore.getRecords()),tcRecords.forEach(function(tcRecord){var featureRecord=me.FeatureStore.findExactRecord("ObjectID",tcRecord.data.ObjectID);if(featureRecord){var newVal=me._getTeamCommit(featureRecord);tcRecord.data.Commitment!=newVal.Commitment&&tcRecord.set("Commitment",newVal.Commitment||"Undecided"),tcRecord.data.Objective!=(newVal.Objective||"")&&tcRecord.set("Objective",newVal.Objective||""),tcRecord.data.Expected!=newVal.Expected&&tcRecord.set("Expected",newVal.Expected)}}),tcStore.resumeEvents()}});var filterProduct=null,filterStatus=null,filterEnd=null,columnCfgs=[{text:"#",dataIndex:"Rank",width:30,editor:!1,sortable:!0,draggable:!1,resizable:!1,tooltip:"Feature Rank",tooltipType:"title"},{text:"F#",dataIndex:"FormattedID",width:60,editor:!1,sortable:!0,draggable:!1,resizable:!1,renderer:function(FID,meta,record){var feature=me.FeatureStore.findExactRecord("FormattedID",FID);return record.data.Expected&&(meta.tdCls+=" manager-expected-cell"),feature.data.Project?'<a href="https://rally1.rallydev.com/#/'+feature.data.Project.ObjectID+"d/detail/portfolioitem/feature/"+feature.data.ObjectID+'" target="_blank">'+FID+"</a>":FID}},{text:"Feature",dataIndex:"Name",flex:1,editor:!1,draggable:!1,resizable:!1},{text:"Product",dataIndex:"Product",width:90,editor:!1,draggable:!1,resizable:!1,layout:"hbox",items:[{id:"team-commits-f-product",xtype:"intelfixedcombo",flex:1,store:Ext.create("Ext.data.Store",{fields:["Product"],data:[{Product:"All"}].concat(_.map(_.sortBy(_.union(_.values(me.FeatureProductHash)),function(p){return p}),function(p){return{Product:p}}))}),displayField:"Product",value:"All",listeners:{focus:function(combo){combo.expand()},select:function(combo,selected){filterProduct="All"==selected[0].data.Product?null:selected[0].data.Product,filterTeamCommitsRowsByFn(teamCommitsFilter)}}},{xtype:"container",width:5}]},{text:"Stories",dataIndex:"ObjectID",sortable:!0,editor:!1,draggable:!1,resizable:!1,doSort:function(direction){var ds=this.up("grid").getStore(),field=this.getSortParam();ds.sort({sorterFn:function(f1,f2){var diff=me._getStoryCount(f1.data.ObjectID)-me._getStoryCount(f2.data.ObjectID);return 0===diff?0:("ASC"==direction?1:-1)*(diff>0?1:-1)}})},width:70,renderer:function(oid){return me._getStoryCount(oid)}},{text:"Plan Estimate",dataIndex:"ObjectID",sortable:!0,editor:!1,draggable:!1,resizable:!1,doSort:function(direction){var ds=this.up("grid").getStore(),field=this.getSortParam();ds.sort({sorterFn:function(f1,f2){var diff=me._getStoriesEstimate(f1.data.ObjectID)-me._getStoriesEstimate(f2.data.ObjectID);return 0===diff?0:("ASC"==direction?1:-1)*(diff>0?1:-1)}})},width:70,renderer:function(oid){return me._getStoriesEstimate(oid)}},{text:"Planned End",dataIndex:"PlannedEnd",sortable:!0,editor:!1,draggable:!1,resizable:!1,width:100,renderer:function(ed){return ed?"ww"+me._getWorkweek(new Date(ed)):"-"},layout:"hbox",items:[{id:"team-commits-f-end",xtype:"intelfixedcombo",flex:1,store:Ext.create("Ext.data.Store",{model:"WorkweekDropdown",data:[{DateVal:0,Workweek:"All"}].concat(_.map(_.sortBy(_.union(_.map(me.FeatureStore.getRange(),function(feature){return 1*me._roundDateDownToWeekStart(feature.data.PlannedEndDate)})),function(date){return date}),function(date){return{DateVal:date,Workweek:"ww"+me._getWorkweek(date)}}))}),displayField:"Workweek",valueField:"DateVal",value:"All",listeners:{focus:function(combo){combo.expand()},select:function(combo,selected){filterEnd=0===selected[0].data.DateVal?null:selected[0].data.DateVal,filterTeamCommitsRowsByFn(teamCommitsFilter)}}},{xtype:"container",width:5}]},{dataIndex:"Commitment",text:"Status",width:100,tdCls:"intel-editor-cell",sortable:!0,draggable:!1,resizable:!1,editor:{xtype:"intelfixedcombo",store:Ext.create("Ext.data.Store",{fields:["Status"],data:[{Status:"Undecided"},{Status:"N/A"},{Status:"Committed"},{Status:"Not Committed"}]}),displayField:"Status"},layout:"hbox",items:[{id:"team-commits-f-status",xtype:"intelfixedcombo",flex:1,store:Ext.create("Ext.data.Store",{fields:["Status"],data:[{Status:"All"},{Status:"Undecided"},{Status:"N/A"},{Status:"Committed"},{Status:"Not Committed"}]}),displayField:"Status",value:"All",listeners:{focus:function(combo){combo.expand()},select:function(combo,selected){filterStatus="All"==selected[0].data.Status?null:selected[0].data.Status,filterTeamCommitsRowsByFn(teamCommitsFilter)}}},{xtype:"container",width:5}]},{text:"Objective",dataIndex:"Objective",flex:1,tdCls:"intel-editor-cell",editor:"inteltextarea",draggable:!1,resizable:!1,sortable:!1,renderer:function(val){return val||"-"}}];me.TeamCommitsGrid=me.down("#tc_vel_box_left").add({xtype:"rallygrid",header:{layout:"hbox",items:[{xtype:"text",cls:"grid-header-text",width:200,text:"TEAM COMMITS"},{xtype:"container",flex:1e3,layout:{type:"hbox",pack:"end"},items:[{xtype:"button",text:"Remove Filters",width:110,listeners:{click:function(){filterProduct=null,filterStatus=null,filterEnd=null,filterTeamCommitsRowsByFn(function(){return!0}),Ext.getCmp("team-commits-f-product").setValue("All"),Ext.getCmp("team-commits-f-status").setValue("All"),Ext.getCmp("team-commits-f-end").setValue("All")}}}]}]},height:410,padding:"0 20px 0 0",scroll:"vertical",columnCfgs:columnCfgs,disableSelection:!0,plugins:["fastcellediting"],viewConfig:{xtype:"scrolltableview",stripeRows:!0,preserveScrollOnRefresh:!0,getRowClass:function(tcRecord,index,rowParams,store){var val=tcRecord.data.Commitment||"Undecided",base=teamCommitsFilter(tcRecord)?"":"hidden ";return"N/A"==val?base+"grey-row":"Committed"==val?base+"green-row":"Not Committed"==val?base+"red-row":base}},listeners:{sortchange:function(){filterTeamCommitsRowsByFn(teamCommitsFilter)},beforeedit:function(){me._isEditingTeamCommits=!0},canceledit:function(){me._isEditingTeamCommits=!1},edit:function(editor,e){var grid=e.grid,tcRecord=e.record,field=e.field,value=e.value,originalValue=e.originalValue;if(value===originalValue)return me._isEditingTeamCommits=!1,void 0;if(!value)return tcRecord.set(field,originalValue),me._isEditingTeamCommits=!1,void 0;"Objective"===field&&(value=me._htmlEscape(value),tcRecord.set(field,value));var tc={Commitment:tcRecord.data.Commitment,Objective:tcRecord.data.Objective};me.TeamCommitsGrid.setLoading(!0),me._enqueue(function(unlockFunc){me._loadFeature(tcRecord.data.ObjectID).then(function(realFeature){return realFeature?me._setTeamCommit(realFeature,tc):(console.log("ERROR: realFeature not found, ObjectID: "+oid),void 0)}).fail(function(reason){me._alert("ERROR",reason)}).then(function(){me.TeamCommitsGrid.setLoading(!1),me._isEditingTeamCommits=!1,unlockFunc()}).done()})}},showRowActionsColumn:!1,showPagingToolbar:!1,enableEditing:!1,context:this.getContext(),store:me.CustomTeamCommitsStore})},_loadVelocityGrid:function(){var me=this,iterationGroups=_.groupBy(me.UserStoryStore.getRecords(),function(us){return us.data.Iteration?us.data.Iteration.Name:"__DELETE__"});delete iterationGroups.__DELETE__;var iterationGroupTotals=_.sortBy(_.map(me.IterationStore.getRecords(),function(iteration){var iName=iteration.data.Name;return{Name:iName,PlannedVelocity:iteration.data.PlannedVelocity||0,RealVelocity:_.reduce(iterationGroups[iName]||[],function(sum,us){return sum+us.data.PlanEstimate},0)}}),"Name");me.CustomVelocityStore=Ext.create("Intel.data.FastStore",{data:iterationGroupTotals,model:"IntelVelocity",autoSync:!0,limit:1/0,proxy:{type:"fastsessionproxy",id:"VelocityProxy"+Math.random()},intelUpdate:function(){var velStore=me.CustomVelocityStore,velRecords=velStore.getRange();velStore.suspendEvents(!0),console.log("syncing velocity with current iterations",velRecords,me.IterationStore.getRecords()),velRecords.forEach(function(velRecord){var iterationName=velRecord.data.Name,iteration=me.IterationStore.findExactRecord("Name",iterationName),newVal=iteration.data.PlannedVelocity||0;newVal!=velRecord.data.PlannedVelocity&&(velRecord.set("PlannedVelocity",iteration.data.PlannedVelocity||0),console.log("velocity record update",velRecord))}),velStore.resumeEvents()}});var columnCfgs=[{text:"Iteration",dataIndex:"Name",flex:1,editor:!1,draggable:!1,resizable:!1,sortable:!0,renderer:function(name,meta,velocityRecord){var iteration=me.IterationStore.findExactRecord("Name",name);if(iteration.data.Project){var pid=iteration.data.Project._ref.split("/project/")[1];return'<a href="https://rally1.rallydev.com/#/'+pid+"d/detail/iteration/"+iteration.data.ObjectID+'" target="_blank">'+name+"</a>"}return name}},{text:"Target Capacity",dataIndex:"PlannedVelocity",width:80,tdCls:"intel-editor-cell",editor:"textfield",draggable:!1,resizable:!1,sortable:!0,tooltip:"(Planned Velocity)",tooltipType:"title",renderer:function(val,meta,record){return meta.tdCls+=0===1*val?" red-cell":"",val}},{text:"Actual Load",dataIndex:"RealVelocity",width:80,editor:!1,draggable:!1,resizable:!1,sortable:!0,tooltip:"(Plan Estimate)",tooltipType:"title",renderer:function(realVel,meta,record){return meta.tdCls+=.9*record.data.PlannedVelocity>1*realVel?" yellow-cell":"",meta.tdCls+=0===1*realVel||1*realVel>1*record.data.PlannedVelocity?" red-cell":"",realVel}}],totalsColumnCfgs=[{flex:1,editor:!1,draggable:!1,resizable:!1,renderer:function(name,meta,velocityRecord){return"<b>TOTAL</b>"}},{width:80,editor:!1,draggable:!1,resizable:!1,renderer:function(val,meta,record){return _.reduce(me.IterationStore.getRecords(),function(sum,i){return sum+(i.data.PlannedVelocity||0)},0)}},{width:80,editor:!1,draggable:!1,resizable:!1,renderer:function(val,meta,record){var planned=_.reduce(me.IterationStore.getRecords(),function(sum,i){return sum+(i.data.PlannedVelocity||0)},0),real=_.reduce(me.IterationStore.getRecords(),function(bigSum,iteration){return bigSum+_.reduce(iterationGroups[iteration.data.Name]||[],function(sum,us){return sum+us.data.PlanEstimate},0)},0);return meta.tdCls+=.9*planned>real?" yellow-cell":"",meta.tdCls+=0===1*real||1*real>planned?" red-cell":"",real}}];me.VelocityGrid=me.down("#tc_vel_box_right").add({xtype:"rallygrid",title:"Velocity",showPagingToolbar:!1,showRowActionsColumn:!1,disableSelection:!0,viewConfig:{stripeRows:!0,preserveScrollOnRefresh:!0},listeners:{beforeedit:function(editor,e){return me._isEditingVelocity=!0,!0},canceledit:function(){me._isEditingVelocity=!1},edit:function(editor,e){var grid=e.grid,velocityRecord=e.record,value=e.value,originalValue=e.originalValue;if(0===value.length||isNaN(value)||0>1*value||1*value===1*originalValue)return velocityRecord.set("PlannedVelocity",originalValue),me._isEditingVelocity=!1,void 0;value=1*value||0;var iterationName=velocityRecord.data.Name,iteration=me.IterationStore.findExactRecord("Name",iterationName);iteration.set("PlannedVelocity",value),me.VelocityGrid.setLoading(!0),iteration.save({callback:function(record,operation,success){success?velocityRecord.set("PlannedVelocity",value):(me._alert("ERROR","Could not modify Iteration"),velocityRecord.set("PlannedVelocity",originalValue)),me._isEditingVelocity=!1,me.VelocityGrid.setLoading(!1),me.VelocityTotalsGrid.view.refreshNode(0)}})}},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{triggerEvent:"cellclick"})],enableEditing:!1,columnCfgs:columnCfgs,store:me.CustomVelocityStore}),me.VelocityTotalsGrid=me.down("#tc_vel_box_right").add({xtype:"rallygrid",showPagingToolbar:!1,showRowActionsColumn:!1,hideHeaders:!0,disableSelection:!0,viewConfig:{stripeRows:!1,preserveScrollOnRefresh:!0},enableEditing:!1,columnCfgs:totalsColumnCfgs,store:Ext.create("Ext.data.Store",{model:"IntelVelocity",data:[{Name:"",PlannedVelocity:0,RealVelocity:0}]})})},_loadSanityGrid:function(){var me=this,columnCfgs=[{dataIndex:"title",flex:1,renderer:function(val,meta){return meta.tdCls+=" sanity-name-cell","Unsized Stories"==val&&(meta.tdCls+=" green-bg-cell"),"Improperly Sized Stories"==val&&(meta.tdCls+=" aqua-bg-cell"),"Stories in Release without Iteration"==val&&(meta.tdCls+=" silver-bg-cell"),"Stories in Iteration not attached to Release"==val&&(meta.tdCls+=" orange-bg-cell"),"Stories with End Date past Feature End Date"==val&&(meta.tdCls+=" lime-bg-cell"),val}},{dataIndex:"userStories",width:30,renderer:function(val,meta){return meta.tdCls+="sanity-num-cell",meta.tdCls+=0===val.length?" green-cell":" red-cell",val.length}}];me.SanityGrid=me.down("#tc_vel_box_right").add({xtype:"rallygrid",header:{items:[{xtype:"container",html:'<a class="sanity-header" href="https://rally1.rallydev.com/#/'+me.ProjectRecord.data.ObjectID+'ud/custom/22859089715" target="_blank">DATA INTEGRITY</a>'}]},margin:"30px 0 0 0",showPagingToolbar:!1,showRowActionsColumn:!1,hideHeaders:!0,disableSelection:!0,viewConfig:{stripeRows:!1,preserveScrollOnRefresh:!0},enableEditing:!1,columnCfgs:columnCfgs,store:Ext.create("Ext.data.Store",{fields:[{name:"title",type:"string"},{name:"userStories",type:"auto"}],data:me.SanityStores})})},_loadRisksGrid:function(){function riskSorter(o1,o2){return o1.data.RiskID>o2.data.RiskID?-1:1}function riskGridFilter(r){return filterFID&&r.data.FormattedID!=filterFID?!1:filterName&&r.data.FeatureName!=filterName?!1:filterStatus&&r.data.Status!=filterStatus?!1:filterCP&&1*me._roundDateDownToWeekStart(r.data.Checkpoint)!=filterCP?!1:!0}function filterRisksRowsByFn(fn){_.each(me.CustomRisksStore.getRange(),function(item,index){fn(item)?me.RisksGrid.view.removeRowCls(index,"hidden"):me.RisksGrid.view.addRowCls(index,"hidden")})}function removeFilters(){filterFID=null,filterName=null,filterStatus=null,filterCP=null,filterRisksRowsByFn(function(){return!0}),Ext.getCmp("risk-f-fid").setValue("All"),Ext.getCmp("risk-f-name").setValue("All"),Ext.getCmp("risk-f-status").setValue("All"),Ext.getCmp("risk-f-cp").setValue("All")}function getFIDfilterOptions(){return[{FormattedID:"All"}].concat(_.map(_.sortBy(_.union(_.map(me.CustomRisksStore.getRange(),function(r){return r.data.FormattedID})),function(f){return f}),function(f){return{FormattedID:f}}))}function getNameFilterOptions(){return[{Name:"All"}].concat(_.map(_.sortBy(_.union(_.map(me.CustomRisksStore.getRange(),function(r){return r.data.FeatureName})),function(f){return f}),function(n){return{Name:n}}))}function getCPFilterOptions(){return[{DateVal:0,Workweek:"All"}].concat(_.map(_.sortBy(_.union(_.map(me.CustomRisksStore.getRange(),function(risk){return 1*me._roundDateDownToWeekStart(risk.data.Checkpoint)})),function(date){return date}),function(date){return{DateVal:date,Workweek:"ww"+me._getWorkweek(date)}}))}function updateFilterOptions(){var fidStore=Ext.getCmp("risk-f-fid").getStore(),nameStore=Ext.getCmp("risk-f-name").getStore(),cpStore=Ext.getCmp("risk-f-cp").getStore();fidStore.removeAll(),fidStore.add(getFIDfilterOptions()),nameStore.removeAll(),nameStore.add(getNameFilterOptions()),cpStore.removeAll(),cpStore.add(getCPFilterOptions())}var me=this;me.FeatureFIDStore=Ext.create("Ext.data.Store",{fields:["FormattedID"],data:_.map(me.FeatureStore.getRange(),function(f){return{FormattedID:f.data.FormattedID}}),sorters:{property:"FormattedID"}}),me.FeatureNameStore=Ext.create("Ext.data.Store",{fields:["Name"],data:_.map(me.FeatureStore.getRange(),function(f){return{Name:f.data.Name}}),sorters:{property:"Name"}}),me.CustomRisksStore=Ext.create("Intel.data.FastStore",{data:Ext.clone(me.RisksParsedData),autoSync:!0,model:"IntelRisk",limit:1/0,proxy:{type:"fastsessionproxy",id:"RiskProxy"+Math.random()},sorters:[riskSorter],intelUpdate:function(){var riskStore=me.CustomRisksStore,riskRecords=riskStore.getRange(),realRisksDatas=me.RisksParsedData.slice(0),remoteChanged=!1;console.log("syncing risks with current features",riskRecords,realRisksDatas),riskStore.suspendEvents(!0),_.each(riskRecords,function(riskRecord){var realRiskData=me._spliceRiskFromList(riskRecord.data.RiskID,realRisksDatas),dirtyType=me._getDirtyType(riskRecord,realRiskData),key;if("New"===dirtyType||"Edited"===dirtyType);else if("Deleted"==dirtyType)riskStore.remove(riskRecord);else{for(key in realRiskData)if(!_.isEqual(riskRecord.get(key),realRiskData[key])){remoteChanged=!0;break}if(remoteChanged){riskRecord.beginEdit();for(key in realRiskData)riskRecord.set(key,realRiskData[key]);riskRecord.endEdit()}}}),realRisksDatas.forEach(function(realRiskData){console.log("adding real risk",realRiskData),riskStore.add(Ext.create("IntelRisk",Ext.clone(realRiskData)))}),riskStore.resumeEvents()}});var defaultRenderer=function(val){return val||"-"},filterFID=null,filterName=null,filterStatus=null,filterCP=null,columnCfgs=[{text:"F#",dataIndex:"FormattedID",tdCls:"intel-editor-cell",width:80,editor:{xtype:"intelcombobox",width:80,store:me.FeatureFIDStore,displayField:"FormattedID"},resizable:!1,draggable:!1,sortable:!0,renderer:defaultRenderer,layout:"hbox",items:[{id:"risk-f-fid",xtype:"intelcombobox",flex:1,store:Ext.create("Ext.data.Store",{fields:["FormattedID"],data:getFIDfilterOptions()}),displayField:"FormattedID",value:"All",listeners:{select:function(combo,selected){filterFID="All"==selected[0].data.FormattedID?null:selected[0].data.FormattedID,filterRisksRowsByFn(riskGridFilter)}}},{xtype:"container",width:5}]},{text:"Feature",dataIndex:"FeatureName",tdCls:"intel-editor-cell",flex:1,editor:{xtype:"intelcombobox",store:me.FeatureNameStore,displayField:"Name"},resizable:!1,draggable:!1,sortable:!0,renderer:defaultRenderer,layout:"hbox",items:[{id:"risk-f-name",xtype:"intelcombobox",flex:1,store:Ext.create("Ext.data.Store",{fields:["Name"],data:getNameFilterOptions()}),displayField:"Name",value:"All",listeners:{select:function(combo,selected){filterName="All"==selected[0].data.Name?null:selected[0].data.Name,filterRisksRowsByFn(riskGridFilter)}}},{xtype:"container",width:5}]},{text:"Risk Description (If This...)",dataIndex:"Description",tdCls:"intel-editor-cell",flex:1,editor:"inteltextarea",resizable:!1,draggable:!1,sortable:!1,renderer:defaultRenderer},{text:"Impact (Then this...)",dataIndex:"Impact",tdCls:"intel-editor-cell",flex:1,resizable:!1,draggable:!1,sortable:!1,editor:"inteltextarea",renderer:defaultRenderer},{text:"Mitigation Plan",dataIndex:"MitigationPlan",tdCls:"intel-editor-cell",flex:1,resizable:!1,draggable:!1,sortable:!1,editor:"inteltextarea",renderer:defaultRenderer},{text:"Status",dataIndex:"Status",tdCls:"intel-editor-cell",width:100,tooltip:"(ROAM)",tooltipType:"title",editor:{xtype:"intelfixedcombo",store:Ext.create("Ext.data.Store",{fields:["Status"],data:[{Status:"Undefined"},{Status:"Resolved"},{Status:"Owned"},{Status:"Accepted"},{Status:"Mitigated"}]}),displayField:"Status"},resizable:!1,draggable:!1,sortable:!0,renderer:function(val,meta){return meta.tdCls+="Undefined"===val?" red-cell":"",val||"-"},layout:"hbox",items:[{id:"risk-f-status",xtype:"intelfixedcombo",flex:1,store:Ext.create("Ext.data.Store",{fields:["Status"],data:[{Status:"All"},{Status:"Undefined"},{Status:"Resolved"},{Status:"Owned"},{Status:"Accepted"},{Status:"Mitigated"}]}),displayField:"Status",value:"All",listeners:{focus:function(combo){combo.expand()},select:function(combo,selected){filterStatus="All"==selected[0].data.Status?null:selected[0].data.Status,filterRisksRowsByFn(riskGridFilter)}}},{xtype:"container",width:5}]},{text:"Contact",dataIndex:"Contact",tdCls:"intel-editor-cell",flex:1,editor:"inteltextarea",sortable:!1,resizable:!1,draggable:!1,renderer:defaultRenderer},{text:"Checkpoint",dataIndex:"Checkpoint",tdCls:"intel-editor-cell",width:90,resizable:!1,draggable:!1,editor:{xtype:"intelfixedcombo",width:80,store:Ext.create("Ext.data.Store",{model:"WorkweekDropdown",data:me._workweekData}),displayField:"Workweek",valueField:"DateVal"},sortable:!0,renderer:function(date){return date?"ww"+me._getWorkweek(date):"-"},layout:"hbox",items:[{id:"risk-f-cp",xtype:"intelfixedcombo",flex:1,store:Ext.create("Ext.data.Store",{model:"WorkweekDropdown",data:getCPFilterOptions()}),displayField:"Workweek",valueField:"DateVal",value:"All",listeners:{focus:function(combo){combo.expand()},select:function(combo,selected){filterCP=0===selected[0].data.DateVal?null:selected[0].data.DateVal,filterRisksRowsByFn(riskGridFilter)}}},{xtype:"container",width:5}]},{text:"",width:30,xtype:"fastgridcolumn",tdCls:"iconCell",resizable:!1,draggable:!1,renderer:function(value,meta,riskRecord){var realRiskData=me._spliceRiskFromList(riskRecord.data.RiskID,me.RisksParsedData.slice(0)),dirtyType=me._getDirtyType(riskRecord,realRiskData);if("Edited"===dirtyType)return meta.tdAttr='title="Undo"',{xtype:"container",width:20,cls:"undo-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){var realRiskData=me._spliceRiskFromList(riskRecord.data.RiskID,me.RisksParsedData.slice(0));riskRecord.beginEdit();for(var key in realRiskData)riskRecord.set(key,realRiskData[key]);riskRecord.endEdit(),updateFilterOptions()}}}}}},{text:"",xtype:"fastgridcolumn",tdCls:"iconCell",width:30,resizable:!1,draggable:!1,renderer:function(value,meta,riskRecord){var realRiskData=me._spliceRiskFromList(riskRecord.data.RiskID,me.RisksParsedData.slice(0)),dirtyType=me._getDirtyType(riskRecord,realRiskData);if("New"===dirtyType||"Edited"===dirtyType)return meta.tdAttr='title="Save Risk"',{xtype:"container",width:20,cls:"save-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){return riskRecord.data.FormattedID&&riskRecord.data.FeatureName?riskRecord.data.Checkpoint?riskRecord.data.Description?riskRecord.data.Impact?riskRecord.data.Status?riskRecord.data.Contact?(me.RisksGrid.setLoading(!0),me._enqueue(function(unlockFunc){var riskRecordData=riskRecord.data,tmpNewFeatureRecord=me.FeatureStore.findExactRecord("FormattedID",riskRecordData.FormattedID),newFeatureRecord;Q(tmpNewFeatureRecord.data.ObjectID!=riskRecord.data.ObjectID?me._loadFeature(tmpNewFeatureRecord.data.ObjectID).then(function(featureRecord){newFeatureRecord=featureRecord}):null).then(function(){return me._loadFeature(riskRecord.data.ObjectID).then(function(oldFeatureRecord){return newFeatureRecord=newFeatureRecord||oldFeatureRecord,Q(oldFeatureRecord&&function(){var oldRealRisksData=me._parseRisksFromFeature(oldFeatureRecord),oldRealRiskData=me._spliceRiskFromList(riskRecordData.RiskID,oldRealRisksData);return oldRealRiskData&&oldFeatureRecord.data.ObjectID!==newFeatureRecord.data.ObjectID?me._removeRisk(oldFeatureRecord,oldRealRiskData):void 0}()).then(function(){return me._addRisk(newFeatureRecord,riskRecordData)}).then(function(){riskRecord.beginEdit(),riskRecord.set("Edited",!1),riskRecord.set("ObjectID",newFeatureRecord.data.ObjectID),riskRecord.endEdit()})})}).fail(function(reason){me._alert("ERROR:",reason)}).then(function(){me.RisksGrid.setLoading(!1),updateFilterOptions(),unlockFunc()}).done()}),void 0):(me._alert("ERROR","You must set the Contact for this risk"),void 0):(me._alert("ERROR","You must set the Status for this risk"),void 0):(me._alert("ERROR","You must set the Impact for this risk"),void 0):(me._alert("ERROR","You must set the Description for this risk"),void 0):(me._alert("ERROR","You must set the Checkpoint for this risk"),void 0):(me._alert("ERROR","You must set the Feature affected by this risk"),void 0)}}}}}},{text:"",width:30,xtype:"fastgridcolumn",tdCls:"iconCell",resizable:!1,draggable:!1,renderer:function(value,meta,riskRecord){return meta.tdAttr='title="Delete Risk"',{xtype:"container",width:20,cls:"delete-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){me._confirm("Confirm","Delete Risk?",function(msg){"yes"===msg.toLowerCase()&&(me.RisksGrid.setLoading(!0),me._enqueue(function(unlockFunc){me._loadFeature(riskRecord.data.ObjectID).then(function(oldFeatureRecord){return Q(oldFeatureRecord&&function(){var riskRecordData=riskRecord.data,oldRealRisksData=me._parseRisksFromFeature(oldFeatureRecord),oldRealRiskData=me._spliceRiskFromList(riskRecordData.RiskID,oldRealRisksData);return oldRealRiskData?me._removeRisk(oldFeatureRecord,oldRealRiskData):void 0}())}).fail(function(reason){me._alert("ERROR:",reason)}).then(function(){me.CustomRisksStore.remove(riskRecord),me.RisksGrid.setLoading(!1),updateFilterOptions(),unlockFunc()}).done()}))})}}}}}}];me.RisksGrid=me.add({xtype:"rallygrid",header:{layout:"hbox",items:[{xtype:"text",cls:"grid-header-text",width:200,text:"RISKS"},{xtype:"container",flex:1e3,layout:{type:"hbox",pack:"end"},items:[{xtype:"button",text:"+ Add Risk",width:80,margin:"0 10 0 0",listeners:{click:function(){if(me.FeatureStore.first()){if(me.CustomRisksStore){removeFilters();var model=Ext.create("IntelRisk",{RiskID:1*new Date+""+(100*Math.random()>>0),ObjectID:"",FormattedID:"",FeatureName:"",Description:"",Impact:"",MitigationPlan:"",Urgency:"",Status:"",Contact:"",Checkpoint:"",Edited:!0});me.CustomRisksStore.insert(0,[model]),me.RisksGrid.view.getEl().setScrollTop(0),me.RisksGrid.getSelectionModel().select(model)
}}else me._alert("ERROR","No Features for this Release!")}}},{xtype:"button",text:"Remove Filters",width:110,listeners:{click:removeFilters}}]}]},height:360,margin:"40 10 0 10",scroll:"vertical",columnCfgs:columnCfgs,disableSelection:!0,plugins:["fastcellediting"],viewConfig:{xtype:"scrolltableview",stripeRows:!0,preserveScrollOnRefresh:!0,getRowClass:function(item){return"intel-row-35px"+(riskGridFilter(item)?"":" hidden")}},listeners:{sortchange:function(){filterRisksRowsByFn(riskGridFilter)},edit:function(editor,e){var grid=e.grid,risksRecord=e.record,field=e.field,value=e.value,originalValue=e.originalValue;if(value!==originalValue){if(!value&&"MitigationPlan"!=field)return risksRecord.set(field,originalValue),void 0;["Description","Impact","Contact","MitigationPlan"].indexOf(field)>-1&&(value=me._htmlEscape(value),risksRecord.set(field,value));var previousEdit=risksRecord.data.Edited;risksRecord.set("Edited",!0);var featureRecord;"FeatureName"===field?(featureRecord=me.FeatureStore.findExactRecord("Name",value),featureRecord?risksRecord.set("FormattedID",featureRecord.data.FormattedID):(risksRecord.set("FeatureName",originalValue),risksRecord.set("Edited",previousEdit))):"FormattedID"===field&&(featureRecord=me.FeatureStore.findExactRecord("FormattedID",value),featureRecord?risksRecord.set("FeatureName",featureRecord.data.Name):(risksRecord.set("FormattedID",originalValue),risksRecord.set("Edited",previousEdit))),updateFilterOptions()}}},showRowActionsColumn:!1,showPagingToolbar:!1,enableEditing:!1,store:me.CustomRisksStore})},_loadDependenciesGrids:function(){function depSorter(o1,o2){return o1.data.DependencyID>o2.data.DependencyID?-1:1}function depTeamSorter(o1,o2){return o1.data.TID>o2.data.TID?-1:1}function predDepGridFilter(r){return filterFIDPred&&r.data.FormattedID!=filterFIDPred?!1:filterNamePred&&r.data.UserStoryName!=filterNamePred?!1:filterNeededByPred&&1*me._roundDateDownToWeekStart(r.data.Checkpoint)!=filterNeededByPred?!1:!0}function filterPredDepRowsByFn(fn){_.each(me.CustomPredDepStore.getRange(),function(item,index){fn(item)?me.PredDepGrid.view.removeRowCls(index,"hidden"):me.PredDepGrid.view.addRowCls(index,"hidden")})}function removePredFilters(){filterFIDPred=null,filterNamePred=null,filterNeededByPred=null,filterPredDepRowsByFn(function(){return!0}),Ext.getCmp("pred-dep-f-fid").setValue("All"),Ext.getCmp("pred-dep-f-name").setValue("All"),Ext.getCmp("pred-dep-f-needed-by").setValue("All")}function getPredFIDfilterOptions(){return[{FormattedID:"All"}].concat(_.map(_.sortBy(_.union(_.map(me.CustomPredDepStore.getRange(),function(r){return r.data.FormattedID})),function(f){return f}),function(f){return{FormattedID:f}}))}function getPredNameFilterOptions(){return[{Name:"All"}].concat(_.map(_.sortBy(_.union(_.map(me.CustomPredDepStore.getRange(),function(r){return r.data.UserStoryName})),function(f){return f}),function(n){return{Name:n}}))}function getPredNeededByFilterOptions(){return[{DateVal:0,Workweek:"All"}].concat(_.map(_.sortBy(_.union(_.map(me.CustomPredDepStore.getRange(),function(risk){return 1*me._roundDateDownToWeekStart(risk.data.Checkpoint)})),function(date){return date}),function(date){return{DateVal:date,Workweek:"ww"+me._getWorkweek(date)}}))}function updatePredFilterOptions(){var fidStore=Ext.getCmp("pred-dep-f-fid").getStore(),nameStore=Ext.getCmp("pred-dep-f-name").getStore(),cpStore=Ext.getCmp("pred-dep-f-needed-by").getStore();fidStore.removeAll(),fidStore.add(getPredFIDfilterOptions()),nameStore.removeAll(),nameStore.add(getPredNameFilterOptions()),cpStore.removeAll(),cpStore.add(getPredNeededByFilterOptions())}function succDepGridFilter(r){return filterReqTeamSucc&&me.ValidProjects[r.data.SuccProjectID].data.Name!=filterReqTeamSucc?!1:filterReqFIDSucc&&r.data.SuccFormattedID!=filterReqFIDSucc?!1:filterReqNameSucc&&r.data.SuccUserStoryName!=filterReqNameSucc?!1:filterNeededBySucc&&1*me._roundDateDownToWeekStart(r.data.Checkpoint)!=filterNeededBySucc?!1:filterSupSucc&&r.data.Supported!=filterSupSucc?!1:!filterFIDSucc||r.data.Supported&&r.data.FormattedID==filterFIDSucc?!filterNameSucc||r.data.Supported&&r.data.UserStoryName==filterNameSucc?!0:!1:!1}function filterSuccDepRowsByFn(fn){_.each(me.CustomSuccDepStore.getRange(),function(item,index){fn(item)?me.SuccDepGrid.view.removeRowCls(index,"hidden"):me.SuccDepGrid.view.addRowCls(index,"hidden")})}function removeSuccFilters(){filterReqTeamSucc=null,filterReqFIDSucc=null,filterReqNameSucc=null,filterNeededBySucc=null,filterSupSucc=null,filterFIDSucc=null,filterNameSucc=null,filterSuccDepRowsByFn(function(){return!0}),Ext.getCmp("succ-dep-f-team").setValue("All"),Ext.getCmp("succ-dep-f-req-fid").setValue("All"),Ext.getCmp("succ-dep-f-req-name").setValue("All"),Ext.getCmp("succ-dep-f-needed-by").setValue("All"),Ext.getCmp("succ-dep-f-sup").setValue("All"),Ext.getCmp("succ-dep-f-fid").setValue("All"),Ext.getCmp("succ-dep-f-name").setValue("All")}function getSuccReqTeamOptions(){return[{TeamName:"All"}].concat(_.map(_.sortBy(_.union(_.map(me.CustomSuccDepStore.getRange(),function(r){return me.ValidProjects[r.data.SuccProjectID].data.Name})),function(teamName){return teamName}),function(teamName){return{TeamName:teamName}}))}function getSuccReqFIDfilterOptions(){return[{FormattedID:"All"}].concat(_.map(_.sortBy(_.union(_.map(me.CustomSuccDepStore.getRange(),function(r){return r.data.SuccFormattedID})),function(f){return f}),function(f){return{FormattedID:f}}))}function getSuccReqNameFilterOptions(){return[{Name:"All"}].concat(_.map(_.sortBy(_.union(_.map(me.CustomSuccDepStore.getRange(),function(r){return r.data.SuccUserStoryName})),function(f){return f}),function(n){return{Name:n}}))}function getSuccNeededByFilterOptions(){return[{DateVal:0,Workweek:"All"}].concat(_.map(_.sortBy(_.union(_.map(me.CustomSuccDepStore.getRange(),function(risk){return 1*me._roundDateDownToWeekStart(risk.data.Checkpoint)})),function(date){return date}),function(date){return{DateVal:date,Workweek:"ww"+me._getWorkweek(date)}}))}function getSuccFIDfilterOptions(){return[{FormattedID:"All"}].concat(_.map(_.sortBy(_.filter(_.union(_.map(me.CustomSuccDepStore.getRange(),function(r){return"Yes"==r.data.Supported?r.data.FormattedID:""})),function(f){return""!==f}),function(f){return f}),function(f){return{FormattedID:f}}))}function getSuccNameFilterOptions(){return[{Name:"All"}].concat(_.map(_.sortBy(_.filter(_.union(_.map(me.CustomSuccDepStore.getRange(),function(r){return"Yes"==r.data.Supported?r.data.UserStoryName:""})),function(f){return""!==f}),function(f){return f}),function(n){return{Name:n}}))}function updateSuccFilterOptions(){var teamStore=Ext.getCmp("succ-dep-f-team").getStore(),reqFidStore=Ext.getCmp("succ-dep-f-req-fid").getStore(),reqNameStore=Ext.getCmp("succ-dep-f-req-name").getStore(),cpStore=Ext.getCmp("succ-dep-f-needed-by").getStore(),fidStore=Ext.getCmp("succ-dep-f-fid").getStore(),nameStore=Ext.getCmp("succ-dep-f-name").getStore();teamStore.removeAll(),teamStore.add(getSuccReqTeamOptions()),reqFidStore.removeAll(),reqFidStore.add(getSuccReqFIDfilterOptions()),reqNameStore.removeAll(),reqNameStore.add(getSuccReqNameFilterOptions()),cpStore.removeAll(),cpStore.add(getSuccNeededByFilterOptions()),fidStore.removeAll(),fidStore.add(getSuccFIDfilterOptions()),nameStore.removeAll(),nameStore.add(getSuccNameFilterOptions())}var me=this;me.UserStoryFIDStore=Ext.create("Ext.data.Store",{fields:["FormattedID"],data:_.map(me.DependenciesReleaseUserStories,function(usr){return{FormattedID:usr.data.FormattedID}}),sorters:{property:"FormattedID"}}),me.UserStoryNameStore=Ext.create("Ext.data.Store",{fields:["Name"],data:_.map(me.DependenciesReleaseUserStories,function(usr){return{Name:usr.data.Name}}),sorters:{property:"Name"}}),me.PredDepTeamStores={},me.PredDepContainers={},me.CustomPredDepStore=Ext.create("Intel.data.FastStore",{data:Ext.clone(me.DependenciesParsedData.Predecessors),autoSync:!0,model:"IntelPredDep",limit:1/0,proxy:{type:"fastsessionproxy",id:"PredDepProxy"+Math.random()},sorters:[depSorter],intelUpdate:function(){var predDepStore=me.CustomPredDepStore,predDepRecs=predDepStore.getRange(),realPredDepsData=me.DependenciesParsedData.Predecessors.slice();console.log("syncing predDeps with current userStories",predDepRecs,realPredDepsData),predDepStore.suspendEvents(!0),_.each(predDepRecs,function(depRec){var depID=depRec.data.DependencyID,realDep=me._spliceDepFromList(depID,realPredDepsData),dirtyType=me._getDirtyType(depRec,realDep),teamStore=me.PredDepTeamStores[depID],teamCont=me.PredDepContainers[depID],key;if("New"===dirtyType||"Edited"===dirtyType);else if("Deleted"==dirtyType)predDepStore.remove(depRec),teamStore&&(me.PredDepTeamStores[depID]=void 0),teamCont&&(me.PredDepContainers[depID]=void 0);else if(_.isEqual(depRec.data.Predecessors,realDep.Predecessors)){depRec.beginEdit();for(key in realDep)"Predecessors"!==key&&realDep[key]!=depRec.get(key)&&depRec.set(key,realDep[key]);depRec.endEdit()}else teamCont&&(me.PredDepContainers[depID].destroy(),me.PredDepContainers[depID]=void 0),predDepStore.remove(depRec),predDepStore.add(Ext.create("IntelPredDep",Ext.clone(realDep))),teamStore&&teamStore.intelUpdate();var preds=depRec.data.Predecessors;preds.length||(depRec.set("Predecessors",[me._newTeamDep()]),teamStore&&teamStore.intelUpdate())}),realPredDepsData.forEach(function(realDep){console.log("adding predDep",realDep),predDepStore.add(Ext.create("IntelPredDep",Ext.clone(realDep)));var depID=realDep.DependencyID,teamStore=me.PredDepTeamStores[depID];teamStore&&teamStore.intelUpdate()}),predDepStore.resumeEvents()}});var defaultRenderer=function(val){return val||"-"},filterFIDPred=null,filterNamePred=null,filterNeededByPred=null,predDepColumnCfgs=[{text:"US#",dataIndex:"FormattedID",width:90,resizable:!1,draggable:!1,sortable:!0,tdCls:"intel-editor-cell",editor:{xtype:"intelcombobox",width:80,store:me.UserStoryFIDStore,displayField:"FormattedID"},renderer:defaultRenderer,layout:"hbox",items:[{id:"pred-dep-f-fid",xtype:"intelcombobox",flex:1,store:Ext.create("Ext.data.Store",{fields:["FormattedID"],data:getPredFIDfilterOptions()}),displayField:"FormattedID",value:"All",listeners:{select:function(combo,selected){filterFIDPred="All"==selected[0].data.FormattedID?null:selected[0].data.FormattedID,filterPredDepRowsByFn(predDepGridFilter)}}},{xtype:"container",width:5}]},{text:"UserStory",dataIndex:"UserStoryName",flex:1,resizable:!1,draggable:!1,sortable:!0,tdCls:"intel-editor-cell",editor:{xtype:"intelcombobox",store:me.UserStoryNameStore,displayField:"Name"},renderer:defaultRenderer,layout:"hbox",items:[{id:"pred-dep-f-name",xtype:"intelcombobox",flex:1,store:Ext.create("Ext.data.Store",{fields:["Name"],data:getPredNameFilterOptions()}),displayField:"Name",value:"All",listeners:{select:function(combo,selected){filterNamePred="All"==selected[0].data.Name?null:selected[0].data.Name,filterPredDepRowsByFn(predDepGridFilter)}}},{xtype:"container",width:5}]},{text:"Dependency Description",dataIndex:"Description",flex:1,resizable:!1,draggable:!1,sortable:!1,tdCls:"intel-editor-cell",editor:"inteltextarea",renderer:defaultRenderer},{text:"Needed By",dataIndex:"Checkpoint",width:90,resizable:!1,draggable:!1,sortable:!0,tdCls:"intel-editor-cell",editor:{xtype:"intelfixedcombo",width:80,store:Ext.create("Ext.data.Store",{model:"WorkweekDropdown",data:me._workweekData}),displayField:"Workweek",valueField:"DateVal"},renderer:function(date){return date?"ww"+me._getWorkweek(date):"-"},layout:"hbox",items:[{id:"pred-dep-f-needed-by",xtype:"intelfixedcombo",flex:1,store:Ext.create("Ext.data.Store",{model:"WorkweekDropdown",data:getPredNeededByFilterOptions()}),displayField:"Workweek",valueField:"DateVal",value:"All",listeners:{focus:function(combo){combo.expand()},select:function(combo,selected){filterNeededByPred=0===selected[0].data.DateVal?null:selected[0].data.DateVal,filterPredDepRowsByFn(predDepGridFilter)}}},{xtype:"container",width:5}]},{text:"Teams Depended On",dataIndex:"DependencyID",xtype:"fastgridcolumn",html:'<div class="pred-dep-header" style="width:40px !important;"></div><div class="pred-dep-header" style="width:110px !important;">Team Name</div><div class="pred-dep-header" style="width:95px  !important;">Supported</div><div class="pred-dep-header" style="width:70px  !important;">US#</div><div class="pred-dep-header" style="width:130px !important;">User Story</div>',width:480,resizable:!1,draggable:!1,sortable:!1,renderer:function(depID){var predDepStore=me.CustomPredDepStore,predDepRecord=predDepStore.getAt(predDepStore.findExact("DependencyID",depID)),predecessors=predDepRecord.data.Predecessors;if(me.PredDepTeamStores[depID]||(me.PredDepTeamStores[depID]=Ext.create("Intel.data.FastStore",{model:"IntelDepTeam",data:predecessors,autoSync:!0,limit:1/0,proxy:{type:"fastsessionproxy",id:"TeamDep-"+depID+"-proxy"+Math.random()},sorters:[depTeamSorter],intelUpdate:function(){var predDepStore=me.CustomPredDepStore,depTeamStore=me.PredDepTeamStores[depID],depTeamRecords=depTeamStore.getRange(),predDepRecord=predDepStore.getAt(predDepStore.findExact("DependencyID",depID)),predecessors=predDepRecord.data.Predecessors.slice();depTeamStore.suspendEvents(!0);Outer:for(var i=0;depTeamRecords.length>i;++i){for(var depTeamRecord=depTeamRecords[i],realTeamDep,key,j=0;predecessors.length>j;++j)if(predecessors[j].TID===depTeamRecord.data.TID){realTeamDep=predecessors.splice(j,1)[0];for(key in realTeamDep)if(!_.isEqual(depTeamRecord.get(key),realTeamDep[key])){depTeamStore.remove(depTeamRecord),depTeamStore.add(Ext.create("IntelDepTeam",Ext.clone(realTeamDep)));continue Outer}}depTeamStore.remove(depTeamRecord)}if(predecessors.forEach(function(realTeamDep){depTeamStore.add(Ext.create("IntelDepTeam",realTeamDep))}),0===depTeamStore.getRange().length){var newItem=me._newTeamDep();depTeamStore.add(Ext.create("IntelDepTeam",newItem)),predDepRecord.data.Predecessors.push(newItem)}depTeamStore.resumeEvents()}})),me.PredDepContainers[depID])return me.PredDepContainers[depID];var defaultHandler={element:"el",fn:function(a){a.stopPropagation()}},teamColumnCfgs=[{dataIndex:"PID",width:115,resizable:!1,renderer:function(val,meta){var projectRecord=me.ValidProjects[val];return val&&projectRecord?projectRecord.data.Name:(meta.tdCls+="intel-editor-cell","-")},editor:{xtype:"intelcombobox",store:Ext.create("Ext.data.Store",{fields:["Name"],data:me.ProjectNames,sorters:{property:"Name"}}),displayField:"Name"}},{dataIndex:"Sup",width:80,resizable:!1,editor:!1,renderer:function(val,meta){return"No"==val?meta.tdCls="intel-not-supported-cell":"Yes"==val&&(meta.tdCls="intel-supported-cell"),val}},{dataIndex:"USID",width:75,resizable:!1,editor:!1,renderer:function(val,meta,depTeamRecord){return depTeamRecord.data.A?val:"-"}},{dataIndex:"USName",width:140,resizable:!1,editor:!1,renderer:function(val,meta,depTeamRecord){return depTeamRecord.data.A?val:"-"}},{resizable:!1,width:30,xtype:"fastgridcolumn",tdCls:"iconCell",renderer:function(val,meta,depTeamRecord){return meta.tdAttr='title="Delete Team"',{xtype:"container",width:20,cls:"minus-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){var predDepStore=me.CustomPredDepStore,predDepRecord=predDepStore.getAt(predDepStore.findExact("DependencyID",depID)),predecessors=Ext.clone(predDepRecord.data.Predecessors),teamStore=me.PredDepTeamStores[depID];teamStore.suspendEvents(!0);for(var i=0;predecessors.length>i;++i)if(predecessors[i].TID===depTeamRecord.data.TID){predecessors.splice(i,1);break}if(teamStore.remove(depTeamRecord),!predecessors.length){var newItem=me._newTeamDep();teamStore.add(Ext.create("IntelDepTeam",newItem)),predecessors.push(newItem)}predDepRecord.set("Edited",!0),predDepRecord.set("Predecessors",predecessors),teamStore.resumeEvents()}}}}}}];return{xtype:"container",layout:"hbox",bodyCls:"blend-in-grid",pack:"start",align:"stretch",border:!1,items:[{xtype:"container",width:20,cls:"plus-button intel-editor-cell",autoEl:{title:"Add Team"},listeners:{click:{element:"el",fn:function(){if(me.PredDepTeamStores[depID]){var predDepStore=me.CustomPredDepStore,predDepRecord=predDepStore.getAt(predDepStore.findExact("DependencyID",depID)),newItem=me._newTeamDep();me.PredDepTeamStores[depID].insert(0,[Ext.create("IntelDepTeam",newItem)]),predDepRecord.set("Predecessors",predDepRecord.data.Predecessors.concat([newItem])),predDepRecord.set("Edited",!0)}}}}},{xtype:"rallygrid",width:450,rowLines:!1,columnCfgs:teamColumnCfgs,disableSelection:!0,plugins:["fastcellediting"],viewConfig:{stripeRows:!1,getRowClass:function(teamDepRecord,index,rowParams,store){return teamDepRecord.data.PID?void 0:"intel-team-dep-row"}},listeners:{beforeedit:function(editor,e){return e.value?!1:void 0},edit:function(editor,e){var depTeamRecord=e.record,field=e.field,value=e.value,originalValue=e.originalValue,predDepStore=me.CustomPredDepStore,predDepRecord=predDepStore.getAt(predDepStore.findExact("DependencyID",depID)),predecessors=predDepRecord.data.Predecessors,i;if(value!==originalValue){if("PID"===field){var projectRecord=_.find(me.ValidProjects,function(vp){return vp.data.Name===value});if(!projectRecord)return depTeamRecord.set("PID",originalValue),void 0;for(i=0;predecessors.length>i;++i)if(predecessors[i].PID==projectRecord.data.ObjectID)return me._alert("ERROR",value+" already included in this dependency"),depTeamRecord.set("PID",originalValue),void 0;if(projectRecord.data.ObjectID===me.ProjectRecord.data.ObjectID)return me._alert("ERROR","You cannot depend on yourself"),depTeamRecord.set("PID",originalValue),void 0;depTeamRecord.set("PID",projectRecord.data.ObjectID)}for(i=0;predecessors.length>i;++i)if(predecessors[i].TID===depTeamRecord.data.TID){predecessors[i].PID=depTeamRecord.data.PID;break}predDepRecord.set("Edited",!0)}},selectionchange:function(){this.getSelectionModel().deselectAll()}},hideHeaders:!0,showRowActionsColumn:!1,scroll:!1,showPagingToolbar:!1,enableEditing:!1,context:me.getContext(),store:me.PredDepTeamStores[depID]}],listeners:{mousedown:defaultHandler,mousemove:defaultHandler,mouseout:defaultHandler,mouseover:defaultHandler,mouseup:defaultHandler,mousewheel:defaultHandler,scroll:defaultHandler,click:defaultHandler,dblclick:defaultHandler,contextmenu:defaultHandler,render:function(){me.PredDepContainers[depID]=this},resize:function(d,w,h,oldw,oldh){}}}}},{text:"",dataIndex:"Edited",xtype:"fastgridcolumn",width:30,resizable:!1,draggable:!1,tdCls:"iconCell",renderer:function(value,meta,predDepRecord){var realDepData=me._spliceDepFromList(predDepRecord.data.DependencyID,me.DependenciesParsedData.Predecessors.slice(0)),dirtyType=me._getDirtyType(predDepRecord,realDepData);return"Edited"!==dirtyType?"":(meta.tdAttr='title="Undo"',{xtype:"container",width:20,cls:"undo-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){var depID=predDepRecord.data.DependencyID,realDep=me._spliceDepFromList(depID,me.DependenciesParsedData.Predecessors.slice(0));predDepRecord.beginEdit();for(var key in realDep)"Predecessors"===key?predDepRecord.set(key,Ext.clone(realDep[key])||[me._newTeamDep()]):predDepRecord.set(key,realDep[key]);predDepRecord.endEdit(),me.PredDepTeamStores[depID].intelUpdate(),updatePredFilterOptions()}}}})}},{text:"",dataIndex:"Edited",xtype:"fastgridcolumn",width:30,resizable:!1,draggable:!1,tdCls:"iconCell",renderer:function(value,meta,predDepRecord){var realDepData=me._spliceDepFromList(predDepRecord.data.DependencyID,me.DependenciesParsedData.Predecessors.slice(0)),dirtyType=me._getDirtyType(predDepRecord,realDepData);if("New"===dirtyType)dirtyType="Save";else{if("Edited"!==dirtyType)return"";dirtyType="Save"}return meta.tdAttr='title="'+dirtyType+' Dependency"',{xtype:"container",width:20,cls:"save-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){if(!predDepRecord.data.FormattedID||!predDepRecord.data.UserStoryName)return me._alert("ERROR","A UserStory is not selected"),void 0;if(!predDepRecord.data.Description)return me._alert("ERROR","The description is empty"),void 0;if(!predDepRecord.data.Checkpoint)return me._alert("ERROR","Select When the dependency is needed by"),void 0;var predecessors=predDepRecord.data.Predecessors;return predecessors.length?_.find(predecessors,function(p){return""===p.PID})?(me._alert("ERROR","All Team Names must be valid"),void 0):(me.PredDepGrid.setLoading(!0),me._enqueue(function(unlockFunc){var predDepData=predDepRecord.data;me._getOldAndNewUSRecords(predDepData).then(function(records){var oldUSRecord=records[0],newUSRecord=records[1],realDepData=me._getRealDepData(oldUSRecord,predDepData,"Predecessors"),teamDeps=me._getTeamDepArrays(predDepData,realDepData),i,len;return me._getAddedTeamDepCallbacks(teamDeps.added,predDepData).then(function(addedCallbacks){return me._getUpdatedTeamDepCallbacks(teamDeps.updated,predDepData).then(function(updatedCallbacks){return me._getRemovedTeamDepCallbacks(teamDeps.removed,predDepData).then(function(removedCallbacks){var promise=Q();for(i=0,len=removedCallbacks.length;len>i;++i)promise=promise.then(removedCallbacks[i]);for(i=0,len=addedCallbacks.length;len>i;++i)promise=promise.then(addedCallbacks[i]);for(i=0,len=updatedCallbacks.length;len>i;++i)promise=promise.then(updatedCallbacks[i]);return promise=promise.then(function(){var newTeamDeps=teamDeps.added.concat(teamDeps.updated);predDepRecord.beginEdit(),predDepRecord.set("ObjectID",newUSRecord.data.ObjectID),predDepRecord.set("Predecessors",newTeamDeps)}),realDepData&&oldUSRecord.data.ObjectID!==newUSRecord.data.ObjectID&&(promise=promise.then(function(){return me._removePredDep(oldUSRecord,realDepData)})),promise.then(function(){return me._addPredDep(newUSRecord,predDepData)}).then(function(){predDepRecord.set("Edited",!1),predDepRecord.endEdit()}).fail(function(reason){return predDepRecord.set("Edited",!1),predDepRecord.endEdit(),Q.reject(reason)})})})})}).fail(function(reason){me._alert("ERROR:",reason)}).then(function(){updatePredFilterOptions(),me.PredDepGrid.setLoading(!1),unlockFunc()}).done()}),void 0):(me._alert("ERROR","You must specify a team you depend on"),void 0)}}}}}},{text:"",xtype:"fastgridcolumn",width:30,resizable:!1,draggable:!1,tdCls:"iconCell",renderer:function(value,meta,predDepRecord){return meta.tdAttr='title="Delete Dependency"',{xtype:"container",width:20,cls:"delete-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){me._confirm("Confirm","Delete Dependency?",function(msg){"yes"===msg.toLowerCase()&&(me.PredDepGrid.setLoading(!0),me._enqueue(function(unlockFunc){var predDepData=predDepRecord.data;me._getOldAndNewUSRecords(predDepData).then(function(records){var oldUSRecord=records[0],realDepData=me._getRealDepData(oldUSRecord,predDepData,"Predecessors"),teamDeps=me._getTeamDepArrays(predDepData,realDepData),depsToDelete=teamDeps.removed.concat(teamDeps.updated),i,len;return me._getRemovedTeamDepCallbacks(depsToDelete,predDepData).then(function(removedCallbacks){var promise=Q();for(i=0,len=removedCallbacks.length;len>i;++i)promise=promise.then(removedCallbacks[i]);return realDepData&&(promise=promise.then(function(){return me._removePredDep(oldUSRecord,realDepData)})),promise.then(function(){me.CustomPredDepStore.remove(predDepRecord)})})}).fail(function(reason){me._alert("ERROR",reason)}).then(function(){updatePredFilterOptions(),me.PredDepGrid.setLoading(!1),unlockFunc()}).done()}))})}}}}}}];me.PredDepGrid=me.add({xtype:"rallygrid",header:{layout:"hbox",items:[{xtype:"text",cls:"grid-header-text",width:400,text:"DEPENDENCIES WE HAVE ON OTHER TEAMS"},{xtype:"container",flex:1e3,layout:{type:"hbox",pack:"end"},items:[{xtype:"button",text:"+ Add Dependency",margin:"0 10 0 0",listeners:{click:function(){if(me.DependenciesReleaseUserStories.length){if(me.CustomPredDepStore){removePredFilters();var model=Ext.create("IntelPredDep",{DependencyID:1*new Date+""+(100*Math.random()>>0),ObjectID:"",FormattedID:"",UserStoryName:"",Description:"",Checkpoint:"",Predecessors:[me._newTeamDep()],Edited:!0});me.CustomPredDepStore.insert(0,[model]),me.PredDepGrid.view.getEl().setScrollTop(0)}}else me._alert("ERROR","No User Stories for this Release!")}}},{xtype:"button",text:"Remove Filters",width:110,listeners:{click:removePredFilters}}]}]},height:400,margin:"40 10 0 10",scroll:"vertical",columnCfgs:predDepColumnCfgs,disableSelection:!0,plugins:["fastcellediting"],viewConfig:{xtype:"scrolltableview",stripeRows:!0,preserveScrollOnRefresh:!0,getRowClass:function(predDepRecord){return predDepGridFilter(predDepRecord)?void 0:"hidden"}},listeners:{sortchange:function(){filterPredDepRowsByFn(predDepGridFilter)},edit:function(editor,e){var predDepRecord=e.record,field=e.field,value=e.value,originalValue=e.originalValue;if(value!==originalValue){if(!value)return predDepRecord.set(field,originalValue),void 0;"Description"===field&&(value=me._htmlEscape(value),predDepRecord.set(field,value));var previousEdit=predDepRecord.data.Edited;predDepRecord.set("Edited",!0);var userStoryRecord;"UserStoryName"===field?(userStoryRecord=_.find(me.DependenciesReleaseUserStories,function(us){return us.data.Name===value}),userStoryRecord?predDepRecord.set("FormattedID",userStoryRecord.data.FormattedID):(predDepRecord.set("UserStoryName",originalValue),predDepRecord.set("Edited",previousEdit))):"FormattedID"===field&&(userStoryRecord=_.find(me.DependenciesReleaseUserStories,function(us){return us.data.FormattedID===value}),userStoryRecord?predDepRecord.set("UserStoryName",userStoryRecord.data.Name):(predDepRecord.set("FormattedID",originalValue),predDepRecord.set("Edited",previousEdit))),updatePredFilterOptions()}}},showRowActionsColumn:!1,showPagingToolbar:!1,enableEditing:!1,store:me.CustomPredDepStore}),me.CustomSuccDepStore=Ext.create("Intel.data.FastStore",{data:Ext.clone(me.DependenciesParsedData.Successors.slice(0)),autoSync:!0,model:"IntelSuccDep",proxy:{type:"fastsessionproxy",id:"SuccDepProxy"+Math.random()},limit:1/0,sorters:[depSorter],intelUpdate:function(){var succDepStore=me.CustomSuccDepStore,customSuccDepRecs=succDepStore.getRange(),realSuccDepsData=me.DependenciesParsedData.Successors.slice(0),remoteChanged=!1,key;console.log("syncing succDeps with current userStories",customSuccDepRecs,realSuccDepsData),succDepStore.suspendEvents(!0);for(var i=0;customSuccDepRecs.length>i;++i){var depRec=customSuccDepRecs[i],depID=depRec.data.DependencyID,realDep=me._spliceDepFromList(depID,realSuccDepsData),dirtyType=me._getDirtyType(depRec,realDep);if("Edited"!==dirtyType)if("Deleted"===dirtyType||"New"===dirtyType)succDepStore.remove(depRec);else{for(key in realDep)if(!_.isEqual(depRec.get(key),realDep[key])){remoteChanged=!0;break}if(remoteChanged){depRec.beginEdit();for(key in realDep)depRec.set(key,realDep[key]);depRec.endEdit()}}}realSuccDepsData.forEach(function(realDep){console.log("adding succDep",realDep),succDepStore.add(Ext.create("IntelSuccDep",Ext.clone(realDep)))}),succDepStore.resumeEvents()}});var filterReqTeamSucc=null,filterReqFIDSucc=null,filterReqNameSucc=null,filterNeededBySucc=null,filterSupSucc=null,filterFIDSucc=null,filterNameSucc=null,succDepColumnCfgs=[{text:"Requested By",dataIndex:"SuccProjectID",width:160,resizable:!1,draggable:!1,sortable:!0,renderer:function(pid){return me.ValidProjects[pid].data.Name},layout:"hbox",items:[{id:"succ-dep-f-team",xtype:"intelcombobox",flex:1,store:Ext.create("Ext.data.Store",{fields:["TeamName"],data:getSuccReqTeamOptions()}),displayField:"TeamName",value:"All",listeners:{select:function(combo,selected){filterReqTeamSucc="All"==selected[0].data.TeamName?null:selected[0].data.TeamName,filterSuccDepRowsByFn(succDepGridFilter)}}},{xtype:"container",width:5}]},{text:"Req Team US#",dataIndex:"SuccFormattedID",width:90,resizable:!1,draggable:!1,sortable:!0,layout:"hbox",items:[{id:"succ-dep-f-req-fid",xtype:"intelcombobox",flex:1,store:Ext.create("Ext.data.Store",{fields:["FormattedID"],data:getSuccReqFIDfilterOptions()}),displayField:"FormattedID",value:"All",listeners:{select:function(combo,selected){filterReqFIDSucc="All"==selected[0].data.FormattedID?null:selected[0].data.FormattedID,filterSuccDepRowsByFn(succDepGridFilter)}}},{xtype:"container",width:5}]},{text:"Req Team UserStory",dataIndex:"SuccUserStoryName",flex:1,resizable:!1,draggable:!1,sortable:!0,layout:"hbox",items:[{id:"succ-dep-f-req-name",xtype:"intelcombobox",flex:1,store:Ext.create("Ext.data.Store",{fields:["Name"],data:getSuccReqNameFilterOptions()}),displayField:"Name",value:"All",listeners:{select:function(combo,selected){filterReqNameSucc="All"==selected[0].data.Name?null:selected[0].data.Name,filterSuccDepRowsByFn(succDepGridFilter)}}},{xtype:"container",width:5}]},{text:"Dependency Description",dataIndex:"Description",flex:1,resizable:!1,draggable:!1,editor:!1,sortable:!1},{text:"Needed By",dataIndex:"Checkpoint",width:80,resizable:!1,draggable:!1,editor:!1,sortable:!0,renderer:function(date){return date?"ww"+me._getWorkweek(date):"-"},layout:"hbox",items:[{id:"succ-dep-f-needed-by",xtype:"intelfixedcombo",flex:1,store:Ext.create("Ext.data.Store",{model:"WorkweekDropdown",data:getSuccNeededByFilterOptions()}),displayField:"Workweek",valueField:"DateVal",value:"All",listeners:{focus:function(combo){combo.expand()},select:function(combo,selected){filterNeededBySucc=0===selected[0].data.DateVal?null:selected[0].data.DateVal,filterSuccDepRowsByFn(succDepGridFilter)}}},{xtype:"container",width:5}]},{text:"Supported",dataIndex:"Supported",width:90,resizable:!1,draggable:!1,tdCls:"intel-editor-cell",editor:{xtype:"intelfixedcombo",width:80,store:Ext.create("Ext.data.Store",{fields:["Sup"],data:[{Sup:"Undefined"},{Sup:"Yes"},{Sup:"No"}]}),displayField:"Sup"},renderer:function(val,meta){return"No"==val?meta.tdCls="intel-not-supported-cell":"Yes"==val&&(meta.tdCls="intel-supported-cell"),val},sortable:!0,layout:"hbox",items:[{id:"succ-dep-f-sup",xtype:"intelfixedcombo",flex:1,store:Ext.create("Ext.data.Store",{fields:["Sup"],data:[{Sup:"All"},{Sup:"Yes"},{Sup:"No"},{Sup:"Undefined"}]}),displayField:"Sup",value:"All",listeners:{focus:function(combo){combo.expand()},select:function(combo,selected){filterSupSucc="All"===selected[0].data.Sup?null:selected[0].data.Sup,filterSuccDepRowsByFn(succDepGridFilter)}}},{xtype:"container",width:5}]},{text:"Sup US#",dataIndex:"FormattedID",tdCls:"intel-editor-cell",width:90,resizable:!1,draggable:!1,editor:{xtype:"intelcombobox",width:120,store:me.UserStoryFIDStore,displayField:"FormattedID"},sortable:!0,renderer:function(val){return val||"-"},layout:"hbox",items:[{id:"succ-dep-f-fid",xtype:"intelcombobox",flex:1,store:Ext.create("Ext.data.Store",{fields:["FormattedID"],data:getSuccFIDfilterOptions()}),displayField:"FormattedID",value:"All",listeners:{select:function(combo,selected){filterFIDSucc="All"==selected[0].data.FormattedID?null:selected[0].data.FormattedID,filterSuccDepRowsByFn(succDepGridFilter)}}},{xtype:"container",width:5}]},{text:"Sup UserStory",dataIndex:"UserStoryName",flex:1,resizable:!1,draggable:!1,tdCls:"intel-editor-cell",editor:{xtype:"intelcombobox",store:me.UserStoryNameStore,displayField:"Name"},sortable:!0,renderer:function(val){return val||"-"},layout:"hbox",items:[{id:"succ-dep-f-name",xtype:"intelcombobox",flex:1,store:Ext.create("Ext.data.Store",{fields:["Name"],data:getSuccNameFilterOptions()}),displayField:"Name",value:"All",listeners:{select:function(combo,selected){filterNameSucc="All"==selected[0].data.Name?null:selected[0].data.Name,filterSuccDepRowsByFn(succDepGridFilter)}}},{xtype:"container",width:5}]},{text:"",dataIndex:"Edited",width:30,xtype:"fastgridcolumn",tdCls:"iconCell",resizable:!1,draggable:!1,renderer:function(value,meta,succDepRecord){return succDepRecord.data.FormattedID?(meta.tdAttr='title="Remove User Story"',{xtype:"container",width:20,cls:"minus-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){succDepRecord.set("Edited",!0),succDepRecord.set("Assigned",!1),succDepRecord.set("FormattedID",""),succDepRecord.set("UserStoryName",""),updateSuccFilterOptions()}}}}):""
}},{text:"",dataIndex:"Edited",width:30,xtype:"fastgridcolumn",tdCls:"iconCell",resizable:!1,draggable:!1,renderer:function(value,meta,succDepRecord){var realDepData=me._spliceDepFromList(succDepRecord.data.DependencyID,me.DependenciesParsedData.Successors.slice(0)),dirtyType=me._getDirtyType(succDepRecord,realDepData);return"Edited"!==dirtyType?"":(meta.tdAttr='title="Undo"',{xtype:"container",width:20,cls:"undo-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){var depID=succDepRecord.data.DependencyID,realDep=me._spliceDepFromList(depID,me.DependenciesParsedData.Successors.slice(0));succDepRecord.beginEdit(!0);for(var key in realDep)succDepRecord.set(key,realDep[key]);succDepRecord.endEdit(),updateSuccFilterOptions()}}}})}},{text:"",width:30,xtype:"fastgridcolumn",tdCls:"iconCell",resizable:!1,draggable:!1,renderer:function(value,meta,succDepRecord){var realDepData=me._spliceDepFromList(succDepRecord.data.DependencyID,me.DependenciesParsedData.Successors.slice(0)),dirtyType=me._getDirtyType(succDepRecord,realDepData);return"Edited"!==dirtyType?"":(meta.tdAttr='title="Save Dependency"',{xtype:"container",width:20,cls:"save-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){return succDepRecord.data.Supported?(me.SuccDepGrid.setLoading(!0),me._enqueue(function(unlockFunc){var succDepData=succDepRecord.data,oldUSRecord,newUSRecord;me._getOldAndNewUSRecords(succDepData).then(function(records){oldUSRecord=records[0],newUSRecord=records[1];var realDepData=me._getRealDepData(oldUSRecord,succDepData,"Successors");return realDepData?(succDepData.ObjectID=newUSRecord.data.ObjectID,succDepData.SuccFormattedID=realDepData.SuccFormattedID,succDepData.SuccUserStoryName=realDepData.SuccUserStoryName,me._updateSuccessor(succDepData,newUSRecord).then(function(){return oldUSRecord.data.ObjectID!==newUSRecord.data.ObjectID?me._removeSuccDep(oldUSRecord,realDepData):void 0}).then(function(){return me._addSuccDep(newUSRecord,succDepData)}).then(function(){succDepRecord.set("Edited",!1)})):Q.reject(["Successor removed this dependency."])}).fail(function(reason){reason instanceof Array?(me._alert("ERROR",reason[0]+" Deleting this dependency now"),realDepData?me._removeSuccDep(oldUSRecord,realDepData).then(function(){me.CustomSuccDepStore.remove(succDepRecord)}).fail(function(reason){me._alert("ERROR",reason)}).done():me.CustomSuccDepStore.remove(succDepRecord)):me._alert("ERROR",reason)}).then(function(){updateSuccFilterOptions(),me.SuccDepGrid.setLoading(!1),unlockFunc()}).done()}),void 0):(me._alert("ERROR","You must set the Supported field."),void 0)}}}})}}];me.SuccDepGrid=me.add({xtype:"rallygrid",header:{layout:"hbox",items:[{xtype:"text",cls:"grid-header-text",width:400,text:"DEPENDENCIES OTHER TEAMS HAVE ON US"},{xtype:"container",flex:1e3,layout:{type:"hbox",pack:"end"},items:[{xtype:"button",text:"Remove Filters",width:110,listeners:{click:removeSuccFilters}}]}]},height:400,margin:"40 10 0 10",scroll:"vertical",columnCfgs:succDepColumnCfgs,disableSelection:!0,plugins:["fastcellediting"],viewConfig:{xtype:"scrolltableview",stripeRows:!0,preserveScrollOnRefresh:!0,getRowClass:function(succDepRecord){return succDepGridFilter(succDepRecord)?void 0:"hidden"}},listeners:{sortchange:function(){filterSuccDepRowsByFn(succDepGridFilter)},beforeedit:function(editor,e){var succDepRecord=e.record;return"Yes"!=succDepRecord.data.Supported&&"Supported"!=e.field?!1:void 0},edit:function(editor,e){var grid=e.grid,succDepRecord=e.record,field=e.field,value=e.value,originalValue=e.originalValue;if(value!=originalValue){if(!value)return succDepRecord.set(field,originalValue),void 0;var previousEdit=succDepRecord.data.Edited;succDepRecord.set("Edited",!0);var userStoryRecord;"UserStoryName"===field?(userStoryRecord=_.find(me.DependenciesReleaseUserStories,function(us){return us.data.Name===value}),userStoryRecord?(succDepRecord.set("FormattedID",userStoryRecord.data.FormattedID),succDepRecord.set("Assigned",!0)):(succDepRecord.set("UserStoryName",originalValue),succDepRecord.set("Edited",previousEdit))):"FormattedID"===field?(userStoryRecord=_.find(me.DependenciesReleaseUserStories,function(us){return us.data.FormattedID===value}),userStoryRecord?(succDepRecord.set("UserStoryName",userStoryRecord.data.Name),succDepRecord.set("Assigned",!0)):(succDepRecord.set("FormattedID",originalValue),succDepRecord.set("Edited",previousEdit))):"Supported"===field&&"Yes"!=value&&(succDepRecord.set("Assigned",!1),succDepRecord.set("FormattedID",""),succDepRecord.set("UserStoryName","")),updateSuccFilterOptions()}}},showRowActionsColumn:!1,showPagingToolbar:!1,enableEditing:!1,store:me.CustomSuccDepStore})}})})();

            Rally.launchApp('ProgramBoard', {
                name:"Program Board",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .x-grid-cell.manager-expected-cell{background-image:-o-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-moz-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-webkit-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-ms-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:linear-gradient(to right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-size:100% 30px;background-repeat:no-repeat}.x-grid-cell.manager-expected-cell-small{background-image:-o-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-moz-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-webkit-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-ms-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:linear-gradient(to right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-size:100% 20px;background-repeat:no-repeat}.x-grid-cell.manager-comment-cell-small{background-image:-o-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%) !important;background-image:-moz-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%) !important;background-image:-webkit-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%) !important;background-image:-ms-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%) !important;background-image:linear-gradient(to left top, rgba(0,0,0,0) 75%, #4c4cff 75%) !important;background-size:100% 20px;background-repeat:no-repeat}.x-grid-cell.manager-expected-comment-cell-small{background-image:-o-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%),-o-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-moz-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%),-moz-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-webkit-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%),-webkit-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-ms-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%),-ms-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:linear-gradient(to left top, rgba(0,0,0,0) 75%, #4c4cff 75%),linear-gradient(to right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-size:100% 20px;background-repeat:no-repeat}.x-grid-cell.intel-team-commits-RED{background-color:rgba(255,0,0,0.5) !important}.x-grid-row-selected .x-grid-cell.intel-team-commits-RED,.x-grid-row-over .x-grid-cell.intel-team-commits-RED{background-color:rgba(255,0,0,0.7) !important}.x-grid-cell.intel-team-commits-GREEN{background-color:rgba(0,255,0,0.5) !important}.x-grid-row-selected .x-grid-cell.intel-team-commits-GREEN,.x-grid-row-over .x-grid-cell.intel-team-commits-GREEN{background-color:rgba(0,255,0,0.7) !important}.x-grid-cell.intel-team-commits-GREY{background-color:rgba(183,183,183,0.5) !important}.x-grid-row-selected .x-grid-cell.intel-team-commits-GREY,.x-grid-row-over .x-grid-cell.intel-team-commits-GREY{background-color:rgba(183,183,183,0.7) !important}
    </style>
    <style type="text/css">
        .undo-button{background-image:url(http://png-4.findicons.com/files/icons/2315/default_icon/256/undo.png) !important}.delete-button{background-image:url(http://superadm.com/wp-content/uploads/2014/05/delete.png) !important}.save-button{background-image:url(http://www.iconpng.com/png/windows8_icons2/save.png) !important}.minus-button{background-image:url(http://www.pubzi.com/f/minus-sign.svg) !important}.plus-button{background-image:url(http://ilstream.com/images/plus-icon.gif) !important}.iconCell,.iconCell *{padding:0px !important;margin:0px !important}.undo-button,.delete-button,.save-button,.minus-button,.plus-button{left:0px !important;top:0px !important;height:16px !important;width:16px !important;background-size:16px !important;padding:0px !important;margin:7px 7px 0px 7px !important}
    </style>
    <style type="text/css">
        .x-grid-row.intel-row-35px>.x-grid-cell{height:35px !important}.x-grid-row.intel-row-45px>.x-grid-cell{height:45px !important}.x-grid-row.intel-row-80px>.x-grid-cell{height:80px !important}.x-grid-row.intel-row-115px>.x-grid-cell{height:115px !important}.x-grid-row.intel-row-150px>.x-grid-cell{height:150px !important}.x-grid-row.intel-row-185px>.x-grid-cell{height:185px !important}.x-grid-row.intel-row-220px>.x-grid-cell{height:220px !important}.x-grid-row.intel-row-255px>.x-grid-cell{height:255px !important}.x-grid-row.intel-row-290px>.x-grid-cell{height:290px !important}.x-grid-row.intel-row-325px>.x-grid-cell{height:325px !important}.x-grid-row.intel-row-360px>.x-grid-cell{height:360px !important}.pred-dep-header{display:inline-block !important;line-height:100% !important;font-weight:500 !important}
    </style>
    <style type="text/css">
        .x-grid-row .intel-editor-cell{cursor:pointer !important}.x-grid-row .intel-editor-cell *{cursor:pointer !important}.grey-row .x-grid-cell{background-color:rgba(224,224,224,0.15) !important}.grey-row.x-grid-row-selected .x-grid-cell{background-color:rgba(224,224,224,0.25) !important}.red-row .x-grid-cell{background-color:rgba(255,0,0,0.15) !important}.red-row.x-grid-row-selected .x-grid-cell{background-color:rgba(255,0,0,0.25) !important}.green-row .x-grid-cell{background-color:rgba(0,255,0,0.15) !important}.green-row.x-grid-row-selected .x-grid-cell{background-color:rgba(0,255,0,0.25) !important}.x-grid-row .green-cell.x-grid-cell{background-color:rgba(0,255,0,0.15) !important}.x-grid-row-selected .green-cell.x-grid-cell{background-color:rgba(0,255,0,0.25) !important}.x-grid-row .red-cell.x-grid-cell{background-color:rgba(255,0,0,0.15) !important}.x-grid-row-selected .red-cell.x-grid-cell{background-color:rgba(255,0,0,0.25) !important}.x-grid-row .yellow-cell.x-grid-cell{background-color:rgba(230,230,0,0.15) !important}.x-grid-row-selected .yellow-cell.x-grid-cell{background-color:rgba(230,230,0,0.25) !important}.x-grid-body .x-grid-body{background-color:rgba(0,0,0,0) !important}.rally-grid .x-grid-body{border-top:0 !important}.x-grid-row.intel-team-dep-row .x-grid-cell,.x-grid-row-hover.intel-team-dep-row.x-grid-cell,.x-grid-row-selected.intel-team-dep-row .x-grid-cell{background-color:rgba(0,0,0,0) !important}.x-grid-row .intel-not-supported-cell.x-grid-cell{background-color:rgba(255,0,0,0.15) !important}.x-grid-row-selected .intel-not-supported-cell.x-grid-cell{background-color:rgba(255,0,0,0.25) !important}.x-grid-row .intel-supported-cell.x-grid-cell{background-color:rgba(0,255,0,0.15) !important}.x-grid-row-selected .intel-supported-cell.x-grid-cell{background-color:rgba(0,255,0,0.25) !important}.hidden{display:none !important}.rally-grid .x-grid-header-ct .x-box-inner .x-box-inner{border-bottom:none !important}.grid-header-text{font-size:13px !important}.sanity-list-item{white-space:nowrap;margin:5px 0 0 0;overflow:hidden}.sanity-name-cell{border-left:1px solid black;border-top:1px solid black;border-bottom:1px solid black;border-bottom-left-radius:5px;border-top-left-radius:5px}.green-bg-cell{background-color:#2ECC40 !important}.aqua-bg-cell{background-color:#7FDBFF !important}.silver-bg-cell{background-color:#DDDDDD !important}.orange-bg-cell{background-color:#FF851B !important}.lime-bg-cell{background-color:#01FF70 !important}.sanity-num-cell{text-align:center;border:1px solid black}.sanity-header{font-size:13px}
    </style>
</head>
<body>
</body>
</html>
