<!DOCTYPE html>
<html>
<head>
    <title>Random App Name70221</title>

    <script type="text/javascript" src="/apps/2.0rc3/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("Skirtle.CTemplate",{extend:"Ext.XTemplate",statics:{AUTO_ID:0},copyDepth:10,cTpl:'<p id="ctemplate-{0}-{1}"></p>',isCTemplate:!0,constructor:function(){var me=this;me.callParent(arguments),me.id=++me.statics().AUTO_ID,me.reset()},copyValues:function(values,depth){var me=this,id,copy={},copyDepth=depth||me.copyDepth;return 1===copyDepth?values:Ext.isArray(values)?Ext.Array.map(values,function(value){return me.copyValues(value,copyDepth-1)}):Ext.isObject(values)?values.isComponent?(id=values.getId(),me.ids.push(id),Ext.String.format(me.cTpl,id,me.id)):(Ext.Object.each(values,function(key,value){copy[key]="$comp"===key?value:me.copyValues(value,copyDepth-1)}),copy):values},doInsert:function(){var ret=this.callParent(arguments);return this.injectComponents(),ret},doPolling:function(interval){var me=this;me.pollInterval=interval,me.pollId&&clearTimeout(me.pollId),me.pollId=Ext.defer(me.injectComponents,interval,me)},getPlaceholderEl:function(id){return Ext.get("ctemplate-"+id+"-"+this.id)},injectComponents:function(){for(var me=this,ids=me.ids,index=ids.length-1,id,cmp,placeholderEl;index>=0;--index)id=ids[index],cmp=Ext.getCmp(id),placeholderEl=me.getPlaceholderEl(id),(me.renderComponent(cmp,placeholderEl)||!cmp)&&(Ext.Array.splice(ids,index,1),placeholderEl&&placeholderEl.remove());ids.length&&me.doPolling(1.5*me.pollInterval)},overwrite:function(el){var dom,firstChild,ret;if(Ext.isIE)for(dom=Ext.getDom(el);dom.firstChild;)dom.removeChild(dom.firstChild);return ret=this.callParent(arguments),this.injectComponents(),ret},renderComponent:function(cmp,placeholderEl){if(cmp&&placeholderEl){var parent=placeholderEl.parent();return cmp.rendered?cmp.getEl().replace(placeholderEl):cmp.render(parent,placeholderEl),Ext.isIE6&&parent.repaint(),!0}return!1},reset:function(){var me=this;me.ids=[],me.pollId&&(clearTimeout(me.pollId),me.pollId=null)}},function(ctemplate){var apply=function(){var me=this,args=Ext.Array.slice(arguments);return args[0]=me.copyValues(args[0]),me.doPolling(10),me.callParent(args)};ctemplate.prototype.applyOut?ctemplate.override({applyOut:apply}):(ctemplate.override({applyTemplate:apply}),ctemplate.createAlias("apply","applyTemplate"))}),Ext.define("Skirtle.grid.column.Component",{alias:"widget.componentcolumn",extend:"Ext.grid.column.Column",requires:["Skirtle.CTemplate"],autoWidthComponents:!0,componentGC:!0,hasCustomRenderer:!0,lastFrameWidth:12,widthUpdateDelay:[10,400],constructor:function(cfg){var me=this;me.callParent(arguments),me.compIds=[],me.dataIndex=me.dataIndex||Ext.id(null,"cc-dataIndex-"),me.tpl=me.createTemplate(me.tpl),me.renderer=me.createRenderer(me.renderer),me.registerColumnListeners()},addRefOwner:function(child){var me=this,fn=me.refOwnerFn||(me.refOwnerFn=function(){return me});40200>me.extVersion?child.getBubbleTarget=fn:child.getRefOwner=fn},applyTemplate:function(data,value){return Ext.isDefined(value)&&(data[this.dataIndex]=value),this.tpl.apply(data)},beforeViewRefresh:function(){if(Ext.isIE)for(var ids=this.compIds,index=0,len=ids.length,item,el,parentEl;len>index;index++)(item=Ext.getCmp(ids[index]))&&(el=item.getEl())&&(el=el.dom)&&(parentEl=el.parentNode)&&parentEl.removeChild(el)},calculateFrameWidth:function(component){var el=component.getEl(),parentDiv=el&&el.parent(),parentTd=parentDiv&&parentDiv.parent();return parentTd?this.lastFrameWidth=parentDiv.getFrameWidth("lr")+parentTd.getFrameWidth("lr"):void 0},createRenderer:function(renderer){var me=this;return function(value,p,record){var data=Ext.apply({},record.data,record.getAssociatedData());return renderer&&(value=renderer.apply(this,arguments)),value=me.processValue(value),me.applyTemplate(data,value)}},createTemplate:function(tpl){return tpl&&tpl.isTemplate?tpl:Ext.create("Skirtle.CTemplate",tpl||["{",this.dataIndex,"}"])},destroyChild:function(child){child.destroy()},getRefItems:function(deep){for(var items=this.callParent([deep]),ids=this.compIds,index=0,len=ids.length,item;len>index;index++)item=Ext.getCmp(ids[index]),item&&(items.push(item),deep&&item.getRefItems&&items.push.apply(items,item.getRefItems(!0)));return items},onChildAfterRender:function(child){this.resizeChild(child)},onChildBoxReady:function(child){this.resizeChild(child,!1)},onChildDestroy:function(child){Ext.Array.remove(this.compIds,child.getId())},onChildResize:function(){this.redoScrollbars()},onColumnResize:function(column){column.resizeAll()},onColumnShow:function(column){column.resizeAll()},onColumnVisibilityChange:function(column){var items=column.getRefItems(),index=0,length=items.length,visible=!column.isHidden();for(Ext.suspendLayouts&&Ext.suspendLayouts();length>index;++index)items[index].setVisible(visible);Ext.resumeLayouts&&Ext.resumeLayouts(!0)},onDestroy:function(){Ext.destroy(this.getRefItems()),this.callParent()},onRender:function(){this.registerViewListeners(),this.callParent(arguments)},onViewChange:function(){var me=this,tpl=me.tpl;me.suspendResizing(),tpl.isCTemplate&&(tpl.injectComponents(),tpl.reset()),me.redoScrollbars(),me.resumeResizing(),me.performGC()},performGC:function(){for(var compIds=this.compIds,index=compIds.length-1,comp,el;index>=0;--index)comp=Ext.getCmp(compIds[index]),el=comp&&comp.getEl(),el&&(!this.componentGC||el.dom&&Ext.getDom(Ext.id(el))===el.dom)||comp&&!comp.isDestroyed&&comp.destroy()},processValue:function(value){var me=this,compIds=me.compIds,id,initialWidth,dom,parent;return Ext.isObject(value)&&!value.isComponent&&value.xtype&&(value=Ext.widget(value.xtype,value)),value&&value.isComponent&&(id=value.getId(),Ext.Array.contains(compIds,id)||compIds.push(id),me.addRefOwner(value),me.registerListeners(value),value.rendered?Ext.isIE&&(dom=value.el.dom,parent=dom.parentNode,parent&&(40101===me.extVersion&&Ext.core.DomHelper.insertBefore(dom,{tag:"p"}),parent.removeChild(dom))):me.autoWidthComponents&&(initialWidth=me.getWidth()-me.lastFrameWidth,initialWidth=initialWidth>4?initialWidth:4,value.setWidth(initialWidth)),(Ext.isIE6||Ext.isIE7)&&me.isHidden()&&value.hide()),value},redoScrollbars:function(){var me=this,grid=me.up("tablepanel");if(grid){if(me.resizeQueue)return me.redoScrollbarsRequired=!0,void 0;40100>me.extVersion?(grid.invalidateScroller(),grid.determineScrollbars()):grid.doLayout()}},registerColumnListeners:function(){var me=this;me.autoWidthComponents&&(me.on("resize",me.onColumnResize),me.on("show",me.onColumnShow)),(Ext.isIE6||Ext.isIE7)&&me.on({hide:me.onColumnVisibilityChange,show:me.onColumnVisibilityChange})},registerListeners:function(component){var me=this;component.on("destroy",me.onChildDestroy,me),me.autoWidthComponents&&(component.on("afterrender",me.onChildAfterRender,me,{single:!0}),me.extVersion>=40100&&component.on("boxready",me.onChildBoxReady,me,{single:!0})),component.on("resize",me.onChildResize,me)},registerViewListeners:function(){var me=this,view=me.up("tablepanel").getView();me.mon(view,"beforerefresh",me.beforeViewRefresh,me),me.mon(view,"refresh",me.onViewChange,me),me.mon(view,"itemupdate",me.onViewChange,me),me.mon(view,"itemadd",me.onViewChange,me),me.mon(view,"itemremove",me.onViewChange,me)},resizeAll:function(){var me=this;me.suspendResizing(),me.resizeQueue=me.getRefItems(),me.resumeResizing()},resizeChild:function(component,defer){var me=this,frameWidth,newWidth,oldWidth,resizeQueue;return me.resizingSuspended?(resizeQueue=me.resizeQueue,Ext.Array.contains(resizeQueue,component)||resizeQueue.push(component),void 0):(frameWidth=me.calculateFrameWidth(component),Ext.isNumber(frameWidth)&&(newWidth=me.getWidth()-frameWidth,oldWidth=component.getWidth(),me.setChildWidth(component,newWidth,oldWidth)&&defer!==!1&&Ext.each(me.widthUpdateDelay,function(delay){Ext.defer(me.resizeChild,delay,me,[component,!1])})),void 0)},resumeResizing:function(){var me=this,index=0,resizeQueue=me.resizeQueue,len=resizeQueue.length;if(!--me.resizingSuspended){for(;len>index;++index)me.resizeChild(resizeQueue[index]);me.resizeQueue=null,me.redoScrollbarsRequired&&me.redoScrollbars()}},setChildWidth:function(component,newWidth,oldWidth){return oldWidth===newWidth?!1:(component.setWidth(newWidth),!0)},suspendResizing:function(){var me=this;me.resizingSuspended=(me.resizingSuspended||0)+1,me.resizeQueue||(me.resizeQueue=[])}},function(cls){var proto=cls.prototype,version=Ext.getVersion();proto.extVersion=100*(100*version.getMajor()+version.getMinor())+version.getPatch(),Ext.Element.prototype.syncContent&&"4.1.0"==""+version&&(proto.extVersion=40101)}),Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",height:2e3,_loadTeamCommitsFeatures:function(cb){var me=this;Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/Feature",autoLoad:!0,limit:1/0,fetch:["Name","FormattedID","c_TeamCommits"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"c_TeamCommits",operator:"!=",value:""}],listeners:{load:{fn:function(featureStore){me.TeamCommitsFeatureStore=featureStore,me.TeamCommitsFeatureStore.filterBy(function(item){return!!item.get("c_TeamCommits")}),cb()},single:!0}}})},_loadRisksFeatures:function(cb){var me=this;Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/Feature",autoLoad:!0,limit:1/0,fetch:["Name","FormattedID","c_Risks"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"c_Risks",operator:"!=",value:""}],listeners:{load:{fn:function(featureStore){me.RisksFeatureStore=featureStore,me.RisksFeatureStore.filterBy(function(item){return!!item.get("c_Risks")}),cb()},single:!0}}})},_loadDependenciesUserStories:function(cb){var me=this;Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",autoLoad:!0,limit:1/0,fetch:["Name","FormattedID","c_Dependencies"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"c_Dependencies",operator:"!=",value:""}],listeners:{load:{fn:function(userStoryStore){me.DependenciesUserStoryStore=userStoryStore,me.DependenciesUserStoryStore.filterBy(function(item){return!!item.get("c_Dependencies")}),cb()},single:!0}}})},_defineModels:function(){Ext.define("RisksModel",{extend:"Ext.data.Model",fields:[{name:"FormattedID",type:"string"},{name:"Name",type:"string"},{name:"Risks",type:"string"}]}),Ext.define("TeamCommitsModel",{extend:"Ext.data.Model",fields:[{name:"FormattedID",type:"string"},{name:"Name",type:"string"},{name:"TeamCommits",type:"string"}]}),Ext.define("DependenciesModel",{extend:"Ext.data.Model",fields:[{name:"FormattedID",type:"string"},{name:"Name",type:"string"},{name:"Dependencies",type:"string"}]})},launch:function(){var me=this;me._defineModels(),me._loadTeamCommitsFeatures(function(){setInterval(function(){me.TeamCommitsFeatureStore.load({callback:function(records,operation){me.TeamCommitsStore&&me.TeamCommitsStore.load()}})},2e4),me._loadTeamCommitsGrid()}),me._loadRisksFeatures(function(){setInterval(function(){me.RisksFeatureStore.load({callback:function(records,operation){me.RisksStore&&me.RisksStore.load()}})},2e4),me._loadRisksGrid()}),me._loadDependenciesUserStories(function(){setInterval(function(){me.DependenciesUserStoryStore.load({callback:function(records,operation){me.DependenciesStore&&me.DependenciesStore.load()}})},2e4),me._loadDependenciesGrid()})},_loadTeamCommitsGrid:function(){var me=this,teamCommitsRecords=_.map(me.TeamCommitsFeatureStore.getRecords(),function(featureRecord){return Ext.create("TeamCommitsModel",{FormattedID:featureRecord.get("FormattedID"),Name:featureRecord.get("Name"),TeamCommits:featureRecord.get("c_TeamCommits")})});me.TeamCommitsStore=Ext.create("Rally.data.custom.Store",{data:teamCommitsRecords,model:"TeamCommitsModel",proxy:{type:"sessionstorage",keyField:"teamcommits"+Math.random()},listeners:{load:function(customStore,customRecords){console.log("syncing custom teamCommits with features");var i,unaccountedFor=customRecords.slice(0);me.TeamCommitsFeatureStore.getRecords().forEach(function(featureRecord){var c_TeamCommits=featureRecord.get("c_TeamCommits"),teamCommitsRecord=customStore.findRecord("FormattedID",featureRecord.get("FormattedID"));if(!teamCommitsRecord&&c_TeamCommits)customStore.add(Ext.create("TeamCommitsModel",{FormattedID:featureRecord.get("FormattedID"),Name:featureRecord.get("Name"),TeamCommits:c_TeamCommits}));else if(teamCommitsRecord&&!c_TeamCommits){for(customStore.remove(teamCommitsRecord),i=0;unaccountedFor.length>i;++i)if(unaccountedFor[i].get("FormattedID")===teamCommitsRecord.get("FormattedID"))return unaccountedFor.splice(i,1),void 0}else{if(!teamCommitsRecord&&!c_TeamCommits)return;for(teamCommitsRecord.get("TeamCommits")!==c_TeamCommits&&teamCommitsRecord.set("TeamCommits",c_TeamCommits),i=0;unaccountedFor.length>i;++i)if(unaccountedFor[i].get("FormattedID")===teamCommitsRecord.get("FormattedID"))return unaccountedFor.splice(i,1),void 0}}),unaccountedFor.forEach(function(teamCommitsRecord){customStore.remove(teamCommitsRecord)})}}}),me.TeamCommitsGrid=me.add({xtype:"rallygrid",title:"Team Commits",width:920,height:500,style:"margin-bottom:10px",scroll:"vertical",columnCfgs:[{text:"ID",dataIndex:"FormattedID",width:50,editor:!1},{text:"Feature",dataIndex:"Name",width:150,editor:!1},{dataIndex:"TeamCommits",width:50,text:"Length",editor:!1,renderer:function(json){return json.length}},{dataIndex:"TeamCommits",width:570,text:"Data",editor:!1,renderer:function(json){return"<pre>"+json+"</pre>"}},{text:"",dataIndex:"FormattedID",width:80,xtype:"componentcolumn",renderer:function(fid){return{xtype:"button",width:70,text:"Delete",handler:function(){var featureRecord=me.TeamCommitsFeatureStore.findRecord("FormattedID",fid);featureRecord&&(console.log("deleting featureRecord teamCommits:",featureRecord),featureRecord.set("c_TeamCommits",""),featureRecord.save()),me.TeamCommitsStore.remove(me.TeamCommitsStore.findRecord("FormattedID",fid))}}}}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{triggerEvent:"cellclick"})],viewConfig:{preserveScrollOnRefresh:!0,stripeRows:!0},showRowActionsColumn:!1,showPagingToolbar:!1,enableEditing:!1,context:this.getContext(),store:me.TeamCommitsStore})},_loadRisksGrid:function(){var me=this,risksRecords=_.map(me.RisksFeatureStore.getRecords(),function(featureRecord){return Ext.create("RisksModel",{FormattedID:featureRecord.get("FormattedID"),Name:featureRecord.get("Name"),Risks:featureRecord.get("c_Risks")})});me.RisksStore=Ext.create("Rally.data.custom.Store",{data:risksRecords,model:"RisksModel",proxy:{type:"sessionstorage",keyField:"risks"+Math.random()},listeners:{load:function(customStore,customRecords){console.log("syncing custom risks with features");var i,unaccountedFor=customRecords.slice(0);me.RisksFeatureStore.getRecords().forEach(function(featureRecord){var c_Risks=featureRecord.get("c_Risks"),risksRecord=customStore.findRecord("FormattedID",featureRecord.get("FormattedID"));if(!risksRecord&&c_Risks)customStore.add(Ext.create("RisksModel",{FormattedID:featureRecord.get("FormattedID"),Name:featureRecord.get("Name"),Risks:c_Risks}));else if(risksRecord&&!c_Risks){for(customStore.remove(riskRecord),i=0;unaccountedFor.length>i;++i)if(unaccountedFor[i].get("FormattedID")===risksRecord.get("FormattedID"))return unaccountedFor.splice(i,1),void 0}else{if(!risksRecord&&!c_Risks)return;for(risksRecord.get("Risks")!==c_Risks&&risksRecord.set("Risks",c_Risks),i=0;unaccountedFor.length>i;++i)if(unaccountedFor[i].get("FormattedID")===risksRecord.get("FormattedID"))return unaccountedFor.splice(i,1),void 0}}),unaccountedFor.forEach(function(riskRecord){customStore.remove(riskRecord)})}}}),me.RisksGrid=me.add({xtype:"rallygrid",title:"Risks",width:920,height:500,style:"margin-bottom:10px",scroll:"vertical",columnCfgs:[{text:"ID",dataIndex:"FormattedID",width:50,editor:!1},{text:"Feature",dataIndex:"Name",width:150,editor:!1},{text:"length",dataIndex:"Risks",width:50,renderer:function(json){return json.length}},{dataIndex:"Risks",width:570,text:"Data",editor:!1,renderer:function(json){return"<pre>"+json+"</pre>"}},{text:"",dataIndex:"FormattedID",width:80,xtype:"componentcolumn",renderer:function(fid,meta,risksRecord){return{xtype:"button",width:70,text:"Delete",handler:function(){var featureRecord=me.RisksFeatureStore.findRecord("FormattedID",fid);featureRecord&&(console.log("deleting featureRecord risk:",featureRecord),featureRecord.set("c_Risks",""),featureRecord.save()),me.RisksStore.remove(me.RisksStore.findRecord("FormattedID",fid))}}}}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{triggerEvent:"cellclick"})],viewConfig:{preserveScrollOnRefresh:!0,stripeRows:!0},showRowActionsColumn:!1,showPagingToolbar:!1,enableEditing:!1,context:this.getContext(),store:me.RisksStore})},_loadDependenciesGrid:function(){var me=this,dependenciesRecords=_.map(me.DependenciesUserStoryStore.getRecords(),function(userStoryRecord){return Ext.create("DependenciesModel",{FormattedID:userStoryRecord.get("FormattedID"),Name:userStoryRecord.get("Name"),Dependencies:userStoryRecord.get("c_Dependencies")})});me.DependenciesStore=Ext.create("Rally.data.custom.Store",{data:dependenciesRecords,model:"DependenciesModel",proxy:{type:"sessionstorage",keyField:"deps"+Math.random()},listeners:{load:function(customStore,customRecords){console.log("syncing custom Dependencies with user Stories");var i,unaccountedFor=customRecords;me.DependenciesUserStoryStore.getRecords().forEach(function(usRecord){var c_Deps=usRecord.get("c_Dependencies"),dependenciesRecord=customStore.findRecord("FormattedID",usRecord.get("FormattedID"));if(!dependenciesRecord&&c_Deps)customStore.add(Ext.create("DependenciesModel",{FormattedID:usRecord.get("FormattedID"),Name:usRecord.get("Name"),Dependencies:c_Deps}));else if(dependenciesRecord&&!c_Deps){for(customStore.remove(dependenciesRecord),i=0;unaccountedFor.length>i;++i)if(unaccountedFor[i].get("FormattedID")===dependenciesRecord.get("FormattedID"))return unaccountedFor.splice(i,1),void 0}else{if(!dependenciesRecord&&!c_Deps)return;for(dependenciesRecord.get("Dependencies")!==c_Deps&&dependenciesRecord.set("Dependencies",c_Deps),i=0;unaccountedFor.length>i;++i)if(unaccountedFor[i].get("FormattedID")===dependenciesRecord.get("FormattedID"))return unaccountedFor.splice(i,1),void 0}}),unaccountedFor.forEach(function(dependenciesRecord){customStore.remove(dependenciesRecord)})}}}),me.DependenciesGrid=me.add({xtype:"rallygrid",title:"Dependencies",width:970,height:800,style:"margin-bottom:10px",scroll:"vertical",columnCfgs:[{text:"ID",dataIndex:"FormattedID",width:100,editor:!1},{text:"UserStory",dataIndex:"Name",width:150,editor:!1},{text:"length",dataIndex:"Dependencies",width:50,renderer:function(json){return json.length}},{dataIndex:"Dependencies",width:570,text:"Data",editor:!1,renderer:function(json){return"<pre>"+json+"</pre>"}},{text:"",dataIndex:"FormattedID",width:80,xtype:"componentcolumn",renderer:function(fid,meta,dependencyRecord){return{xtype:"button",width:70,text:"Delete",handler:function(){var userStoryRecord=me.DependenciesUserStoryStore.findRecord("FormattedID",fid);userStoryRecord&&(console.log("deleting userStory dependency:",userStoryRecord),userStoryRecord.set("c_Dependencies",""),userStoryRecord.save()),me.DependenciesStore.remove(me.DependenciesStore.findRecord("FormattedID",fid))}}}}],plugins:[Ext.create("Ext.grid.plugin.CellEditing",{triggerEvent:"cellclick"})],viewConfig:{preserveScrollOnRefresh:!0,stripeRows:!0},showRowActionsColumn:!1,showPagingToolbar:!1,enableEditing:!1,context:this.getContext(),store:me.DependenciesStore})}});

            Rally.launchApp('CustomApp', {
                name:"Random App Name70221",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .intel-feature-not-committed .x-grid-cell{background-color:rgba(255,0,0,0.15) !important}.intel-feature-not-committed.x-grid-row-selected .x-grid-cell{background-color:rgba(255,0,0,0.25) !important}.intel-feature-committed .x-grid-cell{background-color:rgba(0,255,0,0.15) !important}.intel-feature-committed.x-grid-row-selected .x-grid-cell{background-color:rgba(0,255,0,0.25) !important}
    </style>
</head>
<body>
</body>
</html>
