<!DOCTYPE html>
<html>
<head>
    <title>SAFe Custom Field Editor</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.0rc3/sdk.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.1/q.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("IntelVelocity",{extend:"Ext.data.Model",fields:[{name:"Name",type:"string"},{name:"PlannedVelocity",type:"number"},{name:"RealVelocity",type:"number"}]}),Ext.define("IntelTeamCommits",{extend:"Ext.data.Model",fields:[{name:"Name",type:"string"},{name:"ObjectID",type:"string"},{name:"FormattedID",type:"string"},{name:"Commitment",type:"string"},{name:"Objective",type:"string"},{name:"Product",type:"string"},{name:"PlannedEnd",type:"number"}]}),Ext.define("IntelRisk",{extend:"Ext.data.Model",fields:[{name:"RiskID",type:"string"},{name:"ObjectID",type:"number"},{name:"FormattedID",type:"string"},{name:"FeatureName",type:"string"},{name:"Description",type:"string"},{name:"Impact",type:"string"},{name:"Status",type:"string"},{name:"Contact",type:"string"},{name:"Checkpoint",type:"number"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelDepTeam",{extend:"Ext.data.Model",fields:[{name:"TID",type:"string"},{name:"PID",type:"string"},{name:"Sup",type:"string"},{name:"USID",type:"string"},{name:"USName",type:"string"},{name:"A",type:"boolean"}]}),Ext.define("IntelPredDep",{extend:"Ext.data.Model",fields:[{name:"ObjectID",type:"number"},{name:"DependencyID",type:"string"},{name:"FormattedID",type:"string"},{name:"UserStoryName",type:"string"},{name:"Description",type:"string"},{name:"Checkpoint",type:"number"},{name:"Status",type:"string"},{name:"Predecessors",type:"auto"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelSuccDep",{extend:"Ext.data.Model",fields:[{name:"ObjectID",type:"number"},{name:"DependencyID",type:"string"},{name:"SuccUserStoryName",type:"string"},{name:"SuccFormattedID",type:"string"},{name:"SuccProjectID",type:"string"},{name:"UserStoryName",type:"string"},{name:"FormattedID",type:"string"},{name:"ReleaseStartDate",type:"number"},{name:"ReleaseDate",type:"number"},{name:"Description",type:"string"},{name:"Checkpoint",type:"number"},{name:"Supported",type:"string"},{name:"Assigned",type:"boolean"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelRiskWithProject",{extend:"Ext.data.Model",fields:[{name:"ProjectName",type:"string"},{name:"ProjectID",type:"number"},{name:"RiskID",type:"string"},{name:"ObjectID",type:"number"},{name:"FormattedID",type:"string"},{name:"FeatureName",type:"string"},{name:"Description",type:"string"},{name:"Impact",type:"string"},{name:"Status",type:"string"},{name:"Contact",type:"string"},{name:"Checkpoint",type:"number"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelPredDepWithProject",{extend:"Ext.data.Model",fields:[{name:"ProjectName",type:"string"},{name:"ProjectID",type:"number"},{name:"DependencyID",type:"string"},{name:"ObjectID",type:"number"},{name:"FormattedID",type:"string"},{name:"UserStoryName",type:"string"},{name:"Description",type:"string"},{name:"Checkpoint",type:"number"},{name:"Status",type:"string"},{name:"Predecessors",type:"auto"},{name:"Edited",type:"boolean"}]}),Ext.define("CommitsMatrixFeature",{extend:"Ext.data.Model",fields:[{name:"Rank",type:"number"},{name:"FormattedID",type:"string"},{name:"ObjectID",type:"number"},{name:"FeatureName",type:"string"},{name:"ProductName",type:"string"},{name:"PlannedEndDate",type:"number"}]}),Ext.define("CFEditorModel",{extend:"Ext.data.Model",fields:[{name:"FormattedID",type:"string"},{name:"Name",type:"string"},{name:"Release",type:"string"},{name:"CustomFieldValue",type:"string"}]});
                Ext.define("IntelRallyApp",{alias:"widget.intelrallyapp",extend:"Rally.app.App",_loadModels:function(){var me=this,promises=[],models={Project:"Project",UserStory:"HierarchicalRequirement",Feature:"PortfolioItem/Feature",Milestone:"PortfolioItem/Milestone"};return _.each(models,function(modelType,modelName){var deferred=Q.defer();Rally.data.WsapiModelFactory.getModel({type:modelType,success:function(loadedModel){me[modelName]=loadedModel,deferred.resolve()}}),promises.push(deferred.promise)}),Q.all(promises)},_loadProject:function(oid){var me=this,deferred=Q.defer();return oid?me.Project?(me.Project.load(oid,{fetch:["ObjectID","Releases","Children","Parent","Name"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},callback:deferred.resolve}),deferred.promise):me._loadModels().then(function(){return me._loadProject(oid)}):Q.resolve()},_loadFeature:function(oid,projectRef){var me=this,deferred=Q.defer();return oid?me.Feature?(me.Feature.load(oid,{fetch:["Name","ObjectID","FormattedID","c_TeamCommits","c_Risks","Project","PlannedEndDate","Parent"],context:{workspace:me.getContext().getWorkspace()._ref,project:projectRef},callback:deferred.resolve}),deferred.promise):me._loadModels().then(function(){return me._loadFeature(oid,projectRef)}):Q.resolve()},_loadUserStory:function(oid,projectRef){var me=this,deferred=Q.defer();return oid?me.UserStory?(me.UserStory.load(oid,{fetch:["Name","ObjectID","Release","Project","Feature","FormattedID","Predecessors","Successors","c_Dependencies","Iteration","PlanEstimate"],context:{workspace:me.getContext().getWorkspace()._ref,project:projectRef},callback:deferred.resolve}),deferred.promise):me._loadModels().then(function(){return me._loadUserStory(oid,projectRef)}):Q.resolve()},_loadMilestone:function(oid,projectRef){var me=this,deferred=Q.defer();return oid?me.Milestone?(me.Milestone.load(oid,{fetch:["ObjectID","Parent","Name"],context:{workspace:me.getContext().getWorkspace()._ref,project:projectRef},callback:deferred.resolve}),deferred.promise):me._loadModels().then(function(){return me._loadMilestone(oid)}):Q.resolve()},_loadRootProject:function(projectRecord){var me=this,n=projectRecord.data.Name;return"All Scrums"===n||"All Scrums Sandbox"===n?Q(projectRecord):projectRecord.data.Parent?me._loadProject(projectRecord.data.Parent.ObjectID).then(function(parentRecord){return me._loadRootProject(parentRecord)}):Q.reject("Please Scope to a valid team for Release Planning")},_projectInWhichTrain:function(projectRecord){if(projectRecord){var me=this,split=projectRecord.data.Name.split(" ART");if(split.length>1)return Q(projectRecord);var parent=projectRecord.data.Parent;return parent?me._loadProject(parent.ObjectID).then(function(parentRecord){return me._projectInWhichTrain(parentRecord)}):Q.reject()}return Q.reject()},_loadAllTrains:function(rootProjectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",remoteSort:!1,limit:1/0,fetch:["Name","ObjectID"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",operator:"contains",value:" ART"},{property:"Name",operator:"All Scrums Sandbox"===rootProjectRecord.data.Name?"contains":"!contains",value:"Test"}]});return me._reloadStore(store).then(function(store){return console.log("AllTrainRecords loaded",store.data.items),Q(store)})},_loadRandomUserStory:function(projectRef){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:5,pageSize:5,fetch:["Name","CreationDate","Project","ObjectID","FormattedID","Predecessors","Successors","c_Dependencies"],context:{workspace:me.getContext().getWorkspace()._ref,project:projectRef},sorters:[{property:"CreationDate",direction:"DESC"}]});return me._reloadStore(store).then(function(store){var records=store.data.items;return records.length?Q(records[Math.floor(Math.random()*records.length)]):Q(void 0)})},_loadUserStoryByFID:function(formattedID,projectRef){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1,pageSize:1,fetch:["Name","Project","ObjectID","FormattedID","Predecessors","Successors","c_Dependencies"],context:{workspace:me.getContext().getWorkspace()._ref,project:projectRef},filters:[{property:"FormattedID",value:formattedID}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_loadProjectByName:function(name){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",limit:1,pageSize:1,fetch:["Name","ObjectID"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",value:name}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_getFeatureFilterString:function(trainRecord,releaseRecord){var me=this,trainName=trainRecord.data.Name.split(" ART")[0];return coreFilter=Ext.create("Rally.data.wsapi.Filter",{property:"Release.Name",value:releaseRecord.data.Name}),"Test ART (P&E)"==trainRecord.data.Name?""+Ext.create("Rally.data.wsapi.Filter",{property:"Project.Name",value:"Test ART (P&E)"}).and(coreFilter):""+Ext.create("Rally.data.wsapi.Filter",{property:"Project.Parent.Name",value:trainName+" POWG Portfolios"}).or(Ext.create("Rally.data.wsapi.Filter",{property:"Project.Name",value:trainName+" POWG Portfolios"})).and(coreFilter)},_getProductFilterString:function(trainRecord){var me=this,trainName=trainRecord.data.Name.split(" ART")[0];return"Test"===trainName?""+Ext.create("Rally.data.wsapi.Filter",{property:"Project.Name",value:"Test ART (P&E)"}):""+Ext.create("Rally.data.wsapi.Filter",{property:"Project.Parent.Name",value:trainName+" POWG Portfolios"}).or(Ext.create("Rally.data.wsapi.Filter",{property:"Project.Name",value:trainName+" POWG Portfolios"}))},_loadProducts:function(trainRecord){var me=this,filterString=me._getProductFilterString(trainRecord),store=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/Product",limit:1/0,remoteSort:!1,fetch:["Name"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[{property:"Dummy",value:"value"}]});return store._hydrateModelAndLoad=function(options){var deferred=new Deft.Deferred;this.hydrateModel().then({success:function(model){this.proxy.encodeFilters=function(){return filterString},this.load(options).then({success:Ext.bind(deferred.resolve,deferred),failure:Ext.bind(deferred.reject,deferred)})},scope:this})},me._reloadStore(store).then(function(store){return console.log("Products loaded",store.data.items),Q(store)})},_addProjectsToList:function(projTree,list){var me=this,curProj=projTree.ProjectRecord;curProj.data.TeamMembers.Count>0&&(list[curProj.data.ObjectID]=curProj);for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me._addProjectsToList(projTree[childProjRef],list)},_loadValidProjects:function(rootProjectRecord){var me=this,validProjects={},projTree={},deferred=Q.defer(),store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:["Name","Parent","ObjectID","TeamMembers"],limit:1/0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return store.load({callback:function(projects){for(var i=0,len=projects.length;len>i;++i){var project=projects[i],thisRef=project.data.ObjectID,parentRef=project.data.Parent?project.data.Parent.ObjectID:void 0;projTree[thisRef]||(projTree[thisRef]={}),projTree[thisRef].ProjectRecord=project,parentRef&&(projTree[parentRef]||(projTree[parentRef]={}),projTree[parentRef][thisRef]=projTree[thisRef])}me._addProjectsToList(projTree[rootProjectRecord.data.ObjectID],validProjects),console.log("valid projects",validProjects),deferred.resolve(validProjects)}}),deferred.promise},_reloadStore:function(store){var deferred=Q.defer();return store.load({callback:function(records,operation,success){success?deferred.resolve(store):deferred.reject(operation.getError()||"Could not load data")}}),deferred.promise}});
                Ext.define("WorkweekDropdown",{extend:"Ext.data.Model",fields:[{name:"Workweek",type:"string"},{name:"DateVal",type:"number"}]});
                Ext.define("WindowListener",{__initWindowEventListener:function(eventName){var me=this;me._windowListeners||(me._windowListeners={}),me._windowListeners[eventName]=[],window.parent["on"+eventName]=function(event){for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i](event)}},_addWindowEventListener:function(eventName,fn){var me=this;me._windowListeners&&me._windowListeners[eventName]||me.__initWindowEventListener(eventName),me._windowListeners[eventName].push(fn)},_fireParentWindowEvent:function(eventName){var me=this;if(me._windowListeners&&me._windowListeners[eventName])for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i]()}});
                Ext.define("IframeResize",{requires:["WindowListener"],_applyIframeResizeToContents:function(){for(var w=window,p=w.parent,pd=w.parent.document,l=w.location,iframe=pd.querySelector('iframe[src="'+l.pathname+l.search+'"]'),ip1=iframe.parentNode,ip2=iframe.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode,height=0,next=this.down();next;)height+=next.getHeight()+1*next.getEl().getMargin("tb")+1*next.getEl().getPadding("tb"),next=next.next();height+=150,ip1.style.height=height+"px",ip2.style.height=height+"px",iframe.style.height=height+"px"},_initIframeResizeToContents:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._applyIframeResizeToContents()})},_applyIframeResizeToWindow:function(){var loc=window.location,iframe=Ext.get(window.parent.document.querySelector('iframe[src="'+loc.pathname+loc.search+'"]')),i=iframe.dom,portlet=iframe.up(".x-portlet"),portalColumn=portlet.up(".x-portal-column"),dashboard=portlet.up("#mydash_portlet");height=window.parent.innerHeight-70,height-=200,iframe.style.height=height+"px",ip1.style.height=height+"px",height+=30,ip2.style.height=height+"px"},_initIframeResizeToWindow:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._applyIframeResizeToWindow()}),me._applyIframeResizeToWindow()},_fixRallyDashboard:function(){for(var me=this,loc=window.location,iframe=Ext.get(window.parent.document.querySelector('iframe[src="'+loc.pathname+loc.search+'"]')),portlet=iframe.up(".x-portlet"),portalColumn=portlet.up(".x-portal-column"),dashboard=portlet.up("#mydash_portlet"),i=iframe.dom,innerHeight=window.parent.innerHeight;;){if(i.style.width=window.parent.innerWidth-4+"px",i.style.padding="0",i.style.margin="0","mydash_portlet"===i.id)break;i=i.parentNode}dashboard.dom.style.height=innerHeight-65+"px",portlet.dom.style.height=innerHeight-105+"px",iframe.dom.parentNode.style.height=innerHeight-135+"px",iframe.dom.style.height=innerHeight-135+"px",dashboard.dom.style.padding="0 2px 0 2px"},_initFixRallyDashboard:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._fixRallyDashboard()}),me._fixRallyDashboard()},_disableResizeHandle:function(){var me=this,loc=window.location,iframe=Ext.get(window.parent.document.querySelector('iframe[src="'+loc.pathname+loc.search+'"]')),portlet=iframe.up(".x-portlet"),handle=portlet.down(".x-resizable-handle");handle&&(handle.hide(),handle.dom.onshow=function(){handle&&handle.hide()})},_initDisableResizeHandle:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._disableResizeHandle()}),me._disableResizeHandle()}});
                Ext.define("PrettyAlert",{__getMessageBoxY:function(){var w=window,p=w.parent,pd=w.parent.document,l=w.location,iframe=pd.querySelector('iframe[src="'+l.pathname+l.search+'"]'),ph=p.getWindowHeight(),ps=p.getScrollY(),ofy=ps+iframe.getBoundingClientRect().top,iyOffset=Math.floor(ph/2-ofy+ps-50);return 0>iyOffset?0:iyOffset},_alert:function(title,str){1>arguments.length||(1===arguments.length&&(str=title,title=""),Ext.MessageBox.alert(title,str).setY(this.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},20))},_confirm:function(title,str,fn){2>arguments.length||(2===arguments.length&&(fn=str,str=title,title=""),"function"!=typeof fn&&(fn=function(){}),Ext.MessageBox.confirm(title,str,fn).setY(this.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},20))}});
                Ext.define("IntelWorkweek",{_getWorkweek:function(_date){var date=new Date(_date),oneDay=864e5,yearStart=new Date(date.getFullYear(),0,1),dayIndex=yearStart.getDay(),ww01Start=yearStart-dayIndex*oneDay,timeDiff=date-ww01Start,dayDiff=timeDiff/oneDay,ww=Math.floor(dayDiff/7)+1,leap=0===date.getFullYear()%4,weekCount=leap&&dayIndex>=5||!leap&&6===dayIndex?53:52;return ww>weekCount?1:ww},_getWeekCount:function(_date){var date=new Date(_date),leap=0===date.getFullYear()%4,day=new Date(date.getFullYear(),0,1).getDay();return leap&&day>=5||!leap&&6===day?53:52},_roundDateDownToWeekStart:function(_date){var date=new Date(_date),dayLength=864e5,day=date.getDay(),monthDate=date.getDate(),month=date.getMonth(),year=date.getFullYear();return 1*new Date(year,month,monthDate)-day*dayLength},_getWorkweekDates:function(startDate,endDate){for(var oneWeek=6048e5,startWeekDate=this._roundDateDownToWeekStart(startDate),endWeekDate=this._roundDateDownToWeekStart(endDate),totalWeeks=Math.floor((endWeekDate-startWeekDate)/oneWeek),weeks=Array(totalWeeks),i=0;totalWeeks>i;++i)weeks[i]=startWeekDate+oneWeek*i;return weeks},_getWorkWeeksForDropdown:function(releaseStartDate,releaseEndDate){for(var workweeks=this._getWorkweekDates(releaseStartDate,releaseEndDate),data=Array(workweeks.length),i=0,len=workweeks.length;len>i;++i)data[i]={Workweek:"ww"+this._getWorkweek(workweeks[i]),DateVal:workweeks[i]};return data}});
                Ext.define("ReleaseQuery",{_loadReleasesInTheFuture:function(projectRecord){var deferred=Q.defer();return Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!0,fetch:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID},{property:"ReleaseDate",operator:">=",value:(new Date).toISOString()}],listeners:{load:{fn:function(releaseStore,releaseRecords){console.log("releases loaded:",releaseRecords),deferred.resolve(releaseStore)},single:!0}}}),deferred.promise},_loadReleasesWithName:function(releaseName,trainName){var deferred=Q.defer();return Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!0,fetch:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project"],context:{workspace:this.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",value:releaseName},{property:"Project.Name",operator:"contains",value:trainName},{property:"Project.Children.Name",operator:"=",value:""},{property:"Project.Name",operator:"!contains",value:" ART"}],listeners:{load:{fn:function(store,records){console.log("releasesWithName loaded:",records),deferred.resolve(store)},single:!0}}}),deferred.promise},_getScopedRelease:function(releaseRecords,projectOID,appPrefs){var me=this,d=new Date,rs=releaseRecords,prefOID=appPrefs&&appPrefs.projs[projectOID]&&appPrefs.projs[projectOID].Release;return prefOID&&_.find(rs,function(r){return r.data.ObjectID==prefOID})||_.find(rs,function(r){return new Date(r.data.ReleaseDate)>=d&&d>=new Date(r.data.ReleaseStartDate)})||_.reduce(rs,function(best,r){if(null===best)return r;var d1=new Date(best.data.ReleaseStartDate),d2=new Date(r.data.ReleaseStartDate),now=new Date;return Math.abs(d1-now)<Math.abs(d2-now)?best:r},null)}});
                Ext.define("AsyncQueue",{QueueOfFuncs:{},_dequeue:function(queueName){var me=this;if(queueName=queueName||"undefined",me.QueueOfFuncs[queueName]){if(me.QueueOfFuncs[queueName].shift(),!me.QueueOfFuncs[queueName].length)return;me.QueueOfFuncs[queueName][0].call(me,me._dequeue.bind(me,queueName))}},_enqueue:function(callback,queueName){var me=this;return queueName=queueName||"undefined","function"!=typeof callback?console.log("ERR: not a function",callback):(me.QueueOfFuncs[queueName]&&me.QueueOfFuncs[queueName].length?me.QueueOfFuncs[queueName].push(callback):(me.QueueOfFuncs[queueName]=[callback],callback.call(me,me._dequeue.bind(me,queueName))),void 0)}});
                Ext.define("Skirtle.CTemplate",{extend:"Ext.XTemplate",statics:{AUTO_ID:0},copyDepth:10,cTpl:'<p id="ctemplate-{0}-{1}"></p>',isCTemplate:!0,constructor:function(){var me=this;me.callParent(arguments),me.id=++me.statics().AUTO_ID,me.reset()},copyValues:function(values,depth){var me=this,id,copy={},copyDepth=depth||me.copyDepth;return 1===copyDepth?values:Ext.isArray(values)?Ext.Array.map(values,function(value){return me.copyValues(value,copyDepth-1)}):Ext.isObject(values)?values.isComponent?(id=values.getId(),me.ids.push(id),Ext.String.format(me.cTpl,id,me.id)):(Ext.Object.each(values,function(key,value){copy[key]="$comp"===key?value:me.copyValues(value,copyDepth-1)}),copy):values},doInsert:function(){var ret=this.callParent(arguments);return this.injectComponents(),ret},doPolling:function(interval){var me=this;me.pollInterval=interval,me.pollId&&clearTimeout(me.pollId),me.pollId=Ext.defer(me.injectComponents,interval,me)},getPlaceholderEl:function(id){return Ext.get("ctemplate-"+id+"-"+this.id)},injectComponents:function(){for(var me=this,ids=me.ids,index=ids.length-1,id,cmp,placeholderEl;index>=0;--index)id=ids[index],cmp=Ext.getCmp(id),placeholderEl=me.getPlaceholderEl(id),(me.renderComponent(cmp,placeholderEl)||!cmp)&&(Ext.Array.splice(ids,index,1),placeholderEl&&placeholderEl.remove());ids.length&&me.doPolling(1.5*me.pollInterval)},overwrite:function(el){var dom,firstChild,ret;if(Ext.isIE)for(dom=Ext.getDom(el);dom.firstChild;)dom.removeChild(dom.firstChild);return ret=this.callParent(arguments),this.injectComponents(),ret},renderComponent:function(cmp,placeholderEl){if(cmp&&placeholderEl){var parent=placeholderEl.parent();return cmp.rendered?cmp.getEl().replace(placeholderEl):cmp.render(parent,placeholderEl),Ext.isIE6&&parent.repaint(),!0}return!1},reset:function(){var me=this;me.ids=[],me.pollId&&(clearTimeout(me.pollId),me.pollId=null)}},function(ctemplate){var apply=function(){var me=this,args=Ext.Array.slice(arguments);return args[0]=me.copyValues(args[0]),me.doPolling(10),me.callParent(args)};ctemplate.prototype.applyOut?ctemplate.override({applyOut:apply}):(ctemplate.override({applyTemplate:apply}),ctemplate.createAlias("apply","applyTemplate"))}),Ext.define("Skirtle.grid.column.Component",{alias:"widget.componentcolumn",extend:"Ext.grid.column.Column",requires:["Skirtle.CTemplate"],autoWidthComponents:!0,componentGC:!0,hasCustomRenderer:!0,lastFrameWidth:12,widthUpdateDelay:[10,400],constructor:function(cfg){var me=this;me.callParent(arguments),me.compIds=[],me.dataIndex=me.dataIndex||Ext.id(null,"cc-dataIndex-"),me.tpl=me.createTemplate(me.tpl),me.renderer=me.createRenderer(me.renderer),me.registerColumnListeners()},addRefOwner:function(child){var me=this,fn=me.refOwnerFn||(me.refOwnerFn=function(){return me});40200>me.extVersion?child.getBubbleTarget=fn:child.getRefOwner=fn},applyTemplate:function(data,value){return Ext.isDefined(value)&&(data[this.dataIndex]=value),this.tpl.apply(data)},beforeViewRefresh:function(){if(Ext.isIE)for(var ids=this.compIds,index=0,len=ids.length,item,el,parentEl;len>index;index++)(item=Ext.getCmp(ids[index]))&&(el=item.getEl())&&(el=el.dom)&&(parentEl=el.parentNode)&&parentEl.removeChild(el)},calculateFrameWidth:function(component){var el=component.getEl(),parentDiv=el&&el.parent(),parentTd=parentDiv&&parentDiv.parent();return parentTd?this.lastFrameWidth=parentDiv.getFrameWidth("lr")+parentTd.getFrameWidth("lr"):void 0},createRenderer:function(renderer){var me=this;return function(value,p,record){var data=Ext.apply({},record.data,record.getAssociatedData());return renderer&&(value=renderer.apply(this,arguments)),value=me.processValue(value),me.applyTemplate(data,value)}},createTemplate:function(tpl){return tpl&&tpl.isTemplate?tpl:Ext.create("Skirtle.CTemplate",tpl||["{",this.dataIndex,"}"])},destroyChild:function(child){child.destroy()},getRefItems:function(deep){for(var items=this.callParent([deep]),ids=this.compIds,index=0,len=ids.length,item;len>index;index++)item=Ext.getCmp(ids[index]),item&&(items.push(item),deep&&item.getRefItems&&items.push.apply(items,item.getRefItems(!0)));return items},onChildAfterRender:function(child){this.resizeChild(child)},onChildBoxReady:function(child){this.resizeChild(child,!1)},onChildDestroy:function(child){Ext.Array.remove(this.compIds,child.getId())},onChildResize:function(){this.redoScrollbars()},onColumnResize:function(column){column.resizeAll()},onColumnShow:function(column){column.resizeAll()},onColumnVisibilityChange:function(column){var items=column.getRefItems(),index=0,length=items.length,visible=!column.isHidden();for(Ext.suspendLayouts&&Ext.suspendLayouts();length>index;++index)items[index].setVisible(visible);Ext.resumeLayouts&&Ext.resumeLayouts(!0)},onDestroy:function(){Ext.destroy(this.getRefItems()),this.callParent()},onRender:function(){this.registerViewListeners(),this.callParent(arguments)},onViewChange:function(){var me=this,tpl=me.tpl;me.suspendResizing(),tpl.isCTemplate&&(tpl.injectComponents(),tpl.reset()),me.redoScrollbars(),me.resumeResizing(),me.performGC()},performGC:function(){for(var compIds=this.compIds,index=compIds.length-1,comp,el;index>=0;--index)comp=Ext.getCmp(compIds[index]),el=comp&&comp.getEl(),el&&(!this.componentGC||el.dom&&Ext.getDom(Ext.id(el))===el.dom)||comp&&!comp.isDestroyed&&comp.destroy()},processValue:function(value){var me=this,compIds=me.compIds,id,initialWidth,dom,parent;return Ext.isObject(value)&&!value.isComponent&&value.xtype&&(value=Ext.widget(value.xtype,value)),value&&value.isComponent&&(id=value.getId(),Ext.Array.contains(compIds,id)||compIds.push(id),me.addRefOwner(value),me.registerListeners(value),value.rendered?Ext.isIE&&(dom=value.el.dom,parent=dom.parentNode,parent&&(40101===me.extVersion&&Ext.core.DomHelper.insertBefore(dom,{tag:"p"}),parent.removeChild(dom))):me.autoWidthComponents&&(initialWidth=me.getWidth()-me.lastFrameWidth,initialWidth=initialWidth>4?initialWidth:4,value.setWidth(initialWidth)),(Ext.isIE6||Ext.isIE7)&&me.isHidden()&&value.hide()),value},redoScrollbars:function(){var me=this,grid=me.up("tablepanel");if(grid){if(me.resizeQueue)return me.redoScrollbarsRequired=!0,void 0;40100>me.extVersion?(grid.invalidateScroller(),grid.determineScrollbars()):grid.doLayout()}},registerColumnListeners:function(){var me=this;me.autoWidthComponents&&(me.on("resize",me.onColumnResize),me.on("show",me.onColumnShow)),(Ext.isIE6||Ext.isIE7)&&me.on({hide:me.onColumnVisibilityChange,show:me.onColumnVisibilityChange})},registerListeners:function(component){var me=this;component.on("destroy",me.onChildDestroy,me),me.autoWidthComponents&&(component.on("afterrender",me.onChildAfterRender,me,{single:!0}),me.extVersion>=40100&&component.on("boxready",me.onChildBoxReady,me,{single:!0})),component.on("resize",me.onChildResize,me)},registerViewListeners:function(){var me=this,view=me.up("tablepanel").getView();me.mon(view,"beforerefresh",me.beforeViewRefresh,me),me.mon(view,"refresh",me.onViewChange,me),me.mon(view,"itemupdate",me.onViewChange,me),me.mon(view,"itemadd",me.onViewChange,me),me.mon(view,"itemremove",me.onViewChange,me)},resizeAll:function(){var me=this;me.suspendResizing(),me.resizeQueue=me.getRefItems(),me.resumeResizing()},resizeChild:function(component,defer){var me=this,frameWidth,newWidth,oldWidth,resizeQueue;return me.resizingSuspended?(resizeQueue=me.resizeQueue,Ext.Array.contains(resizeQueue,component)||resizeQueue.push(component),void 0):(frameWidth=me.calculateFrameWidth(component),Ext.isNumber(frameWidth)&&(newWidth=me.getWidth()-frameWidth,oldWidth=component.getWidth(),me.setChildWidth(component,newWidth,oldWidth)&&defer!==!1&&Ext.each(me.widthUpdateDelay,function(delay){Ext.defer(me.resizeChild,delay,me,[component,!1])})),void 0)},resumeResizing:function(){var me=this,index=0,resizeQueue=me.resizeQueue,len=resizeQueue.length;if(!--me.resizingSuspended){for(;len>index;++index)me.resizeChild(resizeQueue[index]);me.resizeQueue=null,me.redoScrollbarsRequired&&me.redoScrollbars()}},setChildWidth:function(component,newWidth,oldWidth){return oldWidth===newWidth?!1:(component.setWidth(newWidth),!0)},suspendResizing:function(){var me=this;me.resizingSuspended=(me.resizingSuspended||0)+1,me.resizeQueue||(me.resizeQueue=[])}},function(cls){var proto=cls.prototype,version=Ext.getVersion();proto.extVersion=100*(100*version.getMajor()+version.getMinor())+version.getPatch(),Ext.Element.prototype.syncContent&&"4.1.0"==""+version&&(proto.extVersion=40101)});
                Ext.define("Intel.form.field.ComboBox",{extend:"Ext.form.field.ComboBox",alias:["widget.intelcombo","widget.intelcombobox"],constructor:function(){this.callParent(arguments)},enableKeyEvents:!0,queryMode:"local",ignoreNoChange:!0,listeners:{keyup:function(a,b){if(!(b.keyCode>=37&&40>=b.keyCode)){var combo=this;combo.store.clearFilter(),combo.store.filterBy(function(item){return null!==item.get(combo.displayField).match(RegExp(combo.getRawValue(),"i"))})}},focus:function(combo){combo.store.clearFilter(),combo.setValue(""),combo.expand()}}});
                Ext.define("Intel.form.field.FixedComboBox",{extend:"Ext.form.field.ComboBox",alias:["widget.intelfixedcombo","widget.intelfixedcombobox"],editable:!1,listeners:{focus:function(combo){combo.setValue(""),combo.expand()}}});
                Ext.define("Intel.form.field.ReleasePicker",{extend:"Intel.form.field.FixedComboBox",alias:["widget.intelreleasepicker"],constructor:function(options){options.releases&&options.currentRelease&&(options.displayField="Name",options.value=options.currentRelease.data.Name,options.store=Ext.create("Ext.data.Store",{fields:["Name"],data:_.map(options.releases,function(r){return{Name:r.data.Name}})}),options.fieldLabel=options.fieldLabel||"Release:",options.editable=options.editable||!1,options.width=options.width||240,options.labelWidth=options.labelWidth||50,this.callParent([options]))}});
                Ext.define("IntelTextarea",{extend:"Ext.form.field.TextArea",alias:["widget.inteltextarea"],grow:!0,growMin:20,growMax:160,maxLength:150,enforceMaxLength:!0,enterIsSpecial:!0});
                Ext.define("intel.grid.column.Component.",{alias:"widget.fastgridcolumn",extend:"Skirtle.grid.column.Component",autoWidthComponents:!1,componentGC:!0,hasCustomRenderer:!0,lastFrameWidth:12,constructor:function(cfg){var me=this;me.callParent(arguments)},registerViewListeners:function(){var me=this,view=me.up("tablepanel").getView();me.mon(view,"beforerefresh",me.beforeViewRefresh,me),me.mon(view,"refresh",me.onViewChange,me)},onViewChange:function(){var me=this,tpl=me.tpl;me.suspendResizing(),tpl.isCTemplate&&(tpl.injectComponents(),tpl.reset()),me.resumeResizing(),me.performGC()},resumeResizing:function(){var me=this,index=0,resizeQueue=me.resizeQueue,len=resizeQueue.length;if(!--me.resizingSuspended){for(;len>index;++index)me.resizeChild(resizeQueue[index]);me.resizeQueue=null}},onChildResize:function(){}});
                Ext.define("Intel.data.proxy.SessionStorage",{extend:"Ext.data.proxy.SessionStorage",alias:"proxy.fastsessionproxy",constructor:function(cfg){var me=this;me.callParent(arguments)},create:function(operation,callback,scope){var me=this,records=operation.records,length=records.length,ids=me.getIds(),id,record,i;for(operation.setStarted(),void 0===me.isHierarchical&&(me.isHierarchical=!!records[0].isNode,me.isHierarchical&&me.getStorageObject().setItem(me.getTreeKey(),!0)),i=0;length>i;i++)record=records[i],record.phantom?(record.phantom=!1,id=me.getNextId()):id=record.getId(),record.beginEdit(),me.setRecord(record,id),record.endEdit(!0),record.commit(!0),ids.push(id);me.setIds(ids),operation.setCompleted(),operation.setSuccessful(),"function"==typeof callback&&callback.call(scope||me,operation)},update:function(operation,callback,scope){var records=operation.records,length=records.length,ids=this.getIds(),record,id,i;for(operation.setStarted(),i=0;length>i;i++)record=records[i],this.setRecord(record),record.commit(!0),id=record.getId(),void 0!==id&&-1==Ext.Array.indexOf(ids,id)&&ids.push(id);this.setIds(ids),operation.setCompleted(),operation.setSuccessful(),"function"==typeof callback&&callback.call(scope||this,operation)}});
                Ext.define("Intel.data.FastStore",{extend:"Ext.data.Store",alias:"store.faststore",constructor:function(cfg){var me=this;me.callParent(arguments)},afterEdit:function(record,modifiedFieldNames){var me=this,i,shouldSync;if(me.autoSync&&!me.autoSyncSuspended)for(i=modifiedFieldNames.length;i--;)if(record.fields.get(modifiedFieldNames[i]).persist){me.sync();break}me.onUpdate(record,Ext.data.Model.EDIT,modifiedFieldNames)}});
                Ext.define("Intel.grid.plugin.CellEditing",{alias:"plugin.fastcellediting",extend:"Ext.grid.plugin.CellEditing",triggerEvent:"cellclick",onEditComplete:function(ed,value,startValue){var me=this,activeColumn=me.getActiveColumn(),context=me.context,record;if(activeColumn){if(record=context.record,me.setActiveEditor(null),me.setActiveColumn(null),me.setActiveRecord(null),context.value=value,!me.validateEdit())return me.editing=!1,void 0;record.beginEdit(),record.isEqual(value,startValue)||record.set(activeColumn.dataIndex,value),context.view.focusRow(context.rowIdx,100),me.fireEvent("edit",me,context),record.endEdit(),me.editing=!1}}});
                Ext.define("Intel.view.ScrollTable",{extend:"Ext.view.Table",alias:"widget.scrolltableview",constructor:function(cfg){var me=this;me.callParent(arguments)},refresh:function(){var me=this,targetEl,targetParent,oldDisplay,nextSibling,dom,records,el=me.getEl(),scroll=el&&el.getScrollTop();me.rendered&&!me.isDestroyed&&(me.hasListeners.beforerefresh&&me.fireEvent("beforerefresh",me)===!1||(targetEl=me.getTargetEl(),records=me.getViewRange(),dom=targetEl.dom,me.preserveScrollOnRefresh||(targetParent=dom.parentNode,oldDisplay=dom.style.display,dom.style.display="none",nextSibling=dom.nextSibling,targetParent.removeChild(dom)),me.refreshCounter?me.clearViewEl():(me.fixedNodes=targetEl.dom.childNodes.length,me.refreshCounter=1),me.tpl.append(targetEl,me.collectData(records,me.all.startIndex)),1>records.length?(this.store.loading||me.deferEmptyText&&!me.hasFirstRefresh||Ext.core.DomHelper.insertHtml("beforeEnd",targetEl.dom,me.emptyText),me.all.clear()):(me.collectNodes(targetEl.dom),me.updateIndexes(0)),me.hasFirstRefresh&&(me.refreshSelmodelOnRefresh!==!1?me.selModel.refresh():me.selModel.pruneIf()),me.hasFirstRefresh=!0,me.preserveScrollOnRefresh||(targetParent.insertBefore(dom,nextSibling),dom.style.display=oldDisplay),Ext.suspendLayouts(),this.refreshSize(),me.fireEvent("refresh",me),Ext.resumeLayouts(!0),me.viewReady||(me.viewReady=!0,me.fireEvent("viewready",me))),scroll&&me.preserveScrollOnRefresh&&el.setScrollTop(scroll))},onRemove:function(ds,records,indexes){var me=this,fireItemRemove=me.hasListeners.itemremove,i,record,index,el=me.getEl(),scroll=el&&el.getScrollTop();if(me.all.getCount()){if(0===me.dataSource.getCount()){if(fireItemRemove)for(i=indexes.length-1;i>=0;--i)me.fireEvent("itemremove",records[i],indexes[i])}else{for(i=indexes.length-1;i>=0;--i)record=records[i],index=indexes[i],me.doRemove(record,index),fireItemRemove&&me.fireEvent("itemremove",record,index);me.updateIndexes(indexes[0])}this.refreshSize(),scroll&&me.preserveScrollOnRefresh&&el.setScrollTop(scroll)}},onUpdate:function(ds,record){var me=this,index,node,el=me.getEl(),scroll=el&&el.getScrollTop();if(me.viewReady){if(index=me.dataSource.indexOf(record),index>-1&&(node=me.bufferRender([record],index)[0],me.getNode(record)))return me.all.replaceElement(index,node,!0),me.updateIndexes(index,index),me.selModel.onUpdate(record),me.hasListeners.itemupdate&&me.fireEvent("itemupdate",record,index,node),node;scroll&&me.preserveScrollOnRefresh&&el.setScrollTop(scroll)}},onAdd:function(store,records,index){var me=this,nodes,el=me.getEl(),scroll=el&&el.getScrollTop();me.rendered&&(0===me.all.getCount()?(me.refresh(),nodes=me.all.slice()):(nodes=me.doAdd(records,index),me.refreshSelmodelOnRefresh!==!1&&me.selModel.refresh(),me.updateIndexes(index)),me.hasListeners.itemadd&&me.fireEvent("itemadd",records,index,nodes),scroll&&me.preserveScrollOnRefresh&&el.setScrollTop(scroll))},scrollRowIntoView:function(row){return 0===row?(this.getEl().setScrollTop(0),void 0):(row=this.getNode(row,!0),row&&Ext.fly(row).scrollIntoView(this.el,!1),void 0)}});
                Ext.define("CustomFieldEditor",{extend:"IntelRallyApp",mixins:["WindowListener","PrettyAlert","IframeResize","ReleaseQuery","IntelWorkweek","AsyncQueue"],componentCls:"app",height:2e3,_getFeatureFilterString:function(){return""+Ext.create("Rally.data.wsapi.Filter",{property:"c_TeamCommits",operator:"!=",value:""}).or(Ext.create("Rally.data.wsapi.Filter",{property:"c_Risks",operator:"!=",value:""}))},_loadFeatures:function(){var me=this,filterString=me._getFeatureFilterString(),featureStore=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/Feature",limit:1/0,remoteSort:!1,fetch:["Name","FormattedID","c_Risks","c_TeamCommits","Release"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Dummy",value:"value"}]});return featureStore._hydrateModelAndLoad=function(options){var deferred=new Deft.Deferred;this.hydrateModel().then({success:function(model){this.proxy.encodeFilters=function(){return filterString},this.load(options).then({success:Ext.bind(deferred.resolve,deferred),failure:Ext.bind(deferred.reject,deferred)})},scope:this})},me._reloadStore(featureStore).then(function(featureStore){me.FeatureStore=featureStore})},_getUserStoryFilterString:function(){return""+Ext.create("Rally.data.wsapi.Filter",{property:"c_Dependencies",operator:"!=",value:""})},_loadUserStories:function(){var me=this,filterString=me._getUserStoryFilterString(),storyStore=Ext.create("Rally.data.wsapi.Store",{model:"Hierarchicalrequirement",limit:1/0,remoteSort:!1,fetch:["Name","FormattedID","c_Dependencies","Release"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Dummy",value:"value"}]});return storyStore._hydrateModelAndLoad=function(options){var deferred=new Deft.Deferred;this.hydrateModel().then({success:function(model){this.proxy.encodeFilters=function(){return filterString},this.load(options).then({success:Ext.bind(deferred.resolve,deferred),failure:Ext.bind(deferred.reject,deferred)})},scope:this})},me._reloadStore(storyStore).then(function(storyStore){me.UserStoryStore=storyStore})},_isJsonValid:function(str){try{return JSON.parse(str),!0}catch(e){return!1}},_atob:function(a){try{return atob(a)}catch(e){return"INVALID ATOB:\n"+a}},_showGrids:function(){var me=this;me._loadGrid(me.FeatureStore,"TeamCommits"),me._loadGrid(me.FeatureStore,"Risks"),me._loadGrid(me.UserStoryStore,"Dependencies")},_updateGrids:function(){var me=this;me.FeatureStore&&(me.TeamCommitsStore&&me.TeamCommitsStore.intelUpdate(),me.RisksStore&&me.RisksStore.intelUpdate()),me.UserStoryStore&&me.DependenciesStore&&me.DependenciesStore.intelUpdate()},_reloadStores:function(){var me=this,promises=[];return promises.push(me._loadFeatures()),promises.push(me._loadUserStories()),Q.all(promises)},_reloadEverything:function(){var me=this;me.UserStoryStore=void 0,me.FeatureStore=void 0,me.RisksGrid=void 0,me.TeamCommitsGrid=void 0,me.DependenciesGrid=void 0,me.DependenciesStore=void 0,me.RisksStore=void 0,me.TeamCommitsStore=void 0,me.setLoading(!0),me.removeAll(),me._loadManualRefreshButton(),me._enqueue(function(unlockFunc){me._reloadStores().then(function(){me._updateGrids()}).then(function(){me.setLoading(!1),me._showGrids(),unlockFunc()}).fail(function(reason){me.setLoading(!1),me._alert("ERROR",reason),unlockFunc()}).done()})},launch:function(){var me=this;me._initDisableResizeHandle(),me._initFixRallyDashboard(),me._reloadEverything()},_loadManualRefreshButton:function(){var me=this;me.add({xtype:"button",text:"Refresh Page",width:100,listeners:{click:function(){me._reloadEverything()}}})},_loadGrid:function(realStore,customFieldName){function sorterFn(o1,o2){return o1.data.FormattedID>o2.data.FormattedID?-1:1}var me=this,c_customFieldName="c_"+customFieldName,customStoreName=customFieldName+"Store",customGridName=customFieldName+"Grid",records=_.reduce(realStore.data.items,function(records,record){var customField=me._atob(record.data[c_customFieldName]);return customField&&records.push({FormattedID:record.data.FormattedID,Name:record.data.Name,Release:record.data.Release?record.data.Release.Name:"",CustomFieldValue:customField}),records},[]);me[customStoreName]=Ext.create("Intel.data.FastStore",{data:records,model:"CFEditorModel",proxy:{type:"fastsessionproxy",id:"teamcommits"+Math.random()},sorters:[sorterFn],intelUpdate:function(){for(var customStore=me[customStoreName],customRecords=customStore.data.items,unaccountedFor=customRecords.slice(),realRecords=realStore.data.items,i=0,len=realRecords.length;len>i;++i){var realRecord=realRecords[i],realFieldValue=me._atob(realRecord.data[c_customFieldName]),customRecord=customStore.findRecord("FormattedID",realRecord.data.FormattedID);if(customRecord||realFieldValue)if(!customRecord&&realFieldValue)customStore.add(Ext.create("CFEditorModel",{FormattedID:realRecord.data.FormattedID,Name:realRecord.data.Name,Release:realRecord.data.Release?realRecord.data.Release.Name:"",TeamCommits:realFieldValue}));else if(customRecord&&!realFieldValue){for(customStore.remove(customRecord),i=0;unaccountedFor.length>i;++i)if(unaccountedFor[i].data.FormattedID===customRecord.data.FormattedID){unaccountedFor.splice(i,1);break}}else for(customRecord.data.CustomFieldValue!==realFieldValue&&customRecord.set(".CustomFieldValue",realFieldValue),i=0;unaccountedFor.length>i;++i)if(unaccountedFor[i].data.FormattedID===customRecord.data.FormattedID){unaccountedFor.splice(i,1);break}}unaccountedFor.forEach(function(customRecord){customStore.remove(customRecord)})}});var columnCfgs=[{text:"ID",dataIndex:"FormattedID",width:100,editor:!1,draggable:!1,sortable:!0,resizable:!1,menuDisabled:!0,cls:"header-cls",renderer:function(val,meta){return meta.tdAttr='title="'+val+'"',val}},{text:"Name",dataIndex:"Name",width:150,editor:!1,draggable:!1,sortable:!0,resizable:!1,menuDisabled:!0,cls:"header-cls",renderer:function(val,meta){return meta.tdAttr='title="'+val+'"',val}},{text:"Release",dataIndex:"Release",width:150,editor:!1,draggable:!1,sortable:!0,resizable:!1,menuDisabled:!0,cls:"header-cls",renderer:function(val,meta){return meta.tdAttr='title="'+val+'"',val}},{dataIndex:"CustomFieldValue",width:60,text:"b64 length",editor:!1,draggable:!1,sortable:!0,resizable:!1,menuDisabled:!0,cls:"header-cls",renderer:function(json){return btoa(json).length}},{dataIndex:"CustomFieldValue",flex:1,text:"Data",editor:{xtype:"textarea",grow:!0,growMin:20,growMax:300},draggable:!1,sortable:!1,resizable:!1,menuDisabled:!0,tdCls:"pre-wrap-cell intel-editor-cell",cls:"header-cls"},{text:"",xtype:"fastgridcolumn",tdCls:"iconCell",width:30,editor:!1,draggable:!1,sortable:!1,resizable:!1,menuDisabled:!0,cls:"header-cls",renderer:function(value,meta,customRecord){var realRecord=realStore.findExactRecord("FormattedID",customRecord.data.FormattedID),realFieldValue=me._atob(realRecord.data[c_customFieldName]);if(realFieldValue!==customRecord.data.CustomFieldValue)return meta.tdAttr='title="Undo"',{xtype:"container",width:20,cls:"undo-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){customRecord.set("CustomFieldValue",realFieldValue),customRecord.commit()}}}}}},{text:"",xtype:"fastgridcolumn",tdCls:"iconCell",width:30,editor:!1,draggable:!1,sortable:!1,resizable:!1,menuDisabled:!0,cls:"header-cls",renderer:function(value,meta,customRecord){var realRecord=realStore.findExactRecord("FormattedID",customRecord.data.FormattedID),realFieldValue=me._atob(realRecord.data[c_customFieldName]),newFieldValue=customRecord.data.CustomFieldValue;if(realFieldValue!==newFieldValue)return meta.tdAttr='title="Save '+c_customFieldName+'"',{xtype:"container",width:20,cls:"save-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){return me._isJsonValid(newFieldValue)?(me[customGridName].setLoading(!0),me._enqueue(function(unlockFunc){realRecord.set(c_customFieldName,btoa(newFieldValue)),realRecord.save({callback:function(record,operation,success){success?customRecord.commit():me._alert("ERROR","Failed to modify "+realRecord.data.FormattedID),me[customGridName].setLoading(!1),unlockFunc()}})}),void 0):me._alert("ERROR","JSON is not valid")}}}}}},{text:"",xtype:"fastgridcolumn",tdCls:"iconCell",width:30,editor:!1,draggable:!1,sortable:!1,resizable:!1,menuDisabled:!0,cls:"header-cls",renderer:function(value,meta,customRecord){return meta.tdAttr='title="Delete '+c_customFieldName+'"',{xtype:"container",width:20,cls:"delete-button intel-editor-cell",listeners:{click:{element:"el",fn:function(){me[customGridName].setLoading(!0),me._enqueue(function(unlockFunc){var realRecord=realStore.findExactRecord("FormattedID",customRecord.data.FormattedID);realRecord.set(c_customFieldName,""),realRecord.save({callback:function(record,operation,success){success?me[customStoreName].remove(customRecord):me._alert("ERROR","Failed to modify "+realRecord.data.FormattedID),me[customGridName].setLoading(!1),unlockFunc()}})})}}}}}}];me[customGridName]=me.add({xtype:"grid",title:customFieldName,height:500,style:"margin-bottom:10px",scroll:"vertical",columns:columnCfgs,disableSelection:!0,enableEditing:!1,plugins:["fastcellediting"],viewConfig:{xtype:"scrolltableview",preserveScrollOnRefresh:!0},listeners:{beforeedit:function(){return me._editing++,!0},canceledit:function(){me._editing--},edit:function(e,d){me._editing--,d.record.commit()}},store:me[customStoreName]})}});

            Rally.launchApp('CustomFieldEditor', {
                name:"SAFe Custom Field Editor",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .undo-button{background-image:url(http://png-4.findicons.com/files/icons/2315/default_icon/256/undo.png) !important}.delete-button{background-image:url(http://superadm.com/wp-content/uploads/2014/05/delete.png) !important}.save-button{background-image:url(http://www.iconpng.com/png/windows8_icons2/save.png) !important}.minus-button{background-image:url(http://www.pubzi.com/f/minus-sign.svg) !important}.plus-button{background-image:url(http://ilstream.com/images/plus-icon.gif) !important}.iconCell,.iconCell *{padding:0px !important;margin:0px !important}.undo-button,.delete-button,.save-button,.minus-button,.plus-button{left:0px !important;top:0px !important;height:16px !important;width:16px !important;background-size:16px !important;padding:0px !important;margin:7px 7px 0px 7px !important}
    </style>
    <style type="text/css">
        .app{background-color:black !important;padding:30px}.header-cls{background-color:white !important}.pre-wrap-cell{white-space:pre-wrap !important}.x-grid-row .intel-editor-cell{cursor:pointer !important}.x-grid-row .intel-editor-cell *{cursor:pointer !important}
    </style>
</head>
<body>
</body>
</html>
