<!DOCTYPE html>
<html>
<head>
    <title>Risk Swimlane</title>

    <script type="text/javascript" src="/apps/2.0/sdk.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/q.js/1.0.1/q.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.6.0/lodash.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                (function(){var Ext=window.Ext4||window.Ext,timeout=12e4;Ext.override(Ext.data.proxy.Ajax,{timeout:timeout}),Ext.override(Ext.data.proxy.JsonP,{timeout:timeout}),Ext.override(Rally.sdk.data.lookback.JsonPProxy,{setException:function(operation,response){var error=operation.getError()||{};operation.setException(Ext.apply(error,{errors:(response||{}).Errors||[]}))}}),Ext.define("IntelRallyApp",{alias:"widget.intelrallyapp",extend:"Rally.app.App",_ScrumGroupConfigPrefName:"intel-portfolio-locations-config",_projectFields:["ObjectID","Releases","Children","Parent","Name","TeamMembers"],_portfolioItemFields:["Name","ObjectID","FormattedID","Release","c_TeamCommits","c_MoSCoW","c_Risks","Project","PlannedEndDate","Parent","Children","PortfolioItemType","Ordinal"],_userStoryFields:["Name","ObjectID","Release","Project","PortfolioItem","PlannedEndDate","ActualEndDate","FormattedID","Predecessors","Successors","c_Dependencies","Iteration","PlanEstimate"],_releaseFields:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project","TeamMembers"],_loadScheduleStates:function(){var me=this,deferred=Q.defer();return Rally.data.ModelFactory.getModel({type:"UserStory",success:function(model){model.getField("ScheduleState").getAllowedValueStore().load({callback:function(records,operation,success){me.ScheduleStates=_.map(records,function(r){return r.data.StringValue}),deferred.resolve()}})}}),deferred.promise},_loadPortfolioItemStatesForEachType:function(){var me=this;return me.PortfolioItemTypeStates=[],Q.all(_.map(me.PortfolioItemTypes,function(portfolioType,ordinal){var store=Ext.create("Rally.data.wsapi.Store",{model:"State",autoLoad:!1,limit:1/0,disableMetaChangeEvent:!0,fetch:["Name","Enabled","OrderIndex"],filters:[{property:"TypeDef.Name",value:portfolioType},{property:"Enabled",value:!0}]});return me._reloadStore(store).then(function(store){me.PortfolioItemTypeStates[ordinal]=store.getRange()})}))},_loadPortfolioItemTypes:function(){var me=this,deferred=Q.defer(),store=Ext.create("Rally.data.wsapi.Store",{model:"TypeDefinition",autoLoad:!0,limit:1/0,disableMetaChangeEvent:!0,fetch:["Ordinal","Name"],filters:[{property:"Parent.Name",value:"Portfolio Item"},{property:"Creatable",value:!0}],listeners:{load:function(portfolioTypeStore){me.PortfolioItemTypes=_.map(_.sortBy(_.map(portfolioTypeStore.getRange(),function(item){return{Name:item.data.Name,Ordinal:item.data.Ordinal}}),function(item){return item.Ordinal}),function(item){return item.Name}),deferred.resolve()}}});return deferred.promise},_loadModels:function(){var me=this,promises=[],models={Project:"Project",UserStory:"HierarchicalRequirement",PortfolioItem:"PortfolioItem"};return _.each(me.PortfolioItemTypes,function(name){models[name]="PortfolioItem/"+name}),_.each(models,function(modelType,modelName){var deferred=Q.defer();Rally.data.WsapiModelFactory.getModel({type:modelType,success:function(loadedModel){me[modelName]=loadedModel,deferred.resolve()}}),promises.push(deferred.promise)}),Q.all(promises)},_loadScrumGroupConfig:function(){var me=this,deferred=Q.defer();return Rally.data.PreferenceManager.load({workspace:me.getContext().getWorkspace()._ref,filterByName:me._ScrumGroupConfigPrefName,success:function(prefs){var configString=prefs[me._ScrumGroupConfigPrefName],scrumGroupConfig;try{scrumGroupConfig=JSON.parse(configString)}catch(e){scrumGroupConfig=[]}me.ScrumGroupConfig=scrumGroupConfig,deferred.resolve()},failure:deferred.reject}),deferred.promise},_saveScrumGroupConfig:function(scrumGroupConfig){var me=this,s={},deferred=Q.defer();return s[me._ScrumGroupConfigPrefName]=JSON.stringify(scrumGroupConfig),Rally.data.PreferenceManager.update({workspace:me.getContext().getWorkspace()._ref,filterByName:me._ScrumGroupConfigPrefName,settings:s,success:deferred.resolve,failure:deferred.reject}),deferred.promise},_configureIntelRallyApp:function(){var me=this;return me.BaseUrl=Rally.environment.getServer().getBaseUrl(),Q.all([me._loadPortfolioItemTypes().then(function(){return me._userStoryFields.push(me.PortfolioItemTypes[0]),Q.all([me._loadModels(),me._loadPortfolioItemStatesForEachType()])}),me._loadScrumGroupConfig(),me._loadScheduleStates()])},_reloadStore:function(store){var deferred=Q.defer();return store.load({callback:function(records,operation,success){success?deferred.resolve(store):deferred.reject(operation.getError()||"Could not load data")}}),deferred.promise},_loadProject:function(oid){var me=this,deferred=Q.defer();return oid?me.Project?(me.Project.load(oid,{fetch:me._projectFields,context:{workspace:me.getContext().getWorkspace()._ref,project:null},callback:deferred.resolve}),deferred.promise):Q.reject("IntelRallyApp is not configured!"):Q.reject("Invalid arguments: LP")},_loadUserStory:function(oid,projectRecord){var me=this,deferred=Q.defer();return oid?me.UserStory?(me.UserStory.load(oid,{fetch:me._userStoryFields,context:{workspace:projectRecord?null:me.getContext().getWorkspace()._ref,project:projectRecord?projectRecord.data._ref:null},callback:deferred.resolve}),deferred.promise):Q.reject("IntelRallyApp is not configured!"):Q.reject("Invalid arguments: LUS")},_loadPortfolioItemByType:function(oid,type){var me=this,deferred=Q.defer();return oid&&type?(me[type].load(oid,{fetch:me._portfolioItemFields,context:{workspace:me.getContext().getWorkspace()._ref,project:null},callback:deferred.resolve}),deferred.promise):Q.reject("Invalid arguments: LPIBT")},_loadPortfolioItemByOrdinal:function(oid,ordinal){var me=this,deferred=Q.defer(),type=me.PortfolioItemTypes[ordinal];return me._loadPortfolioItemByType(oid,type)},_projectInWhichScrumGroup:function(projectRecord){if(projectRecord){var me=this,foundScrumGroupConfig=_.find(me.ScrumGroupConfig,function(scrumGroupConfig){return scrumGroupConfig.ScrumGroupRootProjectOID==projectRecord.data.ObjectID});if(foundScrumGroupConfig)return Q(projectRecord);var parent=projectRecord.data.Parent;return parent?me._loadProject(parent.ObjectID).then(function(parentRecord){return me._projectInWhichScrumGroup(parentRecord)}):Q()}return Q()},_loadScrumGroupPortfolioProject:function(scrumGroupRootProjectRecord){if(!scrumGroupRootProjectRecord)return Q.reject("Invalid arguments: _loadScrumGroupPortfolioProject");var me=this,foundScrumGroupConfig=_.find(me.ScrumGroupConfig,function(scrumGroupConfig){return scrumGroupConfig.ScrumGroupRootProjectOID==scrumGroupRootProjectRecord.data.ObjectID});return foundScrumGroupConfig?foundScrumGroupConfig.ScrumGroupAndPortfolioLocationTheSame?Q(scrumGroupRootProjectRecord):me._loadProject(foundScrumGroupConfig.PortfolioProjectOID):Q.reject("Project "+scrumGroupRootProjectRecord.data.Name+" is not a scrum group!")},_getScrumGroupName:function(scrumGroupRootProjectRecord){if(!scrumGroupRootProjectRecord)throw"Invalid arguments: _getScrumGroupName";var me=this,foundScrumGroupConfig=_.find(me.ScrumGroupConfig,function(scrumGroupConfig){return scrumGroupConfig.ScrumGroupRootProjectOID==scrumGroupRootProjectRecord.data.ObjectID});if(!foundScrumGroupConfig)throw"Project "+scrumGroupRootProjectRecord.data.Name+" is not a scrum-group!";return foundScrumGroupConfig.ScrumGroupName?foundScrumGroupConfig.ScrumGroupName:scrumGroupRootProjectRecord.data.Name},_loadAllScrumGroups:function(){var me=this,filter=_.reduce(me.ScrumGroupConfig,function(filter,scrumGroupConfig){var newFilter=Ext.create("Rally.data.wsapi.Filter",{property:"ObjectID",value:scrumGroupConfig.ScrumGroupRootProjectOID});return filter?filter.or(newFilter):newFilter},null);if(filter){var store=Ext.create("Rally.data.wsapi.Store",{model:"Project",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._projectFields,filters:[filter],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})}return Q([])},__getUserStoryInReleaseTimeFrameFilter:function(releaseRecord){var me=this,lowestPortfolioItem=me.PortfolioItemTypes[0],twoWeeks=12096e5,releaseStartPadding=new Date(1*new Date(releaseRecord.data.ReleaseStartDate)+twoWeeks).toISOString(),releaseEndPadding=new Date(1*new Date(releaseRecord.data.ReleaseDate)-twoWeeks).toISOString();return Ext.create("Rally.data.wsapi.Filter",{property:"Release.ReleaseStartDate",operator:"<",value:releaseStartPadding}).and(Ext.create("Rally.data.wsapi.Filter",{property:"Release.ReleaseDate",operator:">",value:releaseEndPadding})).or(Ext.create("Rally.data.wsapi.Filter",{property:"Release.ObjectID",value:null}).and(Ext.create("Rally.data.wsapi.Filter",{property:lowestPortfolioItem+".Release.ReleaseStartDate",operator:"<",value:releaseStartPadding}).and(Ext.create("Rally.data.wsapi.Filter",{property:lowestPortfolioItem+".Release.ReleaseDate",operator:">",value:releaseEndPadding}))))},_loadRandomUserStory:function(projectRecord){if(!projectRecord)return Q.reject("Invalid arguments: LRUS");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1,pageSize:1,disableMetaChangeEvent:!0,fetch:!1,context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID}]});return me._reloadStore(store).then(function(store){return store.getRange().pop()})},_loadRandomUserStoryFromReleaseTimeframe:function(projectRecord,releaseRecord){if(!projectRecord||!releaseRecord)return Q.reject("Invalid arguments: LRUSFR");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:5,pageSize:5,disableMetaChangeEvent:!0,fetch:me._userStoryFields,context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},sorters:[{property:"CreationDate",direction:"DESC"}],filters:[Ext.create("Rally.data.wsapi.Filter",{property:"Project.ObjectID",value:projectRecord.data.ObjectID}).and(me.__getUserStoryInReleaseTimeFrameFilter(releaseRecord))]});return me._reloadStore(store).then(function(store){var records=store.data.items;return records.length?Q(records[Math.floor(Math.random()*records.length)]):Q(void 0)})},_loadUserStoryByFID:function(formattedID,projectRecord){if(!formattedID||!projectRecord)return Q.reject("Invalid arguments: LUSBFID");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"HierarchicalRequirement",limit:1,pageSize:1,disableMetaChangeEvent:!0,fetch:["Name","Project","ObjectID","FormattedID","Predecessors","Successors","c_Dependencies"],context:{workspace:me.getContext().getWorkspace()._ref,project:void 0},filters:[{property:"FormattedID",value:formattedID},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_loadPortfolioItemsOfType:function(portfolioProject,type){if(!portfolioProject||!type)return Q.reject("Invalid arguments: OPIOT");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/"+type,limit:1/0,disableMetaChangeEvent:!0,remoteSort:!1,fetch:me._portfolioItemFields,context:{project:portfolioProject.data._ref,projectScopeDown:!0,projectScopeUp:!1}});return me._reloadStore(store)},_loadPortfolioItemsOfOrdinal:function(portfolioProject,ordinal){if(!portfolioProject||ordinal===void 0)return Q.reject("Invalid arguments: LPIOO");var me=this,type=me.PortfolioItemTypes[ordinal];return type?me._loadPortfolioItemsOfType(portfolioProject,type):Q.reject("Invalid PortfolioItem ordinal")},_portfolioItemTypeToOrdinal:function(type){return this.PortfolioItemTypes.indexOf(type)},_getPortfolioItemTypeStateByOrdinal:function(ordinal,stateName){return _.find(this.PortfolioItemTypeStates[ordinal],function(state){return state.data.Name==stateName})},_getPortfolioItemTypeStateByName:function(portfolioType,stateName){return this._getPortfolioItemTypeStateByOrdinal(this._portfolioItemTypeToOrdinal(portfolioType),stateName)},__storeItemsToProjTree:function(projects){for(var me=this,projTree={},i=0,len=projects.length;len>i;++i){var project=projects[i],thisRef=project.data.ObjectID,parentRef=project.data.Parent?project.data.Parent.ObjectID:void 0;projTree[thisRef]||(projTree[thisRef]={}),projTree[thisRef].ProjectRecord=project,parentRef&&(projTree[parentRef]||(projTree[parentRef]={}),projTree[parentRef][thisRef]=projTree[thisRef])}return projTree},_loadAllProjects:function(){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){var map=_.reduce(store.getRange(),function(map,project){return map[project.data.ObjectID]=project,map},{});return map})},__addProjectsWithTeamMembersToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;curProj.data.TeamMembers.Count>0&&(hash[curProj.data.ObjectID]=curProj);for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__addProjectsWithTeamMembersToList(projTree[childProjRef],hash)},_loadProjectsWithTeamMembers:function(rootProjectRecord){var me=this,projectsWithTeamMembers={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__addProjectsWithTeamMembersToList(projTree[rootProjectRecord.data.ObjectID],projectsWithTeamMembers),projectsWithTeamMembers}return _.reduce(_.filter(store.getRange(),function(project){return project.data.TeamMembers.Count>0}),function(map,project){return map[project.data.ObjectID]=project,map},{})})},__allChildProjectToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;hash[curProj.data.ObjectID]=curProj;for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__allChildProjectToList(projTree[childProjRef],hash)},_loadAllChildrenProjects:function(rootProjectRecord){var me=this,childrenProjects={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__allChildProjectToList(projTree[rootProjectRecord.data.ObjectID],childrenProjects),childrenProjects}return _.reduce(store.getRange(),function(map,project){return map[project.data.ObjectID]=project,map},{})})},__allLeafProjectsToList:function(projTree,hash){var me=this,curProj=projTree.ProjectRecord;0===curProj.data.Children.Count&&(hash[curProj.data.ObjectID]=curProj);for(var childProjRef in projTree)"ProjectRecord"!==childProjRef&&me.__allLeafProjectsToList(projTree[childProjRef],hash)},_loadAllLeafProjects:function(rootProjectRecord){var me=this,leafProjects={},store=Ext.create("Rally.data.wsapi.Store",{model:"Project",fetch:me._projectFields,limit:1/0,disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){if(rootProjectRecord){var projTree=me.__storeItemsToProjTree(store.getRange());return me.__allLeafProjectsToList(projTree[rootProjectRecord.data.ObjectID],leafProjects),leafProjects}return _.reduce(_.filter(store.getRange(),function(project){return 0===project.data.Children.Count}),function(map,project){return map[project.data.ObjectID]=project,map},{})})},_loadProjectByName:function(projectName){if(!projectName)return Q.reject("Invalid arguments: LPBN");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Project",limit:1,pageSize:1,fetch:["Name","ObjectID"],disableMetaChangeEvent:!0,context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Name",value:projectName}]});return me._reloadStore(store).then(function(store){return Q(store.data.items.pop())})},_loadAllReleases:function(projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesAfterGivenDate:function(projectRecord,givenDate){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"ReleaseDate",operator:">=",value:new Date(givenDate).toISOString()},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesBeforeGivenDate:function(projectRecord,givenDate){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!1,disableMetaChangeEvent:!0,fetch:me._releaseFields,filters:[{property:"ReleaseDate",operator:"<=",value:new Date(givenDate).toISOString()},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesBetweenDates:function(projectRecord,startDate,endDate){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,autoLoad:!1,fetch:["Name","ObjectID","ReleaseDate","ReleaseStartDate","Project"],context:{workspace:me.getContext().getWorkspace()._ref,project:null},filters:[{property:"Project.ObjectID",value:projectRecord.data.ObjectID},{property:"ReleaseDate",operator:">",value:new Date(startDate).toISOString()},{property:"ReleaseStartDate",operator:"<",value:new Date(endDate).toISOString()}]});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleasesInTheFuture:function(projectRecord){return this._loadReleasesAfterGivenDate(projectRecord,new Date)},_loadReleasesByNameUnderProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",value:releaseName}],context:{project:projectRecord.data._ref,projectScopeDown:!0,projectScopeUp:!1}});return me._reloadStore(store).then(function(store){return store.getRange()})},_loadReleaseByNameForProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",value:releaseName},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange().pop()})},_loadReleasesByNameContainsForProject:function(releaseName,projectRecord){var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"Release",limit:1/0,disableMetaChangeEvent:!0,autoLoad:!1,fetch:me._releaseFields,filters:[{property:"Name",operator:"contains",value:releaseName},{property:"Project.ObjectID",value:projectRecord.data.ObjectID}],context:{workspace:me.getContext().getWorkspace()._ref,project:null}});return me._reloadStore(store).then(function(store){return store.getRange()})},_getScopedRelease:function(releaseRecords,projectOID,appPrefs){var me=this,d=new Date,rs=releaseRecords,prefOID=appPrefs&&appPrefs.projs&&appPrefs.projs[projectOID]&&appPrefs.projs[projectOID].Release;return prefOID&&_.find(rs,function(r){return r.data.ObjectID==prefOID})||_.find(rs,function(r){return new Date(r.data.ReleaseDate)>=d&&d>=new Date(r.data.ReleaseStartDate)})||_.reduce(rs,function(best,r){if(null===best)return r;var d1=1*new Date(best.data.ReleaseStartDate),d2=1*new Date(r.data.ReleaseStartDate),now=1*new Date;return Math.abs(d1-now)<Math.abs(d2-now)?best:r},null)}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("WorkweekDropdown",{extend:"Ext.data.Model",fields:[{name:"Workweek",type:"string"},{name:"DateVal",type:"number"}]}),Ext.define("ScrumGroupPortfolioConfigItem",{extend:"Ext.data.Model",fields:[{name:"ScrumGroupRootProjectOID",type:"number"},{name:"ScrumGroupName",type:"string"},{name:"ScrumGroupAndPortfolioLocationTheSame",type:"boolean"},{name:"PortfolioProjectOID",type:"number"},{name:"IsTrain",type:"boolean"}]})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("WindowListener",{__initWindowEventListener:function(eventName){var me=this;me._windowListeners||(me._windowListeners={}),me._windowListeners[eventName]=[],window.parent["on"+eventName]=function(event){for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i](event)}},_addWindowEventListener:function(eventName,fn){var me=this;me._windowListeners&&me._windowListeners[eventName]||me.__initWindowEventListener(eventName),me._windowListeners[eventName].push(fn)},_fireParentWindowEvent:function(eventName){var me=this;if(me._windowListeners&&me._windowListeners[eventName])for(var listeners=me._windowListeners[eventName],i=0,len=listeners.length;len>i;++i)listeners[i]()}})})();
                (function(){var Ext=window.Ext4||window.Ext,TOP_BAR_HEIGHT=40,BOTTOM_BAR_HEIGHT=24,BOTTOM_IFRAME_PADDING=20,TITLE_BAR_HEIGHT=33,IFRAME_HEADER_HEIGHT=28;Ext.define("IframeResize",{requires:["WindowListener"],_fixRallyDashboard:function(){if(window&&window.frameElement){for(var me=this,bottomEl=Ext.get(window.frameElement),portlet=bottomEl.up(".x-portlet"),dashboard=portlet.up("#mydash_portlet"),titleBar=dashboard.down(".titlebar"),domNodeW=bottomEl.dom,domNodeH=bottomEl.dom,innerHeight=window.parent.innerHeight,innerWidth=window.parent.innerWidth;;){if(domNodeW.style.width=innerWidth-4+"px",domNodeW.style.padding="0",domNodeW.style.margin="0","mydash_portlet"===domNodeW.id)break;domNodeW=domNodeW.parentNode}for(;;){if(domNodeH.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT+TITLE_BAR_HEIGHT+IFRAME_HEADER_HEIGHT+BOTTOM_IFRAME_PADDING)+"px",domNodeH.classList.contains("x-portlet"))break;domNodeH=domNodeH.parentNode}for(;;){if(domNodeH.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT+TITLE_BAR_HEIGHT)+"px","mydash_portlet"==domNodeH.id)break;domNodeH=domNodeH.parentNode}dashboard.dom.style.height=innerHeight-(TOP_BAR_HEIGHT+BOTTOM_BAR_HEIGHT)+"px",dashboard.dom.style.padding="0 2px 0 2px",titleBar.dom.style.padding="2px",titleBar.dom.style.margin="0"}},_initFixRallyDashboard:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._fixRallyDashboard()}),me._fixRallyDashboard()},_disableResizeHandle:function(){var me=this,handle;window&&window.frameElement&&(handle=Ext.get(window.frameElement).up(".x-portlet").down(".x-resizable-handle"),handle&&(handle.hide(),handle.dom.onshow=function(){handle&&handle.hide()}))},_initDisableResizeHandle:function(){var me=this;me._addWindowEventListener&&me._addWindowEventListener("resize",function(){me._disableResizeHandle()}),me._disableResizeHandle()}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("AsyncQueue",{QueueOfFuncs:{},_dequeue:function(queueName){var me=this;if(queueName=queueName||"undefined",me.QueueOfFuncs[queueName]){if(me.QueueOfFuncs[queueName].shift(),!me.QueueOfFuncs[queueName].length)return;setTimeout(function(){me.QueueOfFuncs[queueName][0].call(me,me._dequeue.bind(me,queueName))},0)}},_enqueue:function(callback,queueName){var me=this;if(queueName=queueName||"undefined","function"!=typeof callback)throw"ERROR: not a function";me.QueueOfFuncs[queueName]&&me.QueueOfFuncs[queueName].length?me.QueueOfFuncs[queueName].push(callback):(me.QueueOfFuncs[queueName]=[callback],setTimeout(function(){callback.call(me,me._dequeue.bind(me,queueName))},0))}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("PrettyAlert",{__getMessageBoxY:function(){var me=this,bottomEl=window.frameElement?Ext.get(window.frameElement):me.el,ph=window.frameElement?window.parent.getWindowHeight():window.innerHeight,ps=window.frameElement?window.parent.getScrollY():window.scrollY,ofy=ps+bottomEl.dom.getBoundingClientRect().top,iyOffset=Math.floor(ph/2-ofy+ps-50);return 0>iyOffset?0:iyOffset},_alert:function(title,message){var me=this;message="string"==typeof message?message:message.message?message.message:JSON.stringify(message,null,"	"),1>arguments.length||(1===arguments.length&&(message=title,title=""),Ext.MessageBox.alert(title,message).setY(me.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},50))},_confirm:function(title,message,fn){var me=this;message="string"==typeof message?message:message.message?message.message:JSON.stringify(message,null,"	"),2>arguments.length||(2===arguments.length&&(fn=message,message=title,title=""),"function"!=typeof fn&&(fn=function(){}),Ext.MessageBox.confirm(title,message,fn).setY(me.__getMessageBoxY()),setTimeout(function(){for(var x=Ext.MessageBox.down("button");x.isHidden();)x=x.nextSibling();x.focus()},20))}})})();
                (function(){var Ext=window.Ext4||window.Ext,intel_ww={},SECOND=1e3,MINUTE=60*SECOND,HOUR=60*MINUTE,DAY=24*HOUR,WEEK=7*DAY;Ext.define("IntelWorkweek",{_getWorkweek:function(_date){var date=new Date(_date),yearStart=new Date(date.getFullYear(),0,1),dayIndex=yearStart.getDay(),ww01Start=new Date(yearStart-dayIndex*DAY),utcDateMillis=Date.UTC(date.getFullYear(),date.getMonth(),date.getDate()),ww01Millis=Date.UTC(ww01Start.getFullYear(),ww01Start.getMonth(),ww01Start.getDate()),timeDiff=utcDateMillis-ww01Millis,ww=Math.floor(timeDiff/WEEK)+1,leap=0===date.getFullYear()%4,weekCount=leap&&dayIndex>=5||!leap&&6===dayIndex?53:52;return ww>weekCount?1:ww},_getWeekCount:function(_date){var date=new Date(_date),leap=0===date.getFullYear()%4,day=new Date(date.getFullYear(),0,1).getDay();return leap&&day>=5||!leap&&6===day?53:52},_roundDateDownToWeekStart:function(_date){var date=new Date(_date),day=date.getDay(),monthDate=date.getDate(),month=date.getMonth(),year=date.getFullYear(),sundayMidday=new Date(1*new Date(year,month,monthDate)-(day*DAY-.5*DAY));return new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())},_getWorkweekDates:function(startDate,endDate){for(var startWeekDate=this._roundDateDownToWeekStart(startDate),endWeekDate=this._roundDateDownToWeekStart(endDate),startMillis=Date.UTC(startWeekDate.getFullYear(),startWeekDate.getMonth(),startWeekDate.getDate()),endMillis=Date.UTC(endWeekDate.getFullYear(),endWeekDate.getMonth(),endWeekDate.getDate()),totalWeeks=Math.floor((endMillis-startMillis)/WEEK)+1,weeks=Array(totalWeeks),i=0;totalWeeks>i;++i){var sundayMidday=new Date(1*startWeekDate+(WEEK*i+12*HOUR));weeks[i]=new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())}return weeks},_workweekToDate:function(ww,year){var yearStart=new Date(year,0,1),dayIndex=yearStart.getDay(),ww01StartMidday=new Date(yearStart-(dayIndex*DAY-.5*DAY)),sundayMidday=new Date(1*ww01StartMidday+(ww-1)*WEEK);return new Date(sundayMidday.getFullYear(),sundayMidday.getMonth(),sundayMidday.getDate())},_getWorkWeeksForDropdown:function(releaseStartDate,releaseEndDate){for(var workweeks=this._getWorkweekDates(releaseStartDate,releaseEndDate),data=Array(workweeks.length),i=0,len=workweeks.length;len>i;++i)data[i]={Workweek:"ww"+this._getWorkweek(workweeks[i]),DateVal:1*workweeks[i]};return data}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("ParallelLoader",{_parallelLoadWsapiStore:function(config){function doStoreLoad(page){var deferred=Q.defer(),store=Ext.create("Rally.data.wsapi.Store",_.merge({},config,{pageSize:200,listeners:{load:function(store,records,successful){successful?deferred.resolve(store):deferred.reject("could not load data from server")}}}));return store.loadPage(page),deferred.promise}function makeStore(){return Ext.create("Rally.data.wsapi.Store",{model:model,totalCount:data.length,data:data,disableMetaChangeEvent:!0,load:function(){}})}var me=this,data=[],model;return doStoreLoad(1).then(function(store){data=data.concat(store.getRange()),model=store.model;var pages=(store.totalCount/200>>0)+(store.totalCount%200?1:0)||1;return 1===pages?makeStore():Q.all(_.times(pages-1,function(pageNum){return doStoreLoad(pageNum+2).then(function(store){data=data.concat(store.getRange())})})).then(makeStore)})},_parallelLoadLookbackStore:function(config){function doStoreLoad(page){var deferred=Q.defer(),store=Ext.create("Rally.data.lookback.SnapshotStore",_.merge({},config,{pageSize:2e4,listeners:{load:function(store,records,successful){successful?deferred.resolve(store):deferred.reject("could not load data from server")}}}));return store.loadPage(page),deferred.promise}function makeStore(){return Ext.create("Rally.data.lookback.SnapshotStore",{model:model,totalCount:data.length,data:data,disableMetaChangeEvent:!0,load:function(){}})}var me=this,data=[],model;return doStoreLoad(1).then(function(store){data=data.concat(store.getRange()),model=store.model;var pages=(store.totalCount/2e4>>0)+(store.totalCount%2e4?1:0)||1;return 1===pages?makeStore():Q.all(_.times(pages-1,function(pageNum){return doStoreLoad(pageNum+2).then(function(store){data=data.concat(store.getRange())})})).then(makeStore)})}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("UserAppsPreference",{_userAppsPref:"intel-user-apps-preference",_loadAppsPreference:function(){var me=this,deferred=Q.defer();return Rally.data.PreferenceManager.load({filterByUser:!0,filterByName:me._userAppsPref,success:function(prefs){var appPrefs=prefs[me._userAppsPref];try{appPrefs=JSON.parse(appPrefs)}catch(e){appPrefs={projs:{},refresh:0}}deferred.resolve(appPrefs)},failure:deferred.reject}),deferred.promise},_saveAppsPreference:function(prefs){var me=this,s={},deferred=Q.defer();return prefs={projs:prefs.projs,refresh:prefs.refresh},s[me._userAppsPref]=JSON.stringify(prefs),Rally.data.PreferenceManager.update({filterByUser:!0,filterByName:me._userAppsPref,settings:s,success:deferred.resolve,failure:deferred.reject}),deferred.promise}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelComboBox",{extend:"Ext.form.field.ComboBox",alias:["widget.intelcombo","widget.intelcombobox"],constructor:function(options){options=options||{},options=Ext.merge({enableKeyEvents:!0,queryMode:"local",ignoreNoChange:!0,allowBlank:!0,listeners:{keyup:function(a,b){if(!(b.keyCode>=37&&40>=b.keyCode)){var combo=this;combo.store.clearFilter(),combo.store.filterBy(function(item){return null!==item.data[combo.displayField].match(RegExp(combo.getRawValue(),"i"))})}},focus:function(combo){combo.store.clearFilter(),combo.setValue(""),combo.expand()}}},options),this.callParent([options])}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelFixedComboBox",{extend:"Ext.form.field.ComboBox",alias:["widget.intelfixedcombo","widget.intelfixedcombobox"],constructor:function(options){options=options||{},options=Ext.merge({editable:!1,allowBlank:!0,queryMode:"local",listeners:{change:function(combo,newval,oldval){0===newval.length&&combo.setValue(oldval)},focus:function(combo){combo.setValue(""),combo.expand()}}},options),this.callParent([options])}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelReleasePicker",{extend:"IntelFixedComboBox",alias:["widget.intelreleasepicker"],constructor:function(options){options.releases&&options.currentRelease&&(options.displayField="Name",options.value=options.currentRelease.data.Name,options.store=Ext.create("Ext.data.Store",{fields:["Name"],data:_.map(options.releases,function(r){return{Name:r.data.Name}})}),options.fieldLabel=options.fieldLabel||"Release:",options.editable=options.editable||!1,options.width=options.width||240,options.labelWidth=options.labelWidth||50,this.callParent([options]))}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("IntelVelocity",{extend:"Ext.data.Model",fields:[{name:"Name",type:"string"},{name:"PlannedVelocity",type:"number"},{name:"RealVelocity",type:"number"}]}),Ext.define("IntelTeamCommits",{extend:"Ext.data.Model",fields:[{name:"PortfolioItemObjectID",type:"number"},{name:"PortfolioItemMoSCoW",type:"string"},{name:"PortfolioItemName",type:"string"},{name:"PortfolioItemFormattedID",type:"string"},{name:"PortfolioItemPlannedEnd",type:"number"},{name:"TopPortfolioItemName",type:"string"},{name:"Commitment",type:"string"},{name:"Expected",type:"boolean"},{name:"Objective",type:"string"}]}),Ext.define("IntelRisk",{extend:"Ext.data.Model",fields:[{name:"RiskID",type:"string"},{name:"PortfolioItemObjectID",type:"number"},{name:"PortfolioItemFormattedID",type:"string"},{name:"PortfolioItemName",type:"string"},{name:"Description",type:"string"},{name:"Impact",type:"string"},{name:"MitigationPlan",type:"string"},{name:"Urgency",type:"string"},{name:"Status",type:"string"},{name:"Contact",type:"string"},{name:"Checkpoint",type:"number"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelPredecessorItem",{extend:"Ext.data.Model",fields:[{name:"PredecessorItemID",type:"string"},{name:"PredecessorUserStoryObjectID",type:"number"},{name:"PredecessorProjectObjectID",type:"number"},{name:"Supported",type:"string"},{name:"Assigned",type:"boolean"}]}),Ext.define("IntelPredecessorDependency",{extend:"Ext.data.Model",fields:[{name:"DependencyID",type:"string"},{name:"UserStoryObjectID",type:"number"},{name:"UserStoryFormattedID",type:"string"},{name:"UserStoryName",type:"string"},{name:"Description",type:"string"},{name:"NeededBy",type:"number"},{name:"Status",type:"string"},{name:"PredecessorItems",type:"auto"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelSuccessorDependency",{extend:"Ext.data.Model",fields:[{name:"DependencyID",type:"string"},{name:"SuccessorUserStoryObjectID",type:"string"},{name:"SuccessorProjectObjectID",type:"string"},{name:"UserStoryObjectID",type:"number"},{name:"UserStoryFormattedID",type:"string"},{name:"UserStoryName",type:"string"},{name:"Description",type:"string"},{name:"NeededBy",type:"number"},{name:"Supported",type:"string"},{name:"Assigned",type:"boolean"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelRiskForTracking",{extend:"Ext.data.Model",fields:[{name:"RiskID",type:"string"},{name:"PortfolioItemObjectID",type:"number"},{name:"PortfolioItemFormattedID",type:"string"},{name:"PortfolioItemName",type:"string"},{name:"TopPortfolioItemName",type:"string"},{name:"ProjectObjectID",type:"number"},{name:"Description",type:"string"},{name:"Impact",type:"string"},{name:"MitigationPlan",type:"string"},{name:"Urgency",type:"string"},{name:"Status",type:"string"},{name:"Contact",type:"string"},{name:"Checkpoint",type:"number"},{name:"Edited",type:"boolean"}]}),Ext.define("IntelPredecessorDependencyForTracking",{extend:"Ext.data.Model",fields:[{name:"DependencyID",type:"string"},{name:"UserStoryObjectID",type:"number"},{name:"UserStoryFormattedID",type:"string"},{name:"UserStoryName",type:"string"},{name:"TopPortfolioItemName",type:"string"},{name:"ProjectObjectID",type:"number"},{name:"Description",type:"string"},{name:"NeededBy",type:"number"},{name:"Status",type:"string"},{name:"PredecessorItems",type:"auto"},{name:"Edited",type:"boolean"}]}),Ext.define("CommitsMatrixPortfolioItem",{extend:"Ext.data.Model",fields:[{name:"PortfolioItemObjectID",type:"number"},{name:"PortfolioItemRank",type:"number"},{name:"PortfolioItemName",type:"string"},{name:"PortfolioItemFormattedID",type:"string"},{name:"PortfolioItemPlannedEnd",type:"number"},{name:"TopPortfolioItemName",type:"string"},{name:"MoSCoW",type:"string"}]}),Ext.define("IntelSwimlaneRiskForTracking",{extend:"Rally.data.Model",fields:[{name:"_originalRiskData",type:"auto"},{name:"RiskID",type:"string"},{name:"Rank",type:"string"},{name:"PortfolioItem #",type:"string"},{name:"PortfolioItem Name",type:"string"},{name:"Project",type:"string"},{name:"Risk Description",type:"string"},{name:"Impact",type:"string"},{name:"MitigationPlan",type:"string"},{name:"Urgency",type:"string",attributeDefinition:{AttributeType:"Dropdown"}},{name:"Status",type:"string"},{name:"Contact",type:"string"},{name:"Checkpoint",type:"string"},{name:"updatable",type:"boolean"}],idField:{name:"RiskID"},idProperty:"RiskID",isTask:function(){return!1},isSearch:function(){return!1}}),Ext.define("SAFeCustomFieldsEditorModel",{extend:"Ext.data.Model",fields:[{name:"ItemFormattedID",type:"string"},{name:"ItemName",type:"string"},{name:"ProjectName",type:"string"},{name:"ReleaseName",type:"string"},{name:"CustomFieldValue",type:"string"}]})})();
                (function(){var Ext=window.Ext4||window.Ext,RALLY_MAX_STRING_SIZE=32768;Ext.define("RisksLib",{requires:["IntelRallyApp"],_getRisks:function(portfolioItemRecord){var risks=portfolioItemRecord.data.c_Risks;try{risks=JSON.parse(atob(risks))||{}}catch(e){risks={}}return risks},_removeRisk:function(portfolioItemRecord,riskData,projectRecord,risksParsedData){risksParsedData=risksParsedData||[];var me=this,risks=me._getRisks(portfolioItemRecord),projectOID=projectRecord.data.ObjectID,deferred=Q.defer();if(risks[projectOID]){delete risks[projectOID][riskData.RiskID];var indexToSplice=_.findIndex(risksParsedData,function(cachedRisk){return cachedRisk.RiskID===riskData.RiskID&&cachedRisk.PortfolioItemObjectID===riskData.PortfolioItemObjectID});indexToSplice>-1&&risksParsedData.splice(indexToSplice,1);var risksString=btoa(JSON.stringify(risks,null,"	"));risksString.length>=RALLY_MAX_STRING_SIZE?deferred.reject("Risks field for "+portfolioItemRecord.data.FormattedID+" ran out of space! Cannot save"):(portfolioItemRecord.set("c_Risks",risksString),portfolioItemRecord.save({callback:function(record,operation,success){success?deferred.resolve():deferred.reject("Failed to modify "+me.PortfolioItemTypes[0]+": "+portfolioItemRecord.data.FormattedID)}}))}else deferred.resolve();return deferred.promise},_addRisk:function(portfolioItemRecord,riskData,projectRecord,risksParsedData){risksParsedData=risksParsedData||[];var me=this,risks=me._getRisks(portfolioItemRecord),projectOID=projectRecord.data.ObjectID,deferred=Q.defer();riskData=Ext.clone(riskData),riskData.Edited=!1,risks[projectOID]||(risks[projectOID]={}),risks[projectOID][riskData.RiskID]={Checkpoint:riskData.Checkpoint,Description:riskData.Description,Impact:riskData.Impact,MitigationPlan:riskData.MitigationPlan,Urgency:riskData.Urgency,Status:riskData.Status,Contact:riskData.Contact};var indexToSplice=_.findIndex(risksParsedData,function(cachedRisk){return cachedRisk.RiskID===riskData.RiskID&&cachedRisk.PortfolioItemObjectID===riskData.PortfolioItemObjectID});indexToSplice>-1&&risksParsedData.splice(indexToSplice,1),risksParsedData.push(riskData);var risksString=btoa(JSON.stringify(risks,null,"	"));return risksString.length>=RALLY_MAX_STRING_SIZE?deferred.reject("Risks field for "+portfolioItemRecord.data.FormattedID+" ran out of space! Cannot save"):(portfolioItemRecord.set("c_Risks",risksString),portfolioItemRecord.save({callback:function(record,operation,success){success?deferred.resolve():deferred.reject("Failed to modify "+me.PortfolioItemTypes[0]+": "+portfolioItemRecord.data.FormattedID)}})),deferred.promise}})})();
                (function(){var Ext=window.Ext4||window.Ext;Ext.define("RiskSwimlane",{extend:"IntelRallyApp",cls:"RiskSwimlaneApp",mixins:["WindowListener","PrettyAlert","IframeResize","IntelWorkweek","AsyncQueue","ParallelLoader","RisksLib","UserAppsPreference"],layout:{type:"vbox",align:"stretch",pack:"start"},items:[{xtype:"container",itemId:"navbox",layout:{type:"hbox",align:"stretch",pack:"start"},items:[{xtype:"container",flex:3,itemId:"navboxLeft",layout:"hbox",items:[{xtype:"container",flex:1,itemId:"navboxLeftVert",layout:"vbox"}]},{xtype:"container",flex:2,itemId:"navboxRight",layout:{type:"hbox",pack:"end"}}]}],minWidth:910,_userAppsPref:"intel-SAFe-apps-preference",_loadPortfolioItemsOfTypeInRelease:function(portfolioProject,type){if(!portfolioProject||!type)return Q.reject("Invalid arguments: _loadPortfolioItemsOfTypeInRelease");var me=this,store=Ext.create("Rally.data.wsapi.Store",{model:"PortfolioItem/"+type,limit:1/0,disableMetaChangeEvent:!0,remoteSort:!1,fetch:["Name","ObjectID","FormattedID","c_Risks","Release","Project","PlannedEndDate","Parent","PortfolioItemType","Ordinal"],filters:[{property:"Release.Name",value:me.ReleaseRecord.data.Name}],context:{project:portfolioProject.data._ref,projectScopeDown:!0,projectScopeUp:!1}});return me._reloadStore(store)},_loadPortfolioItems:function(){var me=this,deferred=Q.defer();return me._enqueue(function(done){Q.all(_.map(me.PortfolioItemTypes,function(type,ordinal){return(ordinal?me._loadPortfolioItemsOfType(me.TrainPortfolioProject,type):me._loadPortfolioItemsOfTypeInRelease(me.TrainPortfolioProject,type)).then(function(portfolioStore){return{ordinal:ordinal,store:portfolioStore}})})).then(function(items){var orderedPortfolioItemStores=_.sortBy(items,function(item){return item.ordinal});for(me.PortfolioItemStore&&me.PortfolioItemStore.destroyStore(),me.PortfolioItemStore=orderedPortfolioItemStores[0].store,me.PortfolioItemMap={},_.each(me.PortfolioItemStore.getRange(),function(lowPortfolioItemRecord){for(var ordinal=0,parentPortfolioItemRecord=lowPortfolioItemRecord,getParentRecord=function(child,parentList){return _.find(parentList,function(parent){return child.data.Parent&&parent.data.ObjectID==child.data.Parent.ObjectID})};orderedPortfolioItemStores.length-1>ordinal&&parentPortfolioItemRecord;)parentPortfolioItemRecord=getParentRecord(parentPortfolioItemRecord,orderedPortfolioItemStores[ordinal+1].store.getRange()),++ordinal;ordinal===orderedPortfolioItemStores.length-1&&parentPortfolioItemRecord&&(me.PortfolioItemMap[lowPortfolioItemRecord.data.ObjectID]=parentPortfolioItemRecord.data.Name)}),orderedPortfolioItemStores.shift();orderedPortfolioItemStores.length;)orderedPortfolioItemStores.shift().store.destroyStore()}).then(function(){done(),deferred.resolve()}).fail(function(reason){done(),deferred.reject(reason)}).done()},"PortfolioItemQueue"),deferred.promise},_parseRisksFromPortfolioItem:function(portfolioItemRecord){var me=this,array=[],risks=me._getRisks(portfolioItemRecord),PortfolioItemFormattedID=portfolioItemRecord.data.FormattedID,PortfolioItemName=portfolioItemRecord.data.Name;return _.each(risks,function(risksData,projectID){_.each(risksData,function(riskData,riskID){array.push({_originalRiskData:Ext.merge({RiskID:riskID},riskData),RiskID:riskID,Rank:1,"PortfolioItem #":PortfolioItemFormattedID,"PortfolioItem Name":PortfolioItemName,Project:(_.find(me.ProjectsWithTeamMembers,function(project){return project.data.ObjectID==projectID})||{data:{}}).data.Name||"?","Risk Description":riskData.Description,Impact:riskData.Impact,MitigationPlan:riskData.MitigationPlan||" ",Urgency:riskData.Urgency||"Undefined",Status:riskData.Status,Contact:riskData.Contact,Checkpoint:"ww"+me._getWorkweek(riskData.Checkpoint),updatable:!0})})}),array},_parseRisksData:function(){var me=this,array=[];return _.each(me.PortfolioItemStore.getRecords(),function(portfolioItemRecord){array=array.concat(me._parseRisksFromPortfolioItem(portfolioItemRecord))}),array},_saveRisk:function(riskData){var me=this,data=Ext.clone(riskData)._originalRiskData,portfolioItem=_.find(me.PortfolioItemStore.getRange(),function(pi){return pi.data.FormattedID==riskData["PortfolioItem #"]}),projectRecord=_.find(me.ProjectsWithTeamMembers,function(project){return project.data.Name==riskData.Project});data.Urgency=riskData.Urgency,data.Status=riskData.Status,me._addRisk(portfolioItem,data,projectRecord)},_showSwimlanes:function(){var me=this;me.RisksSwimlanes||me._loadRisksSwimlanes()},_updateSwimlanes:function(){var me=this;me.PortfolioItemStore&&me.MatrixStore&&me.MatrixStore.intelUpdate()},_clearEverything:function(){var me=this;me.RiskSwimlanes&&(document.getElementById("risk-swimlanes").remove(),me.RiskSwimlanes=void 0)},_reloadStores:function(){var me=this;return me._loadPortfolioItems().then(function(){me.Risks=me._parseRisksData()})},_reloadEverything:function(){var me=this;me.setLoading("Loading Data"),me._enqueue(function(done){me._reloadStores().then(function(){me._clearEverything(),me.ReleasePicker||me._loadReleasePicker()}).then(function(){me._updateSwimlanes()}).then(function(){me._showSwimlanes()}).fail(function(reason){me._alert("ERROR",reason)}).then(function(){me.setLoading(!1),done()}).done()},"ReloadAndRefreshQueue")},launch:function(){var me=this;return me.setLoading("Loading configuration"),me._initDisableResizeHandle(),me._initFixRallyDashboard(),me.getContext().getPermissions().isProjectEditor(me.getContext().getProject())?(me._configureIntelRallyApp().then(function(){var scopeProject=me.getContext().getProject();return me._loadProject(scopeProject.ObjectID)}).then(function(scopeProjectRecord){return me.ProjectRecord=scopeProjectRecord,Q.all([me._projectInWhichTrain(me.ProjectRecord).then(function(trainRecord){return trainRecord&&me.ProjectRecord.data.ObjectID==trainRecord.data.ObjectID?(me.TrainRecord=trainRecord,me._loadTrainPortfolioProject(me.TrainRecord).then(function(trainPortfolioProject){return trainPortfolioProject?(me.TrainPortfolioProject=trainPortfolioProject,void 0):Q.reject("Invalid portfolio location")})):Q.reject("You are not scoped to a train")}),me._loadAppsPreference().then(function(appsPref){me.AppsPref=appsPref;var twelveWeeks=72576e5;return me._loadReleasesAfterGivenDate(me.ProjectRecord,1*new Date-twelveWeeks)}).then(function(releaseRecords){me.ReleaseRecords=releaseRecords;var currentRelease=me._getScopedRelease(releaseRecords,me.ProjectRecord.data.ObjectID,me.AppsPref);return currentRelease?(me.ReleaseRecord=currentRelease,void 0):Q.reject("This project has no releases.")}),me._loadProjectsWithTeamMembers().then(function(projectsWithTeamMembers){me.ProjectsWithTeamMembers=projectsWithTeamMembers,me.ProjectNames=_.map(projectsWithTeamMembers,function(project){return{Name:project.data.Name}})})])}).then(function(){return me._reloadEverything()}).fail(function(reason){me.setLoading(!1),me._alert("ERROR",reason||"")}).done(),void 0):(me.setLoading(!1),me._alert("ERROR","You do not have permissions to edit this project"),void 0)},_releasePickerSelected:function(combo,records){var me=this,pid=me.ProjectRecord.data.ObjectID;me.ReleaseRecord.data.Name!==records[0].data.Name&&(me.setLoading("Saving Preference"),me.ReleaseRecord=_.find(me.ReleaseRecords,function(rr){return rr.data.Name==records[0].data.Name}),"object"!=typeof me.AppsPref.projs[pid]&&(me.AppsPref.projs[pid]={}),me.AppsPref.projs[pid].Release=me.ReleaseRecord.data.ObjectID,me._saveAppsPreference(me.AppsPref).then(function(){me._reloadEverything()}).done())},_loadReleasePicker:function(){var me=this;me.ReleasePicker=me.down("#navboxLeftVert").add({xtype:"intelreleasepicker",id:"releasePicker",labelWidth:70,width:250,releases:me.ReleaseRecords,currentRelease:me.ReleaseRecord,listeners:{select:me._releasePickerSelected.bind(me)}})},_loadRisksSwimlanes:function(){var me=this,customStore=Ext.create("Ext.data.Store",{data:me.Risks,sorters:[{property:Rally.data.Ranker.RANK_FIELDS.MANUAL,direction:"ASC"}],model:"IntelSwimlaneRiskForTracking",proxy:{type:"sessionstorage",id:"Risk-Swimlane-"+(1e6*Math.random()>>0)},reloadRecord:function(record){return"string"==typeof record?Deft.Promise.when(this.getById(record)):Deft.Promise.when(record)}});_.each(customStore.getRange(),function(model){model.setProxy(model.store.proxy)}),me.RiskSwimlanes=me.add({xtype:"rallycardboard",id:"risk-swimlanes",models:[Ext.ClassManager.get("IntelSwimlaneRiskForTracking")],plugins:[{ptype:"rallyscrollablecardboard",containerEl:this.getEl()},{ptype:"rallyfixedheadercardboard"}],shouldRetrieveModels:function(){return!1},addRow:function(item,applySort){var value=item.isModel?item.getData():item;return this._createRow({showHeader:!0,value:item.Urgency},applySort)},_refreshAssociatedCards:function(record,changedFields){this.refreshCard(record.getId())},attribute:"Status",enableRanking:!0,cardConfig:{xtype:"rallycard",fields:["PortfolioItem #","PortfolioItem Name","Project","Contact","Checkpoint","Risk Description","Impact","MitigationPlan"],showGearIcon:!1},rowConfig:{field:"Urgency",values:["1-Hot","2-Watch","3-Simmer","Undefined"],enableCrossRowDragging:!0},store:customStore,columns:_.map(["Undefined","Resolved","Owned","Accepted","Mitigated"],function(status){return{xtype:"rallycardboardcolumn",value:status,columnHeaderConfig:{headerTpl:status},_queryForData:function(){var me=this;this.store=this.ownerCardboard.store,this.fireEvent("storeload",this.store,this.store.getRange(),!0),setTimeout(function(){me._createAndAddCardsFromStore(me.store)},100)}}}),listeners:{cardupdated:function(card){var cardID=card.record.data.RiskID;window[cardID]||(window[cardID]=!0,setTimeout(function(){window[cardID]=!1},100),me._saveRisk(card.record.data))}}})}})})();

            Rally.launchApp('RiskSwimlane', {
                name:"Risk Swimlane",
	            parentRepos:""
            });

        });
    </script>

    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>

    <style type="text/css">
        .x-grid-cell.intel-editor-cell *,.x4-grid-cell.intel-editor-cell *,.intel-editor-cell{cursor:pointer !important}.fa.fa-md{font-size:1.05rem;line-height:.75em;vertical-align:-15%}
    </style>
    <style type="text/css">
        .x-grid-cell.manager-expected-cell{background-image:-o-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-moz-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-webkit-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-ms-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:linear-gradient(to right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-size:100% 30px;background-repeat:no-repeat}.x-grid-cell.manager-expected-cell-small{background-image:-o-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-moz-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-webkit-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-ms-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:linear-gradient(to right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-size:100% 20px;background-repeat:no-repeat}.x-grid-cell.manager-comment-cell-small{background-image:-o-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%) !important;background-image:-moz-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%) !important;background-image:-webkit-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%) !important;background-image:-ms-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%) !important;background-image:linear-gradient(to left top, rgba(0,0,0,0) 75%, #4c4cff 75%) !important;background-size:100% 20px;background-repeat:no-repeat}.x-grid-cell.manager-expected-comment-cell-small{background-image:-o-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%),-o-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-moz-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%),-moz-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-webkit-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%),-webkit-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:-ms-linear-gradient(left top, rgba(0,0,0,0) 75%, #4c4cff 75%),-ms-linear-gradient(right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-image:linear-gradient(to left top, rgba(0,0,0,0) 75%, #4c4cff 75%),linear-gradient(to right top, rgba(0,0,0,0) 75%, #fbff00 75%) !important;background-size:100% 20px;background-repeat:no-repeat}.x-grid-cell.intel-team-commits-RED{background-color:rgba(255,0,0,0.5) !important}.x-grid-row-selected .x-grid-cell.intel-team-commits-RED,.x-grid-row-over .x-grid-cell.intel-team-commits-RED{background-color:rgba(255,0,0,0.7) !important}.x-grid-cell.intel-team-commits-GREEN{background-color:rgba(0,255,0,0.5) !important}.x-grid-row-selected .x-grid-cell.intel-team-commits-GREEN,.x-grid-row-over .x-grid-cell.intel-team-commits-GREEN{background-color:rgba(0,255,0,0.7) !important}.x-grid-cell.intel-team-commits-GREY{background-color:rgba(183,183,183,0.5) !important}.x-grid-row-selected .x-grid-cell.intel-team-commits-GREY,.x-grid-row-over .x-grid-cell.intel-team-commits-GREY{background-color:rgba(183,183,183,0.7) !important}
    </style>
    <style type="text/css">
        .moscow-cell{padding-left:20px}.must-have{background-image:-o-linear-gradient(left, rgba(0,0,0,0) 85%, #ffdb99 85%) !important;background-image:-moz-linear-gradient(left, rgba(0,0,0,0) 85%, #ffdb99 85%) !important;background-image:-webkit-linear-gradient(left, rgba(0,0,0,0) 85%, #ffdb99 85%) !important;background-image:-ms-linear-gradient(rleft, rgba(0,0,0,0) 85%, #ffdb99 85%) !important;background-image:linear-gradient(to left, rgba(0,0,0,0) 85%, #ffdb99 85%) !important;background-size:100% 20px;background-repeat:repeat-y}.should-have{background-image:-o-linear-gradient(left, rgba(0,0,0,0) 85%, #ffa500 85%) !important;background-image:-moz-linear-gradient(left, rgba(0,0,0,0) 85%, #ffa500 85%) !important;background-image:-webkit-linear-gradient(left, rgba(0,0,0,0) 85%, #ffa500 85%) !important;background-image:-ms-linear-gradient(rleft, rgba(0,0,0,0) 85%, #ffa500 85%) !important;background-image:linear-gradient(to left, rgba(0,0,0,0) 85%, #ffa500 85%) !important;background-size:100% 20px;background-repeat:repeat-y}.could-have{background-image:-o-linear-gradient(left, rgba(0,0,0,0) 85%, #cc8400 85%) !important;background-image:-moz-linear-gradient(left, rgba(0,0,0,0) 85%, #cc8400 85%) !important;background-image:-webkit-linear-gradient(left, rgba(0,0,0,0) 85%, #cc8400 85%) !important;background-image:-ms-linear-gradient(rleft, rgba(0,0,0,0) 85%, #cc8400 85%) !important;background-image:linear-gradient(to left, rgba(0,0,0,0) 85%, #cc8400 85%) !important;background-size:100% 20px;background-repeat:repeat-y}.wont-have{background-image:-o-linear-gradient(left, rgba(0,0,0,0) 85%, rgba(255,0,0,0.5) 85%) !important;background-image:-moz-linear-gradient(left, rgba(0,0,0,0) 85%, rgba(255,0,0,0.5) 85%) !important;background-image:-webkit-linear-gradient(left, rgba(0,0,0,0) 85%, rgba(255,0,0,0.5) 85%) !important;background-image:-ms-linear-gradient(rleft, rgba(0,0,0,0) 85%, rgba(255,0,0,0.5) 85%) !important;background-image:linear-gradient(to left, rgba(0,0,0,0) 85%, rgba(255,0,0,0.5) 85%) !important;background-size:100% 20px;background-repeat:repeat-y}
    </style>
    <style type="text/css">
        #navbar{padding:0 10px 10px 10px}#releasePicker{margin:4px 0 0 0}.RiskSwimlaneApp,.RiskSwimlaneApp>div,.RiskSwimlaneApp>div>div{height:100%}.rui-card .rui-card-right-side{display:none}.rui-card .rui-field-label{font-weight:bold}.rui-card .rui-field-value{display:inline !important}
    </style>
</head>
<body>
</body>
</html>
